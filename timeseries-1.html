<!DOCTYPE html>
<html lang="fr">

<head>
<title>Les s√©ries temporelles avec Python (1/4) - Introduction</title>    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="Le blog statistiques et data science de la coop√©rative Statoscop" />
  <meta name="author" content="" />

  <!-- Font Awesome icons (free version)-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <!-- Google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />



  <!-- <title>Le blog de Statoscop - √©tudes de cas en R et Python</title> -->
  <link rel="icon" type="image/x-icon" href="https://blog.statoscop.fr/themes/statoscop/static/images/favicon-v1.ico" />


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://blog.statoscop.fr/timeseries-1.html" rel="canonical" />
  <!-- Feed -->
        <link href="https://blog.statoscop.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Le blog Full Atom Feed" />
          <link href="https://blog.statoscop.fr/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="Le blog Categories Atom Feed" />
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://blog.statoscop.fr/themes/statoscop/static/css/styles-v1.css" type="text/css" rel="stylesheet" /> 
  <link href="https://blog.statoscop.fr/themes/statoscop/static/css/style-blog.css" type="text/css" rel="stylesheet" /> 
  <!-- Code highlight color scheme -->
      <link href="https://blog.statoscop.fr/themes/statoscop/static/css/code_blocks/github.css" rel="stylesheet">

  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!-- [if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  ![endif] -->



    <meta name="description" content="Introduction √† la manipulation de donn√©es temporelles avec Python">

    <meta name="author" content="Louis">

    <meta name="tags" content="Python">
    <meta name="tags" content="Machine Learning">
    <meta name="tags" content="Statistiques">
    <meta name="tags" content="Data Science">
    <meta name="tags" content="S√©ries temporelles">
    <meta name="tags" content="Datetime">




<!-- Open Graph -->
<meta property="og:site_name" content="Le blog"/>
<meta property="og:title" content="Les s√©ries temporelles avec Python (1/4) - Introduction"/>
<meta property="og:description" content="Introduction √† la manipulation de donn√©es temporelles avec Python"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://blog.statoscop.fr/timeseries-1.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2021-05-04 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://blog.statoscop.fr/author/louis.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="Python"/>
<meta property="article:tag" content="Machine Learning"/>
<meta property="article:tag" content="Statistiques"/>
<meta property="article:tag" content="Data Science"/>
<meta property="article:tag" content="S√©ries temporelles"/>
<meta property="article:tag" content="Datetime"/>
<meta property="og:image" content="https://blog.statoscop.fr/images/cover_3.png">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Les s√©ries temporelles avec Python (1/4) - Introduction",
  "headline": "Les s√©ries temporelles avec Python (1/4) - Introduction",
  "datePublished": "2021-05-04 00:00:00+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Louis",
    "url": "https://blog.statoscop.fr/author/louis.html"
  },
  "image": "https://blog.statoscop.fr/images/cover_3.png",
  "url": "https://blog.statoscop.fr/timeseries-1.html",
  "description": "Introduction √† la manipulation de donn√©es temporelles avec Python"
}
</script>
  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.statoscop.fr/matomo/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->

  

</head>
<!-- TODO : Body class -->
  <body id="page-top">
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container">

        <a class="navbar-brand" href="https://statoscop.fr"><img src="https://blog.statoscop.fr/themes/statoscop/static/images/logo-statoscop-v1.png" alt="Statoscop.logo"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav text-uppercase ml-auto">
              <li class="nav-item font-weight-bold">
                  <a class="nav-link js-scroll-trigger " href="https://statoscop.fr"> Accueil </a>
              </li>
              <li class="nav-item font-weight-bold">
                  <a class="nav-link js-scroll-trigger " href="https://statoscop.fr/about"> √Ä propos </a>
              </li>
              <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle font-weight-bold "
                  id="navbarDropdownMenuLink" aria-haspopup="true" aria-expanded="false"> Prestations </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                      <li><a class="dropdown-item" href="https://statoscop.fr/etudes">Conseils & √©tudes statistiques</a></li>
                      <li><a class="dropdown-item" href="https://statoscop.fr/recodages">Migrations de code & Recodages</a></li>
                      <li><a class="dropdown-item" href="https://statoscop.fr/formations">Formations</a></li>
                      <li><a class="dropdown-item" href="https://statoscop.fr/applis">Dashboards & Applications</a></li>
                  </ul>
              </li>
              <li class="nav-item font-weight-bold">
                  <a class="nav-link js-scroll-trigger " href="https://statoscop.fr/contact">Contact</a>
              </li>
              <li class="nav-item font-weight-bold">
                  <a class="nav-link js-scroll-trigger active" href="https://blog.statoscop.fr/">Le blog</a>
              </li>
          </ul>
      </div>
      </div>
    </nav>
    


    <!-- Post content -->
    <main class="content" role="main">
      
      <div>
      </div>

      <article class="post">
        <div class="inner">




            <section class="post-content">
              <h1 class="post-title">Les s√©ries temporelles avec Python (1/4) - Introduction</h1>
                <!-- Le titres et meta infos-->
                <span class="post-meta">
                        <a href="https://blog.statoscop.fr/author/louis.html">Louis</a>
                    | <time datetime="mar. 04 mai 2021">mar. 04 mai 2021</time>
                </span>

                <!--Table des matieres
-->
                
                <div class="toc"><span class="toctitle">Dans cet article</span><ul>
<li><a href="#les-dates-et-heures-avec-python">Les dates (et heures) avec Python</a><ul>
<li><a href="#les-packages-datetime-and-dateutil">Les packages datetime and dateutil</a></li>
<li><a href="#le-type-de-donnees-date-des-tableaux-numpy-datetime64">Le type de donn√©es date des tableaux numpy : datetime64</a></li>
<li><a href="#dates-et-times-avec-pandas-le-meilleur-des-2-mondes">Dates et times avec pandas: le meilleur des 2 mondes</a></li>
</ul>
</li>
<li><a href="#series-temporelles-avec-pandas">S√©ries temporelles avec pandas</a><ul>
<li><a href="#lindexation-par-le-temps">L'indexation par le temps</a></li>
<li><a href="#les-structures-de-donnees-pandas-pour-les-series-temporelles">Les structures de donn√©es pandas pour les s√©ries temporelles</a></li>
<li><a href="#les-sequences-avec-pddate_range">Les s√©quences avec pd.date_range()</a></li>
<li><a href="#frequences-et-decalages-offset">Fr√©quences et d√©calages (offset)</a></li>
</ul>
</li>
</ul>
</div>
<p>Cet article introductif est le premier d'une s√©quence de 4 posts sur les s√©ries temporelles.   </p>
<ol>
<li><strong>Introduction √† la manipulation de donn√©es temporelles avec Python</strong></li>
<li>Visualisations et op√©rations sur les s√©ries temporelles</li>
<li>√âl√©ments th√©oriques et exemples</li>
<li>Analyse, mod√©lisation et pr√©diction</li>
</ol>
<p>Avant d'entrer dans le vif du sujet, nous allons donc nous pencher sur le fonctionnement, le stockage et la manipulation des donn√©es temporelles avec Python.  </p>
<p>La libraire <code>Pandas</code> a √©t√© d√©velopp√©e dans un contexte de donn√©es financi√®res et son nom est une contraction de <em>Panel Datas</em> (donn√©es de panel), c'est-√†-dire des donn√©es pour lesquelles on a, pour un m√™me individu, des observations au cours du temps. <code>Pandas</code> contient donc par essence de nombreux outils pour travailler avec les dates, le temps et des donn√©es index√©es en fonction du temps.</p>
<blockquote>
<p><em>"Une s√©rie temporelle, ou s√©rie chronologique, est une suite de valeurs num√©riques repr√©sentant l'√©volution d'une quantit√© sp√©cifique au cours du temps."</em><br>
<a href="https://fr.wikipedia.org/wiki/S%C3%A9rie_temporelle" target="_blank">Ma√Ætre Wiki</a></p>
</blockquote>
<p>Une s√©rie temporelle peut √™tre vue comme un cas tr√®s particulier des donn√©es panel puisqu'il s'agit de l'√©volution d'une seule observation au cours du temps.</p>
<p>Nous allons donc nous int√©resser √† ces donn√©es temporelles et pour commencer, un peu de vocabulaire et d'anglicisme :<br>
- <strong>Timestamps</strong> correspond √† un moment pr√©cis (par exemple <em>03 juin 2020, 14:15:16</em>)<br>
- <strong>Time intervals</strong> et <strong>periods</strong> correspondent √† une dur√©e ayant des dates de d√©but et de fin pr√©cises (par exemple, <em>l'ann√©e 2020</em>)<br>
- <strong>Time deltas</strong> ou <strong>durations</strong> correspondent √† une dur√©e exacte (par exemple <em>123.45 secondes</em>)  </p>
<p>On va voir comment utiliser et manipuler ces objets date/time avec Python d'une part, puis avec <code>Pandas</code> plus particuli√®rement.</p>
<h1 id="les-dates-et-heures-avec-python">Les dates (et heures) avec Python</h1>
<p>Python a de nombreuses repr√©sentations et formats possibles des dates, heures, dur√©es...un petit tour d'horizon s'impose.</p>
<h2 id="les-packages-datetime-and-dateutil">Les packages <code>datetime</code> and <code>dateutil</code></h2>
<p>Les objet natifs Python pour les dates/times sont dans le module built-in <code>datetime</code>. En utilisant √©galement le package <code>dateutil</code>, on peut facilement et rapidement effectuer bon nombre d'op√©rations sur objets temporels.</p>
<p>Par exemple, on peut construire une date manuellement.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>datetime.datetime(2021, 4, 30, 0, 0)
</code></pre></div>

<p>Ou avec le module <code>dateutil</code>, on peut lire diff√©rents format de dates √† partir de cha√Ænes de caract√®res.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;30 of April, 2021, 14:00&quot;</span><span class="p">)</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;30/04/2021 14:15:16&quot;</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d1</span><span class="p">,</span> <span class="n">d2</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>(datetime.datetime(2021, 4, 30, 14, 0),
 datetime.datetime(2021, 4, 30, 14, 15, 16))
</code></pre></div>

<p>Une fois qu'on manipule un objet <code>datetime</code>, on peut facilement effectuer des op√©rations sur cet objet. Par exemple, r√©cup√©rer en cha√Æne de caract√®res le jour de la semaine correspondant, le mois, l'ann√©e, etc...</p>
<p>Pour en savoir plus sur <code>strftime</code> et les codes standards de format de string pour afficher les dates ce sera dans la <a href="https://docs.python.org/3/library/datetime.html#strftime-and-strptime-behavior" target="_blank">section strftime</a> de la doc Python <a href="https://docs.python.org/3/library/datetime.html" target="_blank">datetime</a>.
Une autre aide utile sur les manipulation de dates est la <a href="http://labix.org/python-dateutil" target="_blank">documentation en ligne de dateutil</a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">),</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B&quot;</span><span class="p">),</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>(&#39;Friday&#39;, &#39;Fri&#39;, &#39;30&#39;, &#39;April&#39;, &#39;2021&#39;)
</code></pre></div>

<p><strong>√Ä savoir</strong> : il existe un package utile <a href="http://pytz.sourceforge.net/" target="_blank"><code>pytz</code></a> contenant des outils pour pouvoir travailler avec les <em>timezones</em>.</p>
<p>L'int√©r√™t de <code>datetime</code> et <code>dateutil</code> est leur flexibilit√© et leur facilit√© d'utilisation/syntaxe : on peut faire plus ou moins tout ce qu'on veut en utilisant les objets <code>datetime</code> et leurs m√©thodes built-in.</p>
<p>Un b√©mol c'est la gestion des grandes quantit√©s de donn√©es : de la m√™me mani√®re que les listes num√©riques ne sont pas optimales compar√©es √† des arrays <code>numpy</code> de type num√©rique, les listes d'objets <code>datetime</code> ne sont pas optimales compar√©es √† des tableaux ayant un type date/time.</p>
<h2 id="le-type-de-donnees-date-des-tableaux-numpy-datetime64">Le type de donn√©es date des tableaux numpy : <code>datetime64</code></h2>
<p>Pour pallier cet √©cueil, un type de donn√©es temporelles natif a √©t√© ajout√© √† <code>numpy</code>. Le dtype <code>datetime64</code> encode les dates sous forme d'entiers 64-bits et par cons√©quent les tableaux ayant des donn√©es de ce type sont tr√®s compacts (pour rappel, un tableau numpy ne peut contenir qu'un seul type de donn√©es).</p>
<p>Le dtype <code>datetime64</code> n√©cessite toutefois un format particulier comme par exemple <code>"YYYY-MM-DD"</code> ou <code>"YYYY-MM"</code>. D'autre √©l√©ments peuvent √™tre pr√©cis√©s et pour en savoir plus, c'est <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html" target="_blank">sur la documentation numpy</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
<span class="n">date</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">array</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[D]&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Une fois qu'on a une date dans le bon format, on peut facilement effectuer des op√©rations vectorielles dessus :</p>
<div class="highlight"><pre><span></span><code><span class="n">date</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">array</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-01&#39;, &#39;2021-05-02&#39;, &#39;2021-05-03&#39;,</span>
<span class="n">       &#39;2021-05-04&#39;, &#39;2021-05-05&#39;, &#39;2021-05-06&#39;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[D]&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Gr√¢ce au type de donn√©es uniforme dans les tableaux <code>datetime64</code>, ce genre d'op√©rations vectorielles peut √™tre effectu√© bien plus rapidement qu'en travaillant directement avec les objets <code>datetime</code> de Python, particuli√®rement pour de grands tableaux.</p>
<p>Une particularit√© des objets <code>datetime64</code> et <code>timedelta64</code> est qu'ils sont construits sur une <em>unit√© fondamentale de temps (UFT)</em>. Comme le <code>datetime64</code> est limit√© √† une pr√©cision de 64-bit, le nombre de datetime qu'on peut encoder est <span class="math">\(2^{64}\)</span> fois l'UFT. En d'autres termes, <code>datetime64</code> n√©cessite un arbitrage entre <em>r√©solution temporelle</em> et <em>intervalle maximal de temps</em> .<br>
Par exemple, si on veut une pr√©cision de 1 nanoseconde, alors on pourra avoir la place pour encoder <span class="math">\(2^{64}\)</span> nanosecondes, soit un peu moins de 600 ans.</p>
<p><code>numpy</code> d√©duit l'UFT d√©sir√©e √† partir de l'input mais on peut bien s√ªr aussi le sp√©cifier.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># un datetime bas√© sur le jour</span>
<span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>numpy.datetime64(&#39;2021-04-30&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># un datetime bas√© sur la minute</span>
<span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-04-30 14:15&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>numpy.datetime64(&#39;2021-04-30T14:15&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># un datetime bas√© sur la nanoseconde en fixant l&#39;unit√© fondamentale de temps</span>
<span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="s1">&#39;2021-04-30 14:15:16&#39;</span><span class="p">,</span> <span class="s1">&#39;ns&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>numpy.datetime64(&#39;2021-04-30T14:15:16.000000000&#39;)
</code></pre></div>

<p>√Ä noter aussi, la timezone est par d√©faut celle de l'ordinateur qui ex√©cute le code.</p>
<p>Le tableau suivant issu de <a href="http://docs.scipy.org/doc/numpy/reference/arrays.datetime.html" target="_blank">la documentation numpy de datetime64</a> liste les codes disponibles ainsi que les √©chelles relatives et absolues qu'ils permettent d'encoder.</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Signification</th>
<th>Dur√©e relative</th>
<th>Dur√©e absolue</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Y</code></td>
<td>Year</td>
<td>¬± 9.2e18 ans</td>
<td>[9.2e18 av.J-C, 9.2e18]</td>
</tr>
<tr>
<td><code>M</code></td>
<td>Month</td>
<td>¬± 7.6e17 ans</td>
<td>[7.6e17 av.J-C, 7.6e17]</td>
</tr>
<tr>
<td><code>W</code></td>
<td>Week</td>
<td>¬± 1.7e17 ans</td>
<td>[1.7e17 av.J-C, 1.7e17]</td>
</tr>
<tr>
<td><code>D</code></td>
<td>Day</td>
<td>¬± 2.5e16 ans</td>
<td>[2.5e16 av.J-C, 2.5e16]</td>
</tr>
<tr>
<td><code>h</code></td>
<td>Hour</td>
<td>¬± 1.0e15 ans</td>
<td>[1.0e15 av.J-C, 1.0e15]</td>
</tr>
<tr>
<td><code>m</code></td>
<td>Minute</td>
<td>¬± 1.7e13 ans</td>
<td>[1.7e13 av.J-C, 1.7e13]</td>
</tr>
<tr>
<td><code>s</code></td>
<td>Second</td>
<td>¬± 2.9e12 ans</td>
<td>[ 2.9e9 av.J-C, 2.9e9]</td>
</tr>
<tr>
<td><code>ms</code></td>
<td>Millisecond</td>
<td>¬± 2.9e9 ans</td>
<td>[ 2.9e6 av.J-C, 2.9e6]</td>
</tr>
<tr>
<td><code>us</code></td>
<td>Microsecond</td>
<td>¬± 2.9e6 ans</td>
<td>[290301 av.J-C, 294241]</td>
</tr>
<tr>
<td><code>ns</code></td>
<td>Nanosecond</td>
<td>¬± 292 ans</td>
<td>[ 1678, 2262]</td>
</tr>
<tr>
<td><code>ps</code></td>
<td>Picosecond</td>
<td>¬± 106 jours</td>
<td>[ 1969, 1970]</td>
</tr>
<tr>
<td><code>fs</code></td>
<td>Femtosecond</td>
<td>¬± 2.6 heures</td>
<td>[ 1969, 1970]</td>
</tr>
<tr>
<td><code>as</code></td>
<td>Attosecond</td>
<td>¬± 9.2 secondes</td>
<td>[ 1969, 1970]</td>
</tr>
</tbody>
</table>
<p>Dans la "vraie vie", on utilise g√©n√©ralement <code>datetime64[ns]</code> car cela permet d'encoder une √©chelle de temps avec des dates actuelles et une pr√©cision suffisament fine.</p>
<p>Finalement, on retiendra que le type <code>datetime64</code> r√®gle certains d√©fauts du type built-in de Python <code>datetime</code>, cependant il manque plusieurs des m√©thodes et fonctions bien utiles fournies par <code>datetime</code> et surtout <code>dateutil</code>.</p>
<h2 id="dates-et-times-avec-pandas-le-meilleur-des-2-mondes">Dates et times avec <code>pandas</code>: le meilleur des 2 mondes</h2>
<p><code>Pandas</code> se base sur les outils vus √† l'instant pour fournir un objet <code>Timestamp</code> qui combine la facilit√© d'utilisation de <code>datetime</code>/<code>dateutil</code> avec l'efficacit√© de stockage et de calcul vectoriel de<code>numpy.datetime64</code>.</p>
<p>√Ä partir de ces objets <code>Timestamp</code>, <code>Pandas</code> peut construire une index <code>DatetimeIndex</code> qu'on peut utiliser pour indexer les donn√©es d'une <code>Series</code> ou d'un <code>DataFrame</code>.</p>
<p>Par exemple, on peut utiliser les outils de <code>Pandas</code> pour refaire les op√©rations qu'on a fait juste avant, √† savoir: lire une cha√Æne de caract√®res contenant un format de date flexible, utiliser les codes de format pour r√©cup√©rer le jour de la semaine ou encore effectuer des op√©rations vectorielles comme avec <code>numpy</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;30 of April, 2021&quot;</span><span class="p">)</span>
<span class="n">date</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>Timestamp(&#39;2021-04-30 00:00:00&#39;)
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%A&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>&#39;Friday&#39;
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">day_name</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">month_name</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">30</span><span class="w"> </span><span class="n">Friday</span>
<span class="mf">2021</span>
<span class="mf">4</span><span class="w"> </span><span class="n">April</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="c1"># √† noter ici l&#39;utilisation de to_timedelta pour transformer </span>
<span class="c1"># le tableau d&#39;entiers en tableau de dur√©es</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-01&#39;, &#39;2021-05-02&#39;, &#39;2021-05-03&#39;,</span>
<span class="n">               &#39;2021-05-04&#39;, &#39;2021-05-05&#39;, &#39;2021-05-06&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># ici on cr√©e une liste d&#39;entier entre 0 et 24 avec un intervalle de 6 </span>
<span class="c1"># que l&#39;on transforme en dur√©e en heures avant de les ajouter √† notre timestamp</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;30 of April, 2021, 14:00&quot;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30 14:00:00&#39;, &#39;2021-04-30 20:00:00&#39;,</span>
<span class="n">               &#39;2021-05-01 02:00:00&#39;, &#39;2021-05-01 08:00:00&#39;,</span>
<span class="n">               &#39;2021-05-01 14:00:00&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># un dernier exemple avant le suivant</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;30 of April, 2021, 14:00&quot;</span><span class="p">)</span>
<span class="n">d</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30 14:20:00&#39;, &#39;2021-04-30 14:30:00&#39;,</span>
<span class="n">               &#39;2021-04-30 14:40:00&#39;, &#39;2021-04-30 14:50:00&#39;,</span>
<span class="n">               &#39;2021-04-30 15:00:00&#39;, &#39;2021-04-30 15:10:00&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?</p>
</blockquote>
<div class = "d-flex justify-content-center mt-4">
   <a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button">Visiter notre site</a>
   <a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button">Nous contacter</a>
</div>
<p><br>    </p>
<h1 id="series-temporelles-avec-pandas">S√©ries temporelles avec <code>pandas</code></h1>
<h2 id="lindexation-par-le-temps">L'indexation par le temps</h2>
<p>L'int√©r√™t des time series de <code>pandas</code> r√©side dans l'utilisation d'une indexation des donn√©es par des <em>timestamps</em>. On cr√©e donc un objet <code>DatetimeIndex</code> pour ensuite indexer la s√©rie.</p>
<div class="highlight"><pre><span></span><code><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">([</span><span class="s1">&#39;2020-03-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-04-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-03-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-04-30&#39;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">0</span>
<span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">1</span>
<span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">2</span>
<span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">3</span>
<span class="w"> </span><span class="nl">dtype</span><span class="p">:</span><span class="w"> </span><span class="n">int64</span><span class="p">,</span>
<span class="w"> </span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2020-03-30&#39;, &#39;2020-04-30&#39;, &#39;2021-03-30&#39;, &#39;2021-04-30&#39;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">))</span>
</code></pre></div>

<p>Une fois qu'on a une <code>Series</code>, on peut utiliser les index datetime comme pour n'importe quel autre index et notamment avoir recours au <em>slicing</em>.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="p">[</span><span class="s1">&#39;2020-03-30&#39;</span><span class="p">:</span><span class="s1">&#39;2021-03-30&#39;</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="mf">2020</span><span class="o">-</span><span class="mf">03</span><span class="o">-</span><span class="mf">30</span><span class="w">    </span><span class="mf">0</span>
<span class="mf">2020</span><span class="o">-</span><span class="mf">04</span><span class="o">-</span><span class="mf">30</span><span class="w">    </span><span class="mf">1</span>
<span class="mf">2021</span><span class="o">-</span><span class="mf">03</span><span class="o">-</span><span class="mf">30</span><span class="w">    </span><span class="mf">2</span>
<span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="mf">64</span>
</code></pre></div>

<p>Par ailleurs certaines op√©rations sp√©cifiques aux <code>DatetimeIndex</code> permettent d'obtenir des slicing diff√©rents comme par exemple utiliser une ann√©e pour r√©cup√©rer toutes les observations de cette ann√©e ou un date seuil pour r√©cup√©rer toutes les donn√©es avant/apr√®s cette date.</p>
<div class="highlight"><pre><span></span><code><span class="n">data</span><span class="p">[</span><span class="s1">&#39;2020&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;2020-04&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;2020-05-01&#39;</span><span class="p">:]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="mi">2020</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">0</span>
<span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">1</span>
<span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span><span class="p">,</span>
<span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">1</span>
<span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span><span class="p">,</span>
<span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">2</span>
<span class="w"> </span><span class="mi">2021</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">30</span><span class="w">    </span><span class="mi">3</span>
<span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span><span class="p">)</span>
</code></pre></div>

<h2 id="les-structures-de-donnees-pandas-pour-les-series-temporelles">Les structures de donn√©es <code>pandas</code> pour les s√©ries temporelles</h2>
<p>Nous allons maintenant introduire les structures de donn√©es fondamentales de <code>pandas</code> pour travailler avec les s√©ries temporelles :<br>
1. pour les <em>timestamps</em>, il y a le type <code>Timestamp</code> : l'id√©e est que √ßa remplace le type natif de Python <code>datetime</code> tout en √©tant construit sur le type <code>numpy.datetime64</code> qui est plus efficace<br>
2. pour les <em>time Periods</em>, il y a le type <code>Period</code> : il permet d'encoder des dur√©es de fr√©quences fixes bas√©es sur <code>numpy.datetime64</code><br>
3. pour les <em>time deltas</em> ou <em>durations</em>, il y a le type<code>Timedelta</code> : c'est un rempla√ßant plus efficace du type natif de Python <code>datetime.timedelta</code> bas√© sur <code>numpy.timedelta64</code>  </p>
<p>Les structures d'index associ√©es sont respectivement les <code>DatetimeIndex</code>, <code>PeriodIndex</code> et <code>TimedeltaIndex</code>. On retiendra que parmi ces diff√©rents objets, les structures de date/time les plus utilis√©es sont les <code>Timestamp</code> et <code>DatetimeIndex</code>.</p>
<p>M√™me si on peut tr√®s bien appeler ces classes d'objets directement, g√©n√©ralement on passe par la fonction <code>pd.to_datetime()</code> qui permet de lire une grande vari√©t√© de formats de cha√Æne de caract√®res. Si on passe une seule date √† <code>pd.to_datetime()</code>, on obtient un <code>Timestamp</code>. Si on lui passe une s√©rie de dates, on obtient un <code>DatetimeIndex</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="s1">&#39;6th of May, 2021&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-Jun-7&#39;</span><span class="p">,</span> <span class="s1">&#39;06-10-2021&#39;</span><span class="p">,</span> <span class="s1">&#39;20210429&#39;</span><span class="p">])</span>
<span class="n">dates</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-06&#39;, &#39;2021-06-07&#39;, &#39;2021-06-10&#39;,</span>
<span class="n">               &#39;2021-04-29&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<p>Tout objet <code>DatetimeIndex</code> peut √™tre converti en <code>PeriodIndex</code> avec la fonction <code>to_period()</code> en ajoutant un code de fr√©quence (par exemple <code>'D'</code> pour une fr√©quence quotidienne ou <code>'M'</code> pour une fr√©quence mensuelle) :</p>
<div class="highlight"><pre><span></span><code><span class="n">dates</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">PeriodIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04&#39;, &#39;2021-05&#39;, &#39;2021-06&#39;, &#39;2021-06&#39;, &#39;2021-04&#39;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">dates</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">PeriodIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-06&#39;, &#39;2021-06-07&#39;, &#39;2021-06-10&#39;,</span>
<span class="n">             &#39;2021-04-29&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[D]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Enfin, un objet <code>TimedeltaIndex</code> peut √™tre par exemple cr√©√© lorsqu'on soustrait 2 dates :</p>
<div class="highlight"><pre><span></span><code><span class="n">dates</span> <span class="o">-</span> <span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">TimedeltaIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;-6 days&#39;, &#39;0 days&#39;, &#39;32 days&#39;, &#39;35 days&#39;, &#39;-7 days&#39;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;timedelta64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="k">None</span><span class="p">)</span>
</code></pre></div>

<h2 id="les-sequences-avec-pddate_range">Les s√©quences avec <code>pd.date_range()</code></h2>
<p>Pour pouvoir cr√©er des s√©quences r√©guli√®res de dates, <code>pandas</code> contient un certain nombre de fonctions : <code>pd.date_range()</code>, <code>pd.period_range()</code> et <code>pd.timedelta_range()</code>.
Les <code>range()</code> de Python et <code>arange()</code> de numpy prennent comme param√®tres un premier √©l√©ment, un dernier √©l√©ment (non-inclus) et √©ventuellement un pas.<br>
De la m√™me mani√®re, <code>pd.date_range()</code> prend une date de d√©part, une date de fin (qui elle est inclue !) et √©ventuellement une fr√©quence (qui vaut 1 jour par d√©faut).</p>
<div class="highlight"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-05-06&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-01&#39;, &#39;2021-05-02&#39;, &#39;2021-05-03&#39;,</span>
<span class="n">               &#39;2021-05-04&#39;, &#39;2021-05-05&#39;, &#39;2021-05-06&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</code></pre></div>

<p>On peut aussi sp√©cifier simplement un point de d√©part et un nombre de Periods et on peut utiliser <code>freq</code> pour modifier la fr√©quence.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pour avoir 8 timestamps chacune correspondant √† un jour √† partir d&#39;aujourd&#39;hui</span>
<span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-01&#39;, &#39;2021-05-02&#39;, &#39;2021-05-03&#39;,</span>
<span class="n">               &#39;2021-05-04&#39;, &#39;2021-05-05&#39;, &#39;2021-05-06&#39;, &#39;2021-05-07&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># pour avoir 4 timestamps chacune correspondant √† un d√©calage de 2 heures √† partir d&#39;aujourd&#39;hui 14h</span>
<span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2021-04-30 14h&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2H&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30 14:00:00&#39;, &#39;2021-04-30 16:00:00&#39;,</span>
<span class="n">               &#39;2021-04-30 18:00:00&#39;, &#39;2021-04-30 20:00:00&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2H&#39;</span><span class="p">)</span>
</code></pre></div>

<p>N'h√©sitez pas √† jeter un oeil √† <code>pd.period_range()</code> et <code>pd.timedelta_range()</code> qui fonctionnent de mani√®re similaire.</p>
<div class="highlight"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s1">&#39;2021-04&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">PeriodIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2020-06&#39;, &#39;2020-07&#39;, &#39;2020-08&#39;, &#39;2020-09&#39;, &#39;2020-10&#39;, &#39;2020-11&#39;,</span>
<span class="n">             &#39;2020-12&#39;, &#39;2021-01&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">            </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;period[M]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">timedelta_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">TimedeltaIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;00:00:00&#39;, &#39;01:00:00&#39;, &#39;02:00:00&#39;, &#39;03:00:00&#39;, &#39;04:00:00&#39;,</span>
<span class="n">                &#39;05:00:00&#39;, &#39;06:00:00&#39;, &#39;07:00:00&#39;, &#39;08:00:00&#39;, &#39;09:00:00&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">               </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;timedelta64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Vous l'aurez compris, pour bien comprendre ce qu'il se passe et toutes les possibilit√©s, il faut avoir une id√©e des codes de fr√©quences...</p>
<h2 id="frequences-et-decalages-offset">Fr√©quences et d√©calages (offset)</h2>
<p>Le concept de fr√©quence ou de d√©calage (on parlera g√©n√©ralement d'offset)  est fondamental pour les outils <code>pandas</code> de s√©ries temporelles.
On a d√©j√† crois√© les codes <code>M</code> (month), <code>D</code> (day) et <code>H</code> (hour) pour d√©finir des fr√©quences, on va r√©sum√© les codes Pandas dans le tableau suivant.</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description EN</th>
<th>Description     FR</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>D</code></td>
<td>Calendar day</td>
<td>Jour de la semaine</td>
</tr>
<tr>
<td><code>W</code></td>
<td>Weekly</td>
<td>Semaine</td>
</tr>
<tr>
<td><code>M</code></td>
<td>Month end</td>
<td>Fin du mois</td>
</tr>
<tr>
<td><code>Q</code></td>
<td>Quarter end</td>
<td>Fin du trimestre</td>
</tr>
<tr>
<td><code>A</code></td>
<td>Year end</td>
<td>Fin de l'ann√©e</td>
</tr>
<tr>
<td><code>H</code></td>
<td>Hours</td>
<td>Heures</td>
</tr>
<tr>
<td><code>T</code></td>
<td>Minutes</td>
<td>Minutes</td>
</tr>
<tr>
<td><code>S</code></td>
<td>Seconds</td>
<td>Secondes</td>
</tr>
<tr>
<td><code>L</code></td>
<td>Milliseonds</td>
<td>Milliseondes</td>
</tr>
<tr>
<td><code>U</code></td>
<td>Microseconds</td>
<td>Microsecondes</td>
</tr>
<tr>
<td><code>N</code></td>
<td>nanoseconds</td>
<td>nanosecondes</td>
</tr>
<tr>
<td><code>B</code></td>
<td>Business day</td>
<td>Jour ouvrable</td>
</tr>
<tr>
<td><code>BM</code></td>
<td>Business month end</td>
<td>Fin ouvrable de mois</td>
</tr>
<tr>
<td><code>BQ</code></td>
<td>Business quarter end</td>
<td>Fin ouvrable de trimestre</td>
</tr>
<tr>
<td><code>BA</code></td>
<td>Business year end</td>
<td>Fin ouvrable d'ann√©e</td>
</tr>
<tr>
<td><code>BH</code></td>
<td>Business hours</td>
<td>Heures ouvrables</td>
</tr>
</tbody>
</table>
<p>Les fr√©quences mensuelles, trimestrielles et annuelles pointent √† la fin de la p√©riode par d√©faut. En ajoutant un suffixe <code>S</code> √† la fin du nom, elles pointeront √† la place au d√©but de la p√©riode.</p>
<table>
<thead>
<tr>
<th>Code</th>
<th>Description EN</th>
<th>Description FR</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MS</code></td>
<td>Month start</td>
<td>D√©but de mois</td>
</tr>
<tr>
<td><code>QS</code></td>
<td>Quarter start</td>
<td>D√©but de trimestre</td>
</tr>
<tr>
<td><code>AS</code></td>
<td>Year start</td>
<td>D√©but d'ann√©e</td>
</tr>
<tr>
<td><code>BMS</code></td>
<td>Business month start</td>
<td>D√©but ouvrable de mois</td>
</tr>
<tr>
<td><code>BQS</code></td>
<td>Business quarter start</td>
<td>D√©but ouvrable de trimestre</td>
</tr>
<tr>
<td><code>BAS</code></td>
<td>Business year start</td>
<td>D√©but ouvrable d'ann√©e</td>
</tr>
</tbody>
</table>
<p>On peut aussi modifier le mois utilis√© pour marquer un code trimestriel ou annuel en ajoutant les 3 lettres du mois en suffixes:<br>
- <code>Q-JAN</code>, <code>BQ-FEB</code>, <code>QS-MAR</code>, <code>BQS-APR</code>, ...<br>
- <code>A-JAN</code>, <code>BA-FEB</code>, <code>AS-MAR</code>, <code>BAS-APR</code>, ...  </p>
<p>De la m√™me mani√®re, le "jour seuil" d'une fr√©quence hebdomadaire peut √™tre modifi√© en ajoutant en suffixes les 3 lettres du jour:<code>W-SUN</code>, <code>W-MON</code>, <code>W-TUE</code>, <code>W-WED</code>, etc.</p>
<p>Enfin, comme vu un peu plus haut, les codes peuvent √™tre combin√©s avec des valeurs num√©riques pour sp√©cifier d'autres fr√©quences. Par exemple, pour une fr√©quence de 2h30min, on peut faire:</p>
<div class="highlight"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">timedelta_range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;2H30T&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">TimedeltaIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;00:00:00&#39;, &#39;02:30:00&#39;, &#39;05:00:00&#39;, &#39;07:30:00&#39;, &#39;10:00:00&#39;,</span>
<span class="n">                &#39;12:30:00&#39;, &#39;15:00:00&#39;, &#39;17:30:00&#39;, &#39;20:00:00&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">               </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;timedelta64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;150T&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Tout √ßa provient en fait du module <code>pd.tseries.offsets</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Par exemple, pour cr√©er un d√©calage de jour ouvrable, on peut faire :</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">BDay</span>
<span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">BDay</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-03&#39;, &#39;2021-05-04&#39;, &#39;2021-05-05&#39;,</span>
<span class="n">               &#39;2021-05-06&#39;, &#39;2021-05-07&#39;, &#39;2021-05-10&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1"># Par exemple, pour r√©cup√©rer le dernier jour ouvrable du mois, on peut faire :</span>
<span class="kn">from</span> <span class="nn">pandas.tseries.offsets</span> <span class="kn">import</span> <span class="n">BMonthEnd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2021-04-30&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">BMonthEnd</span><span class="p">())</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">DatetimeIndex</span><span class="p">(</span><span class="o">[</span><span class="n">&#39;2021-04-30&#39;, &#39;2021-05-31&#39;, &#39;2021-06-30&#39;, &#39;2021-07-30&#39;,</span>
<span class="n">               &#39;2021-08-31&#39;, &#39;2021-09-30&#39;, &#39;2021-10-29&#39;, &#39;2021-11-30&#39;</span><span class="o">]</span><span class="p">,</span>
<span class="w">              </span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">)</span>
</code></pre></div>

<p>Pour en savoir plus, il y a la <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#dateoffset-objects" target="_blank">section "DateOffset"</a> de la documentation <code>pandas</code>.</p>
<p>Vous trouverez, comme pour l'ensemble de nos posts, le code de ce notebook sur le <a href="https://github.com/Statoscop/notebooks-blog" target="_blank">github de Statoscop</a>. Dans le prochain article, nous commencerons √† manipuler, visualiser et effectuer certaines op√©rations classiques sur les s√©ries temporelles avant de conclure sur une petite √©tude de cas. √Ä tr√®s vite !</p>
<div class = "d-flex justify-content-center mt-4">
   <a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button">Visiter notre site</a>
   <a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button">Nous contacter</a>
</div>
<p><br>  </p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Les s√©ries temporelles avec Python (1/4) - Introduction&amp;url=https://blog.statoscop.fr/timeseries-1.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://blog.statoscop.fr/tag/python.html">Python</a><a href="https://blog.statoscop.fr/tag/machine-learning.html">Machine Learning</a><a href="https://blog.statoscop.fr/tag/statistiques.html">Statistiques</a><a href="https://blog.statoscop.fr/tag/data-science.html">Data Science</a><a href="https://blog.statoscop.fr/tag/series-temporelles.html">S√©ries temporelles</a><a href="https://blog.statoscop.fr/tag/datetime.html">Datetime</a>                </aside>

                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
    
        <!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-4 text-lg-left"> ¬© Statoscop<br> 3 rue Jacques Roudil 31300 Toulouse</div>
                    <div class="col-lg-4 my-3 my-lg-0">
                        <a class="btn btn-dark btn-social mx-2" href="https://fr.linkedin.com/company/statoscop" target="_blank"><i class="fa-brands fa-linkedin-in"></i></a>
                    </div>
                    <div class="col-lg-4 text-lg-left"> 
                        Blog publi√© avec <a class="js-scroll-trigger text-info" href="https://docs.getpelican.com/en/latest/"  target="_blank">Pelican</a> et
                        d√©ploy√© sur <a class="js-scroll-trigger text-info" href="https://pages.github.com/"  target="_blank">Github Pages</a>.
                    </div>
                </div>
            </div>
        </footer>

    <!-- Bootstrap core JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
    <!-- Third party plugin JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script type="text/javascript" src="https://blog.statoscop.fr/themes/statoscop/static/js/script.js"></script>

  </body>
</html>