<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Le blog - Stats &amp; ML</title><link href="https://blog.statoscop.fr/" rel="alternate"></link><link href="https://blog.statoscop.fr/feeds/stats-ml.atom.xml" rel="self"></link><id>https://blog.statoscop.fr/</id><updated>2025-02-04T00:00:00+01:00</updated><entry><title>Appariement par score de propension (PSM) : mise en oeuvre avec R et discussions m√©thodologiques</title><link href="https://blog.statoscop.fr/appariement-score-propension.html" rel="alternate"></link><published>2025-02-04T00:00:00+01:00</published><updated>2025-02-04T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-02-04:/appariement-score-propension.html</id><summary type="html">&lt;p&gt;Implications th√©oriques des m√©thodes d'appariement par score de propension et impl√©mentation avec le package R &lt;code&gt;MatchIt&lt;/code&gt;.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#appariement-de-vos-donnees"&gt;Appariement de vos donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#description-des-donnees-et-de-notre-problematique"&gt;Description des donn√©es et de notre probl√©matique&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#evaluation-de-la-qualite-de-lappariement"&gt;√âvaluation de la qualit√© de l'appariement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux √† partir de la population appari√©e&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des m√©thodes avec score de propension&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Pour √©valuer un effet causal, comme par exemple les effets d'un m√©dicament sur des patients, on a besoin de ce que l'on appelle un &lt;strong&gt;essai clinique randomis√©&lt;/strong&gt;. Le principe est le suivant : on prend un certain nombre de patients (√† d√©terminer en fonction de l'effet minimum attendu, mais c'est un autre sujet) et on les s√©pare al√©atoirement en deux groupes : &lt;strong&gt;un groupe traitement&lt;/strong&gt; qui prend le m√©dicament et &lt;strong&gt;un groupe contr√¥le&lt;/strong&gt; qui en g√©n√©ral prend un placebo.&lt;br&gt;
Comme on a d√©cid√© de mani√®re compl√®tement al√©atoire l'assignation √† l'un ou l'autre groupe, on sait que ces deux groupes auront en moyenne des caract√©ristiques identiques (merci la loi faible des grands nombres!). Cela nous permet de conclure que les diff√©rences qui seraient observ√©es entre les deux groupes (meilleur r√©tablissement, prise de poids, selon ce qu'on cherche √† observer...) &lt;strong&gt;sont imputables au traitement et non √† une sp√©cificit√© d'un des groupes par rapport √† l'autre&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;L'essai clinique randomis√©, c'est donc l'id√©al pour montrer un effet causal et c'est d'ailleurs par l√† qu'il faut passer si vous souhaitez homologuer un nouveau m√©dicament. Mais c'est √©galement co√ªteux et difficile √† r√©aliser. C'est pourquoi on cherche de plus en plus √† essayer &lt;strong&gt;d'imiter les conditions d'un essai clinique randomis√© √† partir de donn√©es observationnelles&lt;/strong&gt;. Pour cette note de blog, on va vous pr√©senter une ces m√©thodes : le &lt;strong&gt;propensity score matching (PSM), ou appariement par score de propension&lt;/strong&gt;.  &lt;/p&gt;
&lt;h1 id="principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/h1&gt;
&lt;p&gt;L'appariement par score de propension vise √† &lt;strong&gt;recr√©er les conditions d'un essai clinique √† partir de donn√©es observationnelles&lt;/strong&gt;. On a ainsi un ensemble de donn√©es avec par exemple un certain nombre de patients qui ont pris un traitement (le &lt;em&gt;groupe traitement&lt;/em&gt;) et d'autres qui ne l'ont pas pris (le &lt;em&gt;groupe contr√¥le&lt;/em&gt;). Probl√®me : ces population qui n'ont pas √©t√© s√©par√©es de mani√®re al√©atoire &lt;strong&gt;peuvent √™tre tr√®s diff√©rentes&lt;/strong&gt; et il n'est pas possible en l'√©tat de conclure qu'une diff√©rence entre elles soit imputable au traitement en question. Il faut donc recr√©er deux groupes de contr√¥le et de traitement qui puissent √™tre comparables.    &lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/h2&gt;
&lt;p&gt;La premi√®re √©tape est de &lt;strong&gt;calculer le score de propension&lt;/strong&gt;. Il est n√©cessaire en premier lieu &lt;strong&gt;d'identifier les variables observables&lt;/strong&gt; sur lesquelles on souhaiterait r√©√©quilibrer les deux groupes. Il n'y a pas de m√©thode magique pour choisir ces variables : il faut que ce soit la connaissance technique du cas qui guide votre choix. L'id√©e est d'identifier les variables dont vous imaginez qu'elles peuvent √™tre &lt;strong&gt;d√©s√©quilibr√©es entre vos deux groupes&lt;/strong&gt; pour diff√©rentes raisons (par exemple, le traitement A est plus souvent donn√© aux femmes donc je sais qu'il y aura plus de femmes dans ce groupe que dans un autre). Il faut aussi bien s√ªr contr√¥ler par les variables dont on sait qu'elles peuvent avoir &lt;strong&gt;un impact sur le r√©sultat ind√©pendemment de l'efficacit√© du m√©dicament&lt;/strong&gt; (l'√¢ge impacte souvent la probabilit√© de gu√©rison par exemple).  &lt;/p&gt;
&lt;p&gt;Une fois ces variables identifi√©es, il ne vous reste plus qu'√† faire &lt;strong&gt;sur l'ensemble de vos donn√©es un mod√®le de r√©gression logistique.&lt;/strong&gt; Par exemple, si votre groupe traitement prend un m√©dicament A et le reste du groupe ne prend pas ce m√©dicament, votre variable &lt;code&gt;Y&lt;/code&gt; sera l'indicatrice &lt;em&gt;Prend le m√©dicament A&lt;/em&gt; et vos variables $X_i$ les variables sur lesquelles vous souhaitez contr√¥ler (sexe, √¢ge, etc...). La formule est la suivante :  &lt;/p&gt;
&lt;p&gt;$\log \left( \frac{P(Y=1)}{1 - P(Y=1)} \right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \dots$&lt;/p&gt;
&lt;h2 id="appariement-de-vos-donnees"&gt;Appariement de vos donn√©es&lt;/h2&gt;
&lt;p&gt;La mise en oeuvre de cette r√©gression logistique nous permet &lt;strong&gt;d'obtenir un score de propension&lt;/strong&gt;. Celui-ci repr√©sente pour chaque individu la probabilit√© pr√©dite qu'il appartienne au groupe traitement. Ce score de propension peut-√™tre utilis√© dans diff√©rentes m√©thodes (IPTW, variable d'ajustement dans la mod√®le...). Pour le PSM, nous l'utilisons pour &lt;strong&gt;apparier les donn√©es&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;En effet, pour chaque observation du groupe trait√©, l'id√©e est de lui attribuer une (ou plusieurs, selon vos donn√©es) observation(s) du groupe contr√¥le, ayant &lt;strong&gt;un score de propension le plus proche possible&lt;/strong&gt;, donc des caract√©ristiques semblables. Diff√©rentes m√©thodes d'appariement existent, la plus courante √©tant celle du plus proche voisin.  &lt;/p&gt;
&lt;p&gt;Une fois que chaque observation du groupe traitement s'est vue attribuer son plus proche voisin du groupe contr√¥le, on √©carte les donn√©es qui n'ont pas √©t√© appari√©es. La premi√®re chose √† faire est bien s√ªr &lt;strong&gt;d'√©valuer la qualit√© de l'appariement&lt;/strong&gt; en v√©rifiant la r√©partition des variables de contr√¥le entre les deux groupes. Puis, nous allons r√©aliser nos analyses comme si nous √©tions dans le cas d'un essai clinique randomis√©, ou presque...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/h1&gt;
&lt;p&gt;Les m√©thodes utilisant des scores de propension, et en particulier l'appariement par score de propension, sont tr√®s bien prises en charge avec R. Nous vous proposons ici d'utiliser le package R &lt;code&gt;MatchIt&lt;/code&gt; sur des &lt;a href="https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records"&gt;donn√©es cliniques librement accessibles&lt;/a&gt;. Il s'agit de patients hospitalis√©s pour une insuffisance cardiaque.  &lt;/p&gt;
&lt;h2 id="description-des-donnees-et-de-notre-problematique"&gt;Description des donn√©es et de notre probl√©matique&lt;/h2&gt;
&lt;p&gt;Nos donn√©es repr√©sentent 299 patients.  Parmi eux, la pr√©valence de cas d'hypertension art√©rielle (HTA) est la suivante :  &lt;/p&gt;
&lt;p&gt;Table: Pr√©sence de diab√®tes&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;high_blood_pressure&lt;/th&gt;
&lt;th style="text-align: right;"&gt;n&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;194&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Oui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;105&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il y a 13 variables disponibles :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt;  [1] &amp;quot;age&amp;quot;                      &amp;quot;anaemia&amp;quot;                 
&lt;span class="gu"&gt;##&lt;/span&gt;  [3] &amp;quot;creatinine_phosphokinase&amp;quot; &amp;quot;diabetes&amp;quot;                
&lt;span class="gu"&gt;##&lt;/span&gt;  [5] &amp;quot;ejection_fraction&amp;quot;        &amp;quot;high_blood_pressure&amp;quot;     
&lt;span class="gu"&gt;##&lt;/span&gt;  [7] &amp;quot;platelets&amp;quot;                &amp;quot;serum_creatinine&amp;quot;        
&lt;span class="gu"&gt;##&lt;/span&gt;  [9] &amp;quot;serum_sodium&amp;quot;             &amp;quot;sex&amp;quot;                     
&lt;span class="gu"&gt;##&lt;/span&gt; [11] &amp;quot;smoking&amp;quot;                  &amp;quot;time&amp;quot;                    
&lt;span class="gu"&gt;##&lt;/span&gt; [13] &amp;quot;death_event&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On cherche ici √† &lt;strong&gt;√©valuer l'impact de l'HTA sur la probabilit√© de d√©c√©der des suites d'une insuffisance cardiaque&lt;/strong&gt;. Notre &lt;strong&gt;variable d'int√©r√™t&lt;/strong&gt; est donc &lt;code&gt;death_event&lt;/code&gt;. Notre &lt;em&gt;traitement&lt;/em&gt; (ici on ne regarde pas l'effet d'un traitement mais d'une caract√©ristique des patients, cependant on va continuer √† utiliser cette terminologie) est ici le fait d'avoir une HTA. Le croisement de ces deux variables donne le r√©sultat suivant :  &lt;/p&gt;
&lt;p&gt;Table: HTA et d√©c√®s&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;high_blood_pressure&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Effectifs&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Part de d√©c√®s&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;194&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Oui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;105&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Ici √† premi√®re vue on trouve une proportion plus importante de d√©c√®s parmi les patients ayant une HTA (37% contre 29% pour les autres). Mais bien s√ªr, il n'est pas encore possible de &lt;strong&gt;savoir si cela est d√ª √† l'HTA en soi ou √† d'autres caract√©ristiques&lt;/strong&gt; des patients souffrant de ce probl√®me.&lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/h2&gt;
&lt;p&gt;La fonction &lt;code&gt;matchit&lt;/code&gt; du package R &lt;code&gt;MatchIt&lt;/code&gt; nous permet de &lt;strong&gt;mettre directement en oeuvre le calcul du score de propension et l'appariement&lt;/strong&gt;. On commence par s√©lectionner les variables par lesquelles il nous semble important de contr√¥ler : ici nous allons prendre l'ensemble des variables cliniques dont nous disposons. Il faut alors &lt;strong&gt;retirer les valeurs manquantes&lt;/strong&gt; pour ensuite obtenir deux groupes de patients avec et sans HTA ayant des caract√©ristiques semblables par ailleurs. La fonction s'√©crit ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MatchIt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;matchit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;creatinine_phosphokinase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;diabetes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="n"&gt;platelets&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_creatinine&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_sodium&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;smoking&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_ps&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;nearest&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;glm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;estimand&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ATT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ici on choisit le param√©trage par d√©faut &lt;code&gt;method = "nearest"&lt;/code&gt; qui apparie √† chaque observation du &lt;strong&gt;groupe trait√©&lt;/strong&gt; (les patients ayant une HTA) l'observation du &lt;strong&gt;groupe contr√¥le&lt;/strong&gt; ayant le score de propension le plus proche possible.
Le param√®tre &lt;code&gt;method = "ATT"&lt;/code&gt; permet d'√©valuer un &lt;strong&gt;effet du traitement sur les trait√©s&lt;/strong&gt; et non sur la population globale. Enfin, on d√©finit le mod√®le (ici logistique avec avec &lt;code&gt;distance = "glm"&lt;/code&gt;) pour le calcul du score de propension. Si vous avez un doute sur la m√©thode √† utiliser, &lt;a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html"&gt;reportez-vous √† la documentation du package MatchIT&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="evaluation-de-la-qualite-de-lappariement"&gt;√âvaluation de la qualit√© de l'appariement&lt;/h2&gt;
&lt;p&gt;Encore une fois, la librairie &lt;code&gt;MatchIt&lt;/code&gt; nous m√¢che directement le travail en nous permettant de comparer facilement la &lt;strong&gt;r√©partition de nos patients avant et apr√®s appariement&lt;/strong&gt; avec &lt;code&gt;summary()&lt;/code&gt;. La &lt;strong&gt;r√©partition avant l'appariement&lt;/strong&gt; est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on affiche seulemet l&amp;#39;√©l√©ment `sum.all` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.all&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Treated&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Control&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Var. Ratio&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Mean&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Max&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;distance&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.36&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.11&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.23&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;age&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.20&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.91&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.13&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexFemme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.31&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.21&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexHomme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.69&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.21&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td style="text-align: right;"&gt;488.90&lt;/td&gt;
&lt;td style="text-align: right;"&gt;632.14&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.16&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.73&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.11&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.59&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;platelets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;269989.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;259769.00&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_creatinine&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.39&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.40&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.99&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.13&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_sodium&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.85&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.51&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.82&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.71&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate ainsi que les personnes souffrant d'hyper tension art√©rielle sont souvent plus √¢g√©es que les autres. Ce sont √©galement plus souvent des femmes, et plus souvent des personnes atteintes d'an√©mie. Observons maintenant si notre appariement a permis d'√©quilibrer nos deux groupes sur ces variables et sur les autres :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# on affiche seulement l&amp;#39;√©l√©ment `sum.matched` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Treated&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Control&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Var. Ratio&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Mean&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Max&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;distance&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;age&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.36&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.00&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.93&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.07&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.89&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexFemme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.40&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexHomme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.56&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.44&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td style="text-align: right;"&gt;488.90&lt;/td&gt;
&lt;td style="text-align: right;"&gt;481.78&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.89&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.07&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.59&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.63&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;platelets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;269989.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;264619.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.87&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_creatinine&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.39&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.43&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;2.09&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_sodium&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.85&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.88&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.07&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.71&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.26&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;On constate que la plupart des variables sont maintenant plus √©quilibr√©es entre les deux groupes. Au global, la variable &lt;code&gt;distance&lt;/code&gt; montre la grande proximit√© du score de propension entre les deux groupes. On peut √©galement mettre en √©vidence l'effet de l'appariement visuellement sur quelques unes des variables avec la fonction &lt;code&gt;plot&lt;/code&gt; :&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;density&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;which.xs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/psm/unnamed-chunk-9-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;h2 id="mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux √† partir de la population appari√©e&lt;/h2&gt;
&lt;p&gt;Une fois convaincus de la qualit√© de l'appariement, on peut mettre en oeuvre notre mod√®le statistique &lt;strong&gt;en tenant compte pour le calcul des estimateurs du fait que nous manipulons des observations appari√©es&lt;/strong&gt;. Diff√©rentes m√©thodes sont possibles en fonction de la variable d'int√©r√™t, du type d'appariement r√©alis√©, etc. En cas de doute, vous pouvez vous reporter &lt;a href="https://kosukeimai.github.io/MatchIt/articles/estimating-effects.html#modeling-the-outcome"&gt;√† la vignette consacr√©e √† l'estimation des effets du package &lt;code&gt;MatchIt&lt;/code&gt;&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;Dans notre exemple simple, nous allons tout d'abord extraire les donn√©es appari√©es avec &lt;code&gt;match_data&lt;/code&gt; et calibrer un mod√®le lin√©aire g√©n√©ralis√©. Nous &lt;strong&gt;pond√©rons avec les poids issus de l'appariement&lt;/strong&gt;. S'ils sont tous √©gaux √† 1 (c'est le cas pour nous) cela n'est pas n√©cessaire. Toutefois, cela reste une bonne habitude en cas d'appariement utilisant des poids diff√©rents. Il est possible √©galement de &lt;strong&gt;contr√¥ler notre r√©gression logistique par les variables ayant servi √† l'appariement, ou directement par le score de propension&lt;/strong&gt;. Nous choisissons ici de ne pas le faire en raison de la bonne qualit√© de l'appariement. &lt;/p&gt;
&lt;p&gt;Enfin, on utilise le package &lt;code&gt;marginaleffects&lt;/code&gt; pour estimer l'&lt;strong&gt;effet moyen sur les trait√©s (ATT)&lt;/strong&gt; en tenant compte l'appariement.   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;match_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;glm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;death_event&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;binomial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;marginaleffects&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;avg_comparisons&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;vcov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;subclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;newdata&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;subset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Oui&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;term&lt;/th&gt;
&lt;th style="text-align: left;"&gt;contrast&lt;/th&gt;
&lt;th style="text-align: right;"&gt;estimate&lt;/th&gt;
&lt;th style="text-align: right;"&gt;std.error&lt;/th&gt;
&lt;th style="text-align: right;"&gt;statistic&lt;/th&gt;
&lt;th style="text-align: right;"&gt;p.value&lt;/th&gt;
&lt;th style="text-align: right;"&gt;s.value&lt;/th&gt;
&lt;th style="text-align: right;"&gt;conf.low&lt;/th&gt;
&lt;th style="text-align: right;"&gt;conf.high&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted_lo&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted_hi&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;high_blood_pressure&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Oui - Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.76&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.45&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.16&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.17&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.32&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;L'estimateur repr√©sente la &lt;strong&gt;diff√©rence de proportions de d√©c√®s&lt;/strong&gt; entre le groupe trait√© (ceux avec HTA) et le groupe contr√¥le (les autres). Elle est ici de 0.05, soit 5 points de pourcentage. En effet, les variables &lt;code&gt;predicted_lo&lt;/code&gt; et &lt;code&gt;predicted_hi&lt;/code&gt; indiquent que lorsqu'on apparie, la part de d√©c√®s dans le groupe contr√¥le monte √† 32% (contre 29% dans l'ensemble des patients n'ayant pas de tension art√©rielle), alors qu'elle est de 37% dans le groupe trait√©. De fait, cette diff√©rence n'est pas significative, puisque la p-value est de 0.45 (&lt;a href="https://blog.statoscop.fr/comprendre-et-interpreter-les-p-values.html"&gt;un autre de nos articles explique ce qu'est une p-value&lt;/a&gt;). Bien s√ªr, cela ne signifie pas forc√©ment que cet effet n'existe pas, mais en tout cas on ne dispose pas dans nos donn√©es de suffisament d'observations pour affirmer ici que l'HTA augmente signficativement la probabilit√© de d√©c√®s.&lt;/p&gt;
&lt;h1 id="forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des m√©thodes avec score de propension&lt;/h1&gt;
&lt;p&gt;De nombreuses questions se posent autour des m√©thodes de score de propension. La premi√®re est sans doute son avantage r√©el ou suppos√© par rapport √† un mod√®le multivari√© classique. Il est vrai cependant que cette m√©thode a l'avantage de capter dans une seule variable un ensemble de dimensions observables par lesquelles on souhaite contr√¥ler notre analyse. Mais le fait, dans le cas de l'appariement, de se passer d'une partie des donn√©es pose question. Cela permet cependant de calculer &lt;strong&gt;un effet moyen sur les trait√©s (ATT)&lt;/strong&gt; et de ne pas trop biaiser l'effet avec des observations qui auraient des caract√©ristiques tr√®s √©loign√©es de la population trait√©e. De plus, la m√©thode de pond√©ration par inverse de probabilit√© de traitement (IPTW) permet d'utiliser le score de propension sans √©carter de donn√©es, et il est √©galement possible d'estimer un ATT.  &lt;/p&gt;
&lt;p&gt;La plus grosse limite de cette m√©thode est sans doute le fait qu'elle pourrait faire oublier que nos groupes de traitement et de contr√¥le sont comparables &lt;strong&gt;uniquement sur des caract√©ristiques observables&lt;/strong&gt;. Il n'est donc pas √† exclure que des biais de s√©lection non observables polluent notre analyse, l√† o√π un essai clinique randomis√© calibr√© correctement met normalement √† l'abri de ce probl√®me. Il est donc fondamental de garder constamment cet √©cueil en t√™te pour essayer d'anticiper les possibles d√©fauts de nos analyses.  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! Si vous cherchez des &lt;a href="https://www.statoscop.fr"&gt;statisticiens pour vos √©tudes cliniques n'h√©sitez pas √† visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Passer de RMarkdown √† Quarto pour vos rapports statistiques</title><link href="https://blog.statoscop.fr/quarto-rmarkdown.html" rel="alternate"></link><published>2024-12-12T00:00:00+01:00</published><updated>2024-12-12T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2024-12-12:/quarto-rmarkdown.html</id><summary type="html">&lt;p&gt;Petit exemple pour vous accompagner dans la transition de RMarkdown vers Quarto, et pourquoi √ßa va rendre vos rapports encore plus ergonomiques!&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#configuration-de-quarto"&gt;Configuration de Quarto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-des-onglets"&gt;Utilisation des onglets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#generation-dynamique-de-contenu-markdown"&gt;G√©n√©ration dynamique de contenu markdown&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#les-references-aux-graphiques-et-tableaux"&gt;Les r√©f√©rences aux graphiques et tableaux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://rmarkdown.rstudio.com/"&gt;RMarkdown&lt;/a&gt; est un outil de g√©n√©ration de rapports qui permet de &lt;strong&gt;communiquer des r√©sultats d'analyse de mani√®re efficace, ergonomique et automatis√©e&lt;/strong&gt;. Nous l'utilisions de mani√®re quasi-quotidienne, mais force est de constater l'√©mergence irr√©m√©diable de &lt;a href="https://quarto.org/"&gt;Quarto&lt;/a&gt;. Du coup, on a fini par s'y mettre. Et en effet, Quarto permet non seulement de reproduire le type de rapports que l'on obtenait avec RMarkdown, mais il offre aussi &lt;strong&gt;encore plus de possibilit√©s!&lt;/strong&gt; C'est pour cela que nous vous pr√©sentons ici quelques unes de ses fonctionnalit√©s et 2/3 choses √† ne pas rater pour l'adopter sans peine.  &lt;/p&gt;
&lt;p&gt;Dans cet article nous allons suivre la cr√©ation d'un rapport fictif, qui repose sur des donn√©es compl√®tement invent√©es. L'id√©e est d'√©tudier la pr√©valence d'une maladie en fonction de diff√©rentes variables. &lt;/p&gt;
&lt;h1 id="configuration-de-quarto"&gt;Configuration de Quarto&lt;/h1&gt;
&lt;p&gt;Pour lancer votre premier rapport, vous pouvez comme pour RMarkdown le cr√©er directement depuis RStudio avec &lt;code&gt;File -&amp;gt; New file -&amp;gt; Quarto document&lt;/code&gt;. Je pr√©f√®re personnellement d√©cocher l'option &lt;code&gt;Use visual markdown editor&lt;/code&gt; qui propose une √©dition qui met directement en forme la partie Markdown, mais vous pouvez de toute fa√ßon passer de l'un √† l'autre en cliquant sur &lt;code&gt;Source&lt;/code&gt; ou &lt;code&gt;Visual&lt;/code&gt; en haut de de votre √©cran d'√©dition.  &lt;/p&gt;
&lt;p&gt;La premi√®re chose √† param√©trer est votre en-t√™te YAML qui donne les param√©trages globaux de votre document. Voici le mien :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;---
title: &amp;quot;Mon rapport dynamique&amp;quot;
format: 
  html:
    self-contained: true
    toc: true
    smooth-scroll: true
execute:
  echo: false
--- 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour RMarkdown, on y renseigne le titre et les formats de sortie, ici html. On remarque le param√®tre &lt;code&gt;self-contained: true&lt;/code&gt; &lt;strong&gt;qui est fondamental&lt;/strong&gt; : en effet, les sorties html de Quarto n√©cessitent de charger beaucoup de classes CSS et de fonctions javascript. Par d√©faut, tous ces √©l√©ments sont stock√©s dans un dossier &lt;code&gt;nom_de_votre_fichier_files&lt;/code&gt;. Cela permet par exemple de &lt;strong&gt;ne le charger qu'une fois&lt;/strong&gt; si vous avez plusieurs fichiers Quarto dans un projet. Par contre, si vous envoyez votre rapport html par mail, &lt;strong&gt;il ne va pas s'afficher correctement!&lt;/strong&gt; Ce param√®tre permet donc de &lt;strong&gt;charger toutes les d√©pendances n√©cessaires directement dans le fichier&lt;/strong&gt;, au prix d'un poids du fichier bien plus important. &lt;/p&gt;
&lt;p&gt;Bien s√ªr, ce que l'on adorait dans RMarkdown et qui est encore plus agr√©able avec Quarto, c'est &lt;strong&gt;la table des mati√®res flottante&lt;/strong&gt; sur le c√¥t√©. Coupl√©e au param√®tre &lt;code&gt;smooth-scroll: true&lt;/code&gt;, elle permet une navigation dans le fichier tr√®s agr√©able. C'est particuli√®rement appr√©ciable dans le cas de rapports tr√®s volumineux. Mais jugez plut√¥t :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/toc.gif"&gt;&lt;/p&gt;
&lt;p&gt;Enfin dans &lt;code&gt;execute&lt;/code&gt; je r√®gle un comportement par d√©faut de traitement de mes cellules de code. Ici, &lt;code&gt;echo: false&lt;/code&gt; indique que je souhaite que seules les sorties s'affichent dans mon rapport.  &lt;/p&gt;
&lt;p&gt;Bien s√ªr, on peut √©craser le param√©trage par d√©faut pour les blocs de code en les param√©trant directement, avec une syntaxe diff√©rente de celle de RMarkdown, ici par exemple pour le bloc me permettant de charger les librairies et les donn√©es :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| include: false&lt;/span&gt;

&lt;span class="gh"&gt;# Librairies&lt;/span&gt;
library(dplyr)
library(ggplot2)

&lt;span class="gh"&gt;# Th√®me et styles ggplot2&lt;/span&gt;
options(ggplot2.discrete.colour = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
options(ggplot2.discrete.fill = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
theme_set(theme_bw())

&lt;span class="gh"&gt;# Import de la base&lt;/span&gt;
base_patients &amp;lt;- read.csv(&amp;quot;base_fictive_patients.csv&amp;quot;)
```                                                                       &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;La partie &lt;code&gt;#| include: false&lt;/code&gt; permet d'indiquer que je ne souhaite pas que ce code ni sa sortie n'apparaisse dans le rapport.&lt;br&gt;
√Ä noter enfin qu'il existe de nombreuses nouvelles possibilit√©s avec Quarto, comme le fait de permettre √† l'utilisateur d'afficher ou non le code ayant permis de g√©n√©rer un r√©sultat (&lt;code&gt;code-fold&lt;/code&gt;) et de lui laisser le choix du comportement par d√©faut de ces blocs de code (&lt;code&gt;code-tools&lt;/code&gt;). Je vous laisse explorer les &lt;a href="https://quarto.org/docs/output-formats/html-code.html"&gt;pages de documentation li√©es √† ces points&lt;/a&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="utilisation-des-onglets"&gt;Utilisation des onglets&lt;/h1&gt;
&lt;p&gt;Une de nos fonctionnalit√©s pr√©f√©r√©es de RMarkdown, c'√©tait la possibilit√© de faire des onglets. Comme pour la table des mati√®res flottante, cela permet d'all√©ger des rapports contenant parfois beaucoup de r√©sultats et cela facilite la navigation de la personne qui cherche un des nombreux r√©sultats qui se trouve dans votre rapport. √âvidemment cela reste possible avec Quarto, en utilisant une syntaxe l√©g√®rement diff√©rente. On va en effet encapsuler notre code Markdown dans une instruction &lt;code&gt;::: panel-tabset&lt;/code&gt;. Tous les titres qui suivront seront automatiquement cr√©√©s comme des onglets. Dans notre rapport fictif, on va par exemple pr√©senter la r√©partition de chacune des variables caract√®re dans un onglet de la mani√®re suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;## Variables caract√®res&lt;/span&gt;

::: panel-tabset
&lt;span class="gu"&gt;### Sexe&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Sexe) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Tabagisme&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Fumeur) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Poids&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Poids) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le r√©sultat obtenu est le suivant :   &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets.gif"&gt;  &lt;/p&gt;
&lt;h1 id="generation-dynamique-de-contenu-markdown"&gt;G√©n√©ration dynamique de contenu markdown&lt;/h1&gt;
&lt;p&gt;Une autre fonctionnalit√© tr√®s pratique de RMarkdown que l'on retrouve dans Quarto est la possibilit√© de g√©n√©rer automatiquement le code Markdown, et pas seulement les blocs de code R ou Python. Cela est tr√®s pratique quand on souhaite par exemple automatiser la cr√©ation d'un dictionnaire de variables, ou faire un rapport standardis√© pour diff√©rentes donn√©es.  &lt;/p&gt;
&lt;p&gt;Ici par exemple on peut se dire qu'on va pr√©senter les variables num√©riques de cette fa√ßon. Comme pour les variables caract√®res, on va pr√©senter un tableau de statistiques par variable dans chaque onglet mais cette fois on va faire une boucle sur les variables num√©riques et ne pas r√©p√©ter le code pour chaque variable. Pour cela, on code dans un bloc R avec le param√®tre &lt;code&gt;results: asis&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| results: asis&lt;/span&gt;
&lt;span class="gh"&gt;# boucle sur les variables num√©riques&lt;/span&gt;
for (var_num in names(base_patients |&amp;gt; select(where(is.numeric)))){
  # titre de l&amp;#39;onglet
  cat(glue::glue(&amp;quot;### {var_num}&amp;quot;))  
  cat(&amp;quot;\n&amp;quot;)
  base_patients |&amp;gt; 
    summarise(
      across(all_of(var_num), list(Min = min,
                                   Moyenne = mean,
                                   Mediane = median,
                                   Max = max),
             .names = &amp;quot;{.fn}&amp;quot;)) |&amp;gt; 
    knitr::kable(format.args = list(digits = 2, nsmall = 2)) |&amp;gt; 
    print()
  # retour √† la ligne
  cat(&amp;quot;\n&amp;quot;)
}

```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il est important de noter plusieurs choses :&lt;br&gt;
- Le code Mardown doit se trouver dans une instructions &lt;code&gt;cat()&lt;/code&gt;&lt;br&gt;
- Ne pas oublier d'ajouter des retours √† la ligne avec &lt;code&gt;cat("\n")&lt;/code&gt; &lt;br&gt;
- Il faut afficher les sorties de R que l'on souhaite dans un &lt;code&gt;print()&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;Le r√©sultat obtenu est le m√™me que pour les variables caract√®res, mais avec un code factoris√© et g√©n√©ralisable √† diff√©rentes donn√©es en entr√©e :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets_num.gif"&gt;  &lt;/p&gt;
&lt;h1 id="les-references-aux-graphiques-et-tableaux"&gt;Les r√©f√©rences aux graphiques et tableaux&lt;/h1&gt;
&lt;p&gt;Vous devez le savoir si vous avez d√©j√† men√© des analyses statistiques, le tableau 1 ne le reste pas forc√©ment tout au long du processus, le graphique 3 appara√Æt finalement souvent en second, etc... Avec Quarto, comme c'√©tait le cas avec RMarkdown, on peut automatiser le r√©f√©rencement aux diff√©rents √©l√©ments de notre rapport tr√®s simplement. Dans le code, on va indiquer un label et un titre au bloc de code correspondant √† notre graphique avec &lt;code&gt;#| label: fig-mon-label&lt;/code&gt; et &lt;code&gt;#| fig-cap: "Titre de mon graphique"&lt;/code&gt;, comme ci-dessous pour les deux graphiques de notre rapport :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| label: fig-glucose&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Taux de glucose et pr√©sence de la maladie&amp;quot;&lt;/span&gt;

base_patients %&amp;gt;% 
  ggplot(aes(x = factor(Maladie), y = Taux_de_glucose)) + 
  geom_boxplot(aes(fill = factor(Maladie)), alpha = 0.4) + 
  geom_jitter(aes(color = factor(Maladie)), size = 0.4, alpha = 0.9) + 
  theme(legend.position = &amp;quot;none&amp;quot;) + 
   labs(x = &amp;quot;Pr√©sence de la maladie&amp;quot;, 
        y = &amp;quot;Taux de glucose&amp;quot;)
```                                                                   &amp;#39;

```{r}
&lt;span class="gh"&gt;#| label: fig-sexe-poids&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Sexe, poids et pr√©valence de la maladie&amp;quot;&lt;/span&gt;
base_patients |&amp;gt; 
  group_by(Sexe, Poids) |&amp;gt; 
  summarise(taux = mean(Maladie),
            .groups = &amp;quot;drop&amp;quot;) |&amp;gt; 
  ggplot(aes(x = Poids, y = taux, fill = Sexe)) + 
  geom_col(position = &amp;quot;dodge&amp;quot;, width = 0.5) + 
  scale_y_continuous(labels = ~ scales::percent(.)) + 
  labs(x = &amp;quot;Tabagisme&amp;quot;, y = &amp;quot;Pr√©valence de la maladie&amp;quot;)
```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il n'y aura ensuite plus qu'√† faire r√©f√©rence √† la sortie voulue dans le texte avec la syntaxe &lt;code&gt;@fig-mon-label&lt;/code&gt; qui permettra de num√©roter correctement le graphique ou le tableau par rapport √† sa position dans le rapport. De plus, par d√©faut dans Quarto, l'√©l√©ment est cliquable ce qui permet de directement retrouver l'√©l√©ment en question. Enfin, en passant juste la souris sur l'√©l√©ment, on peut voir une pr√©visualisation de celui-ci :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/cross-ref.gif"&gt;  &lt;/p&gt;
&lt;h1 id="bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/h1&gt;
&lt;p&gt;On a ainsi effleur√© qu'une toute petite partie des possibilit√©s de Quarto, mais on ne voulait pas partir sans vous parler des &lt;em&gt;Callout Blocks&lt;/em&gt;. Ce sont des blocs de texte mis en forme, permettant de g√©n√©rer diff√©rents types de messages (note, avertissement, erreurs...). On peut √©galement les rendre d√©pliables de mani√®re √† ce que le texte ne s'affiche que si l'utilisateur le souhaite.   &lt;/p&gt;
&lt;p&gt;Voici par exemple le code pour une note (d√©pliable) et un avertissement :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;::: {.callout-note collapse=&amp;quot;true&amp;quot;}   
Pour rappel, cette note s&amp;#39;appuie sur des donn√©es compl√®tement fictives et ne devrait pas r√©volutionner la recherche scientifique.
:::  

::: {.callout-caution}  
L&amp;#39;utilisation des blocs d&amp;#39;annotation de Quarto peut √™tre addictive, merci de ne pas en abuser.
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le r√©sultat obtenu est le suivant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/callout-bloc.gif"&gt;  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans cet article, nous n'avons pr√©sent√© qu'une petite partie du potentiel de Quarto. Mais vous pouvez explorer aussi toutes les autres possibilit√©s (Dashboards Observable/RShiny, utilisation de Python/Julia, r√©daction de livres, d√©ploiement de vos r√©sultats sur un serveur...) dans &lt;a href="https://quarto.org/docs/guide/"&gt;la documentation officielle du projet&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Vous souhaitez mettre en place des rapports Quarto automatis√©s dans votre entreprise ou votre laboratoire? Vous pr√©f√©rez l'utiliser pour votre premier dashboard? N'h√©sitez pas √† &lt;a href="https://statoscop.fr/contact"&gt;nous contacter&lt;/a&gt;! &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! Le faux rapport html sur lequel s'appuie cette note est &lt;a href="https://statoscop.fr/static/rapport_quarto.html"&gt;disponible en ligne&lt;/a&gt;. Vous retrouverez le code ayant permis de le g√©n√©rer sur le &lt;a href="https://github.com/Statoscop/notebooks-blog/tree/main/Rapport%20Quarto"&gt;github de Statoscop&lt;/a&gt;. Vous pouvez aussi &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="quarto"></category><category term="rmarkdown"></category><category term="rapport"></category></entry><entry><title>Python pour la Data Science : configurer son environnement de travail</title><link href="https://blog.statoscop.fr/setup-python.html" rel="alternate"></link><published>2024-10-16T00:00:00+02:00</published><updated>2024-10-16T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2024-10-16:/setup-python.html</id><summary type="html">&lt;p&gt;Les essentiels et rien que les essentiels pour se lancer en Data Science avec Python.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#installer-python-et-vscode"&gt;Installer Python et VSCode&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#installation-de-python"&gt;Installation de Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#installation-de-vscode"&gt;Installation de VSCode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bonus-installation-de-git"&gt;Bonus : Installation de Git&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#travailler-avec-python-sur-vos-projets"&gt;Travailler avec Python sur vos projets&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#gestionnaire-denvironnements"&gt;Gestionnaire d'environnements&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#les-notebooks-jupyter"&gt;Les notebooks jupyter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Python est un &lt;strong&gt;langage de programmation extr√™mement complet&lt;/strong&gt; et souvent pl√©biscit√© pour conduire ses projets en Data Science. Sa grande flexibilit√©, le nombre tr√®s important de &lt;a href="https://pypi.org/"&gt;modules d√©velopp√©s&lt;/a&gt; et de logiciels permettant de le faire tourner constitue une grande part de sa richesse. Mais elle est aussi souvent source de beaucoup de difficult√©s pour ses nouvelles utilisatrices et utilisateurs. Il est en effet parfois difficile de reproduire un &lt;strong&gt;environnement de travail simple et minimaliste&lt;/strong&gt;, semblable √† ce que l'on obtiendrait plus directement en utilisant R et RStudio.&lt;br&gt;
Une des r√©ponses √† cette probl√©matique est la solution &lt;a href="https://www.anaconda.com/download/"&gt;Anaconda&lt;/a&gt;, mais elle nous semble trop lourde et souvent source de complications. C'est pour cela que cette semaine, on vous recommande &lt;strong&gt;un environnement de travail pour la Data Science avec Python&lt;/strong&gt;, en se focalisant sur les outils qui nous semblent les plus &lt;strong&gt;pratiques et utiles&lt;/strong&gt; au quotidien.  &lt;/p&gt;
&lt;h1 id="installer-python-et-vscode"&gt;Installer Python et VSCode&lt;/h1&gt;
&lt;h2 id="installation-de-python"&gt;Installation de Python&lt;/h2&gt;
&lt;p&gt;La premi√®re √©tape est bien s√ªr d'installer Python. Avant cela, vous pouvez tout de m√™me v√©rifier que √ßa n'est pas d√©j√† le cas en ouvrant le terminal de votre syst√®me d'exploitation et en tapant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python&lt;span class="w"&gt; &lt;/span&gt;--version
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Attention, parfois l'alias utilis√© par votre syst√®me ne sera pas &lt;code&gt;python&lt;/code&gt; mais &lt;code&gt;python3&lt;/code&gt;, il faut donc modifier les instructions donn√©es dans cette note en cons√©quence, ou &lt;a href="https://www.askpython.com/python/examples/python3-alias-as-python"&gt;modifier l'alias&lt;/a&gt;.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Si Python est install√©, sa version va s'afficher dans la console, sinon vous recevrez un message d'erreur. Dans ce cas, rendez-vous sur la &lt;a href="https://www.python.org/downloads/"&gt;page du site officiel&lt;/a&gt; pour t√©l√©charger la version de Python qui vous convient. Je vous conseille la 3.12, qui est assez r√©cente mais a d√©j√† √©t√© √©prouv√©e. Surtout, &lt;strong&gt;n'oubliez pas de cocher la case &lt;code&gt;Add Python to PATH&lt;/code&gt;&lt;/strong&gt; quand cela vous est demand√©, afin de pouvoir acc√©der √† Python en ligne de commande.  &lt;/p&gt;
&lt;p&gt;Une fois Python install√©, vous pouvez v√©rifier que tout s'est bien pass√© en tapant √† nouveau &lt;code&gt;python --version&lt;/code&gt; depuis un terminal. Vous pouvez alors lancer depuis votre terminal une session Python en lan√ßant l'instruction &lt;code&gt;python&lt;/code&gt;. Mais nous allons pr√©f√©rer passer par un &lt;strong&gt;environnement de d√©veloppement int√©gr√©, ou IDE&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id="installation-de-vscode"&gt;Installation de VSCode&lt;/h2&gt;
&lt;p&gt;Le choix de l'IDE est d√©j√† une premi√®re √©tape peu √©vidente, puisqu'il en existe de nombreux :  &lt;a href="https://www.jetbrains.com/pycharm/"&gt;Pycharm&lt;/a&gt;, &lt;a href="https://www.spyder-ide.org/"&gt;Spyder&lt;/a&gt;, &lt;a href="https://jupyter.org/"&gt;Jupyter Notebook&lt;/a&gt;... Nous vous proposons d'installer VSCode, parce qu'il est sans doute &lt;strong&gt;le plus populaire&lt;/strong&gt; en ce moment, et qu'il peut √™tre utilis√© &lt;strong&gt;pour des scripts Python, mais aussi des notebooks Jupyter&lt;/strong&gt;. Il supporte √©galement de &lt;strong&gt;nombreux autres langages que Python&lt;/strong&gt; (HTML/CSS, Javascript, C/C++, Ruby....) et pourra donc vous servir pour des projets plus tourn√©s vers le d√©veloppement Web. Enfin, il a un &lt;strong&gt;module int√©gr√© permettant d'utiliser Git&lt;/strong&gt; sans ligne de commande, ce qui peut √™tre tr√®s pratique pour une premi√®re prise en main d'un outil de gestion de versions.  &lt;/p&gt;
&lt;p&gt;Pour installer VSCode, &lt;a href="https://code.visualstudio.com/download"&gt;suivez les instructions correspondant √† l'OS que vous utilisez&lt;/a&gt;. Une fois install√©, ouvrez-le et rendez vous dans l'onglet extensions que vous trouverez sur la barre lat√©rale √† gauche de votre √©cran :   &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/setup_python/image-2.png"&gt;&lt;/p&gt;
&lt;p&gt;Ce sont ces extensions de VSCode qui lui permettent de &lt;strong&gt;g√©rer tant de langages diff√©rents&lt;/strong&gt;. Vous pouvez d'ores et d√©j√† installer les extensions &lt;strong&gt;Python et Jupyter&lt;/strong&gt;.  &lt;/p&gt;
&lt;h2 id="bonus-installation-de-git"&gt;Bonus : Installation de Git&lt;/h2&gt;
&lt;p&gt;√áa n'est pas l'objectif de cet article, mais on vous conseille fortement d'utiliser Git pour tous vos projets de Data Science. Pour cela, commencez par &lt;a href="https://git-scm.com/downloads"&gt;t√©l√©charger Git&lt;/a&gt; et cr√©ez-vous un compte sur &lt;a href="https://about.gitlab.com/"&gt;Gitlab&lt;/a&gt; ou &lt;a href="https://github.com/"&gt;Github&lt;/a&gt;.&lt;br&gt;
Si vous n'√™tez pas √† l'aise avec les lignes de commande, VSCode propose justement &lt;strong&gt;un outil int√©gr√© permettant de g√©rer vos fichiers et commits&lt;/strong&gt; en clic-bouton, toujours accessible depuis la barre lat√©rale :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/setup_python/image-6.png"&gt;&lt;/p&gt;
&lt;p&gt;Pour se lancer avec Git sur vos projets de Data Science en Python, on vous conseille cet &lt;a href="https://pythonds.linogaliana.fr/content/git/introgit.html"&gt;excellent article de Lino Galiana&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="travailler-avec-python-sur-vos-projets"&gt;Travailler avec Python sur vos projets&lt;/h1&gt;
&lt;p&gt;Ok, maintenant vous √™tes pr√™ts √† vous lancer dans vos projets de Data Science. Il ne vous reste plus qu'√† choisir et configurer un gestionnaire d'environnements avant de vous lancer enfin dans votre code Python!&lt;/p&gt;
&lt;h2 id="gestionnaire-denvironnements"&gt;Gestionnaire d'environnements&lt;/h2&gt;
&lt;p&gt;Un gestionnaire d'environnements vous permet de g√©rer les d√©pendances de votre projet afin que ceux-ci soient ind√©pendants les uns des autres et plus reproductibles. En dehors du fait d'avoir des biblioth√®ques de packages propres √† chaque projet, il vous permet √©galement de g√©rer diff√©rentes versions de Python en fonction des besoins de chaque projet.&lt;br&gt;
L√† aussi, il existe diff√©rentes possibilit√©s : &lt;code&gt;virtualenv&lt;/code&gt;, &lt;code&gt;pyenv&lt;/code&gt;, &lt;code&gt;pipenv&lt;/code&gt;... Nous optons de notre c√¥t√© pour le gestionnaire &lt;code&gt;conda&lt;/code&gt;, qui nous semble pratique d'utilisation, notamment pour changer de versions de python simplement. Pour l'installer, nous vous proposons d'&lt;a href="https://docs.anaconda.com/miniconda/miniconda-install/"&gt;installer &lt;code&gt;miniconda&lt;/code&gt;&lt;/a&gt; qui est une version all√©g√©e d'Anaconda nous permettant de faire tourner &lt;code&gt;conda&lt;/code&gt;. Une fois conda install√©, rendez-vous sur le terminal, accessible directement sur VSCode en bas de votre √©cran :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/setup_python/image-4.png"&gt;&lt;/p&gt;
&lt;p&gt;Vous pouvez maintenant cr√©er votre premier environnement virtuel, en tapant dans la console :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda&lt;span class="w"&gt; &lt;/span&gt;create&lt;span class="w"&gt; &lt;/span&gt;--name&lt;span class="w"&gt; &lt;/span&gt;mon_premier_env&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;python&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.12&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il n'est pas n√©cessaire de sp√©cifier la version de python pour cr√©er l'environnement mais c'est une bonne pratique, pour clarifier la version qui sera utilis√©e dans celui-ci. Vous pouvez aussi installer des packages directement √† la cr√©ation en mettant leurs noms √† la suite de la version de Python. &lt;br&gt;
Une fois cr√©√©, il ne reste plus qu'√† l'activer avec :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda&lt;span class="w"&gt; &lt;/span&gt;activate&lt;span class="w"&gt; &lt;/span&gt;mon_premier_env&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans votre terminal, la mention &lt;code&gt;(base)&lt;/code&gt; devrait √™tre remplac√©e par &lt;code&gt;(mon_premier_env)&lt;/code&gt;, vous indiquant que votre environnement est bien activ√©. 
Dor√©navant, les packages que vous installerez seront install√©s seulement pour celui-ci. Nous allons ici installer pandas avec : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;pandas
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Attention, √ßa n'est pas parce que vous utilisez &lt;code&gt;conda&lt;/code&gt; comme gestionnaire d'environnements que  vous ne pouvez pas utiliser &lt;code&gt;pip&lt;/code&gt; pour installer des packages. On pr√©f√®rera cependant utiliser &lt;code&gt;conda&lt;/code&gt; quand cela est possible pour faciliter les gestions de d√©pendances entre packages.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Enfin, pour sortir de votre environnement il vous suffit de taper :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda&lt;span class="w"&gt; &lt;/span&gt;deactivate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="les-notebooks-jupyter"&gt;Les notebooks jupyter&lt;/h2&gt;
&lt;p&gt;Normalement, vous avez d√©j√† install√© les extensions Jupyter et Python sur VSCode. Vous pouvez donc cliquer sur &lt;code&gt;File -&amp;gt; New File... -&amp;gt; Jupyter Notebook&lt;/code&gt;. Cela va vous cr√©er votre premier notebook, avec une extension &lt;code&gt;.ipynb&lt;/code&gt;. 
On vous recommande les notebooks pour la partie exploration de vos donn√©es car ils vous permettent de faire tourner des blocs de Python et aussi d'int√©grer du Markdown pour la mise en forme. C'est d'ailleurs des notebooks que l'on utilise pour r√©diger nos &lt;a href="https://blog.statoscop.fr"&gt;notes de blog sur Python&lt;/a&gt;. Une fois votre notebook ouvert, cliquez sur &lt;code&gt;Select kernel&lt;/code&gt; en haut √† droite de votre fichier :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/setup_python/image-3.png"&gt;&lt;/p&gt;
&lt;p&gt;Dans &lt;code&gt;Python Environments...&lt;/code&gt; vous allez normalement trouver votre environnement conda. Maintenant, cr√©ez une cellule de code et lancez :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;pd&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Et l√†... catastrophe :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/setup_python/image-5.png"&gt;&lt;/p&gt;
&lt;p&gt;Mais non, c'est normal! On a juste oubli√© de vous expliquer quelque chose. Les notebooks s'appuient sur une version am√©lior√©e de Python, que l'on appelle IPython. C'est une surcouche interactive de python qui permet notamment de faire tourner Python par blocs de code, comme dans les notebooks. Vous pouvez l'installer en clic-bouton comme cela vous est sugg√©r√©, ou revenir dans le terminal, activer votre environnement et lancer :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;conda&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;ipykernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Maintenant, vous pouvez importer votre package &lt;code&gt;pandas&lt;/code&gt; depuis votre notebook et lancer vos premi√®res analyses exploratoires. Il vous reste encore probablement de nombreux probl√®mes √† r√©soudre, mais on esp√®re que cet article vous aura bien accompagn√© pour vous lancer!  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="Python"></category><category term="Python"></category><category term="Data Science"></category><category term="conda"></category><category term="anaconda"></category><category term="vscode"></category><category term="notebook"></category></entry><entry><title>Comprendre et interpr√©ter les p-values</title><link href="https://blog.statoscop.fr/comprendre-et-interpreter-les-p-values.html" rel="alternate"></link><published>2024-07-09T00:00:00+02:00</published><updated>2024-07-09T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2024-07-09:/comprendre-et-interpreter-les-p-values.html</id><summary type="html">&lt;p&gt;Petite pr√©sentation intuitive des p-values et de leur utilisation dans nos mod√®les statistiques.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#les-p-values-et-les-tests-statistiques"&gt;Les p-values et les tests statistiques&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#interpretation-des-p-values"&gt;Interpr√©tation des p-values&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Aujourd'hui c'est √† un grand classique de la statistique que l'on s'attaque : la &lt;strong&gt;p-value, ou valeur p&lt;/strong&gt;. Fondamentale dans l'analyse des r√©sultats de la recherche scientifique, elle est pourtant &lt;strong&gt;souvent mal interpr√©t√©e&lt;/strong&gt;. C'est sur elle que l'on s'appuie pour &lt;strong&gt;confirmer ou infirmer une hypoth√®se&lt;/strong&gt; et juger de la &lt;strong&gt;significativ√© de nos r√©sultats&lt;/strong&gt;. Mais qu'est-ce que cela implique et comment bien appr√©hender ce qu'elle permet (et surtout ce qu'elle ne permet pas) de conclure? On essaye de voir √ßa ensemble, de la mani√®re la plus intuitive possible!  &lt;/p&gt;
&lt;h1 id="les-p-values-et-les-tests-statistiques"&gt;Les p-values et les tests statistiques&lt;/h1&gt;
&lt;p&gt;Pour comprendre les p-values, il faut aborder la notion de &lt;strong&gt;tests statistiques&lt;/strong&gt;. Ils permettent de tester une &lt;strong&gt;Hypoth√®se nulle &lt;code&gt;H0&lt;/code&gt;&lt;/strong&gt; contre une &lt;strong&gt;hypoth√®se alternative &lt;code&gt;H1&lt;/code&gt;&lt;/strong&gt;. Par exemple, prenons le cas d'une r√©gression lin√©aire o√π on cherche √† estimer des coefficients $\beta_i$ d√©crivant le lien entre une variable d'int√©r√™t  $Y$ et des variables explicatives $X_i$ :  &lt;/p&gt;
&lt;p&gt;$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \dots$&lt;/p&gt;
&lt;p&gt;Pour chaque coefficient estim√© $\beta_i$, on utilise le &lt;strong&gt;test t de Student&lt;/strong&gt; qui nous permet de tester les hypoth√®ses :&lt;br&gt;
- &lt;code&gt;H0&lt;/code&gt; : $\beta_i  = 0$&lt;br&gt;
- &lt;code&gt;H1&lt;/code&gt; : $\beta_i \neq 0$&lt;/p&gt;
&lt;p&gt;Le principe du test est le suivant : on va &lt;strong&gt;partir du principe que H0 est vrai&lt;/strong&gt; et on va voir &lt;strong&gt;quelle est la chance d'observer notre r√©sultat dans ce monde th√©orique&lt;/strong&gt;. Ce test statistique va ainsi nous donner la &lt;strong&gt;distribution possible des r√©sultats que l'on pourrait obtenir √† partir de diff√©rents √©chantillons si &lt;code&gt;H0&lt;/code&gt; √©tait vraie&lt;/strong&gt;. Selon o√π l'on se situe dans cette distribution, on va pouvoir juger de la &lt;strong&gt;vraisemblance de cette hypoth√®se H0&lt;/strong&gt;, en fonction d'un &lt;strong&gt;seuil alpha que l'on peut faire varier&lt;/strong&gt;. En fonction de la valeur de &lt;code&gt;t&lt;/code&gt; obtenue avec notre √©chantillon, on peut d√©cider de rejeter ou non l'hypoth√®se &lt;code&gt;H0&lt;/code&gt; :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/p_values/unnamed-chunk-1-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Sur le graphique ci-dessus, la zone rouge repr√©sente &lt;strong&gt;5% de l'aire de la courbe de densit√©&lt;/strong&gt;. Si la valeur obtenue par notre test est dans cette zone, on sait que &lt;strong&gt;cela repr√©senterait 5% ou moins des r√©sultats possibles que l'on aurait obtenus si &lt;code&gt;H0&lt;/code&gt; √©tait vraie&lt;/strong&gt;. On peut donc en d√©duire que &lt;strong&gt;la nullit√© du coefficient est peu probable&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;Bien s√ªr, si on modifie le seuil alpha dans un sens plus restrictif, mettant le seuil de significativit√© √† 1%, cela va restreindre la zone rouge de notre graphique. Il faudra alors obtenir &lt;strong&gt;une valeur &lt;code&gt;t&lt;/code&gt; encore plus extr√™me pour rejeter &lt;code&gt;H0&lt;/code&gt;&lt;/strong&gt; : &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/p_values/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ainsi, lorsqu'on fait tourner un mod√®le de r√©gression sur notre logiciel de statistiques favori et que l'on obtient une p-value, il s'agit du &lt;strong&gt;seuil alpha de notre hypoth√®se &lt;code&gt;H0&lt;/code&gt;&lt;/strong&gt; qui doit nous permettre de d√©cider de la rejeter ou non. On va donc l'utiliser pour d√©cider de la &lt;strong&gt;significativit√© de ce coefficient&lt;/strong&gt;. Si l'on devait synth√©tiser ce que veut dire la p-value en une phrase, cela donnerait :   &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Si la vraie valeur du coefficient √©tait 0 et que 
j'avais fait tourner ce mod√®le sur 100 √©chantillons 
diff√©rents, j'aurais obtenu un r√©sultat au moins 
aussi extr√™me dans p cas.   &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ainsi, &lt;strong&gt;plus p est faible, plus on peut √©carter l'hypoth√®se que le coefficient estim√© soit nul&lt;/strong&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;   &lt;/p&gt;
&lt;h1 id="interpretation-des-p-values"&gt;Interpr√©tation des p-values&lt;/h1&gt;
&lt;p&gt;Il faut bien comprendre que la p-value et la &lt;strong&gt;significativit√© du coefficient&lt;/strong&gt; qui en d√©coule ne portent que sur la question de savoir si ce coefficient est ou non diff√©rent de z√©ro. Cela n'indique pas si le r√©sultat trouv√© a une importance particuli√®re. Un coefficient peut tr√®s bien √™tre &lt;strong&gt;significatif statistiquement&lt;/strong&gt; (donc probablement diff√©rent de z√©ro) mais &lt;strong&gt;en pratique insignifiant&lt;/strong&gt;. Il faut donc le confronter √† l'expertise pratique de la question de recherche √©tudi√©e.  &lt;/p&gt;
&lt;p&gt;Une faible p-value n'est pas non plus le signe d'une &lt;strong&gt;estimation pr√©cise&lt;/strong&gt;. Pour juger de cet aspect, il est important de regarder &lt;strong&gt;les intervalles de confiance&lt;/strong&gt;. Un coefficient peut tr√®s bien √™tre &lt;strong&gt;significativement diff√©rent de z√©ro mais avoir un intervalle de confiance tr√®s large&lt;/strong&gt;, ce qui est tr√®s important √† consid√©rer en fonction des implications pratiques de votre recherche. On sait seulement que si par exemple &lt;strong&gt;l'intervalle de confiance √† 95% ne contient pas 0&lt;/strong&gt; (ou 1 si on estime des &lt;a href="https://blog.statoscop.fr/risques-relatifs-et-odds-ratios-comment-les-interpreter-et-les-comparer.html"&gt;odds-ratios&lt;/a&gt;), le &lt;strong&gt;coefficient estim√© est significatif √† au moins 5%&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;De plus, un r√©sultat peut √™tre &lt;strong&gt;non significatif en raison d'une mauvaise calibration du mod√®le&lt;/strong&gt; : un √©chantillon trop peu important, de trop nombreuses variables explicatives, etc... C'est notamment pour cette raison qu'il &lt;strong&gt;ne faut pas directement interpr√©ter un coefficient non significatif comme un absence d'effet&lt;/strong&gt;. C'est plut√¥t une absence de preuve d'effet. Oui, c'est moins facile √† r√©diger, mais cela rend plus justice √† la complexit√© des statistiques inf√©rentielles.    &lt;/p&gt;
&lt;p&gt;En g√©n√©ral, le consensus scientifique fixe le &lt;strong&gt;seuil de significativit√© √† 5%&lt;/strong&gt;. Bien s√ªr, c'est forc√©ment au moins partiellement arbitraire et cela pose question : on √©carterait un r√©sultat avec une p-value √† 5,1% mais on afficherait fi√®rement celui avec une p-value √† 4,9%?    &lt;/p&gt;
&lt;p&gt;Il est ainsi tentant pour les chercheurs de construire leur mod√®le en fonction de la p-value recherch√©e, et non de la question de recherche affich√©e, ce qui est compl√®tement contre-productif. D'autant que la nature de la p-value fait que &lt;strong&gt;si l'on teste un nombre tr√®s important de fois, on finira bien par trouver des r√©sultats significatifs&lt;/strong&gt;, mais uniquement du fait du hasard. Cette mauvaise pratique, volontaire ou non, est bien identifi√©e et se nomme le &lt;a href="https://en.wikipedia.org/wiki/Data_dredging"&gt;p-hacking&lt;/a&gt;. La bonne mani√®re de se pr√©munir de cet √©cueil est de &lt;strong&gt;d√©finir la question de recherche et les mod√®les statistiques en amont de la collecte de donn√©es&lt;/strong&gt; et de calibrer l'√©chantillon en fonction de ceux-ci. Il faut ensuite t√¢cher de ne pas s'√©carter de ces axes de recherche...m√™me si on n'obtient pas les p-values qu'on esp√©rait!  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;La p-value, √ßa n'est donc pas du tout la &lt;em&gt;probabilit√© que le coefficient soit incorrect&lt;/em&gt; ! Dans le cas d'une r√©gression, c'est un indicateur de la vraisemblance que celui-ci soit √©gal √† z√©ro. Mais &lt;strong&gt;un coefficient significatif peut aussi avoir une estimation tr√®s impr√©cise, ou une valeur insignifiante&lt;/strong&gt;. Il est donc fondamental d'affiner son diagnostic, avec par exemple les intervalles de confiance, et surtout l'interpr√©tation de quelqu'un qui comprend les implications pratiques d'un coefficient!  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site (qui a fait peau neuve, vous avez remarqu√©?)&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="Stats &amp; ML"></category><category term="statistiques"></category><category term="p-values"></category><category term="R"></category><category term="tests"></category></entry><entry><title>Taux standardis√©s : calcul et interpr√©tation avec R</title><link href="https://blog.statoscop.fr/taux-standardises-calcul-et-interpretation-avec-r.html" rel="alternate"></link><published>2023-05-17T00:00:00+02:00</published><updated>2023-05-17T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2023-05-17:/taux-standardises-calcul-et-interpretation-avec-r.html</id><summary type="html">&lt;p&gt;Pr√©sentation de la m√©thode de standardisation directe sur les taux de survie des passagers du Titanic.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-√†-pas des taux standardis√©s de survie au naufrage du Titanic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pour-conclure"&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cette note nous pr√©sentons la m√©thode de standardisation directe des taux, qui permet de comparer des fr√©quences d'√©v√®nement entre diff√©rentes sous-populations en contr√¥lant par une ou plusieurs autres variables. Apr√®s avoir d√©fini le principe g√©n√©ral de standardisation directe, on pr√©sente une mise en oeuvre pas-√†-pas de la m√©thode sur une √©tude de cas √† partir des donn√©es des passagers du Titanic.  &lt;/p&gt;
&lt;h1 id="principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/h1&gt;
&lt;p&gt;Les m√©thodes de standardisation des taux sont principalement √©tudi√©es en √©pid√©miologie. Elles permettent en effet de r√©pondre au probl√®me suivant : comment &lt;strong&gt;comparer des indicateurs √©pid√©miologiques&lt;/strong&gt; entre diff√©rents pays ayant leurs sp√©cificit√©s d√©mographiques? &lt;br&gt;
On peut lire par exemple sur le site des &lt;a href="https://donnees.banquemondiale.org"&gt;donn√©es de la banque mondiale&lt;/a&gt; que le taux de mortalit√© en 2020 en Australie est de 6 pour 1000 habitants, contre 12 pour 1000 habitants en Allemagne. Or, cet indicateur est bien s√ªr fortement influenc√© par la structure d'√¢ge de la population concern√©e. Pour correctement comparer cet indicateur entre l'Australie et l'Allemagne et √©ventuellement en tirer des conclusions sur des diff√©rences de qualit√© de vie entre les deux pays, il faudrait &lt;strong&gt;comparer ces taux √† structure d'√¢ge constante&lt;/strong&gt;. &lt;br&gt;
C'est pr√©cis√©ment ce que permet de faire la standardisation directe. Il est n√©cessaire pour cela de disposer du d√©tail de l'indicateur par tranche d'√¢ge dans chacun des pays. Dans notre exemple, une fois qu'on dispose des taux de mortalit√© par tranche d'√¢ge en Australie et en Allemagne, on les  applique √† &lt;strong&gt;une structure d'√¢ge de r√©f√©rence&lt;/strong&gt;, qui peut √™tre soit celle d'un des deux pays, soit celle du monde entier si on dispose de l'information. On peut alors obtenir un nouveau taux de mortalit√© global &lt;strong&gt;corrig√© de l'effet li√© √† l'√¢ge&lt;/strong&gt; et permettant une comparaison plus pertinente entre les pays. Voyons concr√®tement comment on peut mettre en oeuvre cette m√©thode sur une √©tude de cas en R.  &lt;/p&gt;
&lt;h1 id="analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donn√©es&lt;/h1&gt;
&lt;p&gt;Pour notre petit exemple, on s'appuie sur un dataset tr√®s connu : les &lt;a href="https://www.kaggle.com/c/titanic"&gt;donn√©es des passagers du Titanic&lt;/a&gt;. Les informations qui nous int√©ressent ici sont la classe √©conomique, l'√¢ge et le fait d'avoir surv√©cu ou non au naufrage. On ne garde que les observations ayant des valeurs renseign√©es pour ces 3 variables. On veut r√©pondre √† la question suivante : &lt;strong&gt;le fait d'√™tre dans une classe √©conomique ais√©e augmente-t-elle les chances de survie au nauffrage?&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;La premi√®re approche de cette question est bien s√ªr de calculer les taux de survie par classe √©conomique. le r√©sultat est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6373239&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4406130&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2614770&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet une forte disparit√© des taux de survie en fonction de la classe √©conomique, puisque les passagers de 1ere classe sont 63,7% √† survivre, contre 44,1% des passagers de seconde classe et 26,1% des passagers de 3e classe.&lt;br&gt;
Est-on bien s√ªr cependant que l'on observe &lt;strong&gt;l'effet de la classe √©conomique et pas d'un autre facteur de confusion&lt;/strong&gt;? On peut par exemple imaginer que l'√¢ge a un effet important sur la chance de survie, et qu'il est √©galement li√© √† la classe √©conomique choisie pour le voyage. V√©rifions ces hypoth√®ses en croisant la r√©partition en tranches d'√¢ge dans chaque classe :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# √Ä ce stade le df n&amp;#39;est plus group√© que par pclass&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Proportion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Proportion&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0528169&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3239437&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3697183&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2535211&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1264368&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5823755&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1954023&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0957854&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2115768&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6047904&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1576846&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0259481&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet que la classe 3 comporte bien plus de mineurs et bien moins de passagers de plus de cinquante ans que la premi√®re classe. Comme on s'y attendait, &lt;strong&gt;plus la classe √©conomique est ais√©e, plus les passagers ont un √¢ge √©lev√©&lt;/strong&gt;. Voyons maintenant si les taux de survie varient en fonction de l'√¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5259740&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3765996&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4085106&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4000000&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Les taux de survie ne semblent pas beaucoup varier en fonction de l'√¢ge, √† part pour les mineurs qui ont un taux de survie bien sup√©rieur aux autres. Croisons maintenant les taux de survie en fonction de la classe √©conomique &lt;strong&gt;et&lt;/strong&gt; de la tranche d'√¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8666667&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.7065217&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6285714&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5138889&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8787879&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4144737&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3333333&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2400000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate l√† plusieurs choses :&lt;br&gt;
- Au sein de chaque classe √©conomique il y a un lien tr√®s clair entre l'√¢ge et le taux de survie : plus on vieillit pluys celui-ci baisse.&lt;br&gt;
- Au sein de chaque tranche d'√¢ge, plus la classe √©conomique est √©lev√©e plus la chance de survie augmente. La seule exception est la tranche d'√¢ge 0 - 17 ans de la seconde classe qui a un taux de survie l√©g√®rement sup√©rieur √† la population du m√™me √¢ge de la 1ere classe (87,9% contre 86,7%).  &lt;/p&gt;
&lt;p&gt;Au vu de ces √©l√©ments il appara√Æt l√©gitime de calculer des taux standardis√©s pour comparer des fr√©quences de survie au sein de chaque classe corrig√©es de l'effet de l'√¢ge.  &lt;/p&gt;
&lt;h1 id="calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-√†-pas des taux standardis√©s de survie au naufrage du Titanic&lt;/h1&gt;
&lt;p&gt;Au vu des r√©sultats des taux de survie crois√©s par classe et √¢ge, on sait d√©j√† que la classe √©conomique et l'√¢ge jouent sur la chance de survie. Le calcul des taux standardis√©s de survie va permettre de quantifier &lt;strong&gt;l'effet de la classe √©conomique isol√© de l'effet √¢ge&lt;/strong&gt;. Le principe est le suivant : on calcule le taux de survie que l'on observerait dans chaque classe √©conomique &lt;strong&gt;si la r√©partition des passagers en classe d'√¢ge √©tait la m√™me que celle de la population de r√©f√©rence&lt;/strong&gt;. Dans notre exemple, la population de r√©f√©rence est l'ensemble des passagers.&lt;/p&gt;
&lt;p&gt;La premi√®re √©tape est de r√©cup√©rer les effectifs de classe d'√¢ge de la population de r√©f√©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eff&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;154&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;547&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;235&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On calcule ensuite comme pr√©c√©demment les taux de survie par tranche d'√¢ge de chaque classe √©conomique et on transforme la table pour avoir une colonne par classe √©conomique.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# taux de survie par classe et tranche d&amp;#39;√¢ge&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on transforme la table en largeur pour avoir trois colonnes&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# donnant le taux de survie&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;tidyr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;pivot_wider&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;names_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="c1"&gt;# option names_glue pour sp√©cifier le nom des variables cr√©√©es&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;names_glue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{.value}_{pclass}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8666667&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8787879&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.7065217&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4144737&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6285714&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3333333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5138889&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2400000&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il ne reste plus qu'√† fusionner les deux tables ainsi cr√©√©es et √† appliquer chacun des taux de survie aux effectifs par tranche d'√¢ge de la population de r√©f√©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;inner_join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;tr_age&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;
&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eff&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;154&lt;/td&gt;
&lt;td style="text-align: right;"&gt;133.46667&lt;/td&gt;
&lt;td style="text-align: right;"&gt;135.33333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56.660377&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;547&lt;/td&gt;
&lt;td style="text-align: right;"&gt;386.46739&lt;/td&gt;
&lt;td style="text-align: right;"&gt;226.71711&lt;/td&gt;
&lt;td style="text-align: right;"&gt;140.811881&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;235&lt;/td&gt;
&lt;td style="text-align: right;"&gt;147.71429&lt;/td&gt;
&lt;td style="text-align: right;"&gt;78.33333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;38.670886&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;110&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56.52778&lt;/td&gt;
&lt;td style="text-align: right;"&gt;26.40000&lt;/td&gt;
&lt;td style="text-align: right;"&gt;8.461538&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;Si l'utilisation d'across ne vous semble pas claire, je ne saurais trop vous recommander &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;notre pr√©c√©dent article de blog&lt;/a&gt; sur ce verbe bien pratique de dplyr.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On obtient finalement nos taux de survie standardis√©s en sommant les effectifs par tranche d'√¢ge et en divisant par l'effectif total :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;0.692329&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.446256&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2338477&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Par rapport aux taux de survie bruts pr√©sent√©s plus haut, on constate que &lt;strong&gt;les in√©galit√©s √©conomiques de survie s'aggravent apr√®s avoir contr√¥l√© par l'√¢ge&lt;/strong&gt;. Le taux de survie standardis√©s de la classe 1 et de la classe 3 sont en effet de 69,2% et 23,4 % contre 63,7% et 26,1% avant la correction. Cela correspond √† ce que l'on pouvait pressentir apr√®s l'analyse exploratoire puisque les passagers de la classe 3 sont plus jeunes et que les jeunes ont une meilleure chance de survie au sein de chaque classe √©conomique.   &lt;/p&gt;
&lt;h1 id="pour-conclure"&gt;Pour conclure&lt;/h1&gt;
&lt;p&gt;J'esp√®re que cet exemple vous aura permis de mieux appr√©hender la question de la standardisation directe. Bien s√ªr, la m√©thode utilis√©e ici comporte des limites, notamment l'utilisation de tranches d'√¢ge tr√®s larges qui pourraient fausser le r√©sultat. On peut par exemple penser que les enfants en bas √¢ge ont b√©n√©fici√© d'une attention toute particuli√®re, et ils se retrouvent ici dans la m√™me tranche d'√¢ge que des adolescents. Mais nous sommes √©galement contraints par les effectifs qui nous emp√™chent de faire une analyse trop fine de ces subtilit√©s. Si ces questions vous int√©ressent, vous pouvez vous reporter √† notre article sur &lt;a href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html"&gt;le dilemme biais-variance&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Enfin, nous avons pass√© sous silence une variable explicative tr√®s importante : le sexe des passagers. Les taux de survie sont en effet tr√®s diff√©rents pour les hommes et pour les femmes. Il est possible de reproduire cette analyse en prenant en compte cette variable, crois√©e √©galement avec l'√¢ge. Cependant, toujours en raison de trop faibles effectifs, il sera sans doute n√©cessaire d'agr√©ger encore plus les tranches d'√¢ge. Vous avez les cartes en main pour le faire, et mieux comprendre les fortunes diverses de Jack et Rose dans le c√©l√®bre film de la trag√©die...  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Risques relatifs et odds-ratios : comment les interpr√©ter et les comparer?</title><link href="https://blog.statoscop.fr/risques-relatifs-et-odds-ratios-comment-les-interpreter-et-les-comparer.html" rel="alternate"></link><published>2022-03-04T00:00:00+01:00</published><updated>2022-03-04T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2022-03-04:/risques-relatifs-et-odds-ratios-comment-les-interpreter-et-les-comparer.html</id><summary type="html">&lt;p&gt;Petite pr√©sentation des OR et des RR, et ce qu'ils veulent dire.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#probabilites-et-cotes"&gt;Probabilit√©s et cotes&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#definitions"&gt;D√©finitions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#lien-entre-cote-et-probabilite"&gt;Lien entre cote et probabilit√©&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#risques-relatifs-et-odds-ratios"&gt;Risques relatifs et odds ratios&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#interpretations"&gt;Interpr√©tations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#comment-choisir-lindicateur-adapte"&gt;Comment choisir l'indicateur adapt√©&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cet article, on s'int√©resse √† la relation entre probabilit√©s et cotes et aux implications concernant deux indicateurs souvent utilis√©s pour comparer le risque d'un √©v√®nement entre diff√©rents groupes d'individus : les risques relatifs (RR) et les odds ratios (OR). &lt;/p&gt;
&lt;h1 id="probabilites-et-cotes"&gt;Probabilit√©s et cotes&lt;/h1&gt;
&lt;h2 id="definitions"&gt;D√©finitions&lt;/h2&gt;
&lt;p&gt;La &lt;strong&gt;probabilit√©&lt;/strong&gt; correspond √† la vraisemblance d'un √©v√®nement. Elle est comprise entre 0 (√©v√®nement impossible) et 1 (√©v√®nement certain). On peut estimer une probabilit√© d'un √©v√®nement √† partir de sa &lt;strong&gt;fr√©quence&lt;/strong&gt;, au sens du rapport entre &lt;strong&gt;le nombre de fois o√π cet √©v√®nement est observ√©&lt;/strong&gt; et le &lt;strong&gt;nombre d'observations total&lt;/strong&gt; dont on dispose. En √©pid√©miologie, on parle aussi de &lt;strong&gt;pr√©valence&lt;/strong&gt;. Ainsi, si l'on constate par exemple √† un instant T que pour 100 personnes 20 sont atteintes d'une maladie, on en concluera que le &lt;strong&gt;taux de pr√©valence de cette maladie&lt;/strong&gt; est de 20%. On peut aussi en d√©duire que la probabilit√© qu'un individu tir√© au hasard ait cette maladie est de 20%.&lt;br&gt;
La &lt;strong&gt;cote&lt;/strong&gt; d'un √©v√®nement est le rapport entre &lt;strong&gt;le nombre de fois o√π cet √©v√®nement est observ√©&lt;/strong&gt; et le &lt;strong&gt;le nombre de fois o√π cet √©v√®nement n'est pas observ√©&lt;/strong&gt;. Pour notre maladie dont le taux de pr√©valence est de 20%, la cote est donc 20/80, car sur 100 personnes 20 ont la maladie et 80 ne l'ont pas. Notre cote est ainsi de 0,25. Si &lt;strong&gt;le taux de pr√©valence avait √©t√© de 50%, la cote aurait √©t√© de 1&lt;/strong&gt; (50/50) : c'est la valeur de la cote qui d√©finit un √©v√®nement qui a autant de chances de se produire que de ne pas se produire. Si le taux de pr√©valence avait √©t√© de 1, la cote aurait √©t√© de... l'infini (100/0). Les cotes vont ainsi de 0 √† l'infini. &lt;/p&gt;
&lt;h2 id="lien-entre-cote-et-probabilite"&gt;Lien entre cote et probabilit√©&lt;/h2&gt;
&lt;p&gt;Les valeurs des cotes de &lt;strong&gt;0 √† 1&lt;/strong&gt; correspondent aux &lt;strong&gt;√©v√®nements qui ont moins de chances d'arriver que de ne pas arriver&lt;/strong&gt; et ceux de &lt;strong&gt;1 √† l'infini&lt;/strong&gt; aux &lt;strong&gt;√©v√®nements qui ont plus de chances d'arriver que de ne pas arriver&lt;/strong&gt;. &lt;br&gt;
On peut repr√©senter le lien entre une probabilit√© et sa cote, en n'oubliant pas de passer l'axe repr√©sentant la cote en &lt;strong&gt;√©chelle logarithmique&lt;/strong&gt;. En effet, c'est ici cette √©chelle qui va permettre de rendre compte visuellement de la sym√©trie des valeurs entre 0 et 1 et de celles entre 1 et l'infini :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/or_rr/unnamed-chunk-1-1.png"&gt;&lt;/p&gt;
&lt;p&gt;Ainsi, une cote de 0,5 correspond √† &lt;strong&gt;deux fois moins de chances&lt;/strong&gt; que l'√©v√®nement arrive plut√¥t qu'il n'arrive pas et une cote de 2 correspond √† &lt;strong&gt;deux fois plus de chances&lt;/strong&gt; que l'√©v√®nement arrive plut√¥t qu'il n'arrive pas. C'est le m√™me raisonnement pour 0,1 et 10 (10 fois plus ou moins de chances), pour 0,01 et 100 (100 fois plus ou  moins de chance), etc...  &lt;/p&gt;
&lt;p&gt;Les cotes se d√©duisent donc directement des probabilit√©s. Mais lorsque l'on compare plusieurs populations, le choix de l'un ou l'autre des indicateurs va avoir une influence sur le r√©sultat obtenu.     &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;
&lt;h1 id="risques-relatifs-et-odds-ratios"&gt;Risques relatifs et odds ratios&lt;/h1&gt;
&lt;h2 id="interpretations"&gt;Interpr√©tations&lt;/h2&gt;
&lt;p&gt;Les risques relatifs (RR) et les odds ratios (OR) sont utilis√©s pour &lt;strong&gt;comparer le risque d'un √©v√®nement entre plusieurs populations&lt;/strong&gt;. Reprenons notre exemple de la maladie dont la pr√©valence est de 20% dans la population. Imaginons qu'on observe en fait que cette pr√©valence varie fortement selon le sexe, et qu'elle est de 10% chez les hommes et de 30% chez les femmes.&lt;br&gt;
Le risque relatif pour une femme par rapport √† un homme est &lt;strong&gt;le rapport de la probabilit√© pour une femme d'avoir cette maladie sur celle pour un homme&lt;/strong&gt;. Dans notre cas, ce risque relatif est donc de 3 (30%/10%). On interpr√®te ce r√©sultat comme le fait que les femmes ont 3 fois plus de chances d'avoir cette maladie que les hommes.&lt;br&gt;
L'odds ratio est &lt;strong&gt;le rapport de la cote de cette maladie pour une femme sur celle pour un homme&lt;/strong&gt;. La cote d'une femme est de 30/70, soit environ 0,43. Celle d'un homme est de 0,1/0,9, soit environ 0,11. Le rapport de ces cotes est donc de 3,9. Il est sensiblement diff√©rent du risque relatif et ne s'interpr√®te pas aussi ais√©ment. En effet, on ne peut pas ici affirmer que pr√®s de 4 fois plus de femmes ont cette maladie que les hommes, mais que la cote d'une femme est 4 fois plus √©lev√©e que celle d'un homme.  &lt;/p&gt;
&lt;h2 id="comment-choisir-lindicateur-adapte"&gt;Comment choisir l'indicateur adapt√©&lt;/h2&gt;
&lt;p&gt;Le d√©bat entre risques relatifs et odds-ratios vient souvent du fait que lorsque l'on veut faire un mod√®le qui contr√¥le par plusieurs facteurs de risque (par exemple sexe, √¢ge, classe sociale, type d'habitation...) on va le plus souvent se tourner vers la r√©gression logistique. Or ce mod√®le permet d'obtenir facilement les odds-ratio associ√©s √† ces diff√©rents facteurs de risque. Bien s√ªr, on peut d√©duire d'un odds ratio le risque relatif si on conna√Æt la pr√©valence de la variable d'int√©r√™t que l'on √©tudie, mais il devient compliqu√© d'op√©rer cette transformation lorsque l'on contr√¥le par plusieurs variables.&lt;br&gt;
Les risques relatifs sont souvent consid√©r√©s √† raison comme plus intuitifs et faciles √† pr√©senter. Ils ont cependant l'inconv√©nient de &lt;strong&gt;ne pas prendre en compte du tout le niveau de risque de base lorsqu'ils comparent deux populations&lt;/strong&gt;. Ainsi, qu'une probabilit√© passe de 0,5% √† 1%, de 25% √† 50% ou de 40% √† 80% entre deux groupes, le risque relatif sera toujours √©gal √† 2 (ou 0,5 selon le groupe de r√©f√©rence). Les OR seront bien √©gaux √† 2 dans le premier cas, mais √† 3 dans le second et √† 6 dans le dernier. &lt;strong&gt;Plus la pr√©valence de l'√©v√®nement qu'on observe est faible dans la population, plus les OR sont semblables aux RR&lt;/strong&gt;.&lt;br&gt;
Le d√©bat m√™me sur l'interpr√©tabilit√© des RR et des OR n'est pas √©vident. Consid√©rons un groupe A qui a une pr√©valence d'une maladie de 50% et un groupe B avec une pr√©valence de 100%. Est-il plus juste de dire qu'appartenir au groupe B multiplie son risque relatif d'avoir la maladie par 2 par rapport au groupe A comme nous le renseigne le RR ou par l'infini, comme le pr√©tend l'OR? Dans cet exemple, l'OR a l'avantage de capter une situation "extr√™me" o√π personne n'√©chapperait √† la maladie. Au niveau individuel, le &lt;em&gt;risque&lt;/em&gt; semble en effet infiniment de fois plus important dans le groupe B puisque l'√©v√®nement est...certain.&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Contrairement au risque relatif, les OR ne donnent pas les m√™mes r√©sultats en fonction de la pr√©valence initiale de l'√©v√®nement qu'ils d√©crivent. Cela peut √™tre un inconv√©nient quand il est interpr√©t√© √† tort comme un risque relatif, comme c'est souvent le cas. Mais il permet aussi de d√©crire plus justement le risque relatif de l'√©v√®nement &lt;strong&gt;par rapport au non-√©v√®nement&lt;/strong&gt;, et en ce sens ajoute de l'information. Le RR permet lui de mieux rendre compte des diff√©rences de fr√©quence d'un √©v√®nement entre plusieurs populations.&lt;br&gt;
Quelque soit l'indicateur choisi, il est important de &lt;strong&gt;ne pas pr√©senter seulement les OR ou les RR mais aussi la pr√©valence, ou la fr√©quence de l'√©v√®nement&lt;/strong&gt;, m√™me non contr√¥l√©e de tous les facteurs de risque. Cela permet au moins d'identifier si les OR ont de grandes chances ou non de diff√©rer fortement des RR. Ensuite, c'est √† vous de choisir quel indicateur correspond le mieux au type de r√©sultats que vous voulez pr√©senter.  &lt;br&gt;
C'est tout pour aujourd'hui! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="Stats &amp; ML"></category><category term="statistiques"></category><category term="odds-ratio"></category><category term="OR"></category><category term="probabilit√©s"></category></entry><entry><title>Le dilemme biais variance dans la mod√©lisation de donn√©es</title><link href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html" rel="alternate"></link><published>2021-11-08T00:00:00+01:00</published><updated>2021-11-08T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-11-08:/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html</id><summary type="html">&lt;p&gt;Pr√©sentation des enjeux th√©oriques et pratiques de l'arbitrage biais variance dans la construction d'un mod√®le de pr√©diction.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les mod√®les de Machine Learning&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un mod√®le&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;L'arbitrage biais variance est souvent √©voqu√© pour caract√©riser les enjeux de la construction d'un mod√®le de pr√©diction performant. L'id√©e de cet article est d'essayer de donner au lecteur les outils th√©oriques de cette question en essayant de privil√©gier une approche intuitive et pratique du probl√®me. Apr√®s avoir d√©fini ce que sont le biais et la variance, on pr√©sente les enjeux de cet arbitrage puis l'application concr√®te dans le cas de l'entra√Ænement d'un mod√®le de Machine Learning.&lt;/p&gt;
&lt;h1 id="que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/h1&gt;
&lt;p&gt;Pour expliquer le plus simplement possible ces concepts, on se place dans le contexte de l'observation de deux variables &lt;code&gt;Y&lt;/code&gt; et &lt;code&gt;X&lt;/code&gt;. Dans le cas d'une mod√©lisation d'une relation entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;, le biais d'un estimateur est son √©cart avec sa "vraie" valeur si on observait parfaitement la relation entre ces variables. On entend donc le biais comme &lt;strong&gt;l'√©cart entre la fonction mod√©lis√©e et la fonction th√©orique&lt;/strong&gt; qui permettrait de restituer le lien entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Une mani√®re de jouer sur le biais d'un mod√®le c'est de modifier sa variance. La variance est une mesure de dispersion de valeurs, qui donne une estimation de l'√©cart de celles-ci √† leur moyenne. La variance d'un mod√®le estime &lt;strong&gt;√† quel point celui-ci fluctue autour de sa moyenne pour coller aux donn√©es&lt;/strong&gt;. Une mesure utilis√©e couramment dans le cas des r√©gressions lin√©aires est le coefficient de d√©termination R2. Celui-ci calcule &lt;strong&gt;la part de la variance des donn√©es expliqu√©e par la variance du mod√®le&lt;/strong&gt;. Autrement dit, plus mon mod√®le sera proche des points de mes donn√©es, plus sa variance et donc le R2 seront √©lev√©s. Pour illustrer ce concept, on pr√©sente plusieurs mod√®les appliqu√©s au m√™me jeu de donn√©es avec une variance plus ou moins √©lev√©e :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-1-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Pour chaque mod√®le, la courbe du mod√®le est celle qui appara√Æt en rouge et on a mis en √©vidence en vert la projection de chaque point sur sa valeur pr√©dite par le mod√®le. Voyons comment interpr√©ter ces graphiques :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Le premier mod√®le est un mod√®le na√Øf qui se contente de pr√©dire que pour chaque valeur de &lt;code&gt;X&lt;/code&gt;, &lt;code&gt;Y&lt;/code&gt; sera √©gale √† sa moyenne. Par d√©finition donc, sa variance est nulle et sa capacit√© pr√©dictive faible.  &lt;/li&gt;
&lt;li&gt;Le second mod√®le est une r√©gression lin√©aire simple qui a un R2 d'environ 50%. Il a donc une meilleure qualit√© pr√©dictive que le premier mod√®le du fait qu'il capte une partie de la variance des donn√©es, ici √† travers une corr√©lation positive entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;.  &lt;/li&gt;
&lt;li&gt;Le troisi√®me mod√®le est un mod√®le polynomial dont on voit qu'il est plus ajust√© que le second. Les points pr√©dits (en vert) par la courbe sont en effet plus proche des points que pour le pr√©c√©dent mod√®le et m√©caniquement cela fait augmenter le R2. Le fait d'utiliser un mod√®le polynomial a donn√© au mod√®le une plus grande souplesse ce qui lui a permis de se rapprocher de certains points extr√™mes qui √©taient √©loign√©s de la droite de r√©gression du second mod√®le.  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ainsi, plus la variance augmente, plus le mod√®le pr√©dit en moyenne des valeurs proches de leurs vraies valeurs, ce qui fait diminuer le biais, puisqu'il est d√©fini comme l'√©cart entre notre fonction de pr√©diction et une fonction qui permettrait de pr√©dire parfaitement les donn√©es observ√©es.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;
&lt;h1 id="enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/h1&gt;
&lt;p&gt;D'apr√®s ce qu'on a vu, pourquoi alors ne pas simplement chercher √† maximiser la variance pour minimiser le biais, c'est-√†-dire son √©cart aux vraies valeurs? Tout simplement parce que dans le cas de la construction d'un mod√®le de pr√©diction, nous mod√©lisons des relations entre des donn√©es √† partir d'un √©chantillon pour pr√©dire un r√©sultat sur une nouvelle population. C'est donc la performance de ce mod√®le sur de nouvelles donn√©es qui va nous int√©resser. Or, comme vous avez pu le pressentir en observant les graphiques pr√©c√©dents, &lt;strong&gt;un mod√®le avec une variance tr√®s √©lev√©e se g√©n√©ralise mal √† de nouvelles donn√©es&lt;/strong&gt;. D'un autre c√¥t√©, &lt;strong&gt;un mod√®le avec une faible variance aura lui aussi une qualit√© pr√©dictive tr√®s faible&lt;/strong&gt; car il captera mal une √©ventuelle relation entre les variables.&lt;/p&gt;
&lt;p&gt;Tout le probl√®me de cet arbitrage (ou dilemme) biais variance est donc de &lt;strong&gt;trouver un mod√®le qui ait une variance suffisamment forte pour limiter le biais mais suffisamment faible pour qu'il soit g√©n√©ralisable&lt;/strong&gt;. Les mod√®les pr√©c√©dents avaient √©t√© entra√Æn√©s sur une base de donn√©es qui √©tait un √©chantillon al√©atoire correspondant √† 10% des donn√©es d'un √©chantillon plus important. Pour mesurer la qualit√© pr√©dictive de ces mod√®les on les applique donc aux donn√©es enti√®res et on calcule l'√©cart moyen au carr√© de la pr√©diction √† la vraie valeur, c'est-√†-dire l'erreur quadratique moyenne ou en anglais &lt;strong&gt;MSE&lt;/strong&gt; pour &lt;em&gt;Mean Squared Error&lt;/em&gt; :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate que, comme attendu, le mod√®le avec le plus de variance se g√©n√©ralise mal √† des donn√©es non connues et pr√©sente une erreur de pr√©diction sup√©rieure √† celle du mod√®le lin√©aire simple. En effet, les variations de la courbe polynomiale qui lui permettait de coller au plus pr√®s des donn√©es sur lesquelles elle a √©t√© construite entra√Æne beaucoup de pr√©dictions tr√®s √©loign√©es de la vraie valeur des nouvelles donn√©es.&lt;br&gt;
L'erreur attendue d'un mod√®le de pr√©diction sur des donn√©es sur lesquelles il ne s'est pas entra√Æn√© peut en effet se d√©composer en &lt;strong&gt;la somme du biais au carr√© et de la variance de ce mod√®le, c'est la d√©composition biais-variance de l'erreur quadratique&lt;/strong&gt;. Si vous pr√©f√©rez vous en convaincre avec la formule et la d√©monstration math√©matique, vous pouvez vous r√©f√©rer √† &lt;a href="https://fr.wikipedia.org/wiki/Dilemme_biais-variance#D√©composition_biais-variance_de_l'erreur_quadratique"&gt;la page wikip√©dia qui en parle&lt;/a&gt;. Comme le biais diminue avec la variance, il faut donc trouver un niveau de complexit√© du mod√®le qui permette √† la fois de minimiser l'√©cart √† la vraie valeur (faible biais en augmentant la variance) et d'√™tre g√©n√©ralisable en dehors de son √©chantillon d'entra√Ænement (faible variance).&lt;/p&gt;
&lt;h1 id="liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les mod√®les de Machine Learning&lt;/h1&gt;
&lt;h2 id="appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/h2&gt;
&lt;p&gt;Le principe de l'apprentissage automatique supervis√© est le m√™me que celui qu'on a pr√©sent√© jusqu'√† maintenant : on renseigne au mod√®le des variables explicatives (&lt;code&gt;X&lt;/code&gt;) et une variable d'int√©r√™t (&lt;code&gt;Y&lt;/code&gt;) qu'on aimerait pouvoir ensuite pr√©dire √† partir de nouvelles donn√©es &lt;code&gt;X&lt;/code&gt;. Par exemple, on renseigne des photos de chats et de chiens √©tiquett√©es : &lt;code&gt;Y&lt;/code&gt; est alors le label "chien" ou "chat" de la photo, &lt;code&gt;X&lt;/code&gt; la matrice de pixels de la photo. Le mod√®le devra √™tre ensuite capable de pr√©dire √† partir d'une photo qu'il n'a jamais vue si celle-ci repr√©sente un chat ou un chien. Pour mesurer la qualit√© pr√©dictive de notre mod√®le, on r√©serve des donn√©es labellis√©es sur lesquelles il ne s'entra√Ænera pas. On va ensuite lui demander de pr√©dire les labels d√©j√† connus de ces donn√©es, ce qui va nous permettre d'√©valuer la qualit√© de ces pr√©dictions. Cet √©chantillon est en g√©n√©ral appel√© &lt;strong&gt;√©chantillon test&lt;/strong&gt; (&lt;em&gt;test set&lt;/em&gt; en anglais), et les donn√©es sur lesquelles le mod√®le est entra√Æn√© s'appelle l'&lt;strong&gt;√©chantillon d'entra√Ænement&lt;/strong&gt; (&lt;em&gt;train set&lt;/em&gt;). En g√©n√©ral, si l'on dispose de suffisamment de donn√©es, on n'aura pas trop de mal √† construire un mod√®le qui parviendra √† labelliser quasiment parfaitement &lt;strong&gt;nos donn√©es d'entra√Ænement&lt;/strong&gt;. Tout le probl√®me est d'avoir un mod√®le qui se g√©n√©ralise correctement √† de nouvelles donn√©es.&lt;/p&gt;
&lt;h2 id="courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un mod√®le&lt;/h2&gt;
&lt;p&gt;Pour sch√©matiser, imaginons que dans les donn√©es d'entra√Ænement les chiens soient en g√©n√©ral photographi√©es √† l'ext√©rieur et les chats √† l'int√©rieur. Si mon mod√®le a une forte variance, cela signifie qu'il va prendre en compte beaucoup de d√©tails de la photo. Il va par exemple donner du poids aux √©l√©ments de fond dans sa pr√©diction et sera incapable de labelliser correctement un chien photographi√© √† l'int√©rieur. Un mod√®le bien plus basique qui se serait appuy√© par exemple uniquement sur la forme des oreilles de l'animal aurait peut-√™tre de meilleurs r√©sultats.&lt;br&gt;
Dans le premier cas, on dit que l'on est dans une situation de &lt;strong&gt;surapprentissage, ou overfitting&lt;/strong&gt;. Le mod√®le a int√©gr√© des √©l√©ments anecdotiques, du bruit, dans son processus d√©cisionnel et cela va r√©duire sa performance pr√©dictive sur des donn√©es non connues. Autrement dit, &lt;strong&gt;sa variance est trop √©lev√©e&lt;/strong&gt;. Si au contraire le mod√®le est trop peu complexe et n'a pas int√©gr√© assez d'informations pour diff√©rencier un chat d'un chien m√™me sur les donn√©es d'apprentissage, on dit qu'il est dans un √©tat de &lt;strong&gt;sous-apprentissage, ou underfitting&lt;/strong&gt;.&lt;br&gt;
&lt;strong&gt;Dans les deux cas, le mod√®le va avoir de mauvaises performances pr√©dictives sur des nouvelles donn√©es&lt;/strong&gt;. Ce constat peut √™tre sch√©matis√© de la mani√®re suivante :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/courb_apprent.png"&gt;  &lt;/p&gt;
&lt;p&gt;Notons bien ici que cette relation entre complexit√© du mod√®le et d√©composition de l'erreur de pr√©diction s'entend &lt;strong&gt;√† taille d'√©chantillon fix√©e&lt;/strong&gt;. Ainsi, plus l'√©chantillon sera grand, plus le mod√®le pourra √™tre complexe avant d'entrer dans la phase de surapprentissage.  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans le cadre d'une &lt;strong&gt;d√©marche pr√©dictive&lt;/strong&gt;, il est donc tout √† fait naturel de limiter l'apprentissage du mod√®le pour optimiser ses capacit√©s pr√©dictives. Cela peut √™tre fait en r√©duisant le nombre de variables pr√©dictives utilis√©es, en limitant le nombre de couches de neurones dans un r√©seau, mais aussi en utilisant des m√©thodes de r√©duction des dimensions, comme &lt;a href="https://blog.statoscop.fr/acp-python.html"&gt;nous vous l'avions montr√© avec l'analyse en composantes principales&lt;/a&gt;. Bien s√ªr, dans une &lt;strong&gt;d√©marche explicative&lt;/strong&gt;, il sera au contraire normal de sacrifier √©ventuellement une meilleure capacit√© pr√©dictive pour mettre en √©vidence une relation avec une variable explicative. Si vous souhaitez aller plus loin, vous pouvez parcourir l'excellente √©tude de &lt;a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf"&gt;Shmueli, 2010&lt;/a&gt; qui expose les enjeux crois√©s des d√©marches explicative et pr√©dictive dans la mod√©lisation.&lt;br&gt;
Il me reste √† remercier &lt;a href="https://twitter.com/EParoissien"&gt;Emmanuel Paroissien&lt;/a&gt;, chercheur √† l'Inra, pour nos √©changes qui m'ont aid√© √† construire cette note. N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;d√©p√¥t github de nos notes de blog&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category><category term="Machine Learning"></category></entry><entry><title>Analyse en composantes principales avec Python</title><link href="https://blog.statoscop.fr/acp-python.html" rel="alternate"></link><published>2021-04-16T00:00:00+02:00</published><updated>2021-04-16T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-04-16:/acp-python.html</id><summary type="html">&lt;p&gt;Pr√©sentation et exemples d'utilisation de l'ACP en statistiques et data science.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#comprendre-et-interpreter-une-acp"&gt;Comprendre et interpr√©ter une ACP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-oeuvre-dune-acp-avec-python"&gt;Mise en oeuvre d'une ACP avec Python&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#analyse-exploratoire-de-nos-donnees"&gt;Analyse exploratoire de nos donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-lacp-pour-la-reduction-de-dimensions-en-machine-learning"&gt;Utilisation de l'ACP pour la r√©duction de dimensions en Machine Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cet article, nous allons essayer de comprendre intuitivement comment fonctionne l'analyse en composantes principales. Nous pr√©senterons ensuite √† quoi celle-ci peut servir en prenant les exemples d'une analyse exploratoire des donn√©es et d'une probl√©matique de r√©duction de dimension.   &lt;/p&gt;
&lt;h1 id="comprendre-et-interpreter-une-acp"&gt;Comprendre et interpr√©ter une ACP&lt;/h1&gt;
&lt;p&gt;L'analyse en composantes principales est une &lt;strong&gt;m√©thode consistant √† transformer des variables corr√©l√©es entre elles en nouvelles variables&lt;/strong&gt;. Chacune de ces nouvelles variables est le r√©sultat d'une combinaison lin√©aire des anciennes variables. &lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note : une combinaison lin√©aire de 3 variables $V_1$, $V_2$ et $V_3$ s'√©crit $\alpha_1.V_1 + \alpha_2.V_2 + \alpha_3.V_3$ o√π les $\alpha_i$ sont des coefficients r√©els.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Ces nouvelles variables sont appel√©es &lt;strong&gt;composantes principales&lt;/strong&gt; et sont, par contruction, d√©corr√©l√©es les unes des autres.  &lt;/p&gt;
&lt;p&gt;Autrement dit, l'ACP projette vos donn√©es dans un nouvel espace. La &lt;strong&gt;premi√®re composante principale est construite de mani√®re √† capter la plus grande variance possible de vos donn√©es&lt;/strong&gt;, la seconde la part la plus importante de &lt;strong&gt;la variance possible restant √† expliquer&lt;/strong&gt;, et ainsi de suite.  &lt;/p&gt;
&lt;p&gt;Une illustration brillante de ce processus est propos√©e par &lt;a href="https://www.allisonhorst.com/" target="_blank"&gt;Allison Horst&lt;/a&gt;. Elle &lt;a href="https://twitter.com/allison_horst/status/1288904459490213888" target="_blank"&gt;repr√©sente&lt;/a&gt; un jeu de donn√©es √† deux dimensions avec des crevettes et l'analyse en composantes principales comme les passages d'un requin-baleine affam√© :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_3_0.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_4_0.png"&gt;&lt;/p&gt;
&lt;p&gt;La probl√©matique du requin-baleine est en effet la m√™me que celle de la cr√©ation d'une premi√®re composante principale : &lt;strong&gt;quel axe choisir pour avaler un maximum de crevettes&lt;/strong&gt; d√®s le premier passage? L'axe choisi va ressembler √† celui-ci :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_6_0.png"&gt;&lt;/p&gt;
&lt;p&gt;Il s'agit pour le requin de choisir la droite de sorte qu'il y ait un maximum de crevettes sur son parcours ce qui revient √† ce que les crevettes soient &lt;strong&gt;le plus proche possible de cette droite&lt;/strong&gt;. Math√©matiquement, la premi√®re composante principale est &lt;strong&gt;la combinaison lin√©aire des deux axes $x$ et $y$ qui maximise l'inertie projet√©e&lt;/strong&gt;, ce qui revient √† minimiser les √©carts entre les points et cette droite.&lt;/p&gt;
&lt;p&gt;Dans cet exemple, la seconde composante principale sera l'axe perpendiculaire √† ce premier axe.&lt;/p&gt;
&lt;p&gt;Si les points √©taient parfaitement align√©s sur une ligne, l'ensemble de la variance serait expliqu√© par la premi√®re composante et on serait parvenus √† r√©duire le nombre de dimensions de notre probl√®me sans perte d'information.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="mise-en-oeuvre-dune-acp-avec-python"&gt;Mise en oeuvre d'une ACP avec Python&lt;/h1&gt;
&lt;p&gt;D'accord, on a projet√© notre jeu de donn√©es dans un nouvel espace avec des nouvelles "variables" d√©crites comme combinaisons lin√©aires des pr√©c√©dentes telles que la premi√®re explique la plus grande partie de la variance possible, la seconde la plus grande partie de la variance restant √† expliquer, etc... Mais √ßa nous sert √† quoi?   &lt;/p&gt;
&lt;h2 id="analyse-exploratoire-de-nos-donnees"&gt;Analyse exploratoire de nos donn√©es&lt;/h2&gt;
&lt;p&gt;La caract√©ristique des composantes principales par rapport au jeu de donn√©es non transform√© est que &lt;strong&gt;les premi√®res composantes principales ont un fort pouvoir discriminant&lt;/strong&gt;, puisqu'elles expliquent une grande partie de la variance totale du jeu de donn√©es. Ainsi, repr√©senter notre jeu de donn√©es par rapport aux deux premiers axes de l'ACP peut permettre de v√©rifier que &lt;strong&gt;ces donn√©es permettent bien de distinguer diff√©rentes classes&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;Prenons comme exemple la base de donn√©es &lt;code&gt;wine&lt;/code&gt; que l'on peut charger directement depuis le module &lt;code&gt;sklearn&lt;/code&gt;. Cette base de donn√©es contient des r√©sultats d'analyses chimiques de 178 vins de 3 diff√©rents producteurs. Ces r√©sultats sont synth√©tis√©s par 13 mesures diff√©rentes que l'on retrouve dans les donn√©es. Pour &lt;strong&gt;voir si ces mesures permettent ou non de distinguer les vins des trois producteurs&lt;/strong&gt;, nous allons commencer par repr√©senter les vins sur &lt;strong&gt;l'espace des deux premi√®res composantes principales&lt;/strong&gt;. Pour cela, on importe les donn√©es et on les centre-r√©duit avant d'appliquer notre ACP avec la fonction &lt;code&gt;sklearn.decomposition.PCA&lt;/code&gt;. On param√®tre celle-ci pour qu'elle nous renvoie seulement les deux premi√®res composantes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;numpy&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="nn"&gt;np&lt;/span&gt;
&lt;span class="c1"&gt;# Import fonction ACP&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn.decomposition&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;PCA&lt;/span&gt;

&lt;span class="c1"&gt;# Import donn√©es&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn.datasets&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_wine&lt;/span&gt;

&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_wine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;return_X_y&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;target_names&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_wine&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;target_names&lt;/span&gt;
&lt;span class="n"&gt;feature_names&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;load_wine&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;feature_names&lt;/span&gt;
&lt;span class="c1"&gt;# on standardise nos donn√©es : &lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn.preprocessing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StandardScaler&lt;/span&gt;
&lt;span class="n"&gt;values_cr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StandardScaler&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit_transform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# On param√®tre notre PCA pour garder les deux premi√®res composantes&lt;/span&gt;
&lt;span class="n"&gt;pca&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PCA&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;pca_wine&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pca&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit_transform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;values_cr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# en sortie : le m√™me nombre de lignes que les donn√©es en entr√©es&lt;/span&gt;
&lt;span class="c1"&gt;# et le nombre de variables correspondant au nombre de composantes&lt;/span&gt;
&lt;span class="c1"&gt;# conserv√©es&lt;/span&gt;
&lt;span class="n"&gt;pca_wine&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;(178, 2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;En sortie, &lt;strong&gt;nous obtenons les vecteurs des deux premi√®res composantes dans l'objet &lt;code&gt;pca_wine&lt;/code&gt;&lt;/strong&gt;. Notons que nous aurions pu param√©trer la fonction &lt;code&gt;PCA&lt;/code&gt; de mani√®re √† ce qu'elle nous renvoie le nombre de composantes n√©cessaire √† expliquer &lt;code&gt;X&lt;/code&gt;% de la variance, comme nous le ferons par la suite. Depuis l'objet &lt;code&gt;pca&lt;/code&gt;, on peut voir &lt;strong&gt;le vecteur de la variance expliqu√©e par chaque composante&lt;/strong&gt; avec &lt;code&gt;pca.explained_variance_ratio_&lt;/code&gt; et donc la variance totale expliqu√©e par nos deux composantes en sommant les √©l√©ments de ce vecteur :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;pca&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;explained_variance_ratio_&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;0.554063383569353&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On explique donc 55 % de la variance totale de nos donn√©es avec 2 composantes, alors que celle-ci contient 13 variables. Voyons si cela suffit √† discriminer nos 3 producteurs visuellement :  &lt;/p&gt;
&lt;!--- ![Pelican](../images/acp/output_13_0.png)--&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_13_0.png" style="max-width:80% !important" &gt;&lt;/p&gt;
&lt;p&gt;On constate ici que &lt;strong&gt;les 3 producteurs sont bien r√©partis dans des zones distinctes du plan&lt;/strong&gt; et ce r√©sultat semble montrer que chacun produit des types de vin caract√©ristiques.&lt;/p&gt;
&lt;p&gt;On peut se convaincre que l'ACP a bien jou√© son r√¥le en produisant le m√™me type de sch√©ma avec deux autres variables originales du jeu de donn√©es (sans transformation lin√©aire), disons le degr√© d'alcool et l'intensit√© de la couleur. On s'attend bien s√ªr √† ce que &lt;strong&gt;les classes soient moins discrimin√©es qu'avec les deux premi√®res composantes principales&lt;/strong&gt; :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_15_0.png" style="max-width:80% !important" &gt;&lt;/p&gt;
&lt;p&gt;Ces variables permettent de distinguer des tendances, comme le fait que le producteur 1 produit des vins plut√¥t moins alcoolis√©s et dont la couleur est peu intense alors que le producteur 0 produit des vins plus alcoolis√©s. Mais &lt;strong&gt;ces variables seules ne permettent pas de partitionner nos classes aussi clairement qu'avec les deux premi√®res composantes de notre ACP&lt;/strong&gt;.   &lt;/p&gt;
&lt;p&gt;L'ACP ne permet certes pas au premier coup d'oeil de proposer une interpr√©tation des r√©sultats, mais il est n√©anmoins possible d'√©tudier comment chaque variable contribue aux composantes avec l'instruction &lt;code&gt;pca.components_&lt;/code&gt; :  &lt;/p&gt;
&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;Noms des variables&lt;/th&gt;
      &lt;th&gt;Composante 1&lt;/th&gt;
      &lt;th&gt;Composante 2&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;alcohol&lt;/td&gt;
      &lt;td&gt;0.144329&lt;/td&gt;
      &lt;td&gt;-0.483652&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;malic_acid&lt;/td&gt;
      &lt;td&gt;-0.245188&lt;/td&gt;
      &lt;td&gt;-0.224931&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2&lt;/th&gt;
      &lt;td&gt;ash&lt;/td&gt;
      &lt;td&gt;-0.002051&lt;/td&gt;
      &lt;td&gt;-0.316069&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;3&lt;/th&gt;
      &lt;td&gt;alcalinity_of_ash&lt;/td&gt;
      &lt;td&gt;-0.239320&lt;/td&gt;
      &lt;td&gt;0.010591&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;4&lt;/th&gt;
      &lt;td&gt;magnesium&lt;/td&gt;
      &lt;td&gt;0.141992&lt;/td&gt;
      &lt;td&gt;-0.299634&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;5&lt;/th&gt;
      &lt;td&gt;total_phenols&lt;/td&gt;
      &lt;td&gt;0.394661&lt;/td&gt;
      &lt;td&gt;-0.065040&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;6&lt;/th&gt;
      &lt;td&gt;flavanoids&lt;/td&gt;
      &lt;td&gt;0.422934&lt;/td&gt;
      &lt;td&gt;0.003360&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;7&lt;/th&gt;
      &lt;td&gt;nonflavanoid_phenols&lt;/td&gt;
      &lt;td&gt;-0.298533&lt;/td&gt;
      &lt;td&gt;-0.028779&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;8&lt;/th&gt;
      &lt;td&gt;proanthocyanins&lt;/td&gt;
      &lt;td&gt;0.313429&lt;/td&gt;
      &lt;td&gt;-0.039302&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;9&lt;/th&gt;
      &lt;td&gt;color_intensity&lt;/td&gt;
      &lt;td&gt;-0.088617&lt;/td&gt;
      &lt;td&gt;-0.529996&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;10&lt;/th&gt;
      &lt;td&gt;hue&lt;/td&gt;
      &lt;td&gt;0.296715&lt;/td&gt;
      &lt;td&gt;0.279235&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;11&lt;/th&gt;
      &lt;td&gt;od280/od315_of_diluted_wines&lt;/td&gt;
      &lt;td&gt;0.376167&lt;/td&gt;
      &lt;td&gt;0.164496&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;12&lt;/th&gt;
      &lt;td&gt;proline&lt;/td&gt;
      &lt;td&gt;0.286752&lt;/td&gt;
      &lt;td&gt;-0.364903&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;Ce tableau repr√©sente &lt;strong&gt;les coefficients de la combinaison lin√©aire des variables pour chaque composante&lt;/strong&gt;. Il nous permet par exemple de constater que l'intensit√© de la couleur et l'alcool jouent fortement et n√©gativement sur la seconde composante. Cela correspond √† ce que l'on observait dans les deux graphiques pr√©c√©dents puisque les vins des producteurs 0 et 2 ont des valeurs n√©gatives sur l'axe de la seconde composante (1er graphique) et ce sont bien ceux dont le taux en alcool et l'intensit√© de la couleur sont les plus importants (2e graphique)&lt;/p&gt;
&lt;h2 id="utilisation-de-lacp-pour-la-reduction-de-dimensions-en-machine-learning"&gt;Utilisation de l'ACP pour la r√©duction de dimensions en Machine Learning&lt;/h2&gt;
&lt;p&gt;La propri√©t√© de l'ACP de &lt;strong&gt;capter une partie importante de la variance des donn√©es √† partir de moins de variables&lt;/strong&gt; est particuli√®rement int√©ressante dans le domaine du Machine Learning pour √™tre capable de fournir des pr√©dictions avec des mod√®les plus l√©gers (car utilisant moins de variables) et des r√©sultats au moins aussi performants.&lt;br&gt;
Pour notre exemple, m√™me si la r√©duction de dimensions n'est pas un enjeu fondamental vu le faible nombre de variables, nous pouvons tester si nous parvenons √† faire un mod√®le de pr√©diction de l'origine du vin (producteur 0, 1 ou 2) en r√©duisant le nombre de dimensions.&lt;br&gt;
Tout d'abord, commen√ßons par d√©terminer ce nombre de dimensions. Le graphique suivant nous donne &lt;strong&gt;l'√©volution de la variance expliqu√©e en fonction du nombre de composantes&lt;/strong&gt; :   &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/acp/output_20_0.png" style="max-width:80% !important" &gt;&lt;/p&gt;
&lt;p&gt;L'ACP permettrait d'expliquer plus de 70% de la variance totale d√®s 4 composantes. Pour voir si cela est suffisant pour entra√Æner un mod√®le de pr√©diction, on peut &lt;strong&gt;comparer les performances d'un arbre de classification sur les donn√©es transform√©es apr√®s PCA et sur les donn√©es brutes&lt;/strong&gt;. On utilise une m√©thode de validation crois√©e pour estimer les performances du mod√®le qui consiste √† partitionner les donn√©es en 5 groupes et √† entra√Æner les donn√©es sur 4 groupes et les tester sur celui restant. On fait cela 5 fois pour parcourir le champ des possibles et on √©value la pr√©cision globale du mod√®le en faisant la moyenne de ces 5 r√©sultats. Cette m√©thode doit permettre d'estimer la qualit√© du mod√®le sur des donn√©es sur lesquelles il n'a pas √©t√© entra√Æn√© et de ne pas prendre en compte le surapprentissage dans son √©valuation. Le tableau suivant donne les taux de pr√©cision obtenus pour chaque m√©thode, c'est √† dire le nombre de vins correctement classifi√©s sur le nombre de vins total.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Plut√¥t que de renseigner le nombre de composantes &lt;/span&gt;
&lt;span class="c1"&gt;# on renseigne la valeur minimum de la variance &lt;/span&gt;
&lt;span class="c1"&gt;# expliqu√©e totale que l&amp;#39;on souhaite&lt;/span&gt;
&lt;span class="n"&gt;pca&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;PCA&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.70&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; 
&lt;span class="n"&gt;wine_pca&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pca&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fit_transform&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;values_cr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# On entra√Æne notre mod√®le et on l&amp;#39;√©value avec une &lt;/span&gt;
&lt;span class="c1"&gt;# m√©thode de validation crois√©e &lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn.model_selection&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;cross_val_score&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;sklearn.tree&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DecisionTreeClassifier&lt;/span&gt;
&lt;span class="n"&gt;clf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DecisionTreeClassifier&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;random_state&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;mean_pca&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cross_val_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;wine_pca&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cv&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;mean_all&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cross_val_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;clf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cv&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;pd&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DataFrame&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Pr√©cision moyenne apr√®s ACP&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mean_pca&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
              &lt;span class="s2"&gt;&amp;quot;Pr√©cision moyenne sans ACP&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mean_all&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; 
              &lt;span class="s2"&gt;&amp;quot;Nombre de composantes&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;wine_pca&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div&gt;
&lt;style scoped&gt;
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
&lt;/style&gt;
&lt;table border="1" class="dataframe"&gt;
  &lt;thead&gt;
    &lt;tr style="text-align: right;"&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;Pr√©cision moyenne apr√®s ACP&lt;/th&gt;
      &lt;th&gt;Pr√©cision moyenne sans ACP&lt;/th&gt;
      &lt;th&gt;Nombre de composantes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;0.933175&lt;/td&gt;
      &lt;td&gt;0.887619&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;On constate que &lt;strong&gt;l'ACP n'a pas seulement permis de r√©duire le nombre de dimensions de notre probl√®me, elle nous offre aussi une pr√©cision globale du mod√®le sup√©rieure&lt;/strong&gt;. Cela n'est pas toujours le cas - puisque √ßa d√©pend de votre probl√©matique, des variables explicatives dont vous disposez et du nombre de composantes que vous retenez - mais ici c'est d√ª au fait qu'elle permet de &lt;strong&gt;r√©duire le bruit associ√© aux donn√©es en ne conservant qu'une partie de l'information totale&lt;/strong&gt;. Cela permet ainsi de pr√©venir les probl√®mes de surapprentissage, c'est √† dire le fait que &lt;strong&gt;le mod√®le explique parfaitement les donn√©es d'entra√Ænement mais se g√©n√©ralise mal √† de nouvelles donn√©es&lt;/strong&gt;. Ce sujet est abord√© dans &lt;a href="https://blog.statoscop.fr/larbitrage-biaisvariance-dans-la-modelisation-de-donnees.html"&gt;cet article de notre blog sur l'arbitrage biais/variance&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! Si vous voulez voir d'autres exemples d'utilisation de l'ACP, je vous conseille &lt;a href="https://jakevdp.github.io/PythonDataScienceHandbook/05.09-principal-component-analysis.html" target="_blank"&gt;cet article&lt;/a&gt; qui aborde notamment le cas du traitement des images, pour lequel il est particuli√®rement int√©ressant de r√©duire le nombre de dimensions. N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; pour ne pas rater les prochains articles! Vous pouvez trouver le notebook avec l'ensemble du code ayant servi √† g√©n√©rer cette note sur le &lt;a href="https://github.com/Statoscop/notebooks-blog" target="_blank"&gt;github de Statoscop&lt;/a&gt;.   &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="Python"></category><category term="Python"></category><category term="Machine Learning"></category><category term="Statistiques"></category><category term="Data Science"></category></entry></feed>