<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Le blog - R</title><link href="https://blog.statoscop.fr/" rel="alternate"></link><link href="https://blog.statoscop.fr/feeds/r.atom.xml" rel="self"></link><id>https://blog.statoscop.fr/</id><updated>2025-09-16T00:00:00+02:00</updated><entry><title>Utilisation de case_when dans dplyr : cas des variables facteurs</title><link href="https://blog.statoscop.fr/utilisation-de-case_when-dans-dplyr-cas-des-variables-facteurs.html" rel="alternate"></link><published>2025-09-16T00:00:00+02:00</published><updated>2025-09-16T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-09-16:/utilisation-de-case_when-dans-dplyr-cas-des-variables-facteurs.html</id><summary type="html">&lt;p&gt;Astuces pour bien dÃ©finir sa variable facteur dans une instruction case_when suite aux derniÃ¨res mises Ã  jour de dplyr.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#syntaxe-de-case_when-dans-dplyr-et-differences-avec-if_else"&gt;Syntaxe de case_when dans dplyr et diffÃ©rences avec if_else&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#defintion-de-conditions-multiples"&gt;DÃ©fintion de conditions multiples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#gestion-des-valeurs-manquantes"&gt;Gestion des valeurs manquantes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#gestion-des-types-facteur-avec-case_when"&gt;Gestion des types facteur avec case_when&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#default-pour-definir-la-valeur-de-base"&gt;.default pour dÃ©finir la valeur de base&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#ptype-pour-creer-directement-un-facteur"&gt;.ptype pour crÃ©er directement un facteur&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Le verbe &lt;code&gt;case_when&lt;/code&gt; est un &lt;strong&gt;incontournable du traitement de donnÃ©es avec &lt;code&gt;dplyr&lt;/code&gt;&lt;/strong&gt;. Il permet de crÃ©er une variable conditionnellement Ã  une ou plusieurs variables existantes. Sa syntaxe est &lt;strong&gt;trÃ¨s lisible et permet Ã  votre code de rester clair&lt;/strong&gt;. Cependant, vous avez peut-Ãªtre dÃ©jÃ  eu quelques &lt;strong&gt;problÃ¨mes de compatibilitÃ© avec les variables facteurs&lt;/strong&gt;. Dans cette note, on vous prÃ©sente ce verbe bien pratique de &lt;code&gt;dplyr&lt;/code&gt;, ses nouveautÃ©s et comment &lt;strong&gt;l'utiliser pour crÃ©er directement des variables facteurs&lt;/strong&gt;. &lt;/p&gt;
&lt;h1 id="syntaxe-de-case_when-dans-dplyr-et-differences-avec-if_else"&gt;Syntaxe de case_when dans dplyr et diffÃ©rences avec if_else&lt;/h1&gt;
&lt;p&gt;Pour cet article, nous nous reposons sur un dataset complÃ¨tement fictif qui a la structure suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;## tibble [200 Ã— 4] (S3: tbl_df/tbl/data.frame)&lt;/span&gt;
&lt;span class="c1"&gt;##  $ id    : int [1:200] 1 2 3 4 5 6 7 8 9 10 ...&lt;/span&gt;
&lt;span class="c1"&gt;##  $ groupe: chr [1:200] &amp;quot;C&amp;quot; &amp;quot;C&amp;quot; &amp;quot;C&amp;quot; &amp;quot;B&amp;quot; ...&lt;/span&gt;
&lt;span class="c1"&gt;##  $ var1  : int [1:200] NA 20 10 28 19 30 NA 22 20 20 ...&lt;/span&gt;
&lt;span class="c1"&gt;##  $ statut: Factor w/ 2 levels &amp;quot;ko&amp;quot;,&amp;quot;ok&amp;quot;: NA 1 NA 1 1 2 1 NA 2 2 ...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Vous pouvez retrouver le code ayant servi Ã  le gÃ©nÃ©rer sur &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;le dÃ©pÃ´t github des notes de blog de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;Le verbe &lt;code&gt;case_when&lt;/code&gt; comporte plusieurs diffÃ©rences avec &lt;code&gt;if_else&lt;/code&gt;, mais deux nous semblent particuliÃ¨rement importantes :   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sa syntaxe rend &lt;strong&gt;la lecture de plusieurs conditions&lt;/strong&gt; bien plus aisÃ©e    &lt;/li&gt;
&lt;li&gt;par dÃ©faut, &lt;strong&gt;il ne renvoie pas NA s'il croise une valeur manquante&lt;/strong&gt; dans la condition   &lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="defintion-de-conditions-multiples"&gt;DÃ©fintion de conditions multiples&lt;/h2&gt;
&lt;p&gt;Pour &lt;strong&gt;la premiÃ¨re diffÃ©rence&lt;/strong&gt;, la syntaxe de &lt;code&gt;case_when&lt;/code&gt; va permettre de &lt;strong&gt;dÃ©finir les diffÃ©rentes conditions&lt;/strong&gt; et la valeur associÃ©e sur une ligne dÃ©diÃ©e alors que &lt;strong&gt;celle de &lt;code&gt;if_else&lt;/code&gt; oblige Ã  chaÃ®ner les appels Ã  la fonction&lt;/strong&gt;. En fait, &lt;code&gt;case_when&lt;/code&gt; a mÃªme Ã©tÃ© crÃ©Ã© pour mettre de gÃ©nÃ©raliser &lt;code&gt;if_else&lt;/code&gt; Ã  des multiples conditions puisqu'il est indiquÃ© dans sa description de la page d'aide que c'est une fonction &lt;strong&gt;permettant de vectoriser l'appel Ã  plusieurs &lt;code&gt;if_else&lt;/code&gt;&lt;/strong&gt;. Illustrons cela en codant des deux maniÃ¨res une variable Ã©gale Ã  :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;"cas 1" si groupe = "A" et var1 &amp;lt; 25 &lt;/li&gt;
&lt;li&gt;"cas 2" si groupe = "B" ou "C" et var1 &amp;gt;= 25 &lt;/li&gt;
&lt;li&gt;"cas 3" sinon&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Le code avec les deux syntaxes est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# syntaxe case_when&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;cond_case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;groupe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;groupe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;.default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# syntaxe if_else&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;cond_ifelse&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;groupe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;groupe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cas 3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;La syntaxe de case_when permet de &lt;strong&gt;produire un code plus lisible et aÃ©rÃ©&lt;/strong&gt;. Ã€ noter que si l'on ne dÃ©finissait pas de valeur par dÃ©faut explicitement, on aurait Ã  la place des valeurs manquantes.  &lt;/p&gt;
&lt;h2 id="gestion-des-valeurs-manquantes"&gt;Gestion des valeurs manquantes&lt;/h2&gt;
&lt;p&gt;Pour &lt;strong&gt;la seconde diffÃ©rence&lt;/strong&gt;, &lt;code&gt;case_when&lt;/code&gt; considÃ¨re les valeurs manquantes &lt;strong&gt;comme une valeur Ã  part entiÃ¨re&lt;/strong&gt; alors que &lt;code&gt;if_else&lt;/code&gt; &lt;strong&gt;renvoie automatiquement une valeur manquante&lt;/strong&gt; s'il trouve une valeur manquante dans la condition. Si l'on observe nos deux variables on constate en effet qu'elles ne sont pas toujours Ã©gales :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="right"&gt;id&lt;/th&gt;
&lt;th align="left"&gt;groupe&lt;/th&gt;
&lt;th align="right"&gt;var1&lt;/th&gt;
&lt;th align="left"&gt;statut&lt;/th&gt;
&lt;th align="left"&gt;cond_case&lt;/th&gt;
&lt;th align="left"&gt;cond_ifelse&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;C&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="left"&gt;NA&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;C&lt;/td&gt;
&lt;td align="right"&gt;20&lt;/td&gt;
&lt;td align="left"&gt;ko&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;C&lt;/td&gt;
&lt;td align="right"&gt;10&lt;/td&gt;
&lt;td align="left"&gt;NA&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;4&lt;/td&gt;
&lt;td align="left"&gt;B&lt;/td&gt;
&lt;td align="right"&gt;28&lt;/td&gt;
&lt;td align="left"&gt;ko&lt;/td&gt;
&lt;td align="left"&gt;cas 2&lt;/td&gt;
&lt;td align="left"&gt;cas 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;5&lt;/td&gt;
&lt;td align="left"&gt;C&lt;/td&gt;
&lt;td align="right"&gt;19&lt;/td&gt;
&lt;td align="left"&gt;ko&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;6&lt;/td&gt;
&lt;td align="left"&gt;B&lt;/td&gt;
&lt;td align="right"&gt;30&lt;/td&gt;
&lt;td align="left"&gt;ok&lt;/td&gt;
&lt;td align="left"&gt;cas 2&lt;/td&gt;
&lt;td align="left"&gt;cas 2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;7&lt;/td&gt;
&lt;td align="left"&gt;B&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="left"&gt;ko&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;8&lt;/td&gt;
&lt;td align="left"&gt;B&lt;/td&gt;
&lt;td align="right"&gt;22&lt;/td&gt;
&lt;td align="left"&gt;NA&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;9&lt;/td&gt;
&lt;td align="left"&gt;C&lt;/td&gt;
&lt;td align="right"&gt;20&lt;/td&gt;
&lt;td align="left"&gt;ok&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;td align="left"&gt;cas 3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;10&lt;/td&gt;
&lt;td align="left"&gt;A&lt;/td&gt;
&lt;td align="right"&gt;20&lt;/td&gt;
&lt;td align="left"&gt;ok&lt;/td&gt;
&lt;td align="left"&gt;cas 1&lt;/td&gt;
&lt;td align="left"&gt;cas 1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Ainsi, &lt;strong&gt;lorsque la valeur de la variable &lt;code&gt;var1&lt;/code&gt; est manquante&lt;/strong&gt;, la mÃ©thode &lt;code&gt;if_else&lt;/code&gt; renvoie une valeur manquante alors que &lt;code&gt;case_when&lt;/code&gt; lui donne la valeur "cas 3" car elle ne correspond pas aux deux premiÃ¨res conditions. Il faut donc &lt;strong&gt;traiter explicitement les valeurs manquantes dans les conditions de &lt;code&gt;case_when&lt;/code&gt; si l'on souhaite qu'elles ne soient pas prises en compte&lt;/strong&gt;.    &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;      &lt;/p&gt;
&lt;h1 id="gestion-des-types-facteur-avec-case_when"&gt;Gestion des types facteur avec &lt;code&gt;case_when&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;La crÃ©ation d'une variable avec &lt;code&gt;case_when&lt;/code&gt; doit &lt;strong&gt;respecter le fait que la variable crÃ©Ã©e ait un type unique&lt;/strong&gt;. Cela peut poser problÃ¨me lorsque l'on souhaite crÃ©er directement une variable facteur.  &lt;/p&gt;
&lt;h2 id="default-pour-definir-la-valeur-de-base"&gt;&lt;code&gt;.default&lt;/code&gt; pour dÃ©finir la valeur de base&lt;/h2&gt;
&lt;p&gt;Le paramÃ¨tre &lt;code&gt;.default&lt;/code&gt; permet de dÃ©finir la valeur que prend la variable lorsqu'aucune des conditions n'est respectÃ©e. Il remplace l'utilisation de la syntaxe &lt;code&gt;.TRUE ~ valeur&lt;/code&gt; &lt;a href="https://cran.r-project.org/web/packages/dplyr/news/news.html"&gt;depuis dplyr 1.1.0&lt;/a&gt;. Il peut &lt;strong&gt;correspondre Ã  une valeur&lt;/strong&gt;, comme dans l'exemple prÃ©cÃ©dent, &lt;strong&gt;ou Ã  une variable existante&lt;/strong&gt;. Il faut veiller Ã  ce que &lt;strong&gt;le type de la variable corresponde bien Ã  celui des modalitÃ©s dÃ©finies prÃ©cÃ©demment&lt;/strong&gt;. En effet, on obtient sinon l'erreur suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;statut_bis&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# modalitÃ© boolÃ©en&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;.default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;statut&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# variable facteur&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;## Error in `mutate()`:&lt;/span&gt;
&lt;span class="c1"&gt;## â„¹ In argument: `statut_bis = case_when(is.na(var1) ~ FALSE, .default =&lt;/span&gt;
&lt;span class="c1"&gt;##   statut)`.&lt;/span&gt;
&lt;span class="c1"&gt;## Caused by error in `case_when()`:&lt;/span&gt;
&lt;span class="c1"&gt;## ! Can&amp;#39;t combine `..1 (right)` &amp;lt;logical&amp;gt; and `.default` &amp;lt;factor&amp;lt;3d285&amp;gt;&amp;gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le message d'erreur nous indique bien l'impossibilitÃ© pour &lt;code&gt;case_when&lt;/code&gt; de &lt;strong&gt;combiner des valeurs boolÃ©ennes&lt;/strong&gt; (le &lt;code&gt;FALSE&lt;/code&gt;) &lt;strong&gt;et une variable facteur&lt;/strong&gt; (la variable &lt;code&gt;statut&lt;/code&gt; donnant la valeur par dÃ©faut).  &lt;/p&gt;
&lt;p&gt;Ã€ noter qu'auparavant, &lt;code&gt;case_when&lt;/code&gt; sortait Ã©galement une erreur lorsqu'on dÃ©finissait des modalitÃ©s caractÃ¨res et une variable facteur par dÃ©faut. Cela n'est plus le cas &lt;a href="https://cran.r-project.org/web/packages/dplyr/news/news.html"&gt;depuis dplyr 1.1.0&lt;/a&gt;, puisque &lt;code&gt;case_when&lt;/code&gt; &lt;strong&gt;transforme automatiquement les variables facteur en variable caractÃ¨re&lt;/strong&gt;. Ainsi, le code suivant fonctionne :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;statut_bis&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;inconnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# modalitÃ© caractÃ¨re&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;.default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;statut&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# variable facteur convertie automatiquement en caractÃ¨re&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;statut_bis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# affichage des modalitÃ©s de statut_bis&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 4 Ã— 2
&lt;span class="gu"&gt;##&lt;/span&gt;   statut_bis     n
&lt;span class="gu"&gt;##&lt;/span&gt;   &amp;lt;chr&amp;gt;      &amp;lt;int&amp;gt;
&lt;span class="gu"&gt;##&lt;/span&gt; 1 inconnu        5
&lt;span class="gu"&gt;##&lt;/span&gt; 2 ko            62
&lt;span class="gu"&gt;##&lt;/span&gt; 3 ok            61
&lt;span class="gu"&gt;##&lt;/span&gt; 4 &amp;lt;NA&amp;gt;          72
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="ptype-pour-creer-directement-un-facteur"&gt;&lt;code&gt;.ptype&lt;/code&gt; pour crÃ©er directement un facteur&lt;/h2&gt;
&lt;p&gt;Il n'est ici pas possible de &lt;strong&gt;dÃ©finir directement un facteur et l'ordre de ses niveaux&lt;/strong&gt;, Ã  moins de le faire dans une nouvelle instruction dÃ©diÃ©e. C'est lÃ  qu'entre en jeu l'argument &lt;code&gt;.ptype&lt;/code&gt; de la fonction &lt;code&gt;case_when&lt;/code&gt;. Par dÃ©faut, le type de la variable est en effet &lt;strong&gt;dÃ©duit des valeurs dÃ©finies aprÃ¨s les conditions&lt;/strong&gt;. L'argument &lt;code&gt;ptype&lt;/code&gt; permet d'imposer un type spÃ©cifique &lt;strong&gt;quand cela est compatible avec les expressions utilisÃ©es&lt;/strong&gt;. Dans notre exemple prÃ©cÃ©dent, on peut ainsi spÃ©cifier que l'on souhaite une variable facteur en sortie, &lt;strong&gt;Ã  condition de bien en dÃ©finir les niveaux&lt;/strong&gt;  :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;statut_bis&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;inconnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# modalitÃ© caractÃ¨re&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;.default&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;statut&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;.ptype&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;levels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ko&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;inconnu&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;statut_bis&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# affichage des modalitÃ©s de statut_bis&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 4 Ã— 2
&lt;span class="gu"&gt;##&lt;/span&gt;   statut_bis     n
&lt;span class="gu"&gt;##&lt;/span&gt;   &amp;lt;fct&amp;gt;      &amp;lt;int&amp;gt;
&lt;span class="gu"&gt;##&lt;/span&gt; 1 ok            61
&lt;span class="gu"&gt;##&lt;/span&gt; 2 ko            62
&lt;span class="gu"&gt;##&lt;/span&gt; 3 inconnu        5
&lt;span class="gu"&gt;##&lt;/span&gt; 4 &amp;lt;NA&amp;gt;          72
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On a ainsi pu dÃ©finir notre variable facteur avec l'ordre des niveaux voulu directement dans &lt;code&gt;case_when&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="dplyr"></category><category term="case_when"></category><category term="code"></category><category term="Data Science"></category></entry><entry><title>Graphiques et diagrammes Ã  barres empilÃ©es : prÃ©sentation d'une alternative avec R et ggplot2</title><link href="https://blog.statoscop.fr/graphiques-et-diagrammes-a-barres-empilees-presentation-dune-alternative-avec-r-et-ggplot2.html" rel="alternate"></link><published>2025-04-28T00:00:00+02:00</published><updated>2025-04-28T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-04-28:/graphiques-et-diagrammes-a-barres-empilees-presentation-dune-alternative-avec-r-et-ggplot2.html</id><summary type="html">&lt;p&gt;Une alternative pour visualiser des sous-ensembles et leur total sans les empiler&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#dechiffrer-un-diagramme-a-barres-empilees"&gt;DÃ©chiffrer un diagramme Ã  barres empilÃ©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#segmenter-plutot-quempiler-vos-barres-avec-ggplot2"&gt;Segmenter plutÃ´t qu'empiler vos barres avec ggplot2&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#visualiser-levolution-de-la-pauvrete-dans-le-monde-par-regions"&gt;Visualiser l'Ã©volution de la pauvretÃ© dans le monde par rÃ©gions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#le-graphique-a-barres-segmentees-avec-total"&gt;Le graphique Ã  barres segmentÃ©es avec total&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#choisir-le-graphique-adapte-a-son-probleme"&gt;Choisir le graphique adaptÃ© Ã  son problÃ¨me&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Aujourd'hui nous vous proposons un petit article dataviz avec ggplot2 pour apporter notre modeste contribution Ã  des discussions vues ici et lÃ  sur &lt;strong&gt;la pertinence des graphiques Ã  barres empilÃ©es&lt;/strong&gt;, en anglais &lt;strong&gt;stacked bar charts&lt;/strong&gt;. Plus spÃ©cifiquement, on se propose de coder en ggplot2 une visualisation vue sur &lt;a href="https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html"&gt;un article prÃ©sentant la meilleur alternative aux graphiques empilÃ©es&lt;/a&gt; (selon son auteur).  &lt;/p&gt;
&lt;h1 id="dechiffrer-un-diagramme-a-barres-empilees"&gt;DÃ©chiffrer un diagramme Ã  barres empilÃ©es&lt;/h1&gt;
&lt;p&gt;Un graphique Ã  barres empilÃ©es permet &lt;strong&gt;d'illustrer l'Ã©volution ou la comparaison d'une mesure globale, tout en la dÃ©clinant par des sous-ensembles&lt;/strong&gt;. Par exemple, on peut utiliser la base &lt;code&gt;diamonds&lt;/code&gt; de ggplot2 pour prÃ©senter la puretÃ© de la coupe des diamants (variable &lt;code&gt;clarity&lt;/code&gt;) en fonction de la qualitÃ© de leur taille (variable &lt;code&gt;cut&lt;/code&gt;) : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggplot2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;diamonds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cut&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clarity&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# par dÃ©faut, geom_bar s&amp;#39;exÃ©cute avec position = &amp;quot;stack&amp;quot; :&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_bar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Que nous indique ce graphique? Pas grand chose en rÃ©alitÃ©, si Ã§a n'est que notre base contient d'autant plus de diamants que la qualitÃ© de leur taille est bonne. Mais pour dÃ©duire la mÃªme chose de chaque niveau de puretÃ© de diamants, il faut se livrer Ã  un exercice de concentration intense que ne devrait pas nÃ©cessiter une bonne visualisation. Ã€ part pour le niveau &lt;code&gt;IF&lt;/code&gt;, le plus pur, dont ont voit clairement que le nombre augmente avec la qualitÃ© de la taille, &lt;strong&gt;il est difficile d'Ã©valuer l'augmentation relative de chaque sous-ensemble, d'autant plus que les effectifs totaux diffÃ¨rent&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;Bien sÃ»r, on peut dÃ©cider de changer lÃ©gÃ¨rement le type de notre graphique et de reprÃ©senter plutÃ´t la rÃ©partition relative du niveau de puretÃ© des diamants &lt;strong&gt;pour chaque qualitÃ© de taille&lt;/strong&gt;, en spÃ©cifiant le paramÃ¨tre &lt;code&gt;position&lt;/code&gt; de geom_bar Ã  &lt;code&gt;fill&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;diamonds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cut&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clarity&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_bar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-3-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ã€ part pour les niveaux extrÃªmes de puretÃ© (&lt;code&gt;I1&lt;/code&gt; et &lt;code&gt;IF&lt;/code&gt;), l'Ã©volution de la rÃ©partition pour chaque catÃ©gorie de diamants demeure assez obscur, et on a en plus perdu l'information sur le nombre de diamants totaux que chaque catÃ©gorie reprÃ©sente!&lt;br&gt;
Ce problÃ¨me, soulevÃ© par nombre de spÃ©cialistes de la dataviz, et notamment &lt;a href="https://www.data-to-viz.com/caveat/stacking.html"&gt;Yan Holtz dans un article rÃ©cent&lt;/a&gt;, a poussÃ© certains Ã  chercher des alternatives. L'idÃ©e est de pouvoir &lt;strong&gt;prÃ©senter clairement Ã  la fois l'Ã©volution d'un total et de ses sous-ensembles&lt;/strong&gt;. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="segmenter-plutot-quempiler-vos-barres-avec-ggplot2"&gt;Segmenter plutÃ´t qu'empiler vos barres avec ggplot2&lt;/h1&gt;
&lt;p&gt;Nous proposons ici &lt;a href="https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html"&gt;d'appliquer la mÃ©thode prÃ©sentÃ©e par Kevin Flerlage&lt;/a&gt;. La solution qu'il propose avec l'outil Tableau nous semble Ã©lÃ©gante et &lt;strong&gt;nous montrons ici comment la mettre en oeuvre avec&lt;/strong&gt; &lt;code&gt;ggplot2&lt;/code&gt;.  &lt;/p&gt;
&lt;h2 id="visualiser-levolution-de-la-pauvrete-dans-le-monde-par-regions"&gt;Visualiser l'Ã©volution de la pauvretÃ© dans le monde par rÃ©gions&lt;/h2&gt;
&lt;p&gt;On s'appuie ici sur des donnÃ©es de &lt;a href="https://ourworldindata.org"&gt;World In Data&lt;/a&gt; en 2010, 2016, 2020 et 2024. On choisit de regarder l'Ã©volution du nombre de personnes sous le seuil de 2.15$ par jour, dÃ©clinÃ©e par grande rÃ©gion du monde.  &lt;/p&gt;
&lt;p&gt;Avec &lt;code&gt;ggplot2&lt;/code&gt; et &lt;code&gt;geom_col&lt;/code&gt;, on peut facilement proposer une reprÃ©sentation avec un graphique Ã  barres empilÃ©es :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scales&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# pour scale du y-axis&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggtext&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# pour mise en forme du titre&lt;/span&gt;

&lt;span class="n"&gt;data_wid_country&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Region&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;label_number&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1e-6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;suffix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;M&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The evolution of poverty in the World&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;caption&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source : World Bank (2024) â€“ processed by Our World in Data (https://ourworldindata.org)&lt;/span&gt;
&lt;span class="s"&gt;       This data is adjusted for inflation and for differences in living costs between countries.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plot.title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_markdown&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                      &lt;/span&gt;&lt;span class="n"&gt;hjust&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;legend.position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bottom&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-4-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ce graphique nous permet de voir une baisse du nombre de personnes pauvres entre 2010 et 2016 puis une stagnation de cet indicateur entre 2016 et 2024. Il &lt;strong&gt;ne nous permet cependant pas d'Ã©valuer prÃ©cisÃ©ment l'Ã©volution au sein de chaque rÃ©gion du monde&lt;/strong&gt;. &lt;/p&gt;
&lt;h2 id="le-graphique-a-barres-segmentees-avec-total"&gt;Le graphique Ã  barres segmentÃ©es avec total&lt;/h2&gt;
&lt;p&gt;Nous traduisons ici le terme proposÃ© par Kevin Flerlage. L'idÃ©e est la suivante : on va juxtaposer plutÃ´t qu'empiler les diffÃ©rents sous-ensembles. On va pour cela utiliser le paramÃ¨tre &lt;code&gt;position = "dodge"&lt;/code&gt; de &lt;code&gt;geom_col&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;Le problÃ¨me Ã  ce stade est bien sÃ»r &lt;strong&gt;qu'on ne dispose plus d'estimation du total&lt;/strong&gt;. Il s'agit donc d'ajouter &lt;strong&gt;une barre totale qui englobe les barres des sous-ensembles&lt;/strong&gt;, avec une transparence pour permettre une bonne visibilitÃ©. C'est un jeu d'enfant avec &lt;code&gt;ggplot2&lt;/code&gt; puisqu'il s'agit simplement d'ajouter un &lt;code&gt;geom_col&lt;/code&gt; et de lui choisir une couleur avec &lt;code&gt;fill&lt;/code&gt; et un niveau de transparence avec &lt;code&gt;alpha&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;Si on considÃ¨re qu'il n'est pas assez explicite que la barre ajoutÃ©e correspond au total, on peut s'en sortir en ajoutant dans le titre la mÃªme couleur que celle de la barre transparente. Le rÃ©sultat est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;data_wid_country&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Region&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="c1"&gt;# changement de la position&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dodge&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# ajout d&amp;#39;un geom_col&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#C77CFF&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;label_number&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1e-6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;suffix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;M&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The evolution of poverty &amp;lt;span style=&amp;#39;color:#C77CFF;&amp;#39;&amp;gt;in the World&amp;lt;/span&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;caption&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source : World Bank (2024) â€“ processed by Our World in Data (https://ourworldindata.org)&lt;/span&gt;
&lt;span class="s"&gt;       This data is adjusted for inflation and for differences in living costs between countries.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plot.title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_markdown&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                      &lt;/span&gt;&lt;span class="n"&gt;hjust&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;legend.position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bottom&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-5-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate en effet que la lecture nous semble plus explicite : au niveau mondial sur notre pÃ©riode de temps, le nombre de pauvres a baissÃ©. Cela se traduit cependant par deux trajectoires diffÃ©rentes : une baisse trÃ¨s marquÃ©e dans la rÃ©gion Asie-Pacifique et un hausse en Afrique.&lt;/p&gt;
&lt;h1 id="choisir-le-graphique-adapte-a-son-probleme"&gt;Choisir le graphique adaptÃ© Ã  son problÃ¨me&lt;/h1&gt;
&lt;p&gt;Cette proposition d'alternatives aux graphiques Ã  barres empilÃ©es nous semble intÃ©ressante, notamment dans ce cas spÃ©cifique ou &lt;strong&gt;le total reprÃ©sente la somme de ses sous-ensembles&lt;/strong&gt;. Dans le cas oÃ¹ on voudrait par exemple &lt;strong&gt;reprÃ©senter une moyenne totale et la comparer Ã  des moyennes de sous-ensembles&lt;/strong&gt;, on prÃ©coniserait sans doute de prÃ©senter celle-ci avec une forme diffÃ©rente, comme un point ou un losange. Le code prÃ©sentÃ© ci-dessus peut-Ãªtre utilisÃ© de la mÃªme maniÃ¨re en changeant le &lt;code&gt;geom_col&lt;/code&gt; par ce qui vous semble appropriÃ©.  &lt;/p&gt;
&lt;p&gt;Enfin, lorsque votre problÃ©matique contient de nombreux sous-ensembles, &lt;strong&gt;ce choix n'est probablement pas adaptÃ© car le total peut avoir une Ã©chelle trop diffÃ©rente de chacun des sous-ensembles&lt;/strong&gt;. C'est le cas par exemple pour la problÃ©matique des diamants que je prÃ©sentais en dÃ©but de post, et pour laquelle le graphique Ã  barres segmentÃ©es n'aurait pas donnÃ© un rÃ©sultat satisfaisant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-6-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Pour autant, &lt;strong&gt;on ne vous recommande pas non plus de faire un graphique avec deux axes verticaux&lt;/strong&gt;. Cela pourra faire l'objet d'une prochaine note de blog! &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! On espÃ¨re que cette note vous dÃ©bloquera dans le choix de votre prochaine reprÃ©sentation graphique. Si vous avez besoin de &lt;a href="https://statoscop.fr"&gt;conseils en programmation pour la statistique et la data science&lt;/a&gt;, n'hÃ©sitez pas Ã  nous contacter sur notre site, &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; ou &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;.&lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="ggplot2"></category><category term="dataviz"></category></entry><entry><title>if_any et if_all : appliquer la mÃªme condition sur plusieurs variables dans dplyr</title><link href="https://blog.statoscop.fr/if_any-et-if_all-appliquer-la-meme-condition-sur-plusieurs-variables-dans-dplyr.html" rel="alternate"></link><published>2025-04-03T00:00:00+02:00</published><updated>2025-04-03T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-04-03:/if_any-et-if_all-appliquer-la-meme-condition-sur-plusieurs-variables-dans-dplyr.html</id><summary type="html">&lt;p&gt;Quelques exemples d'utilisation de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; dans le traitement de vos donnÃ©es avec R.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#syntaxe-de-if_any-et-if_all"&gt;Syntaxe de if_any et if_all&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#filtrer-un-dataframe-avec-if_any-et-if_all"&gt;Filtrer un dataframe avec if_any et if_all&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reperer-des-valeurs-en-particulier-avec-if_any"&gt;RepÃ©rer des valeurs en particulier avec if_any&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#reperer-les-tres-bons-ou-les-tres-mauvais-resultats-avec-if_all"&gt;RepÃ©rer les trÃ¨s bons (ou les trÃ¨s mauvais) rÃ©sultats avec if_all&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#creer-une-variable-synthetique-avec-if_any-et-if_all-dans-case_when"&gt;CrÃ©er une variable synthÃ©tique avec if_any et if_all dans case_when&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Au dÃ©but de l'annÃ©e 2021, &lt;a href="https://www.tidyverse.org/blog/2021/02/dplyr-1-0-4-if-any/"&gt;la sortie de dplyr 1.0.4&lt;/a&gt; consacre l'arrivÃ©e de deux petits nouveaux : &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;. Ces deux fonctions viennent notamment &lt;strong&gt;complÃ©ter le verbe &lt;code&gt;across&lt;/code&gt;&lt;/strong&gt;, qui avait Ã©tÃ© introduit quelques mois plus tÃ´t dans dplyr 1.0.0, et &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;que nous avons dÃ©jÃ  prÃ©sentÃ© dans un prÃ©cÃ©dent article&lt;/a&gt;.&lt;br&gt;
Ici nous vous proposons donc un rapide tour des possibilitÃ©s offertes par ces fonctions. Nous commenÃ§ons par montrer comment ils peuvent Ãªtre utilisÃ©s dans &lt;code&gt;filter()&lt;/code&gt; pour filtrer facilement notre dataframe &lt;strong&gt;en appliquant la mÃªme condition Ã  plusieurs variables&lt;/strong&gt;. Puis nous montrons comment ils peuvent Ãªtre avantageusement &lt;strong&gt;utilisÃ©s dans des instructions &lt;code&gt;mutate()&lt;/code&gt; pour synthÃ©tiser les valeurs de plusieurs variables&lt;/strong&gt;. &lt;/p&gt;
&lt;h1 id="syntaxe-de-if_any-et-if_all"&gt;Syntaxe de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;La syntaxe de ces deux verbes est exactement la mÃªme que celle d'&lt;code&gt;across()&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour &lt;code&gt;across&lt;/code&gt;, &lt;strong&gt;le paramÃ¨tre &lt;code&gt;.cols&lt;/code&gt; permet de sÃ©lectionner les variables&lt;/strong&gt; sur lesquelles on souhaite appliquer notre filtre. Pour cela on utilise les mÃ©thodes du &lt;code&gt;tidyselect&lt;/code&gt; :&lt;br&gt;
- &lt;code&gt;where(fn)&lt;/code&gt; pour sÃ©lectionner les colonnes sur une condition (&lt;code&gt;where(is.numeric)&lt;/code&gt; par exemple).&lt;br&gt;
- &lt;code&gt;starts_with(match)&lt;/code&gt;, &lt;code&gt;ends_with(match)&lt;/code&gt;, &lt;code&gt;contains(match)&lt;/code&gt;, &lt;code&gt;matches(match)&lt;/code&gt; pour sÃ©lectionner les variables sur une caractÃ©ristique de leur nom (&lt;code&gt;starts_with("v_")&lt;/code&gt; par exemple). &lt;br&gt;
- &lt;code&gt;c(var1, var2, var3)&lt;/code&gt;, &lt;code&gt;all_of(c("var1", "var2", "var3"))&lt;/code&gt; ou &lt;code&gt;any_of(c("var1", "var2", "var3"))&lt;/code&gt; pour sÃ©lectionner directement les variables par leur nom.   &lt;/p&gt;
&lt;p&gt;Le &lt;strong&gt;paramÃ¨tre &lt;code&gt;.fns&lt;/code&gt; permet de dÃ©finir la fonction de filtrage&lt;/strong&gt; sur les variables sÃ©lectionnÃ©es. Ce sera soit une fonction dÃ©jÃ  existante (&lt;code&gt;is.na&lt;/code&gt; par exemple), soit une fonction dÃ©finie en par l'utilisateur en amont ou Ã  la volÃ©e (avec la syntaxe &lt;code&gt;~ .x &amp;gt; 50&lt;/code&gt; par exemple).   &lt;/p&gt;
&lt;p&gt;Ces deux fonctions vont &lt;strong&gt;crÃ©er en sortie un vecteur boolÃ©en&lt;/strong&gt; qui va nous permettre de filtrer nos observations de deux faÃ§ons :   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;avec &lt;code&gt;if_any&lt;/code&gt; si la condition dÃ©finie dans &lt;code&gt;.fns&lt;/code&gt; est respectÃ©e pour au moins une des variables. Cela revient Ã  &lt;strong&gt;coder la condition pour chaque colonne avec l'opÃ©rateur &lt;code&gt;|&lt;/code&gt; (&lt;code&gt;OU&lt;/code&gt;).&lt;/strong&gt;   &lt;/li&gt;
&lt;li&gt;avec &lt;code&gt;if_all&lt;/code&gt; si cette condition est respectÃ©e pour toutes les variables. Cela revient Ã  &lt;strong&gt;coder la condition pour chaque colonne avec l'opÃ©rateur &lt;code&gt;&amp;amp;&lt;/code&gt; (&lt;code&gt;ET&lt;/code&gt;).&lt;/strong&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Voyons concrÃ¨tement comment nous pouvons les utiliser dans deux cas distincts : &lt;strong&gt;filtrer notre dataframe&lt;/strong&gt; sur une conditions portant sur plusieurs variables Ã  la fois et &lt;strong&gt;crÃ©er une nouvelle variable en fonction des valeurs de plusieurs autres variables&lt;/strong&gt;.    &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;        &lt;/p&gt;
&lt;h1 id="filtrer-un-dataframe-avec-if_any-et-if_all"&gt;Filtrer un dataframe avec &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;Pour &lt;strong&gt;illustrer l'utilisation de ces deux verbes&lt;/strong&gt;, on s'appuie sur &lt;a href="https://www.kaggle.com/datasets/simranjitkhehra/student-grades-dataset"&gt;des donnÃ©es Kaggle de notes d'Ã©tudiants Ã  diffÃ©rentes matiÃ¨res&lt;/a&gt;. On a modifiÃ© ces donnÃ©es pour avoir &lt;strong&gt;une colonne pour chaque note de chaque matiÃ¨re&lt;/strong&gt;. Notre dataset &lt;code&gt;stud_grades&lt;/code&gt; a maintenant ce format :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; Rows: 10,000
&lt;span class="gu"&gt;##&lt;/span&gt; Columns: 6
&lt;span class="gu"&gt;##&lt;/span&gt; $ student.id         &amp;lt;int&amp;gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, â€¦
&lt;span class="gu"&gt;##&lt;/span&gt; $ math               &amp;lt;chr&amp;gt; &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;â€¦
&lt;span class="gu"&gt;##&lt;/span&gt; $ science            &amp;lt;chr&amp;gt; &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;â€¦
&lt;span class="gu"&gt;##&lt;/span&gt; $ history            &amp;lt;chr&amp;gt; &amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;â€¦
&lt;span class="gu"&gt;##&lt;/span&gt; $ english            &amp;lt;chr&amp;gt; &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;â€¦
&lt;span class="gu"&gt;##&lt;/span&gt; $ physical_education &amp;lt;chr&amp;gt; &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;â€¦
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Les notes possibles sont &lt;code&gt;A&lt;/code&gt;, &lt;code&gt;B&lt;/code&gt;, &lt;code&gt;C&lt;/code&gt;, &lt;code&gt;D&lt;/code&gt; et &lt;code&gt;F&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;On prÃ©sente plusieurs opÃ©rations de filtrage qui peuvent Ãªtre utiles dans notre exploration des donnÃ©es.  &lt;/p&gt;
&lt;h2 id="reperer-des-valeurs-en-particulier-avec-if_any"&gt;RepÃ©rer des valeurs en particulier avec &lt;code&gt;if_any&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;La premiÃ¨re question que l'on peut se poser est de savoir s'il manque des informations dans notre dataset. &lt;code&gt;if_any&lt;/code&gt; va nous permettre de renvoyer les lignes contenant &lt;strong&gt;au moins une valeur manquante&lt;/strong&gt; parmi les variables que l'on sÃ©lectionne :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;physical_education&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;## # A tibble: 0 Ã— 6&lt;/span&gt;
&lt;span class="c1"&gt;## # â„¹ 6 variables: student.id &amp;lt;int&amp;gt;, math &amp;lt;chr&amp;gt;, science &amp;lt;chr&amp;gt;, history &amp;lt;chr&amp;gt;,&lt;/span&gt;
&lt;span class="c1"&gt;## #   english &amp;lt;chr&amp;gt;, physical_education &amp;lt;chr&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit tout de suite que le dataframe ne contient pas de valeurs manquantes, d'une maniÃ¨re plus directe et Ã©lÃ©gante que de coder la condition &lt;code&gt;is.na(math) | is.na(science) | is.na(history) | is.na(english) | is.na(physical_education)&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;Dans la mÃªme logique on pourrait vouloir identifier &lt;strong&gt;les cas oÃ¹ des Ã©lÃ¨ves ont reÃ§u la note "F"&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# On dÃ©finit ici notre fonction &amp;quot;Ã  la volÃ©e&amp;quot; avec ~ function(.x)&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;physical_education&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on renvoie le nombre d&amp;#39;observations&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## [1] 6749
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On apprend ainsi que 6749 Ã©lÃ¨ves sur 10 000 ont eu au moins un F Ã  une des matiÃ¨res!  &lt;/p&gt;
&lt;h2 id="reperer-les-tres-bons-ou-les-tres-mauvais-resultats-avec-if_all"&gt;RepÃ©rer les trÃ¨s bons (ou les trÃ¨s mauvais) rÃ©sultats avec &lt;code&gt;if_all&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Avec &lt;code&gt;if_all&lt;/code&gt;, on peut facilement repÃ©rer les excellents rÃ©sultats en filtrant par exemple sur les Ã©lÃ¨ves &lt;strong&gt;ayant eu des "A" Ã  toutes les matiÃ¨res&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# notez qu&amp;#39;on sÃ©lectionne les mÃªmes colonnes que prÃ©cÃ©demment&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# avec une mÃ©thode diffÃ©rente&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.character&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 2 Ã— 6
&lt;span class="gu"&gt;##&lt;/span&gt;   student.id math  science history english physical_education
&lt;span class="gu"&gt;##&lt;/span&gt;        &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;             
&lt;span class="gu"&gt;##&lt;/span&gt; 1       6933 A     A       A       A       A                 
&lt;span class="gu"&gt;##&lt;/span&gt; 2       8749 A     A       A       A       A
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit ainsi directement que seulement deux Ã©lÃ¨ves ont rÃ©ussi cet exploit, avec une syntaxe bien plus directe que de coder &lt;code&gt;math == "A" &amp;amp; science == "A" &amp;amp; history == "A" &amp;amp; english == "A" &amp;amp; physical_education == "A"&lt;/code&gt;.    &lt;/p&gt;
&lt;p&gt;On peut bien sÃ»r Ã©galement &lt;strong&gt;repÃ©rer les Ã©lÃ¨ves en difficultÃ©&lt;/strong&gt;, en regardant ceux qui n'ont eu que des "F" Ã  toutes les matiÃ¨res.&lt;/p&gt;
&lt;h1 id="creer-une-variable-synthetique-avec-if_any-et-if_all-dans-case_when"&gt;CrÃ©er une variable synthÃ©tique avec &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; dans &lt;code&gt;case_when&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;On conclut cet article en vous montrant &lt;strong&gt;comment profiter avantageusement de ces verbes dans une instruction &lt;code&gt;mutate()&lt;/code&gt;&lt;/strong&gt;, dans le but par exemple de &lt;strong&gt;crÃ©er une variable synthÃ©thique&lt;/strong&gt; qui prenne en compte l'ensemble de ces notes. Les modalitÃ©s pourraient Ãªtre les suivantes :  &lt;/p&gt;
&lt;p&gt;1 - &lt;em&gt;FacilitÃ©s en sciences et en lettres&lt;/em&gt; (au moins B dans toutes ces matiÃ¨res)&lt;br&gt;
2 - &lt;em&gt;FacilitÃ©s en sciences, difficultÃ©s en lettres&lt;/em&gt; (au moins B en maths et science, C ou moins dans une matiÃ¨re littÃ©raire)&lt;br&gt;
3 - &lt;em&gt;FacilitÃ©s en lettres, difficultÃ©s en sciences&lt;/em&gt; (au moins B en histoire et anglais, C ou moins dans une matiÃ¨re scientifique)&lt;br&gt;
4 - &lt;em&gt;DifficultÃ©s en lettres et sciences&lt;/em&gt; (jamais mieux que C dans aucune de ces 4 matiÃ¨res) &lt;br&gt;
5 - &lt;em&gt;DifficultÃ©s surtout en sciences&lt;/em&gt; (jamais mieux que C dans une matiÃ¨re scientifique) &lt;br&gt;
6 - &lt;em&gt;DifficultÃ©s surtout en lettres&lt;/em&gt; (jamais mieux que C dans une matiÃ¨re littÃ©raire) &lt;br&gt;
7 - &lt;em&gt;RÃ©sultats irrÃ©guliers&lt;/em&gt; (aucune des conditions prÃ©cÃ©dentes : donc bons rÃ©sultats dans seulement au moins une des matiÃ¨res scientifiques et littÃ©raire)   &lt;/p&gt;
&lt;p&gt;Ces conditions s'Ã©crivent ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;lvl_sc_lit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;FacilitÃ©s en sciences et en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;FacilitÃ©s en sciences, difficultÃ©s en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;FacilitÃ©s en lettres, difficultÃ©s en sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DifficultÃ©s en lettres et sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DifficultÃ©s surtout en sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;DifficultÃ©s surtout en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;RÃ©sultats irrÃ©guliers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit ainsi &lt;strong&gt;qu'on peut combiner des conditions de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; avec les &lt;code&gt;&amp;amp;&lt;/code&gt; et &lt;code&gt;|&lt;/code&gt;&lt;/strong&gt;, ce qui permet une grande flexibilitÃ© dans la crÃ©ation de nos conditions. On utilise Ã©galement le paramÃ¨tre &lt;code&gt;TRUE&lt;/code&gt; de &lt;code&gt;case_when&lt;/code&gt; pour tous les cas ne tombant dans aucune des conditions que nous avons imaginÃ©es, c'est Ã  dire les Ã©lÃ¨ves n'ayant pas de profil particuliÃ¨rement littÃ©raire ou scientifique mais plutÃ´t des rÃ©sultats trÃ¨s irrÃ©guliers dans les diffÃ©rentes matiÃ¨res. Voici comment se rÃ©partissent nos Ã©lÃ¨ves dans cette nouvelle variable synthÃ©tique :     &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 7 Ã— 2
&lt;span class="gu"&gt;##&lt;/span&gt;   lvl_sc_lit                                        n
&lt;span class="gu"&gt;##&lt;/span&gt;   &amp;lt;chr&amp;gt;                                         &amp;lt;int&amp;gt;
&lt;span class="gu"&gt;##&lt;/span&gt; 1 DifficultÃ©s en lettres et sciences             1334
&lt;span class="gu"&gt;##&lt;/span&gt; 2 DifficultÃ©s surtout en lettres                 1790
&lt;span class="gu"&gt;##&lt;/span&gt; 3 DifficultÃ©s surtout en sciences                1678
&lt;span class="gu"&gt;##&lt;/span&gt; 4 FacilitÃ©s en lettres, difficultÃ©s en sciences  1334
&lt;span class="gu"&gt;##&lt;/span&gt; 5 FacilitÃ©s en sciences et en lettres             259
&lt;span class="gu"&gt;##&lt;/span&gt; 6 FacilitÃ©s en sciences, difficultÃ©s en lettres  1337
&lt;span class="gu"&gt;##&lt;/span&gt; 7 RÃ©sultats irrÃ©guliers                          2268
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;C'est tout pour aujourd'hui! On espÃ¨re que cette note vous permettra de mieux exploiter la puissance de ces deux petits verbes bien pratiques. Si vous avez besoin de &lt;a href="https://statoscop.fr"&gt;conseils en programmation pour l'analyse de donnÃ©es&lt;/a&gt;, n'hÃ©sitez pas Ã  continuer votre navigation sur notre site ou Ã  nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="dplyr"></category><category term="tidyverse"></category><category term="if_any"></category><category term="if_all"></category><category term="across"></category></entry><entry><title>RÃ©seaux neuronaux convolutifs avec R et Keras</title><link href="https://blog.statoscop.fr/reseaux-neuronaux-convolutifs-avec-r-et-keras.html" rel="alternate"></link><published>2025-02-19T00:00:00+01:00</published><updated>2025-02-19T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-02-19:/reseaux-neuronaux-convolutifs-avec-r-et-keras.html</id><summary type="html">&lt;p&gt;DÃ©monstration de l'utilisation du package &lt;code&gt;keras3&lt;/code&gt; pour faire du Deep Learning avec R.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#presentation-de-la-librairie-keras"&gt;PrÃ©sentation de la librairie Keras&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#origine-de-la-librairie"&gt;Origine de la librairie&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#installation-du-package-sur-r"&gt;Installation du package sur R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#entrainer-un-premier-reseau-convolutionnel"&gt;EntraÃ®ner un premier rÃ©seau convolutionnel&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#pre-traiter-vos-donnees"&gt;PrÃ©-traiter vos donnÃ©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#initialiser-et-definir-votre-reseau-de-neurones-profond"&gt;Initialiser et dÃ©finir votre rÃ©seau de neurones profond&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#entrainer-et-evaluer-les-performances-de-votre-modele"&gt;EntraÃ®ner et Ã©valuer les performances de votre modÃ¨le&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#predictions-a-partir-du-modele-pre-entraine"&gt;PrÃ©dictions Ã  partir du modÃ¨le prÃ©-entraÃ®nÃ©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#deep-learning-avec-r-ou-python"&gt;Deep Learning avec R ou Python?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;On le sait, le &lt;strong&gt;dÃ©bat entre R et Python&lt;/strong&gt; est acharnÃ© et souvent peu productif. En Machine Learning, tout le monde ou presque s'accorde Ã  dire que Python a une longueur d'avance, surtout pour les modÃ¨les de Deep Learning (rÃ©seaux de neurones).  &lt;/p&gt;
&lt;p&gt;Heureusement, il existe souvent des alternatives pour celles et ceux ne souhaitant pas se mettre Ã  un autre langage (mÃªme si on vous y encourage!). Ainsi &lt;strong&gt;le package R &lt;code&gt;keras3&lt;/code&gt; permet d'accÃ©der Ã  la cÃ©lÃ¨bre API Python&lt;/strong&gt; du mÃªme nom. Nous vous montrons donc dans cet article comment elle fonctionne.   &lt;/p&gt;
&lt;h1 id="presentation-de-la-librairie-keras"&gt;PrÃ©sentation de la librairie Keras&lt;/h1&gt;
&lt;h2 id="origine-de-la-librairie"&gt;Origine de la librairie&lt;/h2&gt;
&lt;p&gt;Keras est une &lt;strong&gt;API Python qui permet de crÃ©er et entraÃ®ner des modÃ¨les de Deep Learning&lt;/strong&gt;. Elle a l'avantage d'offrir une interface simple et une syntaxe claire. Elle permet Ã©galement d'accÃ©der Ã  de nombreux modÃ¨les prÃ©-entraÃ®nÃ©s qui &lt;strong&gt;peuvent ensuite facilement Ãªtre &lt;em&gt;fine-tunÃ©s&lt;/em&gt; sur d'autres donnÃ©es&lt;/strong&gt;. Elle a Ã©tÃ© rÃ©cemment intÃ©grÃ©e Ã  &lt;code&gt;TensorFlow&lt;/code&gt; mais peut s'appuyer sur d'autres backends.&lt;/p&gt;
&lt;p&gt;Keras dispose aussi d'une &lt;a href="https://keras.io/api/"&gt;documentation trÃ¨s complÃ¨te&lt;/a&gt;, et sa popularitÃ© permet de retrouver de nombreux exemples d'utilisation en ligne. Elle est le plus souvent utilisÃ©e grÃ¢ce au package Python &lt;code&gt;keras&lt;/code&gt; ou via TensorFlow avec &lt;code&gt;tf.keras&lt;/code&gt;, qui permettent d'exploiter facilement ses diffÃ©rentes mÃ©thodes.   &lt;/p&gt;
&lt;h2 id="installation-du-package-sur-r"&gt;Installation du package sur R&lt;/h2&gt;
&lt;p&gt;GrÃ¢ce notamment Ã  la puissance de &lt;code&gt;reticulate&lt;/code&gt;, un package permettant de faire tourner Python depuis une session R, on dispose maintenant d'un package R &lt;code&gt;keras&lt;/code&gt;, que nous vous prÃ©sentons ici. Nous utiliserons la derniÃ¨re version disponible, le package &lt;code&gt;keras3&lt;/code&gt;. La premiÃ¨re Ã©tape est bien sur d'installer le package avec &lt;code&gt;install.packages("keras3")&lt;/code&gt; puis de lancer la fonction &lt;code&gt;keras3::install_keras()&lt;/code&gt; qui permet d'installer Python et un environnement anaconda dÃ©diÃ©.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keras3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;install_keras&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si vous avez du GPU, vous pouvez vÃ©rifier que &lt;strong&gt;votre device a bien Ã©tÃ© repÃ©rÃ©&lt;/strong&gt; avec l'instruction suivante (normalement, &lt;code&gt;tensorflow&lt;/code&gt; a Ã©tÃ© installÃ© au moment de l'installation de &lt;code&gt;keras3&lt;/code&gt;) :    &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;tensorflow&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nf"&gt;list_physical_devices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GPU&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;PhysicalDevice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;physical_device&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;GPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;device_type&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nx"&gt;GPU&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;      &lt;/p&gt;
&lt;h1 id="entrainer-un-premier-reseau-convolutionnel"&gt;EntraÃ®ner un premier rÃ©seau convolutionnel&lt;/h1&gt;
&lt;p&gt;Pour notre petite dÃ©monstration, nous allons utiliser la cÃ©lÃ©brissime base de donnÃ©es &lt;code&gt;mnist&lt;/code&gt; qui contient &lt;strong&gt;des images de chiffres Ã©crits Ã  la main&lt;/strong&gt;. Le but est donc de dÃ©velopper un modÃ¨le capable de reconnaÃ®tre les chiffres manuscrits.  &lt;/p&gt;
&lt;h2 id="pre-traiter-vos-donnees"&gt;PrÃ©-traiter vos donnÃ©es&lt;/h2&gt;
&lt;p&gt;Les donnÃ©es fournies contiennent 60 000 observations pour les donnÃ©es d'entraÃ®nements et 10 000 pour les donnÃ©es de test. Les images Ã©tant renseignÃ©es directement sous forme de matrice dans le package &lt;code&gt;keras3&lt;/code&gt; nous n'avons besoin que de normaliser ces matrices sur [0, 1]. On passe aussi la variable d'intÃ©rÃªt, qui donne la valeur du chiffre en question, sous un &lt;em&gt;one-hot-encoder&lt;/em&gt; avec la fonction &lt;code&gt;to_categorical&lt;/code&gt;. On obtient ainsi un vecteur de taille 10 contenant un indicateur pour chaque chiffre. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keras3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;dataset_mnist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;train&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;train&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;

&lt;span class="c1"&gt;# on normalise sur [0, 1]&lt;/span&gt;
&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;
&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;

&lt;span class="c1"&gt;# one-hot-encoder pour la variable d&amp;#39;intÃ©rÃªt avec to_categorical&lt;/span&gt;
&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;to_categorical&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;num_classes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;to_categorical&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;num_classes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="initialiser-et-definir-votre-reseau-de-neurones-profond"&gt;Initialiser et dÃ©finir votre rÃ©seau de neurones profond&lt;/h2&gt;
&lt;p&gt;On &lt;strong&gt;initialise le modÃ¨le&lt;/strong&gt; avec &lt;code&gt;keras_model_sequential&lt;/code&gt;, dans lequel on prÃ©cise d'emblÃ©e la dimension des donnÃ©es que le modÃ¨le prendra en entrÃ©e. Puis on ajoute les &lt;strong&gt;diffÃ©rentes couches de neurones&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;Comme nous sommes dans un rÃ©seau convolutionnel, on commence directement par une couche de convolution, qui permet de faire &lt;strong&gt;ressortir les caractÃ©ristiques de chaque image&lt;/strong&gt;. Cela fonctionne grÃ¢ce Ã  un systÃ¨me de filtres, rÃ©alisÃ© en faisant le produit de la matrice de pixels et d'une matrice plus petite, appelÃ©e &lt;code&gt;feature detector&lt;/code&gt;. On dÃ©finit dans cette Ã©tape le nombre de filtres que l'on souhaite faire passer avec le paramÃ¨tre &lt;code&gt;filters&lt;/code&gt; et la taille de la matrice &lt;code&gt;feature detector&lt;/code&gt; avec le paramÃ¨tre &lt;code&gt;kernel_size&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;On &lt;strong&gt;applique ensuite aux matrices obtenues une couche de &lt;em&gt;max pooling&lt;/em&gt;&lt;/strong&gt; qui permet de rÃ©duire les dimensions du problÃ¨me en ne conservant que les valeurs les plus importantes. Cette Ã©tape permet aussi de rendre plus souvent comparables &lt;strong&gt;des images ayant des caractÃ©ristiques semblables Ã  des endroits diffÃ©rents&lt;/strong&gt;. Le paramÃ¨tre &lt;code&gt;pool_size&lt;/code&gt; permet de choisir la &lt;strong&gt;taille du sous-ensemble sur lequel on ne va garder que la valeur maximale&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;On peut ensuite refaire des nouvelles couches de convolution suivies de pooling, en &lt;strong&gt;fonction de la complexitÃ© et de la taille de nos matrices de pixel en entrÃ©e du modÃ¨le&lt;/strong&gt;. On termine ces Ã©tapes par une couche &lt;code&gt;flatten()&lt;/code&gt; qui permet d'obtenir un vecteur unidimensionnel pour chaque observation, sur lequel on va pouvoir construire notre rÃ©seau de neurones profond avec des couches &lt;code&gt;dense()&lt;/code&gt;. On choisit ici une couche avec 128 neurones, suivie d'une couche avec 64 neurones. La couche de sortie contient &lt;strong&gt;10 neurones correspondant aux 10 classes possibles&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Le package R &lt;code&gt;keras3&lt;/code&gt; permet une syntaxe &lt;strong&gt;trÃ¨s proche de celle que l'on utiliserait sur Python&lt;/strong&gt;. On peut en plus relier ces couches avec l'opÃ©rateur &lt;code&gt;|&amp;gt;&lt;/code&gt;, rendant le code encore plus lisible et aÃ©rÃ©.  Ã€ noter qu'une fois que le modÃ¨le &lt;code&gt;my_first_r_cnn&lt;/code&gt; est crÃ©Ã©, &lt;strong&gt;il n'est pas nÃ©cessaire de le rÃ©assigner Ã  chaque ajout de layers&lt;/strong&gt;. L'opÃ©rateur &lt;code&gt;|&amp;gt;&lt;/code&gt; met Ã  jour directement l'objet &lt;code&gt;my_first_r_cnn&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Initialisation du modÃ¨le  &lt;/span&gt;
&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;keras_model_sequential&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;input_shape&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c1"&gt;# convolution et max pooling&lt;/span&gt;
&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on dÃ©finit les dimension des inputs dans une couche dÃ©diÃ©e&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_conv_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kernel_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="c1"&gt;# l&amp;#39;activation relu &amp;quot;casse&amp;quot; une linÃ©aritÃ© qui a pu&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="c1"&gt;# Ãªtre introduite avec la convolution&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_max_pooling_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pool_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_conv_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kernel_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_max_pooling_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pool_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_flatten&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;128&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;softmax&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut illustrer la &lt;strong&gt;structure de notre modÃ¨le&lt;/strong&gt; avec la fonction &lt;code&gt;summary()&lt;/code&gt; : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sequential&amp;quot;&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”ƒ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Layer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                      &lt;/span&gt;&lt;span class="err"&gt;â”ƒ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Shape&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="err"&gt;â”ƒ&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nx"&gt;Param&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”ƒ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;conv2d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Conv2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mi"&gt;320&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;max_pooling2d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;MaxPooling2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;conv2d_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Conv2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                 &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;064&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;max_pooling2d_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;MaxPooling2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;flatten&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Flatten&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                 &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;576&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;128&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="mi"&gt;73&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;856&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mi"&gt;650&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â”‚&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;85&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;146&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;332.60&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;KB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Trainable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;85&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;146&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;332.60&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;KB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Non&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;trainable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;0.00&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="entrainer-et-evaluer-les-performances-de-votre-modele"&gt;EntraÃ®ner et Ã©valuer les performances de votre modÃ¨le&lt;/h2&gt;
&lt;p&gt;La premiÃ¨re Ã©tape est de compiler l'objet crÃ©Ã© prÃ©cÃ©demment, &lt;strong&gt;en dÃ©finissant l'&lt;em&gt;optimizer&lt;/em&gt; qui sera utilisÃ©&lt;/strong&gt;, la fonction de perte et la mÃ©trique sur laquelle on souhaite optimiser le rÃ©sultat du modÃ¨le :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;optimizer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;adam&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;categorical_crossentropy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;metrics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ensuite, on peut &lt;strong&gt;lancer l'entraÃ®nement avec une instruction &lt;code&gt;fit()&lt;/code&gt;&lt;/strong&gt; que l'on applique Ã  nos donnÃ©es d'entraÃ®nement. On y dÃ©finit notamment le paramÃ¨tre &lt;code&gt;batch_size&lt;/code&gt; qui permet de dÃ©terminer combien d'images le modÃ¨le va traiter avant d'ajuster ses coefficients. Le paramÃ¨tre &lt;code&gt;epochs&lt;/code&gt; dÃ©finit le nombre de fois oÃ¹ le modÃ¨le passe sur toutes les donnÃ©es. Enfin, on split nos donnÃ©es d'entraÃ®nement dont on conserve 30% comme donnÃ©es de validation afin de d'&lt;strong&gt;Ã©valuer correctement les performances de notre modÃ¨le&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;epochs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;batch_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;validation_split&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 1/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 5s - 8ms/step - accuracy: 0.9120 - loss: 0.2766 - val_accuracy: 0.9623 - val_loss: 0.1200
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 2/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9766 - loss: 0.0753 - val_accuracy: 0.9774 - val_loss: 0.0733
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 3/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9849 - loss: 0.0507 - val_accuracy: 0.9799 - val_loss: 0.0608
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 4/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9878 - loss: 0.0395 - val_accuracy: 0.9832 - val_loss: 0.0553
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 5/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9895 - loss: 0.0316 - val_accuracy: 0.9859 - val_loss: 0.0490
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 6/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9923 - loss: 0.0234 - val_accuracy: 0.9826 - val_loss: 0.0640
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 7/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9929 - loss: 0.0207 - val_accuracy: 0.9855 - val_loss: 0.0533
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 8/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9946 - loss: 0.0165 - val_accuracy: 0.9866 - val_loss: 0.0507
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 9/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9941 - loss: 0.0165 - val_accuracy: 0.9835 - val_loss: 0.0632
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 10/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9960 - loss: 0.0123 - val_accuracy: 0.9870 - val_loss: 0.0501
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 11/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9958 - loss: 0.0123 - val_accuracy: 0.9853 - val_loss: 0.0613
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 12/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9965 - loss: 0.0103 - val_accuracy: 0.9872 - val_loss: 0.0570
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 13/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9968 - loss: 0.0095 - val_accuracy: 0.9871 - val_loss: 0.0544
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 14/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0082 - val_accuracy: 0.9871 - val_loss: 0.0583
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 15/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9972 - loss: 0.0091 - val_accuracy: 0.9867 - val_loss: 0.0624
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 16/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9988 - loss: 0.0043 - val_accuracy: 0.9871 - val_loss: 0.0623
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 17/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9976 - loss: 0.0070 - val_accuracy: 0.9857 - val_loss: 0.0693
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 18/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0096 - val_accuracy: 0.9853 - val_loss: 0.0693
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 19/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9983 - loss: 0.0051 - val_accuracy: 0.9862 - val_loss: 0.0690
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 20/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9988 - loss: 0.0040 - val_accuracy: 0.9882 - val_loss: 0.0612
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 21/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9983 - loss: 0.0054 - val_accuracy: 0.9881 - val_loss: 0.0596
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 22/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9986 - loss: 0.0042 - val_accuracy: 0.9789 - val_loss: 0.1290
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 23/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9976 - loss: 0.0074 - val_accuracy: 0.9876 - val_loss: 0.0682
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 24/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9996 - loss: 0.0017 - val_accuracy: 0.9879 - val_loss: 0.0690
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 25/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9996 - loss: 0.0016 - val_accuracy: 0.9843 - val_loss: 0.0981
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 26/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0094 - val_accuracy: 0.9863 - val_loss: 0.0723
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 27/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9985 - loss: 0.0049 - val_accuracy: 0.9884 - val_loss: 0.0659
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 28/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9994 - loss: 0.0019 - val_accuracy: 0.9879 - val_loss: 0.0725
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 29/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9997 - loss: 9.4193e-04 - val_accuracy: 0.9889 - val_loss: 0.0674
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 30/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9971 - loss: 0.0086 - val_accuracy: 0.9856 - val_loss: 0.0672
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut illustrer l'Ã©volution de la qualitÃ© du modÃ¨le au fur et Ã  mesure des epochs avec &lt;code&gt;plot&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-8-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Enfin, on sort la &lt;strong&gt;performance du modÃ¨le sur nos donnÃ©es test&lt;/strong&gt; avec &lt;code&gt;evaluate&lt;/code&gt;:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;accuracy_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;evaluate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## 313/313 - 1s - 3ms/step - accuracy: 0.9898 - loss: 0.0522
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;accuracy_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## $accuracy
## [1] 0.9898
## 
## $loss
## [1] 0.05221168
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Inutile bien sÃ»r de prÃ©ciser que nous sommes dans un cas de classification relativement simple et avec Ã©normÃ©ment de donnÃ©es de bonne qualitÃ©, donc ne cherchez pas Ã  atteindre de tels niveaux de prÃ©cision sur des donnÃ©es un peu plus compliquÃ©es! &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="predictions-a-partir-du-modele-pre-entraine"&gt;PrÃ©dictions Ã  partir du modÃ¨le prÃ©-entraÃ®nÃ©&lt;/h1&gt;
&lt;p&gt;Prenons par exemple la 20e image de l'Ã©chantillon test : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# On prend la 20e image&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;,,]&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# SÃ©lection de l&amp;#39;image&lt;/span&gt;
&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Label associÃ©&lt;/span&gt;

&lt;span class="c1"&gt;# Inverser les couleurs pour un affichage correct&lt;/span&gt;
&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;t&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rev&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c1"&gt;# Afficher l&amp;#39;image en niveaux de gris&lt;/span&gt;
&lt;span class="nf"&gt;image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Label :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-10-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On peut sortir les &lt;strong&gt;prÃ©dictions des probabilitÃ©s associÃ©es Ã  chaque classe avec la fonction &lt;code&gt;predict()&lt;/code&gt;&lt;/strong&gt;. La prÃ©diction associÃ©e Ã  l'image prÃ©cÃ©dente donne le rÃ©sultat suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# On prÃ©dit l&amp;#39;ensemble des X_test&lt;/span&gt;
&lt;span class="n"&gt;matrice_pred&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## 313/313 - 1s - 2ms/step
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# On sort l&amp;#39;index max - 1 (qui correspond Ã  la classe) de l&amp;#39;observation nÂ°20&lt;/span&gt;
&lt;span class="n"&gt;pred_obs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;which.max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;matrice_pred&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="nf"&gt;image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Label :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;PrÃ©diction :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pred_obs&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-11-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;h1 id="deep-learning-avec-r-ou-python"&gt;Deep Learning avec R ou Python?&lt;/h1&gt;
&lt;p&gt;Le package &lt;code&gt;keras3&lt;/code&gt; est &lt;strong&gt;trÃ¨s complet et semble offrir autant de possibilitÃ©s que le module Python&lt;/strong&gt;. Il dispose aussi d'une &lt;a href="https://keras3.posit.co"&gt;documentation complÃ¨te et trÃ¨s dÃ©taillÃ©e&lt;/a&gt;. Cependant, il faut garder en tÃªte qu'il fait tourner Python en arriÃ¨re-plan.   &lt;/p&gt;
&lt;p&gt;Le gros avantage pour un utilisateur non aguerri de Python est qu'il va &lt;strong&gt;gÃ©rer pour vous l'environnement anaconda et les dÃ©pendances&lt;/strong&gt;, qui peuvent Ãªtre un vrai casse-tÃªte quand on se met Ã  Python. Enfin, la &lt;strong&gt;syntaxe trÃ¨s proche de celle de Python peut vous permettre de commencer Ã  vous accoutumer en vue d'un futur changement de langage&lt;/strong&gt;, tout en restant sur votre langage favori en attendant!  &lt;/p&gt;
&lt;p&gt;Enfin, on peut imaginer que l'utilisation d'un package R peut Ãªtre trÃ¨s pratique dans le cadre de la mise en oeuvre de mÃ©thodes de statistiques infÃ©rentielles sur des prÃ©dictions de modÃ¨les de Machine Learning, comme par exemple dans &lt;a href="https://www.science.org/doi/10.1126/science.adi6000"&gt;ce papier trÃ¨s intÃ©ressant&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Keras"></category><category term="CNN"></category><category term="Machine Learning"></category><category term="Data Science"></category></entry><entry><title>Appariement par score de propension (PSM) : mise en oeuvre avec R et discussions mÃ©thodologiques</title><link href="https://blog.statoscop.fr/appariement-score-propension.html" rel="alternate"></link><published>2025-02-04T00:00:00+01:00</published><updated>2025-02-04T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-02-04:/appariement-score-propension.html</id><summary type="html">&lt;p&gt;Implications thÃ©oriques des mÃ©thodes d'appariement par score de propension et implÃ©mentation avec le package R &lt;code&gt;MatchIt&lt;/code&gt;.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#appariement-de-vos-donnees"&gt;Appariement de vos donnÃ©es&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#description-des-donnees-et-de-notre-problematique"&gt;Description des donnÃ©es et de notre problÃ©matique&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#evaluation-de-la-qualite-de-lappariement"&gt;Ã‰valuation de la qualitÃ© de l'appariement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux Ã  partir de la population appariÃ©e&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des mÃ©thodes avec score de propension&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Pour Ã©valuer un effet causal, comme par exemple les effets d'un mÃ©dicament sur des patients, on a besoin de ce que l'on appelle un &lt;strong&gt;essai clinique randomisÃ©&lt;/strong&gt;. Le principe est le suivant : on prend un certain nombre de patients (Ã  dÃ©terminer en fonction de l'effet minimum attendu, mais c'est un autre sujet) et on les sÃ©pare alÃ©atoirement en deux groupes : &lt;strong&gt;un groupe traitement&lt;/strong&gt; qui prend le mÃ©dicament et &lt;strong&gt;un groupe contrÃ´le&lt;/strong&gt; qui en gÃ©nÃ©ral prend un placebo.&lt;br&gt;
Comme on a dÃ©cidÃ© de maniÃ¨re complÃ¨tement alÃ©atoire l'assignation Ã  l'un ou l'autre groupe, on sait que ces deux groupes auront en moyenne des caractÃ©ristiques identiques (merci la loi faible des grands nombres!). Cela nous permet de conclure que les diffÃ©rences qui seraient observÃ©es entre les deux groupes (meilleur rÃ©tablissement, prise de poids, selon ce qu'on cherche Ã  observer...) &lt;strong&gt;sont imputables au traitement et non Ã  une spÃ©cificitÃ© d'un des groupes par rapport Ã  l'autre&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;L'essai clinique randomisÃ©, c'est donc l'idÃ©al pour montrer un effet causal et c'est d'ailleurs par lÃ  qu'il faut passer si vous souhaitez homologuer un nouveau mÃ©dicament. Mais c'est Ã©galement coÃ»teux et difficile Ã  rÃ©aliser. C'est pourquoi on cherche de plus en plus Ã  essayer &lt;strong&gt;d'imiter les conditions d'un essai clinique randomisÃ© Ã  partir de donnÃ©es observationnelles&lt;/strong&gt;. Pour cette note de blog, on va vous prÃ©senter une ces mÃ©thodes : le &lt;strong&gt;propensity score matching (PSM), ou appariement par score de propension&lt;/strong&gt;.  &lt;/p&gt;
&lt;h1 id="principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/h1&gt;
&lt;p&gt;L'appariement par score de propension vise Ã  &lt;strong&gt;recrÃ©er les conditions d'un essai clinique Ã  partir de donnÃ©es observationnelles&lt;/strong&gt;. On a ainsi un ensemble de donnÃ©es avec par exemple un certain nombre de patients qui ont pris un traitement (le &lt;em&gt;groupe traitement&lt;/em&gt;) et d'autres qui ne l'ont pas pris (le &lt;em&gt;groupe contrÃ´le&lt;/em&gt;). ProblÃ¨me : ces population qui n'ont pas Ã©tÃ© sÃ©parÃ©es de maniÃ¨re alÃ©atoire &lt;strong&gt;peuvent Ãªtre trÃ¨s diffÃ©rentes&lt;/strong&gt; et il n'est pas possible en l'Ã©tat de conclure qu'une diffÃ©rence entre elles soit imputable au traitement en question. Il faut donc recrÃ©er deux groupes de contrÃ´le et de traitement qui puissent Ãªtre comparables.    &lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/h2&gt;
&lt;p&gt;La premiÃ¨re Ã©tape est de &lt;strong&gt;calculer le score de propension&lt;/strong&gt;. Il est nÃ©cessaire en premier lieu &lt;strong&gt;d'identifier les variables observables&lt;/strong&gt; sur lesquelles on souhaiterait rÃ©Ã©quilibrer les deux groupes. Il n'y a pas de mÃ©thode magique pour choisir ces variables : il faut que ce soit la connaissance technique du cas qui guide votre choix. L'idÃ©e est d'identifier les variables dont vous imaginez qu'elles peuvent Ãªtre &lt;strong&gt;dÃ©sÃ©quilibrÃ©es entre vos deux groupes&lt;/strong&gt; pour diffÃ©rentes raisons (par exemple, le traitement A est plus souvent donnÃ© aux femmes donc je sais qu'il y aura plus de femmes dans ce groupe que dans un autre). Il faut aussi bien sÃ»r contrÃ´ler par les variables dont on sait qu'elles peuvent avoir &lt;strong&gt;un impact sur le rÃ©sultat indÃ©pendemment de l'efficacitÃ© du mÃ©dicament&lt;/strong&gt; (l'Ã¢ge impacte souvent la probabilitÃ© de guÃ©rison par exemple).  &lt;/p&gt;
&lt;p&gt;Une fois ces variables identifiÃ©es, il ne vous reste plus qu'Ã  faire &lt;strong&gt;sur l'ensemble de vos donnÃ©es un modÃ¨le de rÃ©gression logistique.&lt;/strong&gt; Par exemple, si votre groupe traitement prend un mÃ©dicament A et le reste du groupe ne prend pas ce mÃ©dicament, votre variable &lt;code&gt;Y&lt;/code&gt; sera l'indicatrice &lt;em&gt;Prend le mÃ©dicament A&lt;/em&gt; et vos variables &lt;span class="math"&gt;\(X_i\)&lt;/span&gt; les variables sur lesquelles vous souhaitez contrÃ´ler (sexe, Ã¢ge, etc...). La formule est la suivante :  &lt;/p&gt;
&lt;p&gt;&lt;span class="math"&gt;\(\log \left( \frac{P(Y=1)}{1 - P(Y=1)} \right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \dots\)&lt;/span&gt;&lt;/p&gt;
&lt;h2 id="appariement-de-vos-donnees"&gt;Appariement de vos donnÃ©es&lt;/h2&gt;
&lt;p&gt;La mise en oeuvre de cette rÃ©gression logistique nous permet &lt;strong&gt;d'obtenir un score de propension&lt;/strong&gt;. Celui-ci reprÃ©sente pour chaque individu la probabilitÃ© prÃ©dite qu'il appartienne au groupe traitement. Ce score de propension peut-Ãªtre utilisÃ© dans diffÃ©rentes mÃ©thodes (IPTW, variable d'ajustement dans la modÃ¨le...). Pour le PSM, nous l'utilisons pour &lt;strong&gt;apparier les donnÃ©es&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;En effet, pour chaque observation du groupe traitÃ©, l'idÃ©e est de lui attribuer une (ou plusieurs, selon vos donnÃ©es) observation(s) du groupe contrÃ´le, ayant &lt;strong&gt;un score de propension le plus proche possible&lt;/strong&gt;, donc des caractÃ©ristiques semblables. DiffÃ©rentes mÃ©thodes d'appariement existent, la plus courante Ã©tant celle du plus proche voisin.  &lt;/p&gt;
&lt;p&gt;Une fois que chaque observation du groupe traitement s'est vue attribuer son plus proche voisin du groupe contrÃ´le, on Ã©carte les donnÃ©es qui n'ont pas Ã©tÃ© appariÃ©es. La premiÃ¨re chose Ã  faire est bien sÃ»r &lt;strong&gt;d'Ã©valuer la qualitÃ© de l'appariement&lt;/strong&gt; en vÃ©rifiant la rÃ©partition des variables de contrÃ´le entre les deux groupes. Puis, nous allons rÃ©aliser nos analyses comme si nous Ã©tions dans le cas d'un essai clinique randomisÃ©, ou presque...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/h1&gt;
&lt;p&gt;Les mÃ©thodes utilisant des scores de propension, et en particulier l'appariement par score de propension, sont trÃ¨s bien prises en charge avec R. Nous vous proposons ici d'utiliser le package R &lt;code&gt;MatchIt&lt;/code&gt; sur des &lt;a href="https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records"&gt;donnÃ©es cliniques librement accessibles&lt;/a&gt;. Il s'agit de patients hospitalisÃ©s pour une insuffisance cardiaque.  &lt;/p&gt;
&lt;h2 id="description-des-donnees-et-de-notre-problematique"&gt;Description des donnÃ©es et de notre problÃ©matique&lt;/h2&gt;
&lt;p&gt;Nos donnÃ©es reprÃ©sentent 299 patients.  Parmi eux, la prÃ©valence de cas d'hypertension artÃ©rielle (HTA) est la suivante :  &lt;/p&gt;
&lt;p&gt;Table: PrÃ©sence de diabÃ¨tes&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;high_blood_pressure&lt;/th&gt;
&lt;th align="right"&gt;n&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;Non&lt;/td&gt;
&lt;td align="right"&gt;194&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;Oui&lt;/td&gt;
&lt;td align="right"&gt;105&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il y a 13 variables disponibles :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt;  [1] &amp;quot;age&amp;quot;                      &amp;quot;anaemia&amp;quot;                 
&lt;span class="gu"&gt;##&lt;/span&gt;  [3] &amp;quot;creatinine_phosphokinase&amp;quot; &amp;quot;diabetes&amp;quot;                
&lt;span class="gu"&gt;##&lt;/span&gt;  [5] &amp;quot;ejection_fraction&amp;quot;        &amp;quot;high_blood_pressure&amp;quot;     
&lt;span class="gu"&gt;##&lt;/span&gt;  [7] &amp;quot;platelets&amp;quot;                &amp;quot;serum_creatinine&amp;quot;        
&lt;span class="gu"&gt;##&lt;/span&gt;  [9] &amp;quot;serum_sodium&amp;quot;             &amp;quot;sex&amp;quot;                     
&lt;span class="gu"&gt;##&lt;/span&gt; [11] &amp;quot;smoking&amp;quot;                  &amp;quot;time&amp;quot;                    
&lt;span class="gu"&gt;##&lt;/span&gt; [13] &amp;quot;death_event&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On cherche ici Ã  &lt;strong&gt;Ã©valuer l'impact de l'HTA sur la probabilitÃ© de dÃ©cÃ©der des suites d'une insuffisance cardiaque&lt;/strong&gt;. Notre &lt;strong&gt;variable d'intÃ©rÃªt&lt;/strong&gt; est donc &lt;code&gt;death_event&lt;/code&gt;. Notre &lt;em&gt;traitement&lt;/em&gt; (ici on ne regarde pas l'effet d'un traitement mais d'une caractÃ©ristique des patients, cependant on va continuer Ã  utiliser cette terminologie) est ici le fait d'avoir une HTA. Le croisement de ces deux variables donne le rÃ©sultat suivant :  &lt;/p&gt;
&lt;p&gt;Table: HTA et dÃ©cÃ¨s&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;high_blood_pressure&lt;/th&gt;
&lt;th align="right"&gt;Effectifs&lt;/th&gt;
&lt;th align="right"&gt;Part de dÃ©cÃ¨s&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;Non&lt;/td&gt;
&lt;td align="right"&gt;194&lt;/td&gt;
&lt;td align="right"&gt;0.29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;Oui&lt;/td&gt;
&lt;td align="right"&gt;105&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Ici Ã  premiÃ¨re vue on trouve une proportion plus importante de dÃ©cÃ¨s parmi les patients ayant une HTA (37% contre 29% pour les autres). Mais bien sÃ»r, il n'est pas encore possible de &lt;strong&gt;savoir si cela est dÃ» Ã  l'HTA en soi ou Ã  d'autres caractÃ©ristiques&lt;/strong&gt; des patients souffrant de ce problÃ¨me.&lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/h2&gt;
&lt;p&gt;La fonction &lt;code&gt;matchit&lt;/code&gt; du package R &lt;code&gt;MatchIt&lt;/code&gt; nous permet de &lt;strong&gt;mettre directement en oeuvre le calcul du score de propension et l'appariement&lt;/strong&gt;. On commence par sÃ©lectionner les variables par lesquelles il nous semble important de contrÃ´ler : ici nous allons prendre l'ensemble des variables cliniques dont nous disposons. Il faut alors &lt;strong&gt;retirer les valeurs manquantes&lt;/strong&gt; pour ensuite obtenir deux groupes de patients avec et sans HTA ayant des caractÃ©ristiques semblables par ailleurs. La fonction s'Ã©crit ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MatchIt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;matchit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;creatinine_phosphokinase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;diabetes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="n"&gt;platelets&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_creatinine&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_sodium&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;smoking&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_ps&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;nearest&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;glm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;estimand&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ATT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ici on choisit le paramÃ©trage par dÃ©faut &lt;code&gt;method = "nearest"&lt;/code&gt; qui apparie Ã  chaque observation du &lt;strong&gt;groupe traitÃ©&lt;/strong&gt; (les patients ayant une HTA) l'observation du &lt;strong&gt;groupe contrÃ´le&lt;/strong&gt; ayant le score de propension le plus proche possible.
Le paramÃ¨tre &lt;code&gt;method = "ATT"&lt;/code&gt; permet d'Ã©valuer un &lt;strong&gt;effet du traitement sur les traitÃ©s&lt;/strong&gt; et non sur la population globale. Enfin, on dÃ©finit le modÃ¨le (ici logistique avec avec &lt;code&gt;distance = "glm"&lt;/code&gt;) pour le calcul du score de propension. Si vous avez un doute sur la mÃ©thode Ã  utiliser, &lt;a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html"&gt;reportez-vous Ã  la documentation du package MatchIT&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="evaluation-de-la-qualite-de-lappariement"&gt;Ã‰valuation de la qualitÃ© de l'appariement&lt;/h2&gt;
&lt;p&gt;Encore une fois, la librairie &lt;code&gt;MatchIt&lt;/code&gt; nous mÃ¢che directement le travail en nous permettant de comparer facilement la &lt;strong&gt;rÃ©partition de nos patients avant et aprÃ¨s appariement&lt;/strong&gt; avec &lt;code&gt;summary()&lt;/code&gt;. La &lt;strong&gt;rÃ©partition avant l'appariement&lt;/strong&gt; est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on affiche seulemet l&amp;#39;Ã©lÃ©ment `sum.all` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.all&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;&lt;/th&gt;
&lt;th align="right"&gt;Means Treated&lt;/th&gt;
&lt;th align="right"&gt;Means Control&lt;/th&gt;
&lt;th align="right"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th align="right"&gt;Var. Ratio&lt;/th&gt;
&lt;th align="right"&gt;eCDF Mean&lt;/th&gt;
&lt;th align="right"&gt;eCDF Max&lt;/th&gt;
&lt;th align="right"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;distance&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;td align="right"&gt;0.34&lt;/td&gt;
&lt;td align="right"&gt;0.36&lt;/td&gt;
&lt;td align="right"&gt;1.01&lt;/td&gt;
&lt;td align="right"&gt;0.11&lt;/td&gt;
&lt;td align="right"&gt;0.23&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;age&lt;/td&gt;
&lt;td align="right"&gt;62.34&lt;/td&gt;
&lt;td align="right"&gt;60.02&lt;/td&gt;
&lt;td align="right"&gt;0.20&lt;/td&gt;
&lt;td align="right"&gt;0.91&lt;/td&gt;
&lt;td align="right"&gt;0.06&lt;/td&gt;
&lt;td align="right"&gt;0.13&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;sexFemme&lt;/td&gt;
&lt;td align="right"&gt;0.42&lt;/td&gt;
&lt;td align="right"&gt;0.31&lt;/td&gt;
&lt;td align="right"&gt;0.21&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;sexHomme&lt;/td&gt;
&lt;td align="right"&gt;0.58&lt;/td&gt;
&lt;td align="right"&gt;0.69&lt;/td&gt;
&lt;td align="right"&gt;-0.21&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;anaemiaNon&lt;/td&gt;
&lt;td align="right"&gt;0.54&lt;/td&gt;
&lt;td align="right"&gt;0.58&lt;/td&gt;
&lt;td align="right"&gt;-0.08&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;anaemiaOui&lt;/td&gt;
&lt;td align="right"&gt;0.46&lt;/td&gt;
&lt;td align="right"&gt;0.42&lt;/td&gt;
&lt;td align="right"&gt;0.08&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td align="right"&gt;488.90&lt;/td&gt;
&lt;td align="right"&gt;632.14&lt;/td&gt;
&lt;td align="right"&gt;-0.16&lt;/td&gt;
&lt;td align="right"&gt;0.73&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;0.11&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;diabetesNon&lt;/td&gt;
&lt;td align="right"&gt;0.59&lt;/td&gt;
&lt;td align="right"&gt;0.58&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;diabetesOui&lt;/td&gt;
&lt;td align="right"&gt;0.41&lt;/td&gt;
&lt;td align="right"&gt;0.42&lt;/td&gt;
&lt;td align="right"&gt;-0.03&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;platelets&lt;/td&gt;
&lt;td align="right"&gt;269989.18&lt;/td&gt;
&lt;td align="right"&gt;259769.00&lt;/td&gt;
&lt;td align="right"&gt;0.12&lt;/td&gt;
&lt;td align="right"&gt;0.66&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;serum_creatinine&lt;/td&gt;
&lt;td align="right"&gt;1.39&lt;/td&gt;
&lt;td align="right"&gt;1.40&lt;/td&gt;
&lt;td align="right"&gt;-0.01&lt;/td&gt;
&lt;td align="right"&gt;1.99&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.13&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;serum_sodium&lt;/td&gt;
&lt;td align="right"&gt;136.85&lt;/td&gt;
&lt;td align="right"&gt;136.51&lt;/td&gt;
&lt;td align="right"&gt;0.08&lt;/td&gt;
&lt;td align="right"&gt;0.82&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;smokingNon&lt;/td&gt;
&lt;td align="right"&gt;0.71&lt;/td&gt;
&lt;td align="right"&gt;0.66&lt;/td&gt;
&lt;td align="right"&gt;0.12&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;smokingOui&lt;/td&gt;
&lt;td align="right"&gt;0.29&lt;/td&gt;
&lt;td align="right"&gt;0.34&lt;/td&gt;
&lt;td align="right"&gt;-0.12&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate ainsi que les personnes souffrant d'hyper tension artÃ©rielle sont souvent plus Ã¢gÃ©es que les autres. Ce sont Ã©galement plus souvent des femmes, et plus souvent des personnes atteintes d'anÃ©mie. Observons maintenant si notre appariement a permis d'Ã©quilibrer nos deux groupes sur ces variables et sur les autres :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# on affiche seulement l&amp;#39;Ã©lÃ©ment `sum.matched` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;&lt;/th&gt;
&lt;th align="right"&gt;Means Treated&lt;/th&gt;
&lt;th align="right"&gt;Means Control&lt;/th&gt;
&lt;th align="right"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th align="right"&gt;Var. Ratio&lt;/th&gt;
&lt;th align="right"&gt;eCDF Mean&lt;/th&gt;
&lt;th align="right"&gt;eCDF Max&lt;/th&gt;
&lt;th align="right"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;distance&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;1.10&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;age&lt;/td&gt;
&lt;td align="right"&gt;62.34&lt;/td&gt;
&lt;td align="right"&gt;62.36&lt;/td&gt;
&lt;td align="right"&gt;0.00&lt;/td&gt;
&lt;td align="right"&gt;0.93&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.07&lt;/td&gt;
&lt;td align="right"&gt;0.89&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;sexFemme&lt;/td&gt;
&lt;td align="right"&gt;0.42&lt;/td&gt;
&lt;td align="right"&gt;0.40&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;sexHomme&lt;/td&gt;
&lt;td align="right"&gt;0.58&lt;/td&gt;
&lt;td align="right"&gt;0.60&lt;/td&gt;
&lt;td align="right"&gt;-0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;anaemiaNon&lt;/td&gt;
&lt;td align="right"&gt;0.54&lt;/td&gt;
&lt;td align="right"&gt;0.56&lt;/td&gt;
&lt;td align="right"&gt;-0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;anaemiaOui&lt;/td&gt;
&lt;td align="right"&gt;0.46&lt;/td&gt;
&lt;td align="right"&gt;0.44&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td align="right"&gt;488.90&lt;/td&gt;
&lt;td align="right"&gt;481.78&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.89&lt;/td&gt;
&lt;td align="right"&gt;0.02&lt;/td&gt;
&lt;td align="right"&gt;0.07&lt;/td&gt;
&lt;td align="right"&gt;0.46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;diabetesNon&lt;/td&gt;
&lt;td align="right"&gt;0.59&lt;/td&gt;
&lt;td align="right"&gt;0.63&lt;/td&gt;
&lt;td align="right"&gt;-0.08&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;diabetesOui&lt;/td&gt;
&lt;td align="right"&gt;0.41&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;td align="right"&gt;0.08&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;platelets&lt;/td&gt;
&lt;td align="right"&gt;269989.18&lt;/td&gt;
&lt;td align="right"&gt;264619.41&lt;/td&gt;
&lt;td align="right"&gt;0.06&lt;/td&gt;
&lt;td align="right"&gt;0.87&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.10&lt;/td&gt;
&lt;td align="right"&gt;1.02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;serum_creatinine&lt;/td&gt;
&lt;td align="right"&gt;1.39&lt;/td&gt;
&lt;td align="right"&gt;1.43&lt;/td&gt;
&lt;td align="right"&gt;-0.03&lt;/td&gt;
&lt;td align="right"&gt;2.09&lt;/td&gt;
&lt;td align="right"&gt;0.04&lt;/td&gt;
&lt;td align="right"&gt;0.18&lt;/td&gt;
&lt;td align="right"&gt;0.66&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;serum_sodium&lt;/td&gt;
&lt;td align="right"&gt;136.85&lt;/td&gt;
&lt;td align="right"&gt;136.60&lt;/td&gt;
&lt;td align="right"&gt;0.06&lt;/td&gt;
&lt;td align="right"&gt;0.88&lt;/td&gt;
&lt;td align="right"&gt;0.01&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;1.07&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;smokingNon&lt;/td&gt;
&lt;td align="right"&gt;0.71&lt;/td&gt;
&lt;td align="right"&gt;0.74&lt;/td&gt;
&lt;td align="right"&gt;-0.06&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;smokingOui&lt;/td&gt;
&lt;td align="right"&gt;0.29&lt;/td&gt;
&lt;td align="right"&gt;0.26&lt;/td&gt;
&lt;td align="right"&gt;0.06&lt;/td&gt;
&lt;td align="right"&gt;NA&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.03&lt;/td&gt;
&lt;td align="right"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;On constate que la plupart des variables sont maintenant plus Ã©quilibrÃ©es entre les deux groupes. Au global, la variable &lt;code&gt;distance&lt;/code&gt; montre la grande proximitÃ© du score de propension entre les deux groupes. On peut Ã©galement mettre en Ã©vidence l'effet de l'appariement visuellement sur quelques unes des variables avec la fonction &lt;code&gt;plot&lt;/code&gt; :&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;td align="right"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;density&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;which.xs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/psm/unnamed-chunk-9-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;h2 id="mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux Ã  partir de la population appariÃ©e&lt;/h2&gt;
&lt;p&gt;Une fois convaincus de la qualitÃ© de l'appariement, on peut mettre en oeuvre notre modÃ¨le statistique &lt;strong&gt;en tenant compte pour le calcul des estimateurs du fait que nous manipulons des observations appariÃ©es&lt;/strong&gt;. DiffÃ©rentes mÃ©thodes sont possibles en fonction de la variable d'intÃ©rÃªt, du type d'appariement rÃ©alisÃ©, etc. En cas de doute, vous pouvez vous reporter &lt;a href="https://kosukeimai.github.io/MatchIt/articles/estimating-effects.html#modeling-the-outcome"&gt;Ã  la vignette consacrÃ©e Ã  l'estimation des effets du package &lt;code&gt;MatchIt&lt;/code&gt;&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;Dans notre exemple simple, nous allons tout d'abord extraire les donnÃ©es appariÃ©es avec &lt;code&gt;match_data&lt;/code&gt; et calibrer un modÃ¨le linÃ©aire gÃ©nÃ©ralisÃ©. Nous &lt;strong&gt;pondÃ©rons avec les poids issus de l'appariement&lt;/strong&gt;. S'ils sont tous Ã©gaux Ã  1 (c'est le cas pour nous) cela n'est pas nÃ©cessaire. Toutefois, cela reste une bonne habitude en cas d'appariement utilisant des poids diffÃ©rents. Il est possible Ã©galement de &lt;strong&gt;contrÃ´ler notre rÃ©gression logistique par les variables ayant servi Ã  l'appariement, ou directement par le score de propension&lt;/strong&gt;. Nous choisissons ici de ne pas le faire en raison de la bonne qualitÃ© de l'appariement. &lt;/p&gt;
&lt;p&gt;Enfin, on utilise le package &lt;code&gt;marginaleffects&lt;/code&gt; pour estimer l'&lt;strong&gt;effet moyen sur les traitÃ©s (ATT)&lt;/strong&gt; en tenant compte l'appariement.   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;match_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;glm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;death_event&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;binomial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;marginaleffects&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;avg_comparisons&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;vcov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;subclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;newdata&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;subset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Oui&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;term&lt;/th&gt;
&lt;th align="left"&gt;contrast&lt;/th&gt;
&lt;th align="right"&gt;estimate&lt;/th&gt;
&lt;th align="right"&gt;std.error&lt;/th&gt;
&lt;th align="right"&gt;statistic&lt;/th&gt;
&lt;th align="right"&gt;p.value&lt;/th&gt;
&lt;th align="right"&gt;s.value&lt;/th&gt;
&lt;th align="right"&gt;conf.low&lt;/th&gt;
&lt;th align="right"&gt;conf.high&lt;/th&gt;
&lt;th align="right"&gt;predicted_lo&lt;/th&gt;
&lt;th align="right"&gt;predicted_hi&lt;/th&gt;
&lt;th align="right"&gt;predicted&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;high_blood_pressure&lt;/td&gt;
&lt;td align="left"&gt;Oui - Non&lt;/td&gt;
&lt;td align="right"&gt;0.05&lt;/td&gt;
&lt;td align="right"&gt;0.06&lt;/td&gt;
&lt;td align="right"&gt;0.76&lt;/td&gt;
&lt;td align="right"&gt;0.45&lt;/td&gt;
&lt;td align="right"&gt;1.16&lt;/td&gt;
&lt;td align="right"&gt;-0.08&lt;/td&gt;
&lt;td align="right"&gt;0.17&lt;/td&gt;
&lt;td align="right"&gt;0.32&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;td align="right"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;L'estimateur reprÃ©sente la &lt;strong&gt;diffÃ©rence de proportions de dÃ©cÃ¨s&lt;/strong&gt; entre le groupe traitÃ© (ceux avec HTA) et le groupe contrÃ´le (les autres). Elle est ici de 0.05, soit 5 points de pourcentage. En effet, les variables &lt;code&gt;predicted_lo&lt;/code&gt; et &lt;code&gt;predicted_hi&lt;/code&gt; indiquent que lorsqu'on apparie, la part de dÃ©cÃ¨s dans le groupe contrÃ´le monte Ã  32% (contre 29% dans l'ensemble des patients n'ayant pas de tension artÃ©rielle), alors qu'elle est de 37% dans le groupe traitÃ©. De fait, cette diffÃ©rence n'est pas significative, puisque la p-value est de 0.45 (&lt;a href="https://blog.statoscop.fr/comprendre-et-interpreter-les-p-values.html"&gt;un autre de nos articles explique ce qu'est une p-value&lt;/a&gt;). Bien sÃ»r, cela ne signifie pas forcÃ©ment que cet effet n'existe pas, mais en tout cas on ne dispose pas dans nos donnÃ©es de suffisament d'observations pour affirmer ici que l'HTA augmente signficativement la probabilitÃ© de dÃ©cÃ¨s.&lt;/p&gt;
&lt;h1 id="forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des mÃ©thodes avec score de propension&lt;/h1&gt;
&lt;p&gt;De nombreuses questions se posent autour des mÃ©thodes de score de propension. La premiÃ¨re est sans doute son avantage rÃ©el ou supposÃ© par rapport Ã  un modÃ¨le multivariÃ© classique. Il est vrai cependant que cette mÃ©thode a l'avantage de capter dans une seule variable un ensemble de dimensions observables par lesquelles on souhaite contrÃ´ler notre analyse. Mais le fait, dans le cas de l'appariement, de se passer d'une partie des donnÃ©es pose question. Cela permet cependant de calculer &lt;strong&gt;un effet moyen sur les traitÃ©s (ATT)&lt;/strong&gt; et de ne pas trop biaiser l'effet avec des observations qui auraient des caractÃ©ristiques trÃ¨s Ã©loignÃ©es de la population traitÃ©e. De plus, la mÃ©thode de pondÃ©ration par inverse de probabilitÃ© de traitement (IPTW) permet d'utiliser le score de propension sans Ã©carter de donnÃ©es, et il est Ã©galement possible d'estimer un ATT.  &lt;/p&gt;
&lt;p&gt;La plus grosse limite de cette mÃ©thode est sans doute le fait qu'elle pourrait faire oublier que nos groupes de traitement et de contrÃ´le sont comparables &lt;strong&gt;uniquement sur des caractÃ©ristiques observables&lt;/strong&gt;. Il n'est donc pas Ã  exclure que des biais de sÃ©lection non observables polluent notre analyse, lÃ  oÃ¹ un essai clinique randomisÃ© calibrÃ© correctement met normalement Ã  l'abri de ce problÃ¨me. Il est donc fondamental de garder constamment cet Ã©cueil en tÃªte pour essayer d'anticiper les possibles dÃ©fauts de nos analyses.  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! Si vous cherchez des &lt;a href="https://www.statoscop.fr"&gt;statisticiens pour vos Ã©tudes cliniques n'hÃ©sitez pas Ã  visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;

&lt;script type="text/javascript"&gt;if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width &lt; 768) ? "left" : align;
        indent = (screen.width &lt; 768) ? "0em" : indent;
        linebreak = (screen.width &lt; 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
&lt;/script&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Passer de RMarkdown Ã  Quarto pour vos rapports statistiques</title><link href="https://blog.statoscop.fr/quarto-rmarkdown.html" rel="alternate"></link><published>2024-12-12T00:00:00+01:00</published><updated>2024-12-12T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2024-12-12:/quarto-rmarkdown.html</id><summary type="html">&lt;p&gt;Petit exemple pour vous accompagner dans la transition de RMarkdown vers Quarto, et pourquoi Ã§a va rendre vos rapports encore plus ergonomiques!&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#configuration-de-quarto"&gt;Configuration de Quarto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-des-onglets"&gt;Utilisation des onglets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#generation-dynamique-de-contenu-markdown"&gt;GÃ©nÃ©ration dynamique de contenu markdown&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#les-references-aux-graphiques-et-tableaux"&gt;Les rÃ©fÃ©rences aux graphiques et tableaux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://rmarkdown.rstudio.com/"&gt;RMarkdown&lt;/a&gt; est un outil de gÃ©nÃ©ration de rapports qui permet de &lt;strong&gt;communiquer des rÃ©sultats d'analyse de maniÃ¨re efficace, ergonomique et automatisÃ©e&lt;/strong&gt;. Nous l'utilisions de maniÃ¨re quasi-quotidienne, mais force est de constater l'Ã©mergence irrÃ©mÃ©diable de &lt;a href="https://quarto.org/"&gt;Quarto&lt;/a&gt;. Du coup, on a fini par s'y mettre. Et en effet, Quarto permet non seulement de reproduire le type de rapports que l'on obtenait avec RMarkdown, mais il offre aussi &lt;strong&gt;encore plus de possibilitÃ©s!&lt;/strong&gt; C'est pour cela que nous vous prÃ©sentons ici quelques unes de ses fonctionnalitÃ©s et 2/3 choses Ã  ne pas rater pour l'adopter sans peine.  &lt;/p&gt;
&lt;p&gt;Dans cet article nous allons suivre la crÃ©ation d'un rapport fictif, qui repose sur des donnÃ©es complÃ¨tement inventÃ©es. L'idÃ©e est d'Ã©tudier la prÃ©valence d'une maladie en fonction de diffÃ©rentes variables. &lt;/p&gt;
&lt;h1 id="configuration-de-quarto"&gt;Configuration de Quarto&lt;/h1&gt;
&lt;p&gt;Pour lancer votre premier rapport, vous pouvez comme pour RMarkdown le crÃ©er directement depuis RStudio avec &lt;code&gt;File -&amp;gt; New file -&amp;gt; Quarto document&lt;/code&gt;. Je prÃ©fÃ¨re personnellement dÃ©cocher l'option &lt;code&gt;Use visual markdown editor&lt;/code&gt; qui propose une Ã©dition qui met directement en forme la partie Markdown, mais vous pouvez de toute faÃ§on passer de l'un Ã  l'autre en cliquant sur &lt;code&gt;Source&lt;/code&gt; ou &lt;code&gt;Visual&lt;/code&gt; en haut de de votre Ã©cran d'Ã©dition.  &lt;/p&gt;
&lt;p&gt;La premiÃ¨re chose Ã  paramÃ©trer est votre en-tÃªte YAML qui donne les paramÃ©trages globaux de votre document. Voici le mien :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;---
title: &amp;quot;Mon rapport dynamique&amp;quot;
format: 
  html:
    self-contained: true
    toc: true
    smooth-scroll: true
execute:
  echo: false
--- 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour RMarkdown, on y renseigne le titre et les formats de sortie, ici html. On remarque le paramÃ¨tre &lt;code&gt;self-contained: true&lt;/code&gt; &lt;strong&gt;qui est fondamental&lt;/strong&gt; : en effet, les sorties html de Quarto nÃ©cessitent de charger beaucoup de classes CSS et de fonctions javascript. Par dÃ©faut, tous ces Ã©lÃ©ments sont stockÃ©s dans un dossier &lt;code&gt;nom_de_votre_fichier_files&lt;/code&gt;. Cela permet par exemple de &lt;strong&gt;ne le charger qu'une fois&lt;/strong&gt; si vous avez plusieurs fichiers Quarto dans un projet. Par contre, si vous envoyez votre rapport html par mail, &lt;strong&gt;il ne va pas s'afficher correctement!&lt;/strong&gt; Ce paramÃ¨tre permet donc de &lt;strong&gt;charger toutes les dÃ©pendances nÃ©cessaires directement dans le fichier&lt;/strong&gt;, au prix d'un poids du fichier bien plus important. &lt;/p&gt;
&lt;p&gt;Bien sÃ»r, ce que l'on adorait dans RMarkdown et qui est encore plus agrÃ©able avec Quarto, c'est &lt;strong&gt;la table des matiÃ¨res flottante&lt;/strong&gt; sur le cÃ´tÃ©. CouplÃ©e au paramÃ¨tre &lt;code&gt;smooth-scroll: true&lt;/code&gt;, elle permet une navigation dans le fichier trÃ¨s agrÃ©able. C'est particuliÃ¨rement apprÃ©ciable dans le cas de rapports trÃ¨s volumineux. Mais jugez plutÃ´t :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/toc.gif"&gt;&lt;/p&gt;
&lt;p&gt;Enfin dans &lt;code&gt;execute&lt;/code&gt; je rÃ¨gle un comportement par dÃ©faut de traitement de mes cellules de code. Ici, &lt;code&gt;echo: false&lt;/code&gt; indique que je souhaite que seules les sorties s'affichent dans mon rapport.  &lt;/p&gt;
&lt;p&gt;Bien sÃ»r, on peut Ã©craser le paramÃ©trage par dÃ©faut pour les blocs de code en les paramÃ©trant directement, avec une syntaxe diffÃ©rente de celle de RMarkdown, ici par exemple pour le bloc me permettant de charger les librairies et les donnÃ©es :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| include: false&lt;/span&gt;

&lt;span class="gh"&gt;# Librairies&lt;/span&gt;
library(dplyr)
library(ggplot2)

&lt;span class="gh"&gt;# ThÃ¨me et styles ggplot2&lt;/span&gt;
options(ggplot2.discrete.colour = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
options(ggplot2.discrete.fill = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
theme_set(theme_bw())

&lt;span class="gh"&gt;# Import de la base&lt;/span&gt;
base_patients &amp;lt;- read.csv(&amp;quot;base_fictive_patients.csv&amp;quot;)
```                                                                       &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;La partie &lt;code&gt;#| include: false&lt;/code&gt; permet d'indiquer que je ne souhaite pas que ce code ni sa sortie n'apparaisse dans le rapport.&lt;br&gt;
Ã€ noter enfin qu'il existe de nombreuses nouvelles possibilitÃ©s avec Quarto, comme le fait de permettre Ã  l'utilisateur d'afficher ou non le code ayant permis de gÃ©nÃ©rer un rÃ©sultat (&lt;code&gt;code-fold&lt;/code&gt;) et de lui laisser le choix du comportement par dÃ©faut de ces blocs de code (&lt;code&gt;code-tools&lt;/code&gt;). Je vous laisse explorer les &lt;a href="https://quarto.org/docs/output-formats/html-code.html"&gt;pages de documentation liÃ©es Ã  ces points&lt;/a&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="utilisation-des-onglets"&gt;Utilisation des onglets&lt;/h1&gt;
&lt;p&gt;Une de nos fonctionnalitÃ©s prÃ©fÃ©rÃ©es de RMarkdown, c'Ã©tait la possibilitÃ© de faire des onglets. Comme pour la table des matiÃ¨res flottante, cela permet d'allÃ©ger des rapports contenant parfois beaucoup de rÃ©sultats et cela facilite la navigation de la personne qui cherche un des nombreux rÃ©sultats qui se trouve dans votre rapport. Ã‰videmment cela reste possible avec Quarto, en utilisant une syntaxe lÃ©gÃ¨rement diffÃ©rente. On va en effet encapsuler notre code Markdown dans une instruction &lt;code&gt;::: panel-tabset&lt;/code&gt;. Tous les titres qui suivront seront automatiquement crÃ©Ã©s comme des onglets. Dans notre rapport fictif, on va par exemple prÃ©senter la rÃ©partition de chacune des variables caractÃ¨re dans un onglet de la maniÃ¨re suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;## Variables caractÃ¨res&lt;/span&gt;

::: panel-tabset
&lt;span class="gu"&gt;### Sexe&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Sexe) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Tabagisme&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Fumeur) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Poids&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Poids) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le rÃ©sultat obtenu est le suivant :   &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets.gif"&gt;  &lt;/p&gt;
&lt;h1 id="generation-dynamique-de-contenu-markdown"&gt;GÃ©nÃ©ration dynamique de contenu markdown&lt;/h1&gt;
&lt;p&gt;Une autre fonctionnalitÃ© trÃ¨s pratique de RMarkdown que l'on retrouve dans Quarto est la possibilitÃ© de gÃ©nÃ©rer automatiquement le code Markdown, et pas seulement les blocs de code R ou Python. Cela est trÃ¨s pratique quand on souhaite par exemple automatiser la crÃ©ation d'un dictionnaire de variables, ou faire un rapport standardisÃ© pour diffÃ©rentes donnÃ©es.  &lt;/p&gt;
&lt;p&gt;Ici par exemple on peut se dire qu'on va prÃ©senter les variables numÃ©riques de cette faÃ§on. Comme pour les variables caractÃ¨res, on va prÃ©senter un tableau de statistiques par variable dans chaque onglet mais cette fois on va faire une boucle sur les variables numÃ©riques et ne pas rÃ©pÃ©ter le code pour chaque variable. Pour cela, on code dans un bloc R avec le paramÃ¨tre &lt;code&gt;results: asis&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| results: asis&lt;/span&gt;
&lt;span class="gh"&gt;# boucle sur les variables numÃ©riques&lt;/span&gt;
for (var_num in names(base_patients |&amp;gt; select(where(is.numeric)))){
  # titre de l&amp;#39;onglet
  cat(glue::glue(&amp;quot;### {var_num}&amp;quot;))  
  cat(&amp;quot;\n&amp;quot;)
  base_patients |&amp;gt; 
    summarise(
      across(all_of(var_num), list(Min = min,
                                   Moyenne = mean,
                                   Mediane = median,
                                   Max = max),
             .names = &amp;quot;{.fn}&amp;quot;)) |&amp;gt; 
    knitr::kable(format.args = list(digits = 2, nsmall = 2)) |&amp;gt; 
    print()
  # retour Ã  la ligne
  cat(&amp;quot;\n&amp;quot;)
}

```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il est important de noter plusieurs choses :&lt;br&gt;
- Le code Mardown doit se trouver dans une instructions &lt;code&gt;cat()&lt;/code&gt;&lt;br&gt;
- Ne pas oublier d'ajouter des retours Ã  la ligne avec &lt;code&gt;cat("\n")&lt;/code&gt; &lt;br&gt;
- Il faut afficher les sorties de R que l'on souhaite dans un &lt;code&gt;print()&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;Le rÃ©sultat obtenu est le mÃªme que pour les variables caractÃ¨res, mais avec un code factorisÃ© et gÃ©nÃ©ralisable Ã  diffÃ©rentes donnÃ©es en entrÃ©e :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets_num.gif"&gt;  &lt;/p&gt;
&lt;h1 id="les-references-aux-graphiques-et-tableaux"&gt;Les rÃ©fÃ©rences aux graphiques et tableaux&lt;/h1&gt;
&lt;p&gt;Vous devez le savoir si vous avez dÃ©jÃ  menÃ© des analyses statistiques, le tableau 1 ne le reste pas forcÃ©ment tout au long du processus, le graphique 3 apparaÃ®t finalement souvent en second, etc... Avec Quarto, comme c'Ã©tait le cas avec RMarkdown, on peut automatiser le rÃ©fÃ©rencement aux diffÃ©rents Ã©lÃ©ments de notre rapport trÃ¨s simplement. Dans le code, on va indiquer un label et un titre au bloc de code correspondant Ã  notre graphique avec &lt;code&gt;#| label: fig-mon-label&lt;/code&gt; et &lt;code&gt;#| fig-cap: "Titre de mon graphique"&lt;/code&gt;, comme ci-dessous pour les deux graphiques de notre rapport :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| label: fig-glucose&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Taux de glucose et prÃ©sence de la maladie&amp;quot;&lt;/span&gt;

base_patients %&amp;gt;% 
  ggplot(aes(x = factor(Maladie), y = Taux_de_glucose)) + 
  geom_boxplot(aes(fill = factor(Maladie)), alpha = 0.4) + 
  geom_jitter(aes(color = factor(Maladie)), size = 0.4, alpha = 0.9) + 
  theme(legend.position = &amp;quot;none&amp;quot;) + 
   labs(x = &amp;quot;PrÃ©sence de la maladie&amp;quot;, 
        y = &amp;quot;Taux de glucose&amp;quot;)
```                                                                   &amp;#39;

```{r}
&lt;span class="gh"&gt;#| label: fig-sexe-poids&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Sexe, poids et prÃ©valence de la maladie&amp;quot;&lt;/span&gt;
base_patients |&amp;gt; 
  group_by(Sexe, Poids) |&amp;gt; 
  summarise(taux = mean(Maladie),
            .groups = &amp;quot;drop&amp;quot;) |&amp;gt; 
  ggplot(aes(x = Poids, y = taux, fill = Sexe)) + 
  geom_col(position = &amp;quot;dodge&amp;quot;, width = 0.5) + 
  scale_y_continuous(labels = ~ scales::percent(.)) + 
  labs(x = &amp;quot;Tabagisme&amp;quot;, y = &amp;quot;PrÃ©valence de la maladie&amp;quot;)
```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il n'y aura ensuite plus qu'Ã  faire rÃ©fÃ©rence Ã  la sortie voulue dans le texte avec la syntaxe &lt;code&gt;@fig-mon-label&lt;/code&gt; qui permettra de numÃ©roter correctement le graphique ou le tableau par rapport Ã  sa position dans le rapport. De plus, par dÃ©faut dans Quarto, l'Ã©lÃ©ment est cliquable ce qui permet de directement retrouver l'Ã©lÃ©ment en question. Enfin, en passant juste la souris sur l'Ã©lÃ©ment, on peut voir une prÃ©visualisation de celui-ci :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/cross-ref.gif"&gt;  &lt;/p&gt;
&lt;h1 id="bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/h1&gt;
&lt;p&gt;On a ainsi effleurÃ© qu'une toute petite partie des possibilitÃ©s de Quarto, mais on ne voulait pas partir sans vous parler des &lt;em&gt;Callout Blocks&lt;/em&gt;. Ce sont des blocs de texte mis en forme, permettant de gÃ©nÃ©rer diffÃ©rents types de messages (note, avertissement, erreurs...). On peut Ã©galement les rendre dÃ©pliables de maniÃ¨re Ã  ce que le texte ne s'affiche que si l'utilisateur le souhaite.   &lt;/p&gt;
&lt;p&gt;Voici par exemple le code pour une note (dÃ©pliable) et un avertissement :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;::: {.callout-note collapse=&amp;quot;true&amp;quot;}   
Pour rappel, cette note s&amp;#39;appuie sur des donnÃ©es complÃ¨tement fictives et ne devrait pas rÃ©volutionner la recherche scientifique.
:::  

::: {.callout-caution}  
L&amp;#39;utilisation des blocs d&amp;#39;annotation de Quarto peut Ãªtre addictive, merci de ne pas en abuser.
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le rÃ©sultat obtenu est le suivant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/callout-bloc.gif"&gt;  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans cet article, nous n'avons prÃ©sentÃ© qu'une petite partie du potentiel de Quarto. Mais vous pouvez explorer aussi toutes les autres possibilitÃ©s (Dashboards Observable/RShiny, utilisation de Python/Julia, rÃ©daction de livres, dÃ©ploiement de vos rÃ©sultats sur un serveur...) dans &lt;a href="https://quarto.org/docs/guide/"&gt;la documentation officielle du projet&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Vous souhaitez mettre en place des rapports Quarto automatisÃ©s dans votre entreprise ou votre laboratoire? Vous prÃ©fÃ©rez l'utiliser pour votre premier dashboard? N'hÃ©sitez pas Ã  &lt;a href="https://statoscop.fr/contact"&gt;nous contacter&lt;/a&gt;! &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! Le faux rapport html sur lequel s'appuie cette note est &lt;a href="https://statoscop.fr/static/rapport_quarto.html"&gt;disponible en ligne&lt;/a&gt;. Vous retrouverez le code ayant permis de le gÃ©nÃ©rer sur le &lt;a href="https://github.com/Statoscop/notebooks-blog/tree/main/Rapport%20Quarto"&gt;github de Statoscop&lt;/a&gt;. Vous pouvez aussi &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="quarto"></category><category term="rmarkdown"></category><category term="rapport"></category></entry><entry><title>Coder des fonctions dans le tidyverse</title><link href="https://blog.statoscop.fr/coder-des-fonctions-dans-le-tidyverse.html" rel="alternate"></link><published>2023-11-28T00:00:00+01:00</published><updated>2023-11-28T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2023-11-28:/coder-des-fonctions-dans-le-tidyverse.html</id><summary type="html">&lt;p&gt;Quelques trucs pour coder facilement ses propres fonctions en utilisant la syntaxe du tidyverse.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#le-tidyverse-et-levaluation-non-standard"&gt;Le tidyverse et l'Ã©valuation non standard&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#faire-reference-aux-parametres-de-ma-fonction"&gt;Faire rÃ©fÃ©rence aux paramÃ¨tres de ma fonction&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#parametres-renseignes-en-symboles"&gt;ParamÃ¨tres renseignÃ©s en symboles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#parametres-renseignes-en-chaines-de-caracteres"&gt;ParamÃ¨tres renseignÃ©s en chaÃ®nes de caractÃ¨res&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#nommer-des-variables-en-fonction-des-parametres"&gt;Nommer des variables en fonction des paramÃ¨tres&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#coder-une-fonction-avec-nimporte-quel-nombre-de-parametres"&gt;Coder une fonction avec n'importe quel nombre de paramÃ¨tres&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#utilisation-dacross"&gt;Utilisation d'across&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-pick-et"&gt;Utilisation de pick et ...&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cet article, on s'intÃ©resse aux maniÃ¨res de coder des fonctions en utilisant la syntaxe du &lt;code&gt;tidyverse&lt;/code&gt;. AprÃ¨s avoir rappelÃ© quelques principes de l'Ã©valuation non standard dans le tidyverse, on prÃ©sente concrÃ¨tement les maniÃ¨res de faire rÃ©fÃ©rence aux paramÃ¨tres de notre fonction, qu'ils soient renseignÃ©s sous forme de symboles ou de chaÃ®nes de caractÃ¨res. On termine avec des astuces pour coder des fonctions plus flexibles, notamment sans avoir Ã  fixer le nombre de paramÃ¨tres en amont.&lt;/p&gt;
&lt;h1 id="le-tidyverse-et-levaluation-non-standard"&gt;Le tidyverse et l'Ã©valuation non standard&lt;/h1&gt;
&lt;p&gt;La syntaxe du &lt;code&gt;tidyverse&lt;/code&gt; s'appuie sur des fonctions aux noms explicites et une grande facilitÃ© d'utilisation. Le principe est de rendre le code le plus lisible possible. Tout cela permet de coder de maniÃ¨re intuitive et peu verbeuse. Mais lorsqu'il s'agit de coder ses propres fonctions, les choses se compliquent. Prenons par exemple la fonction suivante, qui permet de donner le nombre d'observations d'un dataframe dont une valeur numÃ©rique est infÃ©rieure Ã  un certain seuil :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;## Attachement du package : &amp;#39;dplyr&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;## Les objets suivants sont masquÃ©s depuis &amp;#39;package:stats&amp;#39;:&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;##     filter, lag&lt;/span&gt;
&lt;span class="c1"&gt;## Les objets suivants sont masquÃ©s depuis &amp;#39;package:base&amp;#39;:&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;##     intersect, setdiff, setequal, union&lt;/span&gt;

&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;L'appel de cette fonction pour obtenir le nombre de voitures avec &lt;code&gt;mpg &amp;lt;= 20&lt;/code&gt; donne l'erreur suivante:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## Error in `filter()`:&lt;/span&gt;
&lt;span class="c1"&gt;## â„¹ In argument: `x1 &amp;lt;= seuil`.&lt;/span&gt;
&lt;span class="c1"&gt;## Caused by error:&lt;/span&gt;
&lt;span class="c1"&gt;## ! objet &amp;#39;mpg&amp;#39; introuvable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Cette erreur est la consÃ©quence d'une propriÃ©tÃ© importante du &lt;code&gt;tidyverse&lt;/code&gt; : le &lt;strong&gt;data masking&lt;/strong&gt;. C'est ce qui fait que les verbes de dplyr Ã©valuent l'appel d'une fonction Ã  un objet au sein du dataframe auquel elle s'applique. Ainsi, on fait appel Ã  des fonctions avec la syntaxe fonction(&lt;code&gt;data&lt;/code&gt;, &lt;code&gt;var1&lt;/code&gt;, &lt;code&gt;var2&lt;/code&gt;, &lt;code&gt;var3&lt;/code&gt;) et non fonction(&lt;code&gt;data$var1&lt;/code&gt;, &lt;code&gt;data$var2&lt;/code&gt;, &lt;code&gt;data$var3&lt;/code&gt;). CouplÃ© Ã  l'utilisation du &lt;em&gt;pipe&lt;/em&gt; (que ce soit le &lt;code&gt;%&amp;gt;%&lt;/code&gt; de &lt;code&gt;magritr&lt;/code&gt; ou le rÃ©cent &lt;code&gt;|&amp;gt;&lt;/code&gt; de R auquel nous commenÃ§ons Ã  nous convertir), cette fonctionnalitÃ© permet d'obtenir un code bien plus aisÃ© et agrÃ©able Ã  Ã©crire et Ã  lire. Ainsi, dans &lt;code&gt;dplyr&lt;/code&gt;, on considÃ¨re un peu &lt;strong&gt;le dataframe comme un environnement&lt;/strong&gt; et les colonnes de ce dataframe comme des Ã©lÃ©ments de cet environnement. &lt;/p&gt;
&lt;p&gt;Seulement voilÃ , cette Ã©valuation n'est pas non-standard pour rien : ici lors de l'appel de &lt;code&gt;my_filter&lt;/code&gt; l'objet &lt;code&gt;mpg&lt;/code&gt; est cherchÃ© dans l'environnement et il n'est pas trouvÃ©. Et pour cause : il n'existe pas, contrairement Ã  &lt;code&gt;mtcars$mpg&lt;/code&gt;. &lt;/p&gt;
&lt;h1 id="faire-reference-aux-parametres-de-ma-fonction"&gt;Faire rÃ©fÃ©rence aux paramÃ¨tres de ma fonction&lt;/h1&gt;
&lt;p&gt;Comment donc coder comme un dÃ©veloppeur de Posit et profiter de cette syntaxe avantageuse? Si les choses ne sont pas aussi simples et intuitives qu'avec base R, elles se sont rÃ©cemment simplifiÃ©es et ne devraient pas vous poser trop de problÃ¨mes.  &lt;/p&gt;
&lt;h2 id="parametres-renseignes-en-symboles"&gt;ParamÃ¨tres renseignÃ©s en symboles&lt;/h2&gt;
&lt;p&gt;Si les paramÃ¨tres sont renseignÃ©s "en dur", ou en symboles, comme c'est le cas dans les verbes de &lt;code&gt;dplyr&lt;/code&gt;, on privilÃ©giera l'Ã©criture &lt;code&gt;{{ var }}&lt;/code&gt;. Elle s'est rÃ©cemment substituÃ©e Ã  l'ancienne option, plus Ã©nigmatique, de &lt;code&gt;!!enquo(var)&lt;/code&gt;. &lt;br&gt;
Testons cela sur notre petite fonction :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Merveilleux! Mais si, pour une raison ou pour une autre, vous souhaiteriez que l'utilisateur de votre fonction entre le paramÃ¨tre sous forme de chaÃ®ne de caractÃ¨re?&lt;/p&gt;
&lt;h2 id="parametres-renseignes-en-chaines-de-caracteres"&gt;ParamÃ¨tres renseignÃ©s en chaÃ®nes de caractÃ¨res&lt;/h2&gt;
&lt;p&gt;Dans ce cas, on revient Ã  une notation classique de base R : &lt;code&gt;df[["var"]]&lt;/code&gt;. Sauf que, dans un contexte d'expressions chaÃ®nÃ©es, on va utiliser la notation bien utile &lt;code&gt;.data[["var"]]&lt;/code&gt; qui fait rÃ©fÃ©rence au dataframe de la chaÃ®ne d'expression &lt;strong&gt;dans son Ã©tat au moment de l'appel&lt;/strong&gt;. En effet, si je voulais faire rÃ©fÃ©rence au dataframe par son nom je pourrais me retrouver dans cette situation :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;transmute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;carb_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;carb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## Error in `transmute()`:&lt;/span&gt;
&lt;span class="c1"&gt;## â„¹ In argument: `carb_2 = mtcars[[&amp;quot;carb&amp;quot;]]^2`.&lt;/span&gt;
&lt;span class="c1"&gt;## Caused by error:&lt;/span&gt;
&lt;span class="c1"&gt;## ! `carb_2` must be size 18 or 1, not 32.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Les tailles des vecteurs ne correspondent pas! En effet, le filtre appliquÃ© n'est pas pris en compte au moment de l'appel Ã  la variable &lt;code&gt;carb&lt;/code&gt;. La notation &lt;code&gt;.data&lt;/code&gt; rÃ©soud bien ce souci :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;transmute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;carb_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.data&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;carb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##                   carb_2&lt;/span&gt;
&lt;span class="c1"&gt;## Hornet Sportabout      4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Pour en revenir Ã  notre fonction, il est donc trÃ¨s aisÃ© avec cette notation de dÃ©finir le paramÃ¨tre en chaÃ®ne de caractÃ¨res :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.data&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Mais si vous prÃ©fÃ©rez l'ancienne notation, pour les paramÃ¨tres renseignÃ©s en chaÃ®nes de caractÃ¨res c'est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!!&lt;/span&gt;&lt;span class="nf"&gt;sym&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="nommer-des-variables-en-fonction-des-parametres"&gt;Nommer des variables en fonction des paramÃ¨tres&lt;/h2&gt;
&lt;p&gt;Imaginons maintenant que nous voulions crÃ©er une indicatrice en fonction du seuil d'une variable numÃ©rique, et que nous aimerions nommer cette indicatrice en fonction de la variable numÃ©rique qu'elle dÃ©crit :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans cette version ma nouvelle variable va s'appeler &lt;code&gt;x1_indic&lt;/code&gt;, et non prendre le nom de la variable numÃ©rique de &lt;code&gt;x1&lt;/code&gt;. Et lÃ  encore c'est la double accolade qui va nous permettre de rÃ©soudre ce problÃ¨me, mais pas seulement. Pour cela, on fait &lt;strong&gt;rÃ©fÃ©rence au nom du paramÃ¨tre au sein d'une double accolade&lt;/strong&gt;. De plus, le nom de la variable ainsi crÃ©Ã©e est donnÃ© entre guillemets. On peut Ã©galement ajouter d'autres caractÃ¨res. Enfin, &lt;strong&gt;le signe &lt;code&gt;=&lt;/code&gt; doit Ãªtre remplacÃ© par &lt;code&gt;:=&lt;/code&gt;&lt;/strong&gt;. Cela donne :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ x1 }}_indic&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On vÃ©rifie avec &lt;code&gt;mpg&lt;/code&gt; que la variable &lt;code&gt;mpg_indic&lt;/code&gt; est bien crÃ©Ã© :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;my_indic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg_indic&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##   mpg_indic  n&lt;/span&gt;
&lt;span class="c1"&gt;## 1         0 14&lt;/span&gt;
&lt;span class="c1"&gt;## 2         1 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="coder-une-fonction-avec-nimporte-quel-nombre-de-parametres"&gt;Coder une fonction avec n'importe quel nombre de paramÃ¨tres&lt;/h1&gt;
&lt;p&gt;Essayons maintenant d'aller un peu plus loin! On explore dans cette partie &lt;strong&gt;des maniÃ¨res plus flexibles de coder nos fonctions&lt;/strong&gt;, sans fixer Ã  l'avance le nombre de paramÃ¨tres.  &lt;/p&gt;
&lt;h2 id="utilisation-dacross"&gt;Utilisation d'&lt;code&gt;across&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;La solution la plus directe pour permettre Ã  l'utilisateur de votre fonction de dÃ©finir le nombre de paramÃ¨tres qu'il souhaite est en gÃ©nÃ©ral d'utiliser la puissance d'&lt;code&gt;across()&lt;/code&gt;. On parle de maniÃ¨re dÃ©taillÃ©e de ce verbe dans &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;cet article de notre blog&lt;/a&gt;. Vous pouvez Ã©galement explorer toutes ses possibilitÃ©s dans &lt;a href="https://www.icem7.fr/r/across-plus-puissant-flexible-quil-ny-parait/"&gt;cet article du blog d'Icem7&lt;/a&gt;. &lt;br&gt;
Dans le cas d'une fonction, c'est aussi la syntaxe &lt;code&gt;{{ var }}&lt;/code&gt; qui nous permettra de l'utiliser. Imaginez par exemple que vous souhaitiez crÃ©er une fonction permettant des statistiques sur un certain nombre de variables dÃ©finies par l'utilisateur. Une telle fonction s'Ã©crirait ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut ensuite appeler la fonction en dÃ©finissant &lt;strong&gt;le paramÃ¨tre &lt;code&gt;vars_mean&lt;/code&gt; comme un vecteur de symboles&lt;/strong&gt;, ou comme un seul symbole dans le cas oÃ¹ on ne voudrait la moyenne que d'une variable :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##       disp&lt;/span&gt;
&lt;span class="c1"&gt;## 1 230.7219&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qsec&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si nous souhaitons que l'utilisateur entre un vecteur de chaÃ®nes de caractÃ¨res, cela fonctionne aussi car &lt;strong&gt;across utilise la tidyselection&lt;/strong&gt; qui tolÃ¨re les appels aux vecteurs de chaÃ®nes de caractÃ¨res. Il faut juste l'encapsuler dans une fonction appropriÃ©e, ici &lt;code&gt;all_of()&lt;/code&gt; pour sÃ©lectionner tous les Ã©lÃ©ments du vecteur :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;all_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Notez qu'avec &lt;code&gt;any_of()&lt;/code&gt;, on autorise l'utilisateur Ã  entre &lt;strong&gt;des noms de colonnes n'existant pas dans le dataframe&lt;/strong&gt;. Ils sont alors juste Ã©cartÃ©s de la sÃ©lection, sans que cela gÃ©nÃ¨re des erreurs :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;any_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var3&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal.Length&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal.Width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Enfin, on peut utiliser l'argument &lt;code&gt;.names&lt;/code&gt; de la fonction &lt;code&gt;across&lt;/code&gt; pour permettre un &lt;strong&gt;renommage des variables au souhait de l'utilisateur&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;prefixe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;all_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{prefixe}_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##   mean_mpg mean_disp mean_qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062  230.7219  17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans cette version, l'utilisateur peut &lt;strong&gt;paramÃ©trer le prÃ©fixe qu'il souhaite&lt;/strong&gt;, grÃ¢ce Ã  l'utilisation de la syntaxe propre au &lt;a href="https://glue.tidyverse.org/"&gt;package &lt;code&gt;glue&lt;/code&gt;&lt;/a&gt;. Notez l'utilisation de &lt;code&gt;.col&lt;/code&gt;, interne Ã  &lt;code&gt;across()&lt;/code&gt;, pour faire rÃ©fÃ©rence au nom de la variable.   &lt;/p&gt;
&lt;h2 id="utilisation-de-pick-et"&gt;Utilisation de &lt;code&gt;pick&lt;/code&gt; et &lt;code&gt;...&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;pick()&lt;/code&gt; (Ã  partir de dplyr &amp;gt;= 1.1.4) permet de sÃ©lectionner un nombre indÃ©terminÃ© de paramÃ¨tres dans les fonctions du type &lt;code&gt;group_by()&lt;/code&gt;, &lt;code&gt;select()&lt;/code&gt;...c'est-Ã -dire les fonctions permettant de sÃ©lectionner un sous-ensemble de la base. C'est l'Ã©quivalent de &lt;code&gt;across()&lt;/code&gt; pour les fonctions portant sur toute la base et non sur chacune des colonnes. Par exemple, la fonction suivante permet de grouper par des variables du choix de l'utilisateur et de sortir les moyennes de toutes les variables numÃ©riques :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_group_by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;pick&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cyl&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## `summarise()` has grouped output by &amp;#39;am&amp;#39;. You can override using the `.groups`&lt;/span&gt;
&lt;span class="c1"&gt;## argument.&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 6 Ã— 11&lt;/span&gt;
&lt;span class="c1"&gt;## # Groups:   am [2]&lt;/span&gt;
&lt;span class="c1"&gt;##      am   cyl mean_mpg mean_disp mean_hp mean_drat mean_wt mean_qsec mean_vs&lt;/span&gt;
&lt;span class="c1"&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1     0     4     22.9     136.     84.7      3.77    2.94      21.0   1    &lt;/span&gt;
&lt;span class="c1"&gt;## 2     0     6     19.1     205.    115.       3.42    3.39      19.2   1    &lt;/span&gt;
&lt;span class="c1"&gt;## 3     0     8     15.0     358.    194.       3.12    4.10      17.1   0    &lt;/span&gt;
&lt;span class="c1"&gt;## 4     1     4     28.1      93.6    81.9      4.18    2.04      18.4   0.875&lt;/span&gt;
&lt;span class="c1"&gt;## 5     1     6     20.6     155     132.       3.81    2.76      16.3   0    &lt;/span&gt;
&lt;span class="c1"&gt;## 6     1     8     15.4     326     300.       3.88    3.37      14.6   0    &lt;/span&gt;
&lt;span class="c1"&gt;## # â„¹ 2 more variables: mean_gear &amp;lt;dbl&amp;gt;, mean_carb &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour &lt;code&gt;across&lt;/code&gt;, vous pouvez aussi utiliser les verbes de la tidyselection : &lt;code&gt;all_of&lt;/code&gt;, &lt;code&gt;any_of&lt;/code&gt;, &lt;code&gt;starts_with&lt;/code&gt;, etc...  &lt;/p&gt;
&lt;p&gt;Enfin, il est possible d'utiliser la syntaxe &lt;code&gt;...&lt;/code&gt;, de la maniÃ¨re suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_group_by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cyl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## `summarise()` has grouped output by &amp;#39;am&amp;#39;. You can override using the `.groups`&lt;/span&gt;
&lt;span class="c1"&gt;## argument.&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 3 Ã— 11&lt;/span&gt;
&lt;span class="c1"&gt;## # Groups:   am [1]&lt;/span&gt;
&lt;span class="c1"&gt;##      am   cyl mean_mpg mean_disp mean_hp mean_drat mean_wt mean_qsec mean_vs&lt;/span&gt;
&lt;span class="c1"&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1     0     4     22.9      136.    84.7      3.77    2.94      21.0       1&lt;/span&gt;
&lt;span class="c1"&gt;## 2     0     6     19.1      205.   115.       3.42    3.39      19.2       1&lt;/span&gt;
&lt;span class="c1"&gt;## 3     0     8     15.0      358.   194.       3.12    4.10      17.1       0&lt;/span&gt;
&lt;span class="c1"&gt;## # â„¹ 2 more variables: mean_gear &amp;lt;dbl&amp;gt;, mean_carb &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Cette notation a l'avantage d'Ãªtre trÃ¨s simple et flexible : on peut dÃ©finir Ã  la place des &lt;code&gt;...&lt;/code&gt; autant de paramÃ¨tres diffÃ©rents que l'on veut. Mais elle ne permet pas de diffÃ©rencier deux groupes de paramÃ¨tres diffÃ©rents, si l'on veut par exemple dÃ©finir d'une part des variables sur lesquels grouper, et d'autre des variables sur lesquels sÃ©lectionner.       &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Le &lt;code&gt;tidyverse&lt;/code&gt;, c'est donc plein d'astuces pour rendre le code trÃ¨s facile Ã  Ã©crire et Ã  lire, mais cela implique quelques Ã©tapes supplÃ©mentaires quand on veut coder ses propres fonctions. On espÃ¨re que cet article vous aura aidÃ©s Ã  y voir plus clair. Pour creuser le sujet, vous pouvez vous rÃ©fÃ©rer Ã  la page &lt;a href="https://dplyr.tidyverse.org/articles/programming.html#user-supplied-data"&gt;Programming with dplyr&lt;/a&gt; sur la documentation officielle de &lt;code&gt;dplyr&lt;/code&gt;. Vous pouvez Ã©galement consulter, sur le site de &lt;code&gt;rlang&lt;/code&gt;, les pages &lt;a href="https://rlang.r-lib.org/reference/glue-operators.html"&gt;Name injection&lt;/a&gt; et &lt;a href="https://rlang.r-lib.org/reference/topic-data-mask-programming.html"&gt;Data mask programming patterns&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.   &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="tidyverse"></category><category term="dplyr"></category><category term="across"></category></entry><entry><title>Taux standardisÃ©s : calcul et interprÃ©tation avec R</title><link href="https://blog.statoscop.fr/taux-standardises-calcul-et-interpretation-avec-r.html" rel="alternate"></link><published>2023-05-17T00:00:00+02:00</published><updated>2023-05-17T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2023-05-17:/taux-standardises-calcul-et-interpretation-avec-r.html</id><summary type="html">&lt;p&gt;PrÃ©sentation de la mÃ©thode de standardisation directe sur les taux de survie des passagers du Titanic.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donnÃ©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-Ã -pas des taux standardisÃ©s de survie au naufrage du Titanic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pour-conclure"&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cette note nous prÃ©sentons la mÃ©thode de standardisation directe des taux, qui permet de comparer des frÃ©quences d'Ã©vÃ¨nement entre diffÃ©rentes sous-populations en contrÃ´lant par une ou plusieurs autres variables. AprÃ¨s avoir dÃ©fini le principe gÃ©nÃ©ral de standardisation directe, on prÃ©sente une mise en oeuvre pas-Ã -pas de la mÃ©thode sur une Ã©tude de cas Ã  partir des donnÃ©es des passagers du Titanic.  &lt;/p&gt;
&lt;h1 id="principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/h1&gt;
&lt;p&gt;Les mÃ©thodes de standardisation des taux sont principalement Ã©tudiÃ©es en Ã©pidÃ©miologie. Elles permettent en effet de rÃ©pondre au problÃ¨me suivant : comment &lt;strong&gt;comparer des indicateurs Ã©pidÃ©miologiques&lt;/strong&gt; entre diffÃ©rents pays ayant leurs spÃ©cificitÃ©s dÃ©mographiques? &lt;br&gt;
On peut lire par exemple sur le site des &lt;a href="https://donnees.banquemondiale.org"&gt;donnÃ©es de la banque mondiale&lt;/a&gt; que le taux de mortalitÃ© en 2020 en Australie est de 6 pour 1000 habitants, contre 12 pour 1000 habitants en Allemagne. Or, cet indicateur est bien sÃ»r fortement influencÃ© par la structure d'Ã¢ge de la population concernÃ©e. Pour correctement comparer cet indicateur entre l'Australie et l'Allemagne et Ã©ventuellement en tirer des conclusions sur des diffÃ©rences de qualitÃ© de vie entre les deux pays, il faudrait &lt;strong&gt;comparer ces taux Ã  structure d'Ã¢ge constante&lt;/strong&gt;. &lt;br&gt;
C'est prÃ©cisÃ©ment ce que permet de faire la standardisation directe. Il est nÃ©cessaire pour cela de disposer du dÃ©tail de l'indicateur par tranche d'Ã¢ge dans chacun des pays. Dans notre exemple, une fois qu'on dispose des taux de mortalitÃ© par tranche d'Ã¢ge en Australie et en Allemagne, on les  applique Ã  &lt;strong&gt;une structure d'Ã¢ge de rÃ©fÃ©rence&lt;/strong&gt;, qui peut Ãªtre soit celle d'un des deux pays, soit celle du monde entier si on dispose de l'information. On peut alors obtenir un nouveau taux de mortalitÃ© global &lt;strong&gt;corrigÃ© de l'effet liÃ© Ã  l'Ã¢ge&lt;/strong&gt; et permettant une comparaison plus pertinente entre les pays. Voyons concrÃ¨tement comment on peut mettre en oeuvre cette mÃ©thode sur une Ã©tude de cas en R.  &lt;/p&gt;
&lt;h1 id="analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donnÃ©es&lt;/h1&gt;
&lt;p&gt;Pour notre petit exemple, on s'appuie sur un dataset trÃ¨s connu : les &lt;a href="https://www.kaggle.com/c/titanic"&gt;donnÃ©es des passagers du Titanic&lt;/a&gt;. Les informations qui nous intÃ©ressent ici sont la classe Ã©conomique, l'Ã¢ge et le fait d'avoir survÃ©cu ou non au naufrage. On ne garde que les observations ayant des valeurs renseignÃ©es pour ces 3 variables. On veut rÃ©pondre Ã  la question suivante : &lt;strong&gt;le fait d'Ãªtre dans une classe Ã©conomique aisÃ©e augmente-t-elle les chances de survie au nauffrage?&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;La premiÃ¨re approche de cette question est bien sÃ»r de calculer les taux de survie par classe Ã©conomique. le rÃ©sultat est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="right"&gt;pclass&lt;/th&gt;
&lt;th align="right"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="right"&gt;0.6373239&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="right"&gt;0.4406130&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="right"&gt;0.2614770&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet une forte disparitÃ© des taux de survie en fonction de la classe Ã©conomique, puisque les passagers de 1ere classe sont 63,7% Ã  survivre, contre 44,1% des passagers de seconde classe et 26,1% des passagers de 3e classe.&lt;br&gt;
Est-on bien sÃ»r cependant que l'on observe &lt;strong&gt;l'effet de la classe Ã©conomique et pas d'un autre facteur de confusion&lt;/strong&gt;? On peut par exemple imaginer que l'Ã¢ge a un effet important sur la chance de survie, et qu'il est Ã©galement liÃ© Ã  la classe Ã©conomique choisie pour le voyage. VÃ©rifions ces hypothÃ¨ses en croisant la rÃ©partition en tranches d'Ã¢ge dans chaque classe :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Ã€ ce stade le df n&amp;#39;est plus groupÃ© que par pclass&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Proportion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="right"&gt;pclass&lt;/th&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;Proportion&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.0528169&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.3239437&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.3697183&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.2535211&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.1264368&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.5823755&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.1954023&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.0957854&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.2115768&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.6047904&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.1576846&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.0259481&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet que la classe 3 comporte bien plus de mineurs et bien moins de passagers de plus de cinquante ans que la premiÃ¨re classe. Comme on s'y attendait, &lt;strong&gt;plus la classe Ã©conomique est aisÃ©e, plus les passagers ont un Ã¢ge Ã©levÃ©&lt;/strong&gt;. Voyons maintenant si les taux de survie varient en fonction de l'Ã¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.5259740&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.3765996&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.4085106&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.4000000&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Les taux de survie ne semblent pas beaucoup varier en fonction de l'Ã¢ge, Ã  part pour les mineurs qui ont un taux de survie bien supÃ©rieur aux autres. Croisons maintenant les taux de survie en fonction de la classe Ã©conomique &lt;strong&gt;et&lt;/strong&gt; de la tranche d'Ã¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="right"&gt;pclass&lt;/th&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.8666667&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.7065217&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.6285714&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;1&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.5138889&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.8787879&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.4144737&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.3333333&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;2&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.2400000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="right"&gt;3&lt;/td&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate lÃ  plusieurs choses :&lt;br&gt;
- Au sein de chaque classe Ã©conomique il y a un lien trÃ¨s clair entre l'Ã¢ge et le taux de survie : plus on vieillit plus celui-ci baisse.&lt;br&gt;
- Au sein de chaque tranche d'Ã¢ge, plus la classe Ã©conomique est Ã©levÃ©e plus la chance de survie augmente. La seule exception est la tranche d'Ã¢ge 0 - 17 ans de la seconde classe qui a un taux de survie lÃ©gÃ¨rement supÃ©rieur Ã  la population du mÃªme Ã¢ge de la 1ere classe (87,9% contre 86,7%).  &lt;/p&gt;
&lt;p&gt;Au vu de ces Ã©lÃ©ments il apparaÃ®t lÃ©gitime de calculer des taux standardisÃ©s pour comparer des frÃ©quences de survie au sein de chaque classe corrigÃ©es de l'effet de l'Ã¢ge.  &lt;/p&gt;
&lt;h1 id="calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-Ã -pas des taux standardisÃ©s de survie au naufrage du Titanic&lt;/h1&gt;
&lt;p&gt;Au vu des rÃ©sultats des taux de survie croisÃ©s par classe et Ã¢ge, on sait dÃ©jÃ  que la classe Ã©conomique et l'Ã¢ge jouent sur la chance de survie. Le calcul des taux standardisÃ©s de survie va permettre de quantifier &lt;strong&gt;l'effet de la classe Ã©conomique isolÃ© de l'effet Ã¢ge&lt;/strong&gt;. Le principe est le suivant : on calcule le taux de survie que l'on observerait dans chaque classe Ã©conomique &lt;strong&gt;si la rÃ©partition des passagers en classe d'Ã¢ge Ã©tait la mÃªme que celle de la population de rÃ©fÃ©rence&lt;/strong&gt;. Dans notre exemple, la population de rÃ©fÃ©rence est l'ensemble des passagers.&lt;/p&gt;
&lt;p&gt;La premiÃ¨re Ã©tape est de rÃ©cupÃ©rer les effectifs de classe d'Ã¢ge de la population de rÃ©fÃ©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;eff&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;154&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;547&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;235&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On calcule ensuite comme prÃ©cÃ©demment les taux de survie par tranche d'Ã¢ge de chaque classe Ã©conomique et on transforme la table pour avoir une colonne par classe Ã©conomique.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# taux de survie par classe et tranche d&amp;#39;Ã¢ge&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on transforme la table en largeur pour avoir trois colonnes&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# donnant le taux de survie&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;tidyr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;pivot_wider&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;names_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="c1"&gt;# option names_glue pour spÃ©cifier le nom des variables crÃ©Ã©es&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;names_glue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{.value}_{pclass}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;survie_1&lt;/th&gt;
&lt;th align="right"&gt;survie_2&lt;/th&gt;
&lt;th align="right"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;0.8666667&lt;/td&gt;
&lt;td align="right"&gt;0.8787879&lt;/td&gt;
&lt;td align="right"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;0.7065217&lt;/td&gt;
&lt;td align="right"&gt;0.4144737&lt;/td&gt;
&lt;td align="right"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;0.6285714&lt;/td&gt;
&lt;td align="right"&gt;0.3333333&lt;/td&gt;
&lt;td align="right"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;0.5138889&lt;/td&gt;
&lt;td align="right"&gt;0.2400000&lt;/td&gt;
&lt;td align="right"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il ne reste plus qu'Ã  fusionner les deux tables ainsi crÃ©Ã©es et Ã  appliquer chacun des taux de survie aux effectifs par tranche d'Ã¢ge de la population de rÃ©fÃ©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;inner_join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;tr_age&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;
&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;tr_age&lt;/th&gt;
&lt;th align="right"&gt;eff&lt;/th&gt;
&lt;th align="right"&gt;survie_1&lt;/th&gt;
&lt;th align="right"&gt;survie_2&lt;/th&gt;
&lt;th align="right"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;0 - 17 ans&lt;/td&gt;
&lt;td align="right"&gt;154&lt;/td&gt;
&lt;td align="right"&gt;133.46667&lt;/td&gt;
&lt;td align="right"&gt;135.33333&lt;/td&gt;
&lt;td align="right"&gt;56.660377&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;18 - 34 ans&lt;/td&gt;
&lt;td align="right"&gt;547&lt;/td&gt;
&lt;td align="right"&gt;386.46739&lt;/td&gt;
&lt;td align="right"&gt;226.71711&lt;/td&gt;
&lt;td align="right"&gt;140.811881&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;35 - 49 ans&lt;/td&gt;
&lt;td align="right"&gt;235&lt;/td&gt;
&lt;td align="right"&gt;147.71429&lt;/td&gt;
&lt;td align="right"&gt;78.33333&lt;/td&gt;
&lt;td align="right"&gt;38.670886&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;50 ans ou +&lt;/td&gt;
&lt;td align="right"&gt;110&lt;/td&gt;
&lt;td align="right"&gt;56.52778&lt;/td&gt;
&lt;td align="right"&gt;26.40000&lt;/td&gt;
&lt;td align="right"&gt;8.461538&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;Si l'utilisation d'across ne vous semble pas claire, je ne saurais trop vous recommander &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;notre prÃ©cÃ©dent article de blog&lt;/a&gt; sur ce verbe bien pratique de dplyr.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On obtient finalement nos taux de survie standardisÃ©s en sommant les effectifs par tranche d'Ã¢ge et en divisant par l'effectif total :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="right"&gt;survie_1&lt;/th&gt;
&lt;th align="right"&gt;survie_2&lt;/th&gt;
&lt;th align="right"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="right"&gt;0.692329&lt;/td&gt;
&lt;td align="right"&gt;0.446256&lt;/td&gt;
&lt;td align="right"&gt;0.2338477&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Par rapport aux taux de survie bruts prÃ©sentÃ©s plus haut, on constate que &lt;strong&gt;les inÃ©galitÃ©s Ã©conomiques de survie s'aggravent aprÃ¨s avoir contrÃ´lÃ© par l'Ã¢ge&lt;/strong&gt;. Le taux de survie standardisÃ©s de la classe 1 et de la classe 3 sont en effet de 69,2% et 23,4 % contre 63,7% et 26,1% avant la correction. Cela correspond Ã  ce que l'on pouvait pressentir aprÃ¨s l'analyse exploratoire puisque les passagers de la classe 3 sont plus jeunes et que les jeunes ont une meilleure chance de survie au sein de chaque classe Ã©conomique.   &lt;/p&gt;
&lt;h1 id="pour-conclure"&gt;Pour conclure&lt;/h1&gt;
&lt;p&gt;J'espÃ¨re que cet exemple vous aura permis de mieux apprÃ©hender la question de la standardisation directe. Bien sÃ»r, la mÃ©thode utilisÃ©e ici comporte des limites, notamment l'utilisation de tranches d'Ã¢ge trÃ¨s larges qui pourraient fausser le rÃ©sultat. On peut par exemple penser que les enfants en bas Ã¢ge ont bÃ©nÃ©ficiÃ© d'une attention toute particuliÃ¨re, et ils se retrouvent ici dans la mÃªme tranche d'Ã¢ge que des adolescents. Mais nous sommes Ã©galement contraints par les effectifs qui nous empÃªchent de faire une analyse trop fine de ces subtilitÃ©s. Si ces questions vous intÃ©ressent, vous pouvez vous reporter Ã  notre article sur &lt;a href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html"&gt;le dilemme biais-variance&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Enfin, nous avons passÃ© sous silence une variable explicative trÃ¨s importante : le sexe des passagers. Les taux de survie sont en effet trÃ¨s diffÃ©rents pour les hommes et pour les femmes. Il est possible de reproduire cette analyse en prenant en compte cette variable, croisÃ©e Ã©galement avec l'Ã¢ge. Cependant, toujours en raison de trop faibles effectifs, il sera sans doute nÃ©cessaire d'agrÃ©ger encore plus les tranches d'Ã¢ge. Vous avez les cartes en main pour le faire, et mieux comprendre les fortunes diverses de Jack et Rose dans le cÃ©lÃ¨bre film de la tragÃ©die...  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Migration de SAS vers R</title><link href="https://blog.statoscop.fr/migration-de-sas-vers-r.html" rel="alternate"></link><published>2022-11-08T00:00:00+01:00</published><updated>2022-11-08T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2022-11-08:/migration-de-sas-vers-r.html</id><summary type="html">&lt;p&gt;Quelques conseils pour rÃ©ussir sa transition de SAS vers R&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#options-de-recodage-en-r"&gt;Options de recodage en R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#base-r"&gt;Base R&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tidyverse"&gt;Tidyverse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datatable"&gt;data.table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#notre-conseil"&gt;Notre conseil&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#organisation-du-travail-de-recodage-en-r"&gt;Organisation du travail de recodage en R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#les-projets-rstudio"&gt;Les projets RStudio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#renv-pour-gerer-les-packages"&gt;Renv pour gÃ©rer les packages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-ou-un-autre-logiciel-de-gestion-de-versions"&gt;Git ou un autre logiciel de gestion de versions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#accompagnement-de-la-migration-de-sas-vers-r"&gt;Accompagnement de la migration de SAS vers R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#en-interne"&gt;En interne&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#avec-un-prestataire"&gt;Avec un prestataire&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;L'utilisation du logiciel d'analyses statistiques SAS est encore assez ancrÃ©e dans certaines administrations publiques et grandes entreprises, malgrÃ© la concurrence de deux logiciels open-source offrant des performances souvent supÃ©rieures : R et Python. La &lt;strong&gt;migration vers un nouveau langage&lt;/strong&gt; prÃ©sente un certain nombre de difficultÃ©s, mais le jeu en vaut la chandelle! Nous proposons dans cet article quelques recommandations pour recoder ses scripts SAS en R et assurer une &lt;strong&gt;transition vers l'open-source&lt;/strong&gt; la plus simple possible.  &lt;/p&gt;
&lt;h1 id="options-de-recodage-en-r"&gt;Options de recodage en R&lt;/h1&gt;
&lt;p&gt;Une des difficultÃ©s de R est aussi une de ses forces : le grand nombre de possibilitÃ©s qui s'offrent Ã  vous pour coder. Le CRAN (pour &lt;em&gt;Comprehensive R Archive Network&lt;/em&gt;) comprend un nombre impressionnant de packages (+ de 18000!). Dans ces conditions, il est important de se mettre d'accord a minima sur l'orientation que vous souhaitez prendre, afin d'assurer une certaine homogÃ©nÃ©itÃ© entre les diffÃ©rents membres de vos Ã©quipes. Ces &lt;em&gt;rÃ¨gles&lt;/em&gt; peuvent bien sÃ»r varier d'une Ã©quipe Ã  l'autre, en fonction de ses besoins spÃ©cifiques. On prÃ©sente ici trois des options les plus couramment utilisÃ©es en statistiques : base R, le tidyverse et data.table. On ne rentre pas dans le dÃ©tail de la syntaxe de chacune de ces options mais vous pouvez approfondir cet aspect en lisant notre &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;article qui compare les performances de ces trois options&lt;/a&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous cherchez un prestataire pour vous accompagner dans votre migration vers R?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;   &lt;/p&gt;
&lt;h2 id="base-r"&gt;Base R&lt;/h2&gt;
&lt;p&gt;Base R dÃ©signe toutes les fonctions natives de R, qui sont chargÃ©es par dÃ©faut au lancement du logiciel. Pour l'analyse de donnÃ©es, on s'appuiera notamment sur le format &lt;code&gt;data.frame&lt;/code&gt;. L'utilisation exclusive de base R aurait l'avantage de ne pas faire dÃ©pendre votre code d'autres packages et donc de lui assurer une certaine stabilitÃ©. Cependant, pour l'analyse de donnÃ©es, la syntaxe sera vite verbeuse et peu lisible pour des non initiÃ©s. De plus, pour des traitements de donnÃ©es plus complexes, vous ne trouverez pas forcÃ©ment ce qu'il vous faut dans ce que propose base R. Enfin, cette option est souvent &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;bien moins performante&lt;/a&gt; en termes de vitesse d'exÃ©cution que les deux que nous vous prÃ©sentons ensuite.  &lt;/p&gt;
&lt;h2 id="tidyverse"&gt;Tidyverse&lt;/h2&gt;
&lt;p&gt;Le tidyverse est un &lt;a href="https://www.tidyverse.org/"&gt;ensemble de packages&lt;/a&gt; destinÃ©s au traitement de donnÃ©es, du nettoyage Ã  l'analyse et la datavisualisation. En particulier, le package &lt;code&gt;dplyr&lt;/code&gt; propose des fonctions de haut niveau couvrant la trÃ¨s grande majoritÃ© des besoins lors de la manipulation des donnÃ©es. Ces fonctions, chaÃ®nÃ©es avec l'opÃ©rateur &lt;em&gt;pipe&lt;/em&gt; (&lt;code&gt;%&amp;gt;%&lt;/code&gt; du package &lt;code&gt;magritr&lt;/code&gt; ou &lt;code&gt;|&amp;gt;&lt;/code&gt; de base R depuis la version 4.1.0), offrent un &lt;strong&gt;code trÃ¨s lisible et intuitif&lt;/strong&gt; Ã  Ã©crire. Enfin, elles sont optimisÃ©es et offrent de &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;bonnes performances&lt;/a&gt;. L'inconvÃ©nient du tidyverse est sans doute qu'il concerne beaucoup de packages qui ont chacun Ã©galement un certain nombre de dÃ©pendances Ã  d'autres packages. Cependant, le fait qu'il soit maintenu par les Ã©quipes de RStudio (la sociÃ©tÃ© s'appelle &lt;a href="https://posit.co/"&gt;Posit&lt;/a&gt; depuis peu) est de nature Ã  rassurer sur la stabilitÃ© de cette solution. En gÃ©nÃ©ral on ne recommande de toute faÃ§on pas de charger l'ensemble du tidyverse mais seulement les packages que vous utilisez.  &lt;/p&gt;
&lt;h2 id="datatable"&gt;data.table&lt;/h2&gt;
&lt;p&gt;Des trois options, &lt;code&gt;data.table&lt;/code&gt; est &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;la plus performante&lt;/a&gt;. Ce package utilise un format concurrent du &lt;code&gt;data.frame&lt;/code&gt; de base R, le &lt;code&gt;data.table&lt;/code&gt;, qui optimise la vitesse d'exÃ©cution des instructions. Ce package a aussi l'avantage de ne dÃ©pendre d'aucun autre package. En contrepartie, il offre une syntaxe sans doute moins lisible pour les non-initiÃ©s, en particulier pour des opÃ©rations plus complexes.  &lt;/p&gt;
&lt;h2 id="notre-conseil"&gt;Notre conseil&lt;/h2&gt;
&lt;p&gt;Dans la majoritÃ© des cas, le &lt;code&gt;tidyverse&lt;/code&gt; et en particulier &lt;strong&gt;&lt;code&gt;dplyr&lt;/code&gt; sera le choix le plus adaptÃ©&lt;/strong&gt;. Pour des utilisateurs de SAS, en particulier pour ceux connaissant un peu de SQL, les fonctions Ã  utiliser seront plus intuitives. Cette option bÃ©nÃ©ficie en outre d'une communautÃ© d'utilisateurs trÃ¨s importante permettant de trouver facilement des rÃ©ponses en ligne aux problÃ¨mes que vous pourrez rencontrer. De plus, la vitesse d'exÃ©cution sera souvent au moins aussi bonne que celle de SAS. Si l'activitÃ© concernÃ©e par le recodage a un gros enjeu de temps d'exÃ©cution et moins de lisibilitÃ© du code, c'est sans doute vers &lt;code&gt;data.table&lt;/code&gt; qu'il sera intÃ©ressant de se tourner. Il peut aussi Ãªtre possible de choisir le meilleur des deux mondes avec le package &lt;a href="https://dtplyr.tidyverse.org/"&gt;dtplyr&lt;/a&gt;, combinant la syntaxe de dplyr aux fonctions de data.table. Enfin, il va de soi qu'une certaine souplesse est de mise pour pouvoir utiliser les fonctions de base R quand elles n'ont pas d'Ã©quivalent dans l'Ã©cosystÃ¨me choisi, ainsi que d'autres packages pour des besoins spÃ©cifiques.  &lt;/p&gt;
&lt;h1 id="organisation-du-travail-de-recodage-en-r"&gt;Organisation du travail de recodage en R&lt;/h1&gt;
&lt;p&gt;Une fois que vous avez choisi comment vous souhaitez coder en R, vous pouvez spÃ©cifier vos recommandations dans un document &lt;strong&gt;listant les bonnes pratiques&lt;/strong&gt; de codage en R. Cela pourra servir Ã  encadrer et accompagner le travail des dÃ©veloppeurs R et uniformiser autant que possible les diffÃ©rentes maniÃ¨res de coder. En plus de cela, nous recommandons quelques outils simples Ã  adopter pour tirer le meilleur de l'Ã©co-systÃ¨me R.    &lt;/p&gt;
&lt;h2 id="les-projets-rstudio"&gt;Les projets RStudio&lt;/h2&gt;
&lt;p&gt;Les &lt;a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-RStudio-Projects"&gt;projets RStudio&lt;/a&gt; sont des fichiers associÃ©s Ã  un dossier de travail que vous aurez crÃ©Ã©s. Ils permettent de spÃ©cifier les chemins vers vos donnÃ©es ou vers le dossier des sorties que vous voulez crÃ©er de maniÃ¨re &lt;strong&gt;relative Ã  ce dossier parent&lt;/strong&gt;. Leur utilisation permet de bannir de vos scripts l'utilisation de chemins spÃ©cifiques Ã  votre machine. Ainsi, on remplacera avantageusement l'appel du chemin &lt;code&gt;C://Users/antoine/Documents/Mon_projet/data/ma_base.csv&lt;/code&gt; par &lt;code&gt;data/ma_base.csv&lt;/code&gt; dans les scripts.  C'est donc &lt;strong&gt;un premier pas&lt;/strong&gt; vers la crÃ©ation d'un dossier de travail contenant des scripts rÃ©utilisables en l'Ã©tat par vos collÃ¨gues, que ce soit ceux qui travaillent dans votre Ã©quipe ou ceux qui vous succÃ©deront.  &lt;/p&gt;
&lt;h2 id="renv-pour-gerer-les-packages"&gt;Renv pour gÃ©rer les packages&lt;/h2&gt;
&lt;p&gt;Renv est un gestionnaire de packages R, dont nous parlons dÃ©jÃ  dans &lt;a href="https://blog.statoscop.fr/gestion-des-packages-sur-r-avec-renv.html"&gt;cet article&lt;/a&gt;. Il vous permet de choisir un &lt;strong&gt;environnement stable de packages&lt;/strong&gt; sur un projet donnÃ©. En particulier, il vous assure Ã  un moment T que toute une Ã©quipe sur un mÃªme projet travaille bien avec les mÃªmes packages et les mÃªmes versions de ceux-ci. Il vous permet aussi de pouvoir refaire tourner un code avec le mÃªme systÃ¨me de packages qu'au moment oÃ¹ il a Ã©tÃ© crÃ©Ã©. C'est donc un autre Ã©lÃ©ment essentiel de la reproductibilitÃ© et de la stabilitÃ© de vos projets, en particulier si on l'utilise avec un logiciel de gestion de versions...  &lt;/p&gt;
&lt;h2 id="git-ou-un-autre-logiciel-de-gestion-de-versions"&gt;Git ou un autre logiciel de gestion de versions&lt;/h2&gt;
&lt;p&gt;MÃªme si Ã§a n'est pas spÃ©cifique Ã  R, il est important de profiter de cette migration pour adopter l'utilisation d'un logiciel de gestion de versions si cela n'est pas dÃ©jÃ  fait. &lt;a href="https://githowto.com/"&gt;Git&lt;/a&gt; est sans doute le plus utilisÃ© aujourd'hui. Il permet de tracer les modifications de votre code pas-Ã -pas, de revenir Ã  une version antÃ©rieure de votre projet sans difficultÃ©s, de partager en temps rÃ©el avec votre Ã©quipe les modifications du code, de gÃ©rer aussi simplement que possible des modifications simultanÃ©es sur un mÃªme projet, et bien d'autres choses encore... La prise en main de Git peut prendre un peu de temps car cela n'est pas forcÃ©ment intuitif pour qui n'est pas habituÃ© Ã  la gestion de versions mais c'est sans aucun doute absolument nÃ©cessaire pour assurer une bonne gestion de vos projets.    &lt;/p&gt;
&lt;h1 id="accompagnement-de-la-migration-de-sas-vers-r"&gt;Accompagnement de la migration de SAS vers R&lt;/h1&gt;
&lt;p&gt;Enfin, un aspect important de la migration vers un nouveau langage est la &lt;strong&gt;gestion de la transition&lt;/strong&gt; entre les deux. Que celle-ci soit prise en main en interne ou par un prestataire, il est indispensable de former les Ã©quipes en place et de libÃ©rer du temps de travail pour accompagner cette transition.  &lt;/p&gt;
&lt;h2 id="en-interne"&gt;En interne&lt;/h2&gt;
&lt;p&gt;L'avantage de gÃ©rer la migration vers R en interne est qu'elle associe forcÃ©ment Ã  ce processus les Ã©quipes en place. L'inconvÃ©nient Ã©vident est qu'il est alors indispensable de libÃ©rer beaucoup de temps du travail effectif Ã  consacrer Ã  cette tÃ¢che. Il est trÃ¨s important en amont de se mettre d'accord sur les points Ã©voquÃ©s plus haut afin d'Ã©tablir une sorte de &lt;em&gt;charte&lt;/em&gt; du code qui assurera un minimum de cohÃ©rence au sein des Ã©quipes. Enfin, il est Ã©videmment indispensable d'accompagner chacun des membres des Ã©quipes en fonction de leur familiaritÃ© avec le nouveau langage. L'idÃ©al est de proposer des &lt;strong&gt;formations sur mesure&lt;/strong&gt; correspondant aux problÃ©matiques mÃ©tier de chacun.  &lt;/p&gt;
&lt;h2 id="avec-un-prestataire"&gt;Avec un prestataire&lt;/h2&gt;
&lt;p&gt;Si vous faites appel Ã  un prestataire, cela ne signifie pas pour autant que vous ne devrez pas libÃ©rer du temps de vos Ã©quipes pour la migration. On recommande en effet des Ã©changes Ã©troits et rÃ©guliers avec le prestataire, et plusieurs livraisons Ã  intervalles rÃ©guliers plutÃ´t qu'une seule Ã  la fin du travail. Ceci doit permettre de s'assurer d'une part que le prestataire ne va pas dans une mauvaise direction et d'autre part que le code apparaÃ®t lisible et comprÃ©hensible pour les chargÃ©s d'Ã©tude. C'est aussi l'occasion pour ces derniers de se former et d'Ã©changer avec le prestataire sur ces choix lors du recodage. Il est aussi possible de faire appel Ã  un prestataire simplement pour encadrer votre Ã©quipe dans le travail de recodage, optimiser le code Ã  certains points bloquants, faire un audit du travail rÃ©alisÃ©...&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Quitter SAS et aller vers R, ou un autre logiciel, c'est donc du travail et cela nÃ©cessite d'investir du temps et des moyens. Mais c'est aussi se libÃ©rer d'une &lt;strong&gt;licence beaucoup trop chÃ¨re&lt;/strong&gt;, et s'ouvrir les portes de nouvelles possibilitÃ©s. Pourquoi ne pas en profiter pour &lt;strong&gt;automatiser vos rapports&lt;/strong&gt; et vos publications avec &lt;a href="https://rmarkdown.rstudio.com/"&gt;R Markdown&lt;/a&gt;? Et si vous vous lanciez dans le dÃ©veloppement d'une petite &lt;a href="https://shiny.rstudio.com/gallery/"&gt;application interactive R Shiny&lt;/a&gt; pour mettre en valeur vos rÃ©sultats les plus marquants? &lt;br&gt;
Quoiqu'il en soit, si cet article vous a donnÃ© envie d'aller plus loin, vous pouvez &lt;a href="https://www.statoscop.fr/contact"&gt;nous contacter sur le site de Statoscop&lt;/a&gt; pour discuter des prochaines Ã©tapes!   &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;   &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="SAS"></category><category term="recodage"></category><category term="migration"></category><category term="codes"></category><category term="scripts"></category></entry><entry><title>Ggplot2 : mise en forme d'un barplot</title><link href="https://blog.statoscop.fr/ggplot2-mise-en-forme-dun-barplot.html" rel="alternate"></link><published>2022-08-22T00:00:00+02:00</published><updated>2022-08-22T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2022-08-22:/ggplot2-mise-en-forme-dun-barplot.html</id><summary type="html">&lt;p&gt;RÃ©alisation et mise en forme d'un graphique en colonnes avec ggplot2.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#creer-notre-premier-graphique-avec-geom_col"&gt;CrÃ©er notre premier graphique avec geom_col&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mettre-en-forme-le-graphique"&gt;Mettre en forme le graphique&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#ordonner-laffichage-en-fonction-de-la-valeur-de-la-variable-dinteret"&gt;Ordonner l'affichage en fonction de la valeur de la variable d'intÃ©rÃªt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-forme-des-axes"&gt;Mise en forme des axes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-dun-theme"&gt;Utilisation d'un thÃ¨me&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cette note nous proposons un petit cas pratique pour illustrer la mise en forme d'un graphique en colonnes, ou barplot, avec le package R &lt;code&gt;ggplot2&lt;/code&gt;. On s'appuie pour cela sur les donnÃ©es de la &lt;a href="https://www.gapminder.org/"&gt;fondation Gapminder&lt;/a&gt; en s'intÃ©ressant Ã  la part des dÃ©penses de santÃ© financÃ©es par l'Etat dans les 30 pays les plus peuplÃ©s au monde.  &lt;/p&gt;
&lt;h1 id="creer-notre-premier-graphique-avec-geom_col"&gt;CrÃ©er notre premier graphique avec geom_col&lt;/h1&gt;
&lt;p&gt;Notre objectif dans cet exemple est d'afficher le taux de dÃ©penses de santÃ© financÃ©es par l'Ã‰tat pour chaque pays prÃ©sent dans la base. Ce barplot se rÃ©alise avec &lt;code&gt;ggplot2&lt;/code&gt; Ã  l'aide de &lt;code&gt;geom_col&lt;/code&gt;. En effet, nous voulons reprÃ©senter la valeur d'une variable (ce taux de dÃ©penses) pour chaque modalitÃ© donnÃ©e d'une variable catÃ©gorielle (le pays). Si nous avions voulu reprÃ©senter le nombre de fois oÃ¹ une variable catÃ©gorielle apparaÃ®t dans la base, nous aurions utilisÃ© &lt;code&gt;geom_bar&lt;/code&gt;.&lt;br&gt;
Avec ces Ã©lÃ©ments, le premier graphique qui nous viendrait Ã  l'esprit en utilisant &lt;code&gt;ggplot2&lt;/code&gt; serait le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-1-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;Il est bien sÃ»r illisible, en raison notamment du grand nombre de pays reprÃ©sentÃ© et du fait que leurs noms ne peuvent pas s'afficher correctement sur l'axe des abscisses. On peut corriger Ã§a en faisant une rotation de l'Ã©tiquette des axes de 90Â° avec &lt;code&gt;theme(axis.text.x = element_text(angle = 90))&lt;/code&gt;. Les barres sont Ã©galement trop rapprochÃ©es, ce que l'on va corriger avec le paramÃ¨tre &lt;code&gt;width&lt;/code&gt; de &lt;code&gt;geom_col&lt;/code&gt;. On obtient avec ces rÃ©glages rapides le graphique suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-2-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;C'est dÃ©jÃ  mieux! Mais il reste un peu de travail pour faciliter la lecture de ce graphique.  &lt;/p&gt;
&lt;h1 id="mettre-en-forme-le-graphique"&gt;Mettre en forme le graphique&lt;/h1&gt;
&lt;p&gt;Pour rendre ce graphique plus agrÃ©able Ã  lire et plus comprÃ©hensible, on propose d'ordonner l'affichage en fonction de la valeur du rÃ©sultat, de mettre en forme et d'inverser les axes et enfin de changer quelques Ã©lÃ©ments graphiques. &lt;/p&gt;
&lt;h2 id="ordonner-laffichage-en-fonction-de-la-valeur-de-la-variable-dinteret"&gt;Ordonner l'affichage en fonction de la valeur de la variable d'intÃ©rÃªt&lt;/h2&gt;
&lt;p&gt;Un Ã©lÃ©ment important de ce graphique est que les pays sont prÃ©sentÃ©s dans l'ordre alphabÃ©tique, ce qui n'a pas d'intÃ©rÃªt pour le lecteur. On peut facilement changer l'ordre d'affichage des modalitÃ©s de l'axe des abscisses en le conditionnant aux valeurs de l'axe des ordonnÃ©es. On utilise pour cela dans l'instruction &lt;code&gt;aes()&lt;/code&gt; la fonction &lt;code&gt;reorder()&lt;/code&gt; au moment de la dÃ©finition du &lt;code&gt;x&lt;/code&gt;, qui nous permet de l'ordonner de maniÃ¨re croissante ou dÃ©croissante en fonction de notre variable d'intÃ©rÃªt :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# par ordre croissant &lt;/span&gt;
&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;

&lt;span class="c1"&gt;# par ordre dÃ©croissant&lt;/span&gt;
&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/order_desc_asc.png"&gt;  &lt;/p&gt;
&lt;p&gt;Il est maintenant bien  plus facile de situer chaque pays par rapport aux autres.  &lt;/p&gt;
&lt;h2 id="mise-en-forme-des-axes"&gt;Mise en forme des axes&lt;/h2&gt;
&lt;p&gt;Avec l'instruction &lt;code&gt;labs&lt;/code&gt;, on dÃ©finit tout d'abord les titres de nos axes ainsi que le titre gÃ©nÃ©ral du graphique. Puis, dans &lt;code&gt;scale_y_continuous&lt;/code&gt;, on met en forme l'axe reprÃ©sentant les parts de dÃ©penses de santÃ© :&lt;br&gt;
- avec le paramÃ¨tre &lt;code&gt;labels&lt;/code&gt; on fait apparaÃ®tre les Ã©tiquettes sous forme de pourcentage grÃ¢ce Ã  la fonction &lt;code&gt;scales::percent()&lt;/code&gt;.&lt;br&gt;
- avec le paramÃ¨tre &lt;code&gt;limits&lt;/code&gt; on fait en sorte que les pourcentages affichÃ©s aillent jusqu'Ã  1, de maniÃ¨re Ã  ce que le lecteur ait une reprÃ©sentation plus juste de ce que serait la part de dÃ©penses restantes financÃ©es par les patients ou des organismes d'assurance privÃ©s.&lt;br&gt;
- le paramÃ¨tre &lt;code&gt;expand = c(0, 0)&lt;/code&gt; permet de supprimer les espaces avant et aprÃ¨s les valeurs minimum et maximum de notre variable d'intÃ©rÃªt.&lt;br&gt;
Pour mieux lire les noms des pays, on intervertit l'axe des ordonnÃ©es et des abscisses avec l'instruction &lt;code&gt;coord_flip()&lt;/code&gt; pour avoir un graphique en barres horizontales. Enfin, on rÃ¨gle la taille des labels des Ã©lÃ©ments de x et de y.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Pays&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Part de dÃ©penses de santÃ©&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Part des dÃ©penses de santÃ© financÃ©es par l&amp;#39;Etat\n dans les 30 pays les plus peuplÃ©s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scales&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;percent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accuracy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;limits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;coord_flip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plot_health&lt;/span&gt;

&lt;span class="n"&gt;plot_health&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;axis.text.y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-4-1.png"&gt;  &lt;/p&gt;
&lt;h2 id="utilisation-dun-theme"&gt;Utilisation d'un thÃ¨me&lt;/h2&gt;
&lt;p&gt;Pour l'affichage graphique il est possible de rÃ©gler chaque Ã©lÃ©ment du graphique comme on le souhaite. Le plus facile reste cependant d'utiliser les nombreux thÃ¨mes existants disponibles, par dÃ©faut dans &lt;code&gt;ggplot2&lt;/code&gt; ou en installant d'autres packages, comme &lt;code&gt;ggthemes&lt;/code&gt;. Pour les utiliser il suffit d'ajouter l'instruction &lt;code&gt;+ theme_*()&lt;/code&gt; Ã  la suite de votre plot. Le thÃ¨me par dÃ©faut dans ggplot2 est &lt;code&gt;theme_gray&lt;/code&gt;. On vous prÃ©sente le rÃ©sultat donnÃ© par &lt;code&gt;theme_economist&lt;/code&gt;, disponible dans la librairie &lt;code&gt;ggthemes&lt;/code&gt;, qui reprend la charte graphique du magazine &lt;em&gt;The Economist&lt;/em&gt;. On ajuste Ã©galement la taille des labels Ã  ce nouveau thÃ¨me.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggthemes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plot_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;theme_economist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;axis.text.y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-5-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="ggplot2"></category><category term="dataviz"></category><category term="graphiques"></category><category term="barplot"></category></entry><entry><title>Le dilemme biais variance dans la modÃ©lisation de donnÃ©es</title><link href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html" rel="alternate"></link><published>2021-11-08T00:00:00+01:00</published><updated>2021-11-08T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-11-08:/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html</id><summary type="html">&lt;p&gt;PrÃ©sentation des enjeux thÃ©oriques et pratiques de l'arbitrage biais variance dans la construction d'un modÃ¨le de prÃ©diction.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les modÃ¨les de Machine Learning&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un modÃ¨le&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;L'arbitrage biais variance est souvent Ã©voquÃ© pour caractÃ©riser les enjeux de la construction d'un modÃ¨le de prÃ©diction performant. L'idÃ©e de cet article est d'essayer de donner au lecteur les outils thÃ©oriques de cette question en essayant de privilÃ©gier une approche intuitive et pratique du problÃ¨me. AprÃ¨s avoir dÃ©fini ce que sont le biais et la variance, on prÃ©sente les enjeux de cet arbitrage puis l'application concrÃ¨te dans le cas de l'entraÃ®nement d'un modÃ¨le de Machine Learning.&lt;/p&gt;
&lt;h1 id="que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/h1&gt;
&lt;p&gt;Pour expliquer le plus simplement possible ces concepts, on se place dans le contexte de l'observation de deux variables &lt;code&gt;Y&lt;/code&gt; et &lt;code&gt;X&lt;/code&gt;. Dans le cas d'une modÃ©lisation d'une relation entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;, le biais d'un estimateur est son Ã©cart avec sa "vraie" valeur si on observait parfaitement la relation entre ces variables. On entend donc le biais comme &lt;strong&gt;l'Ã©cart entre la fonction modÃ©lisÃ©e et la fonction thÃ©orique&lt;/strong&gt; qui permettrait de restituer le lien entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Une maniÃ¨re de jouer sur le biais d'un modÃ¨le c'est de modifier sa variance. La variance est une mesure de dispersion de valeurs, qui donne une estimation de l'Ã©cart de celles-ci Ã  leur moyenne. La variance d'un modÃ¨le estime &lt;strong&gt;Ã  quel point celui-ci fluctue autour de sa moyenne pour coller aux donnÃ©es&lt;/strong&gt;. Une mesure utilisÃ©e couramment dans le cas des rÃ©gressions linÃ©aires est le coefficient de dÃ©termination R2. Celui-ci calcule &lt;strong&gt;la part de la variance des donnÃ©es expliquÃ©e par la variance du modÃ¨le&lt;/strong&gt;. Autrement dit, plus mon modÃ¨le sera proche des points de mes donnÃ©es, plus sa variance et donc le R2 seront Ã©levÃ©s. Pour illustrer ce concept, on prÃ©sente plusieurs modÃ¨les appliquÃ©s au mÃªme jeu de donnÃ©es avec une variance plus ou moins Ã©levÃ©e :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-1-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Pour chaque modÃ¨le, la courbe du modÃ¨le est celle qui apparaÃ®t en rouge et on a mis en Ã©vidence en vert la projection de chaque point sur sa valeur prÃ©dite par le modÃ¨le. Voyons comment interprÃ©ter ces graphiques :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Le premier modÃ¨le est un modÃ¨le naÃ¯f qui se contente de prÃ©dire que pour chaque valeur de &lt;code&gt;X&lt;/code&gt;, &lt;code&gt;Y&lt;/code&gt; sera Ã©gale Ã  sa moyenne. Par dÃ©finition donc, sa variance est nulle et sa capacitÃ© prÃ©dictive faible.  &lt;/li&gt;
&lt;li&gt;Le second modÃ¨le est une rÃ©gression linÃ©aire simple qui a un R2 d'environ 50%. Il a donc une meilleure qualitÃ© prÃ©dictive que le premier modÃ¨le du fait qu'il capte une partie de la variance des donnÃ©es, ici Ã  travers une corrÃ©lation positive entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;.  &lt;/li&gt;
&lt;li&gt;Le troisiÃ¨me modÃ¨le est un modÃ¨le polynomial dont on voit qu'il est plus ajustÃ© que le second. Les points prÃ©dits (en vert) par la courbe sont en effet plus proche des points que pour le prÃ©cÃ©dent modÃ¨le et mÃ©caniquement cela fait augmenter le R2. Le fait d'utiliser un modÃ¨le polynomial a donnÃ© au modÃ¨le une plus grande souplesse ce qui lui a permis de se rapprocher de certains points extrÃªmes qui Ã©taient Ã©loignÃ©s de la droite de rÃ©gression du second modÃ¨le.  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ainsi, plus la variance augmente, plus le modÃ¨le prÃ©dit en moyenne des valeurs proches de leurs vraies valeurs, ce qui fait diminuer le biais, puisqu'il est dÃ©fini comme l'Ã©cart entre notre fonction de prÃ©diction et une fonction qui permettrait de prÃ©dire parfaitement les donnÃ©es observÃ©es.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ‘‹ Nous c'est Antoine et Louis de Statoscop, une coopÃ©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;
&lt;h1 id="enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/h1&gt;
&lt;p&gt;D'aprÃ¨s ce qu'on a vu, pourquoi alors ne pas simplement chercher Ã  maximiser la variance pour minimiser le biais, c'est-Ã -dire son Ã©cart aux vraies valeurs? Tout simplement parce que dans le cas de la construction d'un modÃ¨le de prÃ©diction, nous modÃ©lisons des relations entre des donnÃ©es Ã  partir d'un Ã©chantillon pour prÃ©dire un rÃ©sultat sur une nouvelle population. C'est donc la performance de ce modÃ¨le sur de nouvelles donnÃ©es qui va nous intÃ©resser. Or, comme vous avez pu le pressentir en observant les graphiques prÃ©cÃ©dents, &lt;strong&gt;un modÃ¨le avec une variance trÃ¨s Ã©levÃ©e se gÃ©nÃ©ralise mal Ã  de nouvelles donnÃ©es&lt;/strong&gt;. D'un autre cÃ´tÃ©, &lt;strong&gt;un modÃ¨le avec une faible variance aura lui aussi une qualitÃ© prÃ©dictive trÃ¨s faible&lt;/strong&gt; car il captera mal une Ã©ventuelle relation entre les variables.&lt;/p&gt;
&lt;p&gt;Tout le problÃ¨me de cet arbitrage (ou dilemme) biais variance est donc de &lt;strong&gt;trouver un modÃ¨le qui ait une variance suffisamment forte pour limiter le biais mais suffisamment faible pour qu'il soit gÃ©nÃ©ralisable&lt;/strong&gt;. Les modÃ¨les prÃ©cÃ©dents avaient Ã©tÃ© entraÃ®nÃ©s sur une base de donnÃ©es qui Ã©tait un Ã©chantillon alÃ©atoire correspondant Ã  10% des donnÃ©es d'un Ã©chantillon plus important. Pour mesurer la qualitÃ© prÃ©dictive de ces modÃ¨les on les applique donc aux donnÃ©es entiÃ¨res et on calcule l'Ã©cart moyen au carrÃ© de la prÃ©diction Ã  la vraie valeur, c'est-Ã -dire l'erreur quadratique moyenne ou en anglais &lt;strong&gt;MSE&lt;/strong&gt; pour &lt;em&gt;Mean Squared Error&lt;/em&gt; :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate que, comme attendu, le modÃ¨le avec le plus de variance se gÃ©nÃ©ralise mal Ã  des donnÃ©es non connues et prÃ©sente une erreur de prÃ©diction supÃ©rieure Ã  celle du modÃ¨le linÃ©aire simple. En effet, les variations de la courbe polynomiale qui lui permettait de coller au plus prÃ¨s des donnÃ©es sur lesquelles elle a Ã©tÃ© construite entraÃ®ne beaucoup de prÃ©dictions trÃ¨s Ã©loignÃ©es de la vraie valeur des nouvelles donnÃ©es.&lt;br&gt;
L'erreur attendue d'un modÃ¨le de prÃ©diction sur des donnÃ©es sur lesquelles il ne s'est pas entraÃ®nÃ© peut en effet se dÃ©composer en &lt;strong&gt;la somme du biais au carrÃ© et de la variance de ce modÃ¨le, c'est la dÃ©composition biais-variance de l'erreur quadratique&lt;/strong&gt;. Si vous prÃ©fÃ©rez vous en convaincre avec la formule et la dÃ©monstration mathÃ©matique, vous pouvez vous rÃ©fÃ©rer Ã  &lt;a href="https://fr.wikipedia.org/wiki/Dilemme_biais-variance#DÃ©composition_biais-variance_de_l'erreur_quadratique"&gt;la page wikipÃ©dia qui en parle&lt;/a&gt;. Comme le biais diminue avec la variance, il faut donc trouver un niveau de complexitÃ© du modÃ¨le qui permette Ã  la fois de minimiser l'Ã©cart Ã  la vraie valeur (faible biais en augmentant la variance) et d'Ãªtre gÃ©nÃ©ralisable en dehors de son Ã©chantillon d'entraÃ®nement (faible variance).&lt;/p&gt;
&lt;h1 id="liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les modÃ¨les de Machine Learning&lt;/h1&gt;
&lt;h2 id="appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/h2&gt;
&lt;p&gt;Le principe de l'apprentissage automatique supervisÃ© est le mÃªme que celui qu'on a prÃ©sentÃ© jusqu'Ã  maintenant : on renseigne au modÃ¨le des variables explicatives (&lt;code&gt;X&lt;/code&gt;) et une variable d'intÃ©rÃªt (&lt;code&gt;Y&lt;/code&gt;) qu'on aimerait pouvoir ensuite prÃ©dire Ã  partir de nouvelles donnÃ©es &lt;code&gt;X&lt;/code&gt;. Par exemple, on renseigne des photos de chats et de chiens Ã©tiquettÃ©es : &lt;code&gt;Y&lt;/code&gt; est alors le label "chien" ou "chat" de la photo, &lt;code&gt;X&lt;/code&gt; la matrice de pixels de la photo. Le modÃ¨le devra Ãªtre ensuite capable de prÃ©dire Ã  partir d'une photo qu'il n'a jamais vue si celle-ci reprÃ©sente un chat ou un chien. Pour mesurer la qualitÃ© prÃ©dictive de notre modÃ¨le, on rÃ©serve des donnÃ©es labellisÃ©es sur lesquelles il ne s'entraÃ®nera pas. On va ensuite lui demander de prÃ©dire les labels dÃ©jÃ  connus de ces donnÃ©es, ce qui va nous permettre d'Ã©valuer la qualitÃ© de ces prÃ©dictions. Cet Ã©chantillon est en gÃ©nÃ©ral appelÃ© &lt;strong&gt;Ã©chantillon test&lt;/strong&gt; (&lt;em&gt;test set&lt;/em&gt; en anglais), et les donnÃ©es sur lesquelles le modÃ¨le est entraÃ®nÃ© s'appelle l'&lt;strong&gt;Ã©chantillon d'entraÃ®nement&lt;/strong&gt; (&lt;em&gt;train set&lt;/em&gt;). En gÃ©nÃ©ral, si l'on dispose de suffisamment de donnÃ©es, on n'aura pas trop de mal Ã  construire un modÃ¨le qui parviendra Ã  labelliser quasiment parfaitement &lt;strong&gt;nos donnÃ©es d'entraÃ®nement&lt;/strong&gt;. Tout le problÃ¨me est d'avoir un modÃ¨le qui se gÃ©nÃ©ralise correctement Ã  de nouvelles donnÃ©es.&lt;/p&gt;
&lt;h2 id="courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un modÃ¨le&lt;/h2&gt;
&lt;p&gt;Pour schÃ©matiser, imaginons que dans les donnÃ©es d'entraÃ®nement les chiens soient en gÃ©nÃ©ral photographiÃ©es Ã  l'extÃ©rieur et les chats Ã  l'intÃ©rieur. Si mon modÃ¨le a une forte variance, cela signifie qu'il va prendre en compte beaucoup de dÃ©tails de la photo. Il va par exemple donner du poids aux Ã©lÃ©ments de fond dans sa prÃ©diction et sera incapable de labelliser correctement un chien photographiÃ© Ã  l'intÃ©rieur. Un modÃ¨le bien plus basique qui se serait appuyÃ© par exemple uniquement sur la forme des oreilles de l'animal aurait peut-Ãªtre de meilleurs rÃ©sultats.&lt;br&gt;
Dans le premier cas, on dit que l'on est dans une situation de &lt;strong&gt;surapprentissage, ou overfitting&lt;/strong&gt;. Le modÃ¨le a intÃ©grÃ© des Ã©lÃ©ments anecdotiques, du bruit, dans son processus dÃ©cisionnel et cela va rÃ©duire sa performance prÃ©dictive sur des donnÃ©es non connues. Autrement dit, &lt;strong&gt;sa variance est trop Ã©levÃ©e&lt;/strong&gt;. Si au contraire le modÃ¨le est trop peu complexe et n'a pas intÃ©grÃ© assez d'informations pour diffÃ©rencier un chat d'un chien mÃªme sur les donnÃ©es d'apprentissage, on dit qu'il est dans un Ã©tat de &lt;strong&gt;sous-apprentissage, ou underfitting&lt;/strong&gt;.&lt;br&gt;
&lt;strong&gt;Dans les deux cas, le modÃ¨le va avoir de mauvaises performances prÃ©dictives sur des nouvelles donnÃ©es&lt;/strong&gt;. Ce constat peut Ãªtre schÃ©matisÃ© de la maniÃ¨re suivante :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/courb_apprent.png"&gt;  &lt;/p&gt;
&lt;p&gt;Notons bien ici que cette relation entre complexitÃ© du modÃ¨le et dÃ©composition de l'erreur de prÃ©diction s'entend &lt;strong&gt;Ã  taille d'Ã©chantillon fixÃ©e&lt;/strong&gt;. Ainsi, plus l'Ã©chantillon sera grand, plus le modÃ¨le pourra Ãªtre complexe avant d'entrer dans la phase de surapprentissage.  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans le cadre d'une &lt;strong&gt;dÃ©marche prÃ©dictive&lt;/strong&gt;, il est donc tout Ã  fait naturel de limiter l'apprentissage du modÃ¨le pour optimiser ses capacitÃ©s prÃ©dictives. Cela peut Ãªtre fait en rÃ©duisant le nombre de variables prÃ©dictives utilisÃ©es, en limitant le nombre de couches de neurones dans un rÃ©seau, mais aussi en utilisant des mÃ©thodes de rÃ©duction des dimensions, comme &lt;a href="https://blog.statoscop.fr/acp-python.html"&gt;nous vous l'avions montrÃ© avec l'analyse en composantes principales&lt;/a&gt;. Bien sÃ»r, dans une &lt;strong&gt;dÃ©marche explicative&lt;/strong&gt;, il sera au contraire normal de sacrifier Ã©ventuellement une meilleure capacitÃ© prÃ©dictive pour mettre en Ã©vidence une relation avec une variable explicative. Si vous souhaitez aller plus loin, vous pouvez parcourir l'excellente Ã©tude de &lt;a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf"&gt;Shmueli, 2010&lt;/a&gt; qui expose les enjeux croisÃ©s des dÃ©marches explicative et prÃ©dictive dans la modÃ©lisation.&lt;br&gt;
Il me reste Ã  remercier &lt;a href="https://twitter.com/EParoissien"&gt;Emmanuel Paroissien&lt;/a&gt;, chercheur Ã  l'Inra, pour nos Ã©changes qui m'ont aidÃ© Ã  construire cette note. N'hÃ©sitez pas Ã  &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et Ã  nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi Ã  gÃ©nÃ©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;dÃ©pÃ´t github de nos notes de blog&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category><category term="Machine Learning"></category></entry><entry><title>Gestion des packages sur R avec renv</title><link href="https://blog.statoscop.fr/gestion-des-packages-sur-r-avec-renv.html" rel="alternate"></link><published>2021-10-07T00:00:00+02:00</published><updated>2021-10-07T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-10-07:/gestion-des-packages-sur-r-avec-renv.html</id><summary type="html">&lt;p&gt;PrÃ©sentation du gestionnaire de packages de R&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#interet-dun-gestionnaire-de-packages-dans-un-projet-avec-r"&gt;IntÃ©rÃªt d'un gestionnaire de packages dans un projet avec R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#organisation-du-projet"&gt;Organisation du projet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#avantages-dun-gestionnaire-de-packages-dans-un-projet-r"&gt;Avantages d'un gestionnaire de packages dans un projet R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#votre-projet-sera-isole"&gt;Votre projet sera isolÃ©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#votre-projet-sera-portable-et-reproductible"&gt;Votre projet sera portable et reproductible&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renv"&gt;Utilisation de renv&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#initialisation-de-renv"&gt;Initialisation de renv&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mettre-a-jour-les-dependances-avec-le-fichier-lock"&gt;Mettre Ã  jour les dÃ©pendances avec le fichier lock&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renvrestore"&gt;Utilisation de renv::restore()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renvsnapshot"&gt;Utilisation de renv::snapshot()&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#petite-note-sur-git"&gt;Petite note sur git&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;En 2019, je prÃ©sentais briÃ¨vement le package &lt;code&gt;packrat&lt;/code&gt; dans &lt;a href="https://antoinesir.rbind.io/post/gestion-des-packages-sur-r-pr%C3%A9sentation-de-packrat/"&gt;un article de blog&lt;/a&gt;. Ce package R permettait de gÃ©rer les dÃ©pendances aux packages d'un projet R Ã  la maniÃ¨re des environnements de Python. Il comportait cependant un certain nombre d'inconvÃ©nients, dont celui d'un temps long de tÃ©lÃ©chargement des packages. Depuis 2020, il a Ã©tÃ© remplacÃ© par &lt;code&gt;renv&lt;/code&gt; qui gomme la plupart de ces dÃ©fauts, et c'est l'occasion de vous montrer pourquoi et comment vous devriez vous servir d'un gestionnaire de packages pour vos projets R Ã  partir d'un exemple concret!&lt;/p&gt;
&lt;p&gt;On commence cet article par la prÃ©sentation du projet dont on se sert comme exemple et de l'intÃ©rÃªt d'un gestionnaire de packages avant d'illustrer l'utilisation de &lt;code&gt;renv&lt;/code&gt; dans ce contexte. Cet article a pour but de prÃ©senter un cas concret d'utilisation de &lt;code&gt;renv&lt;/code&gt; mais ne se substitue pas Ã  la &lt;a href="https://rstudio.github.io/renv/articles/renv.html"&gt;documentation officielle du package&lt;/a&gt;.  &lt;/p&gt;
&lt;h1 id="interet-dun-gestionnaire-de-packages-dans-un-projet-avec-r"&gt;IntÃ©rÃªt d'un gestionnaire de packages dans un projet avec R&lt;/h1&gt;
&lt;p&gt;La premiÃ¨re Ã©tape pour aller vers plus de reproductibilitÃ© sur R est de connaÃ®tre le fonctionnement des projets (fichiers .Rproj), qui permettent d'ouvrir R Ã  la racine de votre projet et de proposer un code avec seulement des chemins relatifs. Si vous n'Ãªtes pas du tout familiers avec ce fonctionnement, je vous conseille de lire &lt;a href="http://larmarange.github.io/analyse-R/organiser-ses-fichiers.html"&gt;cet article&lt;/a&gt; de l'excellent blog de Joseph Larmarange.  &lt;/p&gt;
&lt;h2 id="organisation-du-projet"&gt;Organisation du projet&lt;/h2&gt;
&lt;p&gt;On propose pour illustrer le propos un projet tout simple dont l'organisation est prÃ©sentÃ©e ci-dessous :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/orga_dossier.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ce projet contient un dossier &lt;code&gt;data&lt;/code&gt; dans lequel se trouve notre base de donnÃ©es et un dossier &lt;code&gt;scripts&lt;/code&gt; avec un code R contenant quelques traitements basiques. Ã€ la racine du dossier, on remarque Ã©galement notre fichier &lt;code&gt;Presentation renv.Rproj&lt;/code&gt; qui dÃ©finit donc l'emplacement de notre rÃ©pertoire de travail. Le script R contient les instructions suivantes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Chargement des packages&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Import des donnÃ©es&lt;/span&gt;
&lt;span class="n"&gt;mon_iris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data/iris.csv&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mon_iris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ce code tout simple permet donc de calculer la moyenne des largeur et longueur des sÃ©pales de la base de donnÃ©es &lt;code&gt;iris&lt;/code&gt;. L'utilisation d'un fichier .Rproj, d'un chemin relatif pour importer les donnÃ©es et le fait que les deux packages utilisÃ©s (&lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt;) soient chargÃ©s explicitement semblent rendre la reproductibilitÃ© des rÃ©sultats aisÃ©e : il me suffit de rÃ©cupÃ©rer l'ensemble du dossier, d'installer les deux packages s'ils ne sont pas dÃ©jÃ  installÃ©s et de faire tourner le code. Seulement, je pourrais avoir sur mon poste une version de dplyr installÃ©e trop ancienne et dans laquelle &lt;code&gt;across&lt;/code&gt; n'existerait pas encore. Bien sÃ»r il suffirait ici de mettre Ã  jour mon package, mais peut-Ãªtre que la version la plus rÃ©cente de &lt;code&gt;dplyr&lt;/code&gt; ne correspond pas non plus Ã  la version du code utilisÃ© par la personne ayant Ã©crit le code, et que cela peut causer de nouveaux problÃ¨mes...&lt;/p&gt;
&lt;h2 id="avantages-dun-gestionnaire-de-packages-dans-un-projet-r"&gt;Avantages d'un gestionnaire de packages dans un projet R&lt;/h2&gt;
&lt;p&gt;Tout d'abord, sachez qu'en gÃ©nÃ©ral les dÃ©veloppeurs de package R, et en particulier ceux ayant un trÃ¨s grand nombre d'utilisateurs, portent une attention particuliÃ¨re Ã  faire en sorte que les mises Ã  jour ne "cassent" pas les codes existants, en d'autres termes que ce qui a Ã©tÃ© codÃ© dans une ancienne version du package tourne toujours avec la nouvelle version. Ceci Ã©tant dit, une mise Ã  jour peut toujours avoir des consÃ©quences sur vos rÃ©sultats (anticipÃ©s ou non par les dÃ©veloppeurs) et il est bien plus facile d'utiliser un gestionnaire de packages, et nous allons vous expliquer pourquoi.  &lt;/p&gt;
&lt;h3 id="votre-projet-sera-isole"&gt;Votre projet sera isolÃ©&lt;/h3&gt;
&lt;p&gt;Avec le systÃ¨me classique de packages R, tous les packages installÃ©s le sont dans un rÃ©pertoire commun Ã  votre ordinateur. Quand vous mettez Ã  jour un package, l'ancienne version est Ã©crasÃ©e et ce pour &lt;strong&gt;tous&lt;/strong&gt; vos projets. Ce que va permettre un gestionnaire de packages, c'est de faire dÃ©pendre une version d'un package Ã  un projet en particulier. C'est ce qui va permettre Ã  chacun de vos projets d'Ãªtre &lt;strong&gt;isolÃ©s&lt;/strong&gt; les uns des autres. En plus, &lt;code&gt;renv&lt;/code&gt; fonctionne sur un systÃ¨me de caches qui lui permet malgrÃ© tout de ne pas avoir Ã  tÃ©lÃ©charger deux fois la mÃªme version du mÃªme package si elle est utilisÃ©e dans deux projets diffÃ©rents. Cette propriÃ©tÃ© est particuliÃ¨rement importante pour des gros projets pour lesquels vous n'auriez pas le temps d'adapter le code Ã  une mise Ã  jour d'un package, tout en voulant bÃ©nÃ©ficier de cette mise Ã  jour pour vos autres travaux.  &lt;/p&gt;
&lt;h3 id="votre-projet-sera-portable-et-reproductible"&gt;Votre projet sera portable et reproductible&lt;/h3&gt;
&lt;p&gt;La portabilitÃ© d'un projet, c'est sa capacitÃ© Ã  pouvoir tourner sur n'importe quelle machine, n'importe quel OS, etc... C'est ce qui permet sa reproductibilitÃ©, c'est-Ã -dire la capacitÃ© Ã  reproduire les rÃ©sultats dans des conditions identiques. C'est extrÃªmement prÃ©cieux pour les projets en Ã©quipe mais aussi pour soi : en effet rien ne nous assure que notre projet codÃ© il y a deux ans va tourner aprÃ¨s les nombreuses mises Ã  jour qu'ont dÃ» subir les packages utilisÃ©s. &lt;code&gt;renv&lt;/code&gt; permet de rÃ©pondre Ã  cette problÃ©matique en vous renvoyant 2 ans en arriÃ¨re dans le mÃªme environnement de packages, Ã  condition bien sÃ»r que les versions utilisÃ©es alors soient encore disponibles sur le CRAN ou sur la source de laquelle vous les avez tÃ©lÃ©chargÃ©s.  &lt;/p&gt;
&lt;h1 id="utilisation-de-renv"&gt;Utilisation de renv&lt;/h1&gt;
&lt;p&gt;AprÃ¨s, je l'espÃ¨re, vous avoir convaincu de l'utilitÃ© d'un gestionnaire de packages, je vais vous prÃ©senter rapidement comment utiliser &lt;code&gt;renv&lt;/code&gt; dans le petit projet que je vous ai prÃ©sentÃ©.  &lt;/p&gt;
&lt;h2 id="initialisation-de-renv"&gt;Initialisation de &lt;code&gt;renv&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Pour commencer Ã  utiliser le gestionnaire de packages, vous ouvrez votre projet dans RStudio et vous lancez dans la console &lt;code&gt;renv::init()&lt;/code&gt;. Votre projet va maintenant ressembler Ã  Ã§a :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/orga_dossier_renv.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate l'apparition d'un dossier &lt;code&gt;renv&lt;/code&gt;, qui contient les fichiers de lancement et de paramÃ©trage du gestionnaire ainsi que les liens vers les packages Ã  charger. Contrairement Ã  &lt;code&gt;packrat&lt;/code&gt;, renv utilise en effet un cache dans lequel il installe les packages, ce qui permet de ne pas dupliquer l'installation de la mÃªme version du mÃªme package pour deux projets diffÃ©rents. Mais ce qui nous intÃ©resse plus, c'est l'apparition Ã  la racine du projet du fichier &lt;code&gt;renv.lock&lt;/code&gt;, qui ressemble Ã  Ã§a :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;4.1.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repositories&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;URL&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://cloud.r-project.org&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Packages&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R6&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;2.5.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;b203113193e70978a696b2809525649d&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cli&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cli&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;2.5.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;a94ba44cee3ea571e813721e64184172&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;crayon&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;crayon&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1.4.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;e75525c55c70e5f4f78c9960a4b402e9&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data.table&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data.table&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1.14.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;d1b8b1a821ee564a3515fa6c6d5c52dc&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le gestionnaire a repÃ©rÃ© les packages utilisÃ©s dans mon script et a recensÃ© toutes leurs informations utiles ainsi que celles de leurs dÃ©pendances : nom, version, source d'installation... Il renseigne aussi les caractÃ©ristiques du logiciel R installÃ© sur mon poste. C'est Ã  partir de ce fichier que le gestionnaire va ensuite Ãªtre capable de vÃ©rifier l'adÃ©quation de l'environnement de packages de l'utilisateur et celui enregistrÃ© le plus rÃ©cemment. C'est aussi lÃ  qu'il va Ã©crire les rÃ©fÃ©rences des packages que j'installerai aprÃ¨s avoir commencÃ© Ã  travailler sur le poste.  &lt;/p&gt;
&lt;p&gt;Ã€ noter que &lt;strong&gt;&lt;code&gt;renv&lt;/code&gt; peut aussi bien Ãªtre utilisÃ© au lancement de votre projet qu'au cours de celui-ci&lt;/strong&gt;. S'il est utilisÃ© au lancement, vous enregistrerez dans le fichier lock les informations des packages au fur et Ã  mesure de votre utilisation. Si le projet est dÃ©jÃ  bien avancÃ© comme dans notre exemple, il va partir d'un fichier lock contenant dÃ©jÃ  les rÃ©fÃ©rences des packages installÃ©s et utilisÃ©s. &lt;/p&gt;
&lt;h2 id="mettre-a-jour-les-dependances-avec-le-fichier-lock"&gt;Mettre Ã  jour les dÃ©pendances avec le fichier lock&lt;/h2&gt;
&lt;p&gt;On prÃ©sente les deux instructions les plus utiles de &lt;code&gt;renv&lt;/code&gt; : &lt;code&gt;restore()&lt;/code&gt; et &lt;code&gt;snapshot()&lt;/code&gt;. Ce sont elles qui permettent de raccorder l'Ã©tat de votre environnement de packages en local par rapport Ã  celui qui sera proposÃ© Ã  l'ouverture de votre projet &lt;code&gt;renv&lt;/code&gt;. C'est la fonction &lt;code&gt;status()&lt;/code&gt; qui permet de vÃ©rifier que votre environnement de packages utilisÃ© Ã  un moment T correspond bien Ã  celui enregistrÃ© dans le fichier lock.   &lt;/p&gt;
&lt;h3 id="utilisation-de-renvrestore"&gt;Utilisation de &lt;code&gt;renv::restore()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Imaginons que j'ouvre ce mÃªme projet sur un autre poste sur lequel &lt;code&gt;data.table&lt;/code&gt; n'est pas installÃ©. En ouvrant le projet RStudio je vais avoir un message d'avertissement m'indiquant que mon environnement pourrait ne pas Ãªtre Ã  jour du projet. Je lance alors &lt;code&gt;renv::status()&lt;/code&gt;, qui me renvoie en effet :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/warning_renv.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;L'absence d'installation de &lt;code&gt;data.table&lt;/code&gt; a bien Ã©tÃ© repÃ©rÃ©e. Comme suggÃ©rÃ©, il suffit de lancer &lt;code&gt;renv::restore()&lt;/code&gt; pour que mon environnement de packages soit de nouveau Ã  jour avec celui dÃ©crit dans le fichier lock. Il aurait fallu aussi envoyer cette instruction si la version de &lt;code&gt;data.table&lt;/code&gt; enregistrÃ©e sur votre poste ne correspondait plus Ã  celle enregistrÃ©e dans le fichier lock. Cette instruction sert donc Ã  rendre mon environnement de packages en local cohÃ©rent avec celui renseignÃ© dans le fichier lock.     &lt;/p&gt;
&lt;h3 id="utilisation-de-renvsnapshot"&gt;Utilisation de &lt;code&gt;renv::snapshot()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Je peux aussi vouloir changer le fichier lock suite Ã  une Ã©volution du code. Imaginons par exemple que je n'utilise plus &lt;code&gt;data.table&lt;/code&gt; pour importer mes donnÃ©es mais directement la fonction &lt;code&gt;read.csv()&lt;/code&gt;, qui fait partie des fonctions chargÃ©es automatiquement au lancement de RStudio. Cette modification des dÃ©pendances va Ãªtre repÃ©rÃ©e et &lt;code&gt;renv::status()&lt;/code&gt; va renvoyer le message suivant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/warning_renv2.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Si au contraire j'avais installÃ© et utilisÃ© un nouveau package, c'est la mÃªme instruction qui m'aurait permis d'ajouter ses rÃ©fÃ©rences au fichier lock. &lt;code&gt;renv::snapshot()&lt;/code&gt; permet donc de mettre Ã  jour le fichier lock afin que mes modifications dans l'utilisation des packages soient prises en compte. &lt;strong&gt;Avant d'avoir lancÃ© cette instruction, les modifications dans les dÃ©pendances de mon projet ne seront pas prises en compte par le gestionnaire de packages&lt;/strong&gt;.   &lt;/p&gt;
&lt;h2 id="petite-note-sur-git"&gt;Petite note sur git&lt;/h2&gt;
&lt;p&gt;Comme on l'a vu, l'utilisation de &lt;code&gt;renv&lt;/code&gt; est particuliÃ¨rement intÃ©ressante dans le cadre d'un travail collaboratif. C'est donc naturellement qu'on l'utilisera avec git. Il est important de noter qu'il n'est pas nÃ©cessaire de versionner tout le dossier &lt;code&gt;renv&lt;/code&gt;, mais seulement le fichier lock, le script &lt;code&gt;renv/activate.R&lt;/code&gt; et le fichier &lt;code&gt;.Rprofile&lt;/code&gt; de la personne ayant initialisÃ© le projet. Le reste du dossier &lt;code&gt;renv&lt;/code&gt; contient en effet des informations spÃ©cifiques Ã  chaque poste, comme les liens vers le cache ayant stockÃ© les packages installÃ©s. Il se mettra Ã  jour automatiquement avec les trois fichiers versionnÃ©s. Pensez Ã  vous &lt;a href="https://rstudio.github.io/renv/articles/collaborating.html"&gt;rÃ©fÃ©rer Ã  la documentation avant de vous lancer&lt;/a&gt;.  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Vous l'avez compris, &lt;code&gt;renv&lt;/code&gt; est un outil trÃ¨s prÃ©cieux pour s'assurer que d'autres personnes ou vous-mÃªme pourront refaire tourner votre code sans difficultÃ©s. Il est sans doute nÃ©cessaire, mais pas suffisant : certains packages ont des dÃ©pendances externes comme javascript, il faut bien sÃ»r veiller Ã  ce que les donnÃ©es soient accessibles et identiques pour tous et que les scripts ne contiennent pas de paramÃ¨tres spÃ©cifiques Ã  un utilisateur. &lt;br&gt;
En plus des qualitÃ©s prÃ©sentÃ©es dans l'article, &lt;code&gt;renv&lt;/code&gt; vous permettra aussi de vous rendre compte du nombre de packages sur lequel repose votre projet, qui ne se limitent pas qu'aux packages installÃ©s mais aussi Ã  leurs dÃ©pendances. Cela peut Ãªtre une bonne occasion d'essayer de les rÃ©duire dans la mesure du possible. RÃ©cemment, un frisson a parcouru les quelques milliers de dÃ©veloppeurs de packages R dÃ©pendant du package &lt;code&gt;lubridate&lt;/code&gt; quand ils ont reÃ§u un mail du CRAN leur annonÃ§ant que ce dernier risquait d'Ãªtre supprimÃ© et qu'ils devaient ajuster leurs packages en consÃ©quence. Naturellement, au vu de la popularitÃ© de &lt;code&gt;lubridate&lt;/code&gt;, cela &lt;a href="https://twitter.com/dvaughan32/status/1445459240718458881"&gt;n'arrivera finalement pas&lt;/a&gt;, mais c'est un rappel utile de la fragilitÃ© relative d'un projet avec de trop nombreuses dÃ©pendances.&lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="renv"></category><category term="packages"></category><category term="CRAN"></category></entry><entry><title>Fonctionnement et performances d'across dans dplyr</title><link href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html" rel="alternate"></link><published>2021-06-02T00:00:00+02:00</published><updated>2021-06-02T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-06-02:/fonctionnement-et-performances-dacross-dans-dplyr.html</id><summary type="html">&lt;p&gt;Mise Ã  jour de l'Ã©valuation des performances du verbe &lt;code&gt;across&lt;/code&gt; dans dplyr version 1.0.6&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#across-ca-marche-comment"&gt;across(), Ã§a marche comment?&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#syntaxe-de-base"&gt;Syntaxe de base&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#selection-avec-des-conditions"&gt;SÃ©lection avec des conditions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#selection-a-partir-du-nom"&gt;SÃ©lection Ã  partir du nom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#autres-proprietes"&gt;Autres propriÃ©tÃ©s&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#across-ca-tourne-comment"&gt;across(), Ã§a tourne comment?&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#instructions-sur-lesquelles-on-compare-les-methodes"&gt;Instructions sur lesquelles on compare les mÃ©thodes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#resultats-de-la-version-106"&gt;RÃ©sultats de la version 1.0.6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#resultats-de-la-version-100"&gt;RÃ©sultats de la version 1.0.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;A la sortie de l'Ã©tÃ© dernier, j'ai rÃ©alisÃ© une &lt;a href="https://antoinesir.rbind.io/post/fonctionnement-de-across-dans-dplyr/" target="_blank"&gt;note sur mon blog personnel&lt;/a&gt; sur un Ã©lÃ©ment important d'une mise Ã  jour majeure de dplyr : &lt;code&gt;across()&lt;/code&gt;, un nouveau verbe pour rÃ©aliser des opÃ©rations sur plusieurs colonnes. Dans cette note, on utilisait la version &lt;code&gt;1.0.2&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; et on comparait &lt;code&gt;across&lt;/code&gt; aux verbes Ã©quivalents que cela devait remplacer (fonctions indexÃ©es par &lt;code&gt;_at&lt;/code&gt;, &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;) . On constatait une moins bonne performance d' &lt;code&gt;across&lt;/code&gt; en termes de temps d'exÃ©cution. Cet Ã©lÃ©ment Ã©tait bien connu des dÃ©veloppeurs de RStudio et a Ã©tÃ© constamment pris en compte dans les diffÃ©rentes mises Ã  jour. On reprend ici cette note en la mettant Ã  jour avec la version &lt;code&gt;1.0.6&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; disponible Ã  ce jour pour voir oÃ¹ se place dÃ©sormais &lt;code&gt;across&lt;/code&gt; en termes de temps d'exÃ©cution.&lt;/p&gt;
&lt;p&gt;Si vous voulez balayer plus largement les diffÃ©rents Ã©lÃ©ments de la mise Ã  jour de &lt;code&gt;dplyr&lt;/code&gt;, vous pouvez vous rendre sur &lt;a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/" target="_blank"&gt;le site du tidyverse&lt;/a&gt; (en anglais) ou sur &lt;a href="https://thinkr.fr/hey-quoi-de-neuf-dplyr-le-point-sur-la-v1/#La_fonction_de_calcul_avec_conditions_sur_les_variables_across()" target="_blank"&gt;cet article du blog de ThinkR&lt;/a&gt; (en franÃ§ais) qui en prÃ©sentent les changements majeurs. &lt;/p&gt;
&lt;h1 id="across-ca-marche-comment"&gt;&lt;code&gt;across()&lt;/code&gt;, Ã§a marche comment?&lt;/h1&gt;
&lt;h2 id="syntaxe-de-base"&gt;Syntaxe de base&lt;/h2&gt;
&lt;p&gt;Le verbe &lt;code&gt;across()&lt;/code&gt; vise Ã  remplacer toutes les fonctions suffixÃ©es par &lt;code&gt;_if&lt;/code&gt;, &lt;code&gt;_at&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;. Il regroupe ces mÃ©thodes dans une seule et permet ainsi de les associer, ce qui n'Ã©tait pas possible avant. Il s'utilise dans &lt;code&gt;mutate&lt;/code&gt; et &lt;code&gt;summarise&lt;/code&gt;. La syntaxe associÃ©e Ã  ce verbe est la suivante :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans laquelle :&lt;br&gt;
 - Les colonnes &lt;code&gt;.cols&lt;/code&gt; peuvent Ãªtre sÃ©lectionnÃ©es en utilisant la mÃªme syntaxe que pour la mÃ©thode &lt;code&gt;vars()&lt;/code&gt; (nom des variables, &lt;code&gt;starts_with&lt;/code&gt;, &lt;code&gt;end_with&lt;/code&gt;, &lt;code&gt;contains&lt;/code&gt;,...), mais aussi avec des conditions rentrÃ©es dans &lt;code&gt;where()&lt;/code&gt; qui sÃ©lectionneront de la mÃªme maniÃ¨re que le faisaient les fonctions suffixÃ©es par &lt;code&gt;_if&lt;/code&gt;.&lt;br&gt;
 - La fonction &lt;code&gt;.fns&lt;/code&gt; est dÃ©finie comme auparavant (le nom de la fonction ou sa dÃ©finition "Ã  la volÃ©e" avec &lt;code&gt;~ my_fun(.)&lt;/code&gt;).  &lt;/p&gt;
&lt;p&gt;On prÃ©sente quelques exemples en utilisant la table &lt;code&gt;penguins&lt;/code&gt; promue par &lt;a href="https://github.com/allisonhorst/palmerpenguins" target="_blank"&gt;Allison Horst&lt;/a&gt; pour remplacer l'usage de la table iris. Vous pouvez l'obtenir depuis le package &lt;code&gt;palmerpenguins&lt;/code&gt; sur le CRAN.  &lt;/p&gt;
&lt;h2 id="selection-avec-des-conditions"&gt;SÃ©lection avec des conditions&lt;/h2&gt;
&lt;p&gt;Ã€ partir de cette table, l'instruction visant Ã  sortir la moyenne de toutes les variables numÃ©riques s'Ã©crivait auparavant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202. 2008.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Elle se rÃ©Ã©crit avec &lt;code&gt;across()&lt;/code&gt; en utilisant &lt;code&gt;where()&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202. 2008.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="selection-a-partir-du-nom"&gt;SÃ©lection Ã  partir du nom&lt;/h2&gt;
&lt;p&gt;Si l'on souhaite sÃ©lectionner Ã  partir du nom des variables, la nouvelle syntaxe est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Ancienne version&lt;/span&gt;
&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill*|flipper*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 3&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.&lt;/span&gt;

&lt;span class="c1"&gt;# Avec across()&lt;/span&gt;
&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill*|flipper*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 3&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="autres-proprietes"&gt;Autres propriÃ©tÃ©s&lt;/h2&gt;
&lt;p&gt;On note Ã©galement qu'on peut combiner dorÃ©navant les sÃ©lections sur les types des colonnes et sur leur nom dans une seule instruction &lt;code&gt;across()&lt;/code&gt;, ce qui n'Ã©tait pas possible avant. Pour enlever les annÃ©es des moyennes numÃ©riques, on peut par exemple Ã©crire :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nf"&gt;contains&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 4&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Enfin, le paramÃ¨tre &lt;code&gt;.names&lt;/code&gt; de &lt;code&gt;across()&lt;/code&gt; est Ã©galement trÃ¨s pratique et permet notamment dans une instruction &lt;code&gt;mutate()&lt;/code&gt; de crÃ©er de nouvelles colonnes nommÃ©es Ã  partir des anciennes auxquelles on peut se rÃ©fÃ©rer avec &lt;code&gt;.col&lt;/code&gt;. Par exemple, si je veux crÃ©er deux nouvelles colonnes passant les informations sur le bec en pouces mais en conservant les anciennes colonnes, je peux Ã©crire :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.04&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;pouces_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;contains&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 5 x 4&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm pouces_bill_length_mm pouces_bill_depth_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;                 &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           39.1          18.7                  1.56                0.748&lt;/span&gt;
&lt;span class="c1"&gt;## 2           39.5          17.4                  1.58                0.696&lt;/span&gt;
&lt;span class="c1"&gt;## 3           40.3          18                    1.61                0.72 &lt;/span&gt;
&lt;span class="c1"&gt;## 4           NA            NA                   NA                  NA    &lt;/span&gt;
&lt;span class="c1"&gt;## 5           36.7          19.3                  1.47                0.772&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="across-ca-tourne-comment"&gt;&lt;code&gt;across()&lt;/code&gt;, Ã§a tourne comment?&lt;/h1&gt;
&lt;p&gt;Ã€ la sortie de la mise Ã  jour de &lt;code&gt;dplyr&lt;/code&gt;, il avait Ã©tÃ© signalÃ© que la mÃ©thode &lt;code&gt;across()&lt;/code&gt; impliquerait peut-Ãªtre de lÃ©gÃ¨res pertes en termes de vitesse d'exÃ©cution par rapport aux anciennes mÃ©thodes &lt;code&gt;_at&lt;/code&gt;, &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;. On a mis en Ã©vidence ce problÃ¨me avec la version &lt;code&gt;1.0.2&lt;/code&gt; de dplyr dans &lt;a href="https://antoinesir.rbind.io/post/fonctionnement-de-across-dans-dplyr/" target="_blank"&gt;la premiÃ¨re version de cet article&lt;/a&gt;. Sur ce mÃªme modÃ¨le, on va comparer les instructions &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_at&lt;/code&gt; d'un summarise groupÃ© avec leurs Ã©quivalents dans &lt;code&gt;across()&lt;/code&gt; pour diffÃ©rentes tailles d'Ã©chantillons et de groupes.   &lt;/p&gt;
&lt;h2 id="instructions-sur-lesquelles-on-compare-les-methodes"&gt;Instructions sur lesquelles on compare les mÃ©thodes&lt;/h2&gt;
&lt;p&gt;On crÃ©e un tibble comportant 4 variables numÃ©riques et une variable facteur, et on va comparer la vitesse d'exÃ©cution des moyennes de ces variables numÃ©riques groupÃ©es par modalitÃ© de la variable facteur en faisant varier le nombre de lignes du tibble et le nombre de groupes (de modalitÃ©s distinctes de la variable facteur). Le tibble est crÃ©Ã© par exemple ainsi, pour 100 lignes et deux groupes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;
&lt;span class="n"&gt;nbgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nf"&gt;as_tibble&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;x3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;runif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;runif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;sample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbgpe&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;                               &lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;arrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;round&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 100 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##       x1    x2    x3    x4 y    &lt;/span&gt;
&lt;span class="c1"&gt;##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##  1 -3.36  0.9   0.32  0.36 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  2 -3.04  0.92  0.61  0.46 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  3 -2.4   1.37  0.32  0.98 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  4 -2.08  1.64  0.87  0.72 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  5 -2.05  1.22  0.62  0.79 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  6 -1.78 -1.28  0.58  0.31 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  7 -1.56  1.19  0.96  0.58 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  8 -1.55 -1.18  0.4   0.85 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  9 -1.47  1.77  0.71  0.21 2    &lt;/span&gt;
&lt;span class="c1"&gt;## 10 -1.29 -0.6   0.68  0.4  2    &lt;/span&gt;
&lt;span class="c1"&gt;## # â€¦ with 90 more rows&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Sur chaque tibble (chaque combinaison du nombre de lignes et de groupes), les diffÃ©rentes instructions testÃ©es sont les suivantes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# summarise_if  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="c1"&gt;# across + where()  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;

&lt;span class="c1"&gt;# summarise_at  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="c1"&gt;# across + starts_with()  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Toutes les instructions font la mÃªme chose : une moyenne groupÃ©e par &lt;code&gt;y&lt;/code&gt; des 4 variables numÃ©riques. L'idÃ©e est de vÃ©rifier que l'option &lt;code&gt;across&lt;/code&gt; n'est pas plus lente que les options &lt;code&gt;summarise_if&lt;/code&gt; et &lt;code&gt;summarise_at&lt;/code&gt;. &lt;/p&gt;
&lt;h2 id="resultats-de-la-version-106"&gt;RÃ©sultats de la version 1.0.6&lt;/h2&gt;
&lt;p&gt;Les rÃ©sultats du &lt;code&gt;microbenchmark()&lt;/code&gt; pour les diffÃ©rentes combinaisons de nombres de groupes et de lignes sont prÃ©sentÃ©s dans un graphique qui reprÃ©sente la distribution du temps dâ€™exÃ©cution des 10 occurences testÃ©es pour chaque mÃ©thode :     &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/across_files/unnamed-chunk-10-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Sur nos exemples, il semblerait qu'&lt;code&gt;across&lt;/code&gt; ait complÃ¨tement rattrapÃ© son retard sur ses Ã©quivalents &lt;code&gt;_at&lt;/code&gt; et &lt;code&gt;_if&lt;/code&gt;. Il semble mÃªme lÃ©gÃ¨rement plus performant dans certains cas de figure.  &lt;/p&gt;
&lt;h2 id="resultats-de-la-version-100"&gt;RÃ©sultats de la version 1.0.0&lt;/h2&gt;
&lt;p&gt;Pour illustrer le chemin parcouru, on peut refaire tourner cette mÃªme comparaison avec la version &lt;code&gt;1.0.0&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/across_files/unnamed-chunk-11-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate bien que dans sa premiÃ¨re version, &lt;code&gt;across&lt;/code&gt; connaissait de bien moins bonnes performances, en particulier sur les dataframes avec beaucoup de lignes et/ou beaucoup de groupes. Les mises Ã  jour successives ont donc bien permis de combler ces problÃ¨mes de performance et c'est une excellente nouvelle car au niveau de la syntaxe, nous, on adore!  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui ! Comme d'habitude vous pouvez retrouver le fichier Rmarkdown ayant servi Ã  gÃ©nÃ©rer cette note sur le &lt;a href="https://github.com/Statoscop/notebooks-blog" target="_blank"&gt;github de Statoscop&lt;/a&gt;.&lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="dplyr"></category><category term="across"></category><category term="tidyverse"></category></entry><entry><title>Comparaisons base R, dplyr et data.table</title><link href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html" rel="alternate"></link><published>2021-03-30T00:00:00+02:00</published><updated>2021-03-30T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-03-30:/comparaisons-base-dplyr-datatable.html</id><summary type="html">&lt;p&gt;Comparaisons des temps d'exÃ©cution de base R, dplyr et data.table sur quelques cas d'Ã©tude&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des matiÃ¨res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#rappels-sur-dplyr-et-datatable"&gt;Rappels sur dplyr et data.table&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#dplyr-et-le-tidyverse"&gt;dplyr et le tidyverse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datatable"&gt;Data.table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vitesses-dexecution"&gt;Vitesses d'exÃ©cution&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#comparaisons-sur-une-etude-de-cas-simple"&gt;Comparaisons sur une Ã©tude de cas simple&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#notre-etude-de-cas"&gt;Notre Ã©tude de cas&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#moyenne-des-retards-et-fusion-des-tables"&gt;Moyenne des retards et fusion des tables&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#comparaisons-des-vitesses-dexecution"&gt;Comparaisons des vitesses d'exÃ©cution&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Cet article est une mise Ã  jour de l'article du &lt;a href="https://antoinesir.rbind.io/post/comparaisons-base-r-dplyr-data-table/" target="_blank"&gt;blog d'Antoine&lt;/a&gt; rÃ©alisÃ© en 2018. L'idÃ©e est de comparer les performances de trois alternatives dans R pour l'analyse de donnÃ©es : &lt;br&gt;
- l'utilisation des seules fonctions de base R&lt;br&gt;
- dplyr&lt;br&gt;
- data.table  &lt;/p&gt;
&lt;h1 id="rappels-sur-dplyr-et-datatable"&gt;Rappels sur dplyr et data.table&lt;/h1&gt;
&lt;p&gt;On rappelle ici les principales caractÃ©ristiques de ces packages mais pour se former Ã  leur utilisation on peut se rÃ©fÃ©rer au &lt;a href="https://teaching.slmc.fr/perf/presentation_handout.pdf" target="_blank"&gt;cours de perfectionnement de Martin Chevalier&lt;/a&gt;. Pour une exploration de ce qu'englobe le &lt;code&gt;tidyverse&lt;/code&gt; et notamment une prÃ©sentation des commandes de &lt;code&gt;dplyr&lt;/code&gt;, vous pouvez jeter un oeil Ã  &lt;a href="https://juba.github.io/tidyverse/index.html" target="_blank"&gt;l'introduction Ã  R et au tidyverse&lt;/a&gt; de J. Barnier. Enfin pour data.table, on trouve des informations utiles sur le cours &lt;a href="http://larmarange.github.io/analyse-R/manipulations-avancees-avec-data-table.html" target="_blank"&gt;Manipulations avancÃ©e avec data.table&lt;/a&gt; de J. Larmarange et on vous conseille l'excellent article &lt;a href="https://atrebas.github.io/post/2020-06-17-datatable-introduction/" target="_blank"&gt;a gentle introduction to data.table&lt;/a&gt;.  &lt;/p&gt;
&lt;h2 id="dplyr-et-le-tidyverse"&gt;dplyr et le tidyverse&lt;/h2&gt;
&lt;p&gt;Le &lt;code&gt;tidyverse&lt;/code&gt; (contraction de "tidy" et "universe") est un concept initiÃ© par Hadley Wickham, chef statisticien de RStudio. Il regroupe un ensemble de packages utiles au traitement statistique et au nettoyage de bases de donnÃ©es. On va s'intÃ©resser ici presque seulement au package &lt;code&gt;dplyr&lt;/code&gt; (dont les instructions seront appliquÃ©es aux &lt;code&gt;tibbles&lt;/code&gt;, un format de data.frame issu du &lt;code&gt;tidyverse&lt;/code&gt;), mais vous pouvez parcourir les packages proposÃ©s dans le tidyverse sur &lt;a href="https://www.tidyverse.org/" target="_blank"&gt;le site officiel&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;dplyr&lt;/code&gt; propose un ensemble d'opÃ©rations de traitement de donnÃ©es sous une syntaxe diffÃ©rente de celle utilisÃ©e dans les fonctions de base de R. Ce langage prÃ©sente le double avantage d'Ãªtre Ã  la fois lisible pour quelqu'un habituÃ© aux langages tels que SAS ou SQL et de proposer des fonctions optimisÃ©es qui prÃ©sentent de bonnes performances en termes de temps d'exÃ©cution. La grammaire &lt;code&gt;dplyr&lt;/code&gt; s'appuie en effet sur des fonctions au nom explicite :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mutate(data, newvar1=fonction(var1,var2...))&lt;/code&gt; et &lt;code&gt;transmute(data, newvar1=fonction(var1,var2...))&lt;/code&gt; crÃ©ent de nouvelles variables&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter(data, condition)&lt;/code&gt; sÃ©lectionne au sein d'une table certaines observations, Ã  la maniÃ¨re de &lt;code&gt;where&lt;/code&gt; dans SAS.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;arrange(data, var1, descending var2,...)&lt;/code&gt; trie une base selon une ou plusieurs variables (l'Ã©quivalent d'une &lt;code&gt;proc sort&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;select(data, var1 : varX)&lt;/code&gt; sÃ©lectionne certaines variables dans une base, Ã  la maniÃ¨re de &lt;code&gt;keep&lt;/code&gt; dans SAS. &lt;/li&gt;
&lt;li&gt;&lt;code&gt;summarise(data, newvar1=mean(var1), newvar2=sum(var2))&lt;/code&gt; rÃ©alise toute sorte d'opÃ©rations statistiques sur une table.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;group_by(data, var)&lt;/code&gt; regroupe une table par une variable&lt;/li&gt;
&lt;li&gt;et bien d'autres...  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Un aspect pratique de ce langage est que toutes ces opÃ©rations peuvent Ãªtre chaÃ®nÃ©es Ã  l'aide de l'opÃ©rateur &lt;code&gt;%&amp;gt;%&lt;/code&gt; ("pipe" en anglais, issu du package &lt;code&gt;magrittr&lt;/code&gt;) dont la syntaxe est la suivante : &lt;code&gt;data %&amp;gt;% fonction(...)&lt;/code&gt; est Ã©quivalent Ã  &lt;code&gt;fonction(data, ...)&lt;/code&gt;. Cette syntaxe permet de chaÃ®ner un grand nombre d'opÃ©rations sur une base commune, en limitant le nombre de fois oÃ¹ l'on Ã©crit des tables intermÃ©diaires tout en conservant une grande lisibilitÃ© du code. Ce petit exemple vous en convaincra peut-Ãªtre :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# on crÃ©e un data frame avec 100 lignes, &lt;/span&gt;
&lt;span class="c1"&gt;# chaque individu appartenant Ã  un des 50 groupes&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;50&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on y applique les instructions de dplyr&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as_tibble&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_tibble&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Un regard peu habituÃ© contesterait peut-Ãªtre l'aspect trÃ¨s lisible de l'instruction, mais Ã§a l'est rÃ©ellement. Le dÃ©roulÃ© est le suivant :  &lt;/p&gt;
&lt;p&gt;1) on transforme notre data.frame en tibble (pour rappel : format optimisÃ© de data.frame pour dplyr) avec &lt;code&gt;as_tibble&lt;/code&gt;&lt;br&gt;
2) on crÃ©e une variable &lt;code&gt;var&lt;/code&gt; avec &lt;code&gt;mutate&lt;/code&gt;&lt;br&gt;
3) on agrÃ¨ge par  &lt;code&gt;idgpe&lt;/code&gt; avec &lt;code&gt;group_by&lt;/code&gt; &lt;br&gt;
4) on calcule la moyenne de &lt;code&gt;var&lt;/code&gt; avec &lt;code&gt;summarise&lt;/code&gt;, que l'on stocke dans &lt;code&gt;var_mean&lt;/code&gt;. Comme cette instruction suit un group_by, elle est rÃ©alisÃ©e Ã  l'intÃ©rieur de chaque groupe (dÃ©fini par &lt;code&gt;idgpe&lt;/code&gt;), sinon elle aurait Ã©tÃ© rÃ©alisÃ© sur l'ensemble de la table.    &lt;/p&gt;
&lt;p&gt;Tout cela est stockÃ© dans une table output_tibble, qui est ainsi un tibble agrÃ©gÃ© par &lt;code&gt;idgpe&lt;/code&gt; et qui a donc 50 lignes. L'intÃ©rÃªt de ce chaÃ®nage est qu'il permet une Ã©conomie de code et d'Ã©criture d'Ã©ventuelles tables intermÃ©diaires.  &lt;/p&gt;
&lt;h2 id="datatable"&gt;Data.table&lt;/h2&gt;
&lt;p&gt;Le package &lt;code&gt;data.table&lt;/code&gt; ne prÃ©tend pas, contrairement au &lt;code&gt;tidyverse&lt;/code&gt;, proposer une syntaxe concurrente Ã  base R mais enrichir celle-ci. Il est axÃ© autour d'un nouveau format d'objet, le data.table, qui est un type de data.frame qui permet une utilisation optimisÃ©e de l'opÃ©rateur &lt;code&gt;[&lt;/code&gt;.&lt;br&gt;
Tout data.frame peut Ãªtre converti en data.table grÃ¢ce Ã  la fonction &lt;code&gt;as.data.table&lt;/code&gt;, ou, de maniÃ¨re plus optimale pour l'utilisation de la mÃ©moire, grÃ¢ce Ã  la fonction &lt;code&gt;setDT&lt;/code&gt; qui permet de directement transformer la nature de l'objet sans avoir Ã  en Ã©crire un autre. Il est important d'avoir en tÃªte qu'un data.frame converti en data.table conserve les caractÃ©ristiques d'un data.frame. Cependant, l'opÃ©rateur &lt;code&gt;[&lt;/code&gt; appliquÃ© au data.table change de signification et devient :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;DT&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Avec &lt;code&gt;i&lt;/code&gt; qui permet de sÃ©lectionner des observations (sans avoir besoin de rÃ©pÃ©ter le nom de la base dans laquelle on se trouve), &lt;code&gt;j&lt;/code&gt; qui permet de crÃ©er ou sÃ©lectionner des variables et &lt;code&gt;by&lt;/code&gt; de regrouper les traitement selon les modalitÃ©s d'une variable dÃ©finie. Comme dans &lt;code&gt;dplyr&lt;/code&gt;, il est possible de chaÃ®ner les opÃ©rations rÃ©alisÃ©es comme le montre l'exemple suivant, qui reprend le mÃªme cas de figure que celui illustrant le package &lt;code&gt;dplyr&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;# on convertit notre data frame prÃ©cÃ©demment crÃ©Ã© en data.table&lt;/span&gt;
&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on y applique les mÃªme instructions&lt;/span&gt;
&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_dt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le fait de renseigner les variables au sein de &lt;code&gt;list()&lt;/code&gt; permet d'avoir une table en sortie au niveau de &lt;code&gt;idgpe&lt;/code&gt; (donc 50 observations), sans cela la variable est bien moyennÃ©e par groupe mais la table en sortie est toujours au niveau &lt;code&gt;id1&lt;/code&gt; (100 observations).   &lt;/p&gt;
&lt;h2 id="vitesses-dexecution"&gt;Vitesses d'exÃ©cution&lt;/h2&gt;
&lt;p&gt;VoilÃ  donc pour les prÃ©sentations! Allez, on montre le rÃ©sultat d'un petit &lt;code&gt;microbenchmark&lt;/code&gt; des deux juste pour voir : &lt;/p&gt;
&lt;table class="dataframe"&gt;
&lt;caption&gt;Temps d'exÃ©cution en microsecondes&lt;/caption&gt;
&lt;thead&gt;
    &lt;tr&gt;&lt;th scope=col&gt;expr&lt;/th&gt;&lt;th scope=col&gt;lq&lt;/th&gt;&lt;th scope=col&gt;mean&lt;/th&gt;&lt;th scope=col&gt;uq&lt;/th&gt;&lt;th scope=col&gt;neval&lt;/th&gt;&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;dplyr     &lt;/td&gt;&lt;td&gt;9.79270&lt;/td&gt;&lt;td&gt;13.23297&lt;/td&gt;&lt;td&gt;14.367579&lt;/td&gt;&lt;td&gt;100&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;data.table&lt;/td&gt;&lt;td&gt;1.40644&lt;/td&gt;&lt;td&gt; 2.13729&lt;/td&gt;&lt;td&gt; 2.546176&lt;/td&gt;&lt;td&gt;100&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Sur cet exemple, on voit un avantage clair Ã  data.table! Mais on est sur une toute petite table en entrÃ©e. On va essayer de se rapprocher de cas plus concrets en s'intÃ©ressant Ã  un exemple sur des bases plus importantes.  &lt;/p&gt;
&lt;h1 id="comparaisons-sur-une-etude-de-cas-simple"&gt;Comparaisons sur une Ã©tude de cas simple&lt;/h1&gt;
&lt;p&gt;Les avantages et inconvÃ©nients de ces deux packages sont Ã  l'origine de nombreux dÃ©bats. Vous pouvez vous en convaincre en suivant &lt;a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly" target="_blank"&gt;cette discussion sur stackoverflow&lt;/a&gt;. On peut quand mÃªme dÃ©gager deux compromis :   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Le choix de l'un ou l'autre des packages dÃ©pend beaucoup de ce que l'on va en faire (types d'analyses, taille des donnÃ©es, profils des utilisateurs du code...).   &lt;/li&gt;
&lt;li&gt;Les deux packages sont plus intÃ©ressants que base R pour l'analyse de donnÃ©es, que ce soit en termes de facilitÃ© d'Ã©criture ou de performances.   &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour ce deuxiÃ¨me point, on va essayer de s'en convaincre ensemble avec ce petit exemple.&lt;/p&gt;
&lt;h2 id="notre-etude-de-cas"&gt;Notre Ã©tude de cas&lt;/h2&gt;
&lt;p&gt;Pour cet exemple, on utilise les donnÃ©es du package de Hadley Wickham que l'on trouve dans &lt;code&gt;nycflights13&lt;/code&gt;. En particulier, la base &lt;code&gt;flights&lt;/code&gt; donne toutes les heures de dÃ©part et d'arrivÃ©e selon les aÃ©roports de dÃ©part et d'arrivÃ©e ainsi que les retards au dÃ©part et Ã  l'arrivÃ©e. La base &lt;code&gt;weather&lt;/code&gt; donne elle des indications mÃ©tÃ©o, heure par heure, dans chaque aÃ©roport. &lt;br&gt;
CommenÃ§ons par charger nos packages (n'oubliez pas de faire &lt;code&gt;install.packages("nom_pck")&lt;/code&gt; avant si vous ne l'avez jamais fait) et nos donnÃ©es : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Les packages nÃ©cessaires&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tidyverse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Regroupe diffÃ©rents packages, voir https://www.tidyverse.org/ &lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;microbenchmark&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Pour les calculs de vitesse d&amp;#39;exÃ©cution&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nycflights13&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Pour les donnÃ©es&lt;/span&gt;

&lt;span class="c1"&gt;# data.table pour tests avec data.table&lt;/span&gt;
&lt;span class="n"&gt;flightsdt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;weatherdt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="moyenne-des-retards-et-fusion-des-tables"&gt;Moyenne des retards et fusion des tables&lt;/h2&gt;
&lt;p&gt;Un rapide examen des bases vous montre que la premiÃ¨re Ã©tape avant toute analyse est comme souvent de regrouper les Ã©lÃ©ments de flights par heure et aÃ©roport de dÃ©part pour pouvoir les fusionner avec la table weather, qui donnent les indications mÃ©tÃ©o minute par minute. On Ã©crit cette instruction de  3 maniÃ¨res diffÃ©rentes :  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;En base R&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;flights_time_hour&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aggregate.data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;output_base&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights_time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;En dplyr&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ungroup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;inner_join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_dplyr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;En data.table&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;output_DT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flightsdt&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_perc_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                                    &lt;/span&gt;&lt;span class="n"&gt;dep_perc_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                             &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="n"&gt;weatherdt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On utilise la fonction &lt;code&gt;merge&lt;/code&gt; plutÃ´t que &lt;code&gt;DT1[DT2, on = c("time_hour", "origin"), nomatch = 0]&lt;/code&gt; car on a constatÃ© qu'elle Ã©tait plus rapide, conformÃ©ment Ã  ce que montre bien cet &lt;a href="https://jozefhajnala.gitlab.io/r/r006-merge/" target="_blank"&gt;article du Jozef's Rblog&lt;/a&gt;.  &lt;/p&gt;
&lt;h2 id="comparaisons-des-vitesses-dexecution"&gt;Comparaisons des vitesses d'exÃ©cution&lt;/h2&gt;
&lt;p&gt;Chacun jugera de la lisibilitÃ© de chacune de ces instructions, qui font toutes la mÃªme chose, car c'est finalement assez subjectif. On donne ici les rÃ©sultats d'un &lt;code&gt;microbenchmark&lt;/code&gt; de ces instructions : &lt;/p&gt;
&lt;table class="dataframe"&gt;
&lt;caption&gt;Temps d'exÃ©cution en millisecondes&lt;/caption&gt;
&lt;thead&gt;
    &lt;tr&gt;&lt;th scope=col&gt;expr&lt;/th&gt;&lt;th scope=col&gt;lq&lt;/th&gt;&lt;th scope=col&gt;mean&lt;/th&gt;&lt;th scope=col&gt;uq&lt;/th&gt;&lt;th scope=col&gt;neval&lt;/th&gt;&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;Base &lt;/td&gt;&lt;td&gt;1182.33161&lt;/td&gt;&lt;td&gt;1396.52780&lt;/td&gt;&lt;td&gt;1559.42968&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;dplyr&lt;/td&gt;&lt;td&gt; 223.45642&lt;/td&gt;&lt;td&gt; 313.16457&lt;/td&gt;&lt;td&gt; 360.95388&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;DT   &lt;/td&gt;&lt;td&gt;  22.83487&lt;/td&gt;&lt;td&gt;  24.68264&lt;/td&gt;&lt;td&gt;  26.32068&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Les rÃ©sultats sont trÃ¨s nettement en faveur des packages &lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt;. Ce dernier est mÃªme assez largement le plus rapide, son avantage s'Ã©tant accru depuis la premiÃ¨re version de cette article. Sans doute existe-t-il des moyens de plus optimiser l'instruction en base R, mais lÃ  n'est pas vraiment la question. On voit qu'avec une syntaxe simple et lisible, &lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt; font beaucoup mieux en termes de vitesse d'exÃ©cution que les fonctions de base R. &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="dplyr"></category><category term="data.table"></category><category term="benchmark"></category></entry></feed>