<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Le blog - R</title><link href="https://blog.statoscop.fr/" rel="alternate"></link><link href="https://blog.statoscop.fr/feeds/r.atom.xml" rel="self"></link><id>https://blog.statoscop.fr/</id><updated>2025-04-28T00:00:00+02:00</updated><entry><title>Graphiques et diagrammes √† barres empil√©es : pr√©sentation d'une alternative avec R et ggplot2</title><link href="https://blog.statoscop.fr/graphiques-et-diagrammes-a-barres-empilees-presentation-dune-alternative-avec-r-et-ggplot2.html" rel="alternate"></link><published>2025-04-28T00:00:00+02:00</published><updated>2025-04-28T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-04-28:/graphiques-et-diagrammes-a-barres-empilees-presentation-dune-alternative-avec-r-et-ggplot2.html</id><summary type="html">&lt;p&gt;Une alternative pour visualiser des sous-ensembles et leur total sans les empiler&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#dechiffrer-un-diagramme-a-barres-empilees"&gt;D√©chiffrer un diagramme √† barres empil√©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#segmenter-plutot-quempiler-vos-barres-avec-ggplot2"&gt;Segmenter plut√¥t qu'empiler vos barres avec ggplot2&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#visualiser-levolution-de-la-pauvrete-dans-le-monde-par-regions"&gt;Visualiser l'√©volution de la pauvret√© dans le monde par r√©gions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#le-graphique-a-barres-segmentees-avec-total"&gt;Le graphique √† barres segment√©es avec total&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#choisir-le-graphique-adapte-a-son-probleme"&gt;Choisir le graphique adapt√© √† son probl√®me&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Aujourd'hui nous vous proposons un petit article dataviz avec ggplot2 pour apporter notre modeste contribution √† des discussions vues ici et l√† sur &lt;strong&gt;la pertinence des graphiques √† barres empil√©es&lt;/strong&gt;, en anglais &lt;strong&gt;stacked bar charts&lt;/strong&gt;. Plus sp√©cifiquement, on se propose de coder en ggplot2 une visualisation vue sur &lt;a href="https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html"&gt;un article pr√©sentant la meilleur alternative aux graphiques empil√©es&lt;/a&gt; (selon son auteur).  &lt;/p&gt;
&lt;h1 id="dechiffrer-un-diagramme-a-barres-empilees"&gt;D√©chiffrer un diagramme √† barres empil√©es&lt;/h1&gt;
&lt;p&gt;Un graphique √† barres empil√©es permet &lt;strong&gt;d'illustrer l'√©volution ou la comparaison d'une mesure globale, tout en la d√©clinant par des sous-ensembles&lt;/strong&gt;. Par exemple, on peut utiliser la base &lt;code&gt;diamonds&lt;/code&gt; de ggplot2 pour pr√©senter la puret√© de la coupe des diamants (variable &lt;code&gt;clarity&lt;/code&gt;) en fonction de la qualit√© de leur taille (variable &lt;code&gt;cut&lt;/code&gt;) : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggplot2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;diamonds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cut&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clarity&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# par d√©faut, geom_bar s&amp;#39;ex√©cute avec position = &amp;quot;stack&amp;quot; :&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_bar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Que nous indique ce graphique? Pas grand chose en r√©alit√©, si √ßa n'est que notre base contient d'autant plus de diamants que la qualit√© de leur taille est bonne. Mais pour d√©duire la m√™me chose de chaque niveau de puret√© de diamants, il faut se livrer √† un exercice de concentration intense que ne devrait pas n√©cessiter une bonne visualisation. √Ä part pour le niveau &lt;code&gt;IF&lt;/code&gt;, le plus pur, dont ont voit clairement que le nombre augmente avec la qualit√© de la taille, &lt;strong&gt;il est difficile d'√©valuer l'augmentation relative de chaque sous-ensemble, d'autant plus que les effectifs totaux diff√®rent&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;Bien s√ªr, on peut d√©cider de changer l√©g√®rement le type de notre graphique et de repr√©senter plut√¥t la r√©partition relative du niveau de puret√© des diamants &lt;strong&gt;pour chaque qualit√© de taille&lt;/strong&gt;, en sp√©cifiant le param√®tre &lt;code&gt;position&lt;/code&gt; de geom_bar √† &lt;code&gt;fill&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;diamonds&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cut&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;clarity&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_bar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-3-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;√Ä part pour les niveaux extr√™mes de puret√© (&lt;code&gt;I1&lt;/code&gt; et &lt;code&gt;IF&lt;/code&gt;), l'√©volution de la r√©partition pour chaque cat√©gorie de diamants demeure assez obscur, et on a en plus perdu l'information sur le nombre de diamants totaux que chaque cat√©gorie repr√©sente!&lt;br&gt;
Ce probl√®me, soulev√© par nombre de sp√©cialistes de la dataviz, et notamment &lt;a href="https://www.data-to-viz.com/caveat/stacking.html"&gt;Yan Holtz dans un article r√©cent&lt;/a&gt;, a pouss√© certains √† chercher des alternatives. L'id√©e est de pouvoir &lt;strong&gt;pr√©senter clairement √† la fois l'√©volution d'un total et de ses sous-ensembles&lt;/strong&gt;. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="segmenter-plutot-quempiler-vos-barres-avec-ggplot2"&gt;Segmenter plut√¥t qu'empiler vos barres avec ggplot2&lt;/h1&gt;
&lt;p&gt;Nous proposons ici &lt;a href="https://www.flerlagetwins.com/2025/04/the-best-alternative-to-stacked-bar.html"&gt;d'appliquer la m√©thode pr√©sent√©e par Kevin Flerlage&lt;/a&gt;. La solution qu'il propose avec l'outil Tableau nous semble √©l√©gante et &lt;strong&gt;nous montrons ici comment la mettre en oeuvre avec&lt;/strong&gt; &lt;code&gt;ggplot2&lt;/code&gt;.  &lt;/p&gt;
&lt;h2 id="visualiser-levolution-de-la-pauvrete-dans-le-monde-par-regions"&gt;Visualiser l'√©volution de la pauvret√© dans le monde par r√©gions&lt;/h2&gt;
&lt;p&gt;On s'appuie ici sur des donn√©es de &lt;a href="https://ourworldindata.org"&gt;World In Data&lt;/a&gt; en 2010, 2016, 2020 et 2024. On choisit de regarder l'√©volution du nombre de personnes sous le seuil de 2.15$ par jour, d√©clin√©e par grande r√©gion du monde.  &lt;/p&gt;
&lt;p&gt;Avec &lt;code&gt;ggplot2&lt;/code&gt; et &lt;code&gt;geom_col&lt;/code&gt;, on peut facilement proposer une repr√©sentation avec un graphique √† barres empil√©es :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scales&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# pour scale du y-axis&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggtext&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# pour mise en forme du titre&lt;/span&gt;

&lt;span class="n"&gt;data_wid_country&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Region&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;label_number&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1e-6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;suffix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;M&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The evolution of poverty in the World&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;caption&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source : World Bank (2024) ‚Äì processed by Our World in Data (https://ourworldindata.org)&lt;/span&gt;
&lt;span class="s"&gt;       This data is adjusted for inflation and for differences in living costs between countries.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plot.title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_markdown&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                      &lt;/span&gt;&lt;span class="n"&gt;hjust&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;legend.position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bottom&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-4-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ce graphique nous permet de voir une baisse du nombre de personnes pauvres entre 2010 et 2016 puis une stagnation de cet indicateur entre 2016 et 2024. Il &lt;strong&gt;ne nous permet cependant pas d'√©valuer pr√©cis√©ment l'√©volution au sein de chaque r√©gion du monde&lt;/strong&gt;. &lt;/p&gt;
&lt;h2 id="le-graphique-a-barres-segmentees-avec-total"&gt;Le graphique √† barres segment√©es avec total&lt;/h2&gt;
&lt;p&gt;Nous traduisons ici le terme propos√© par Kevin Flerlage. L'id√©e est la suivante : on va juxtaposer plut√¥t qu'empiler les diff√©rents sous-ensembles. On va pour cela utiliser le param√®tre &lt;code&gt;position = "dodge"&lt;/code&gt; de &lt;code&gt;geom_col&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;Le probl√®me √† ce stade est bien s√ªr &lt;strong&gt;qu'on ne dispose plus d'estimation du total&lt;/strong&gt;. Il s'agit donc d'ajouter &lt;strong&gt;une barre totale qui englobe les barres des sous-ensembles&lt;/strong&gt;, avec une transparence pour permettre une bonne visibilit√©. C'est un jeu d'enfant avec &lt;code&gt;ggplot2&lt;/code&gt; puisqu'il s'agit simplement d'ajouter un &lt;code&gt;geom_col&lt;/code&gt; et de lui choisir une couleur avec &lt;code&gt;fill&lt;/code&gt; et un niveau de transparence avec &lt;code&gt;alpha&lt;/code&gt;.  &lt;/p&gt;
&lt;p&gt;Si on consid√®re qu'il n'est pas assez explicite que la barre ajout√©e correspond au total, on peut s'en sortir en ajoutant dans le titre la m√™me couleur que celle de la barre transparente. Le r√©sultat est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;data_wid_country&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Region&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="c1"&gt;# changement de la position&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;dodge&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# ajout d&amp;#39;un geom_col&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;Year&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;`Number below $2.15 a day`&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;alpha&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fill&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;#C77CFF&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;label_number&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1e-6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;suffix&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;M&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The evolution of poverty &amp;lt;span style=&amp;#39;color:#C77CFF;&amp;#39;&amp;gt;in the World&amp;lt;/span&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;caption&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source : World Bank (2024) ‚Äì processed by Our World in Data (https://ourworldindata.org)&lt;/span&gt;
&lt;span class="s"&gt;       This data is adjusted for inflation and for differences in living costs between countries.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme_minimal&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;plot.title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_markdown&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                      &lt;/span&gt;&lt;span class="n"&gt;hjust&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;legend.position&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bottom&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-5-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate en effet que la lecture nous semble plus explicite : au niveau mondial sur notre p√©riode de temps, le nombre de pauvres a baiss√©. Cela se traduit cependant par deux trajectoires diff√©rentes : une baisse tr√®s marqu√©e dans la r√©gion Asie-Pacifique et un hausse en Afrique.&lt;/p&gt;
&lt;h1 id="choisir-le-graphique-adapte-a-son-probleme"&gt;Choisir le graphique adapt√© √† son probl√®me&lt;/h1&gt;
&lt;p&gt;Cette proposition d'alternatives aux graphiques √† barres empil√©es nous semble int√©ressante, notamment dans ce cas sp√©cifique ou &lt;strong&gt;le total repr√©sente la somme de ses sous-ensembles&lt;/strong&gt;. Dans le cas o√π on voudrait par exemple &lt;strong&gt;repr√©senter une moyenne totale et la comparer √† des moyennes de sous-ensembles&lt;/strong&gt;, on pr√©coniserait sans doute de pr√©senter celle-ci avec une forme diff√©rente, comme un point ou un losange. Le code pr√©sent√© ci-dessus peut-√™tre utilis√© de la m√™me mani√®re en changeant le &lt;code&gt;geom_col&lt;/code&gt; par ce qui vous semble appropri√©.  &lt;/p&gt;
&lt;p&gt;Enfin, lorsque votre probl√©matique contient de nombreux sous-ensembles, &lt;strong&gt;ce choix n'est probablement pas adapt√© car le total peut avoir une √©chelle trop diff√©rente de chacun des sous-ensembles&lt;/strong&gt;. C'est le cas par exemple pour la probl√©matique des diamants que je pr√©sentais en d√©but de post, et pour laquelle le graphique √† barres segment√©es n'aurait pas donn√© un r√©sultat satisfaisant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/graph_bar_empilees/unnamed-chunk-6-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Pour autant, &lt;strong&gt;on ne vous recommande pas non plus de faire un graphique avec deux axes verticaux&lt;/strong&gt;. Cela pourra faire l'objet d'une prochaine note de blog! &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! On esp√®re que cette note vous d√©bloquera dans le choix de votre prochaine repr√©sentation graphique. Si vous avez besoin de &lt;a href="https://statoscop.fr"&gt;conseils en programmation pour la statistique et la data science&lt;/a&gt;, n'h√©sitez pas √† nous contacter sur notre site, &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; ou &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;.&lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="ggplot2"></category><category term="dataviz"></category></entry><entry><title>if_any et if_all : appliquer la m√™me condition sur plusieurs variables dans dplyr</title><link href="https://blog.statoscop.fr/if_any-et-if_all-appliquer-la-meme-condition-sur-plusieurs-variables-dans-dplyr.html" rel="alternate"></link><published>2025-04-03T00:00:00+02:00</published><updated>2025-04-03T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-04-03:/if_any-et-if_all-appliquer-la-meme-condition-sur-plusieurs-variables-dans-dplyr.html</id><summary type="html">&lt;p&gt;Quelques exemples d'utilisation de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; dans le traitement de vos donn√©es avec R.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#syntaxe-de-if_any-et-if_all"&gt;Syntaxe de if_any et if_all&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#filtrer-un-dataframe-avec-if_any-et-if_all"&gt;Filtrer un dataframe avec if_any et if_all&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#reperer-des-valeurs-en-particulier-avec-if_any"&gt;Rep√©rer des valeurs en particulier avec if_any&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#reperer-les-tres-bons-ou-les-tres-mauvais-resultats-avec-if_all"&gt;Rep√©rer les tr√®s bons (ou les tr√®s mauvais) r√©sultats avec if_all&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#creer-une-variable-synthetique-avec-if_any-et-if_all-dans-case_when"&gt;Cr√©er une variable synth√©tique avec if_any et if_all dans case_when&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Au d√©but de l'ann√©e 2021, &lt;a href="https://www.tidyverse.org/blog/2021/02/dplyr-1-0-4-if-any/"&gt;la sortie de dplyr 1.0.4&lt;/a&gt; consacre l'arriv√©e de deux petits nouveaux : &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;. Ces deux fonctions viennent notamment &lt;strong&gt;compl√©ter le verbe &lt;code&gt;across&lt;/code&gt;&lt;/strong&gt;, qui avait √©t√© introduit quelques mois plus t√¥t dans dplyr 1.0.0, et &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;que nous avons d√©j√† pr√©sent√© dans un pr√©c√©dent article&lt;/a&gt;.&lt;br&gt;
Ici nous vous proposons donc un rapide tour des possibilit√©s offertes par ces fonctions. Nous commen√ßons par montrer comment ils peuvent √™tre utilis√©s dans &lt;code&gt;filter()&lt;/code&gt; pour filtrer facilement notre dataframe &lt;strong&gt;en appliquant la m√™me condition √† plusieurs variables&lt;/strong&gt;. Puis nous montrons comment ils peuvent √™tre avantageusement &lt;strong&gt;utilis√©s dans des instructions &lt;code&gt;mutate()&lt;/code&gt; pour synth√©tiser les valeurs de plusieurs variables&lt;/strong&gt;. &lt;/p&gt;
&lt;h1 id="syntaxe-de-if_any-et-if_all"&gt;Syntaxe de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;La syntaxe de ces deux verbes est exactement la m√™me que celle d'&lt;code&gt;across()&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour &lt;code&gt;across&lt;/code&gt;, &lt;strong&gt;le param√®tre &lt;code&gt;.cols&lt;/code&gt; permet de s√©lectionner les variables&lt;/strong&gt; sur lesquelles on souhaite appliquer notre filtre. Pour cela on utilise les m√©thodes du &lt;code&gt;tidyselect&lt;/code&gt; :&lt;br&gt;
- &lt;code&gt;where(fn)&lt;/code&gt; pour s√©lectionner les colonnes sur une condition (&lt;code&gt;where(is.numeric)&lt;/code&gt; par exemple).&lt;br&gt;
- &lt;code&gt;starts_with(match)&lt;/code&gt;, &lt;code&gt;ends_with(match)&lt;/code&gt;, &lt;code&gt;contains(match)&lt;/code&gt;, &lt;code&gt;matches(match)&lt;/code&gt; pour s√©lectionner les variables sur une caract√©ristique de leur nom (&lt;code&gt;starts_with("v_")&lt;/code&gt; par exemple). &lt;br&gt;
- &lt;code&gt;c(var1, var2, var3)&lt;/code&gt;, &lt;code&gt;all_of(c("var1", "var2", "var3"))&lt;/code&gt; ou &lt;code&gt;any_of(c("var1", "var2", "var3"))&lt;/code&gt; pour s√©lectionner directement les variables par leur nom.   &lt;/p&gt;
&lt;p&gt;Le &lt;strong&gt;param√®tre &lt;code&gt;.fns&lt;/code&gt; permet de d√©finir la fonction de filtrage&lt;/strong&gt; sur les variables s√©lectionn√©es. Ce sera soit une fonction d√©j√† existante (&lt;code&gt;is.na&lt;/code&gt; par exemple), soit une fonction d√©finie en par l'utilisateur en amont ou √† la vol√©e (avec la syntaxe &lt;code&gt;~ .x &amp;gt; 50&lt;/code&gt; par exemple).   &lt;/p&gt;
&lt;p&gt;Ces deux fonctions vont &lt;strong&gt;cr√©er en sortie un vecteur bool√©en&lt;/strong&gt; qui va nous permettre de filtrer nos observations de deux fa√ßons :   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;avec &lt;code&gt;if_any&lt;/code&gt; si la condition d√©finie dans &lt;code&gt;.fns&lt;/code&gt; est respect√©e pour au moins une des variables. Cela revient √† &lt;strong&gt;coder la condition pour chaque colonne avec l'op√©rateur &lt;code&gt;|&lt;/code&gt; (&lt;code&gt;OU&lt;/code&gt;).&lt;/strong&gt;   &lt;/li&gt;
&lt;li&gt;avec &lt;code&gt;if_all&lt;/code&gt; si cette condition est respect√©e pour toutes les variables. Cela revient √† &lt;strong&gt;coder la condition pour chaque colonne avec l'op√©rateur &lt;code&gt;&amp;amp;&lt;/code&gt; (&lt;code&gt;ET&lt;/code&gt;).&lt;/strong&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Voyons concr√®tement comment nous pouvons les utiliser dans deux cas distincts : &lt;strong&gt;filtrer notre dataframe&lt;/strong&gt; sur une conditions portant sur plusieurs variables √† la fois et &lt;strong&gt;cr√©er une nouvelle variable en fonction des valeurs de plusieurs autres variables&lt;/strong&gt;.    &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;        &lt;/p&gt;
&lt;h1 id="filtrer-un-dataframe-avec-if_any-et-if_all"&gt;Filtrer un dataframe avec &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;Pour &lt;strong&gt;illustrer l'utilisation de ces deux verbes&lt;/strong&gt;, on s'appuie sur &lt;a href="https://www.kaggle.com/datasets/simranjitkhehra/student-grades-dataset"&gt;des donn√©es Kaggle de notes d'√©tudiants √† diff√©rentes mati√®res&lt;/a&gt;. On a modifi√© ces donn√©es pour avoir &lt;strong&gt;une colonne pour chaque note de chaque mati√®re&lt;/strong&gt;. Notre dataset &lt;code&gt;stud_grades&lt;/code&gt; a maintenant ce format :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; Rows: 10,000
&lt;span class="gu"&gt;##&lt;/span&gt; Columns: 6
&lt;span class="gu"&gt;##&lt;/span&gt; $ student.id         &amp;lt;int&amp;gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, ‚Ä¶
&lt;span class="gu"&gt;##&lt;/span&gt; $ math               &amp;lt;chr&amp;gt; &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;‚Ä¶
&lt;span class="gu"&gt;##&lt;/span&gt; $ science            &amp;lt;chr&amp;gt; &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;‚Ä¶
&lt;span class="gu"&gt;##&lt;/span&gt; $ history            &amp;lt;chr&amp;gt; &amp;quot;A&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;‚Ä¶
&lt;span class="gu"&gt;##&lt;/span&gt; $ english            &amp;lt;chr&amp;gt; &amp;quot;F&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;D&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;‚Ä¶
&lt;span class="gu"&gt;##&lt;/span&gt; $ physical_education &amp;lt;chr&amp;gt; &amp;quot;C&amp;quot;, &amp;quot;A&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;C&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;B&amp;quot;, &amp;quot;F&amp;quot;, &amp;quot;‚Ä¶
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Les notes possibles sont &lt;code&gt;A&lt;/code&gt;, &lt;code&gt;B&lt;/code&gt;, &lt;code&gt;C&lt;/code&gt;, &lt;code&gt;D&lt;/code&gt; et &lt;code&gt;F&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;On pr√©sente plusieurs op√©rations de filtrage qui peuvent √™tre utiles dans notre exploration des donn√©es.  &lt;/p&gt;
&lt;h2 id="reperer-des-valeurs-en-particulier-avec-if_any"&gt;Rep√©rer des valeurs en particulier avec &lt;code&gt;if_any&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;La premi√®re question que l'on peut se poser est de savoir s'il manque des informations dans notre dataset. &lt;code&gt;if_any&lt;/code&gt; va nous permettre de renvoyer les lignes contenant &lt;strong&gt;au moins une valeur manquante&lt;/strong&gt; parmi les variables que l'on s√©lectionne :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;physical_education&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;is.na&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;## # A tibble: 0 √ó 6&lt;/span&gt;
&lt;span class="c1"&gt;## # ‚Ñπ 6 variables: student.id &amp;lt;int&amp;gt;, math &amp;lt;chr&amp;gt;, science &amp;lt;chr&amp;gt;, history &amp;lt;chr&amp;gt;,&lt;/span&gt;
&lt;span class="c1"&gt;## #   english &amp;lt;chr&amp;gt;, physical_education &amp;lt;chr&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit tout de suite que le dataframe ne contient pas de valeurs manquantes, d'une mani√®re plus directe et √©l√©gante que de coder la condition &lt;code&gt;is.na(math) | is.na(science) | is.na(history) | is.na(english) | is.na(physical_education)&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;Dans la m√™me logique on pourrait vouloir identifier &lt;strong&gt;les cas o√π des √©l√®ves ont re√ßu la note "F"&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# On d√©finit ici notre fonction &amp;quot;√† la vol√©e&amp;quot; avec ~ function(.x)&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;physical_education&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on renvoie le nombre d&amp;#39;observations&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## [1] 6749
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On apprend ainsi que 6749 √©l√®ves sur 10 000 ont eu au moins un F √† une des mati√®res!  &lt;/p&gt;
&lt;h2 id="reperer-les-tres-bons-ou-les-tres-mauvais-resultats-avec-if_all"&gt;Rep√©rer les tr√®s bons (ou les tr√®s mauvais) r√©sultats avec &lt;code&gt;if_all&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Avec &lt;code&gt;if_all&lt;/code&gt;, on peut facilement rep√©rer les excellents r√©sultats en filtrant par exemple sur les √©l√®ves &lt;strong&gt;ayant eu des "A" √† toutes les mati√®res&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# notez qu&amp;#39;on s√©lectionne les m√™mes colonnes que pr√©c√©demment&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# avec une m√©thode diff√©rente&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.character&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 2 √ó 6
&lt;span class="gu"&gt;##&lt;/span&gt;   student.id math  science history english physical_education
&lt;span class="gu"&gt;##&lt;/span&gt;        &amp;lt;int&amp;gt; &amp;lt;chr&amp;gt; &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;   &amp;lt;chr&amp;gt;             
&lt;span class="gu"&gt;##&lt;/span&gt; 1       6933 A     A       A       A       A                 
&lt;span class="gu"&gt;##&lt;/span&gt; 2       8749 A     A       A       A       A
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit ainsi directement que seulement deux √©l√®ves ont r√©ussi cet exploit, avec une syntaxe bien plus directe que de coder &lt;code&gt;math == "A" &amp;amp; science == "A" &amp;amp; history == "A" &amp;amp; english == "A" &amp;amp; physical_education == "A"&lt;/code&gt;.    &lt;/p&gt;
&lt;p&gt;On peut bien s√ªr √©galement &lt;strong&gt;rep√©rer les √©l√®ves en difficult√©&lt;/strong&gt;, en regardant ceux qui n'ont eu que des "F" √† toutes les mati√®res.&lt;/p&gt;
&lt;h1 id="creer-une-variable-synthetique-avec-if_any-et-if_all-dans-case_when"&gt;Cr√©er une variable synth√©tique avec &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; dans &lt;code&gt;case_when&lt;/code&gt;&lt;/h1&gt;
&lt;p&gt;On conclut cet article en vous montrant &lt;strong&gt;comment profiter avantageusement de ces verbes dans une instruction &lt;code&gt;mutate()&lt;/code&gt;&lt;/strong&gt;, dans le but par exemple de &lt;strong&gt;cr√©er une variable synth√©thique&lt;/strong&gt; qui prenne en compte l'ensemble de ces notes. Les modalit√©s pourraient √™tre les suivantes :  &lt;/p&gt;
&lt;p&gt;1 - &lt;em&gt;Facilit√©s en sciences et en lettres&lt;/em&gt; (au moins B dans toutes ces mati√®res)&lt;br&gt;
2 - &lt;em&gt;Facilit√©s en sciences, difficult√©s en lettres&lt;/em&gt; (au moins B en maths et science, C ou moins dans une mati√®re litt√©raire)&lt;br&gt;
3 - &lt;em&gt;Facilit√©s en lettres, difficult√©s en sciences&lt;/em&gt; (au moins B en histoire et anglais, C ou moins dans une mati√®re scientifique)&lt;br&gt;
4 - &lt;em&gt;Difficult√©s en lettres et sciences&lt;/em&gt; (jamais mieux que C dans aucune de ces 4 mati√®res) &lt;br&gt;
5 - &lt;em&gt;Difficult√©s surtout en sciences&lt;/em&gt; (jamais mieux que C dans une mati√®re scientifique) &lt;br&gt;
6 - &lt;em&gt;Difficult√©s surtout en lettres&lt;/em&gt; (jamais mieux que C dans une mati√®re litt√©raire) &lt;br&gt;
7 - &lt;em&gt;R√©sultats irr√©guliers&lt;/em&gt; (aucune des conditions pr√©c√©dentes : donc bons r√©sultats dans seulement au moins une des mati√®res scientifiques et litt√©raire)   &lt;/p&gt;
&lt;p&gt;Ces conditions s'√©crivent ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stud_grades&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;lvl_sc_lit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;case_when&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Facilit√©s en sciences et en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Facilit√©s en sciences, difficult√©s en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Facilit√©s en lettres, difficult√©s en sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Difficult√©s en lettres et sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Difficult√©s surtout en sciences&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nf"&gt;if_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;english&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;D&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;F&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nf"&gt;if_any&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;math&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;science&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%in%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;A&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;B&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Difficult√©s surtout en lettres&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;

&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R√©sultats irr√©guliers&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On voit ainsi &lt;strong&gt;qu'on peut combiner des conditions de &lt;code&gt;if_any&lt;/code&gt; et &lt;code&gt;if_all&lt;/code&gt; avec les &lt;code&gt;&amp;amp;&lt;/code&gt; et &lt;code&gt;|&lt;/code&gt;&lt;/strong&gt;, ce qui permet une grande flexibilit√© dans la cr√©ation de nos conditions. On utilise √©galement le param√®tre &lt;code&gt;TRUE&lt;/code&gt; de &lt;code&gt;case_when&lt;/code&gt; pour tous les cas ne tombant dans aucune des conditions que nous avons imagin√©es, c'est √† dire les √©l√®ves n'ayant pas de profil particuli√®rement litt√©raire ou scientifique mais plut√¥t des r√©sultats tr√®s irr√©guliers dans les diff√©rentes mati√®res. Voici comment se r√©partissent nos √©l√®ves dans cette nouvelle variable synth√©tique :     &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; # A tibble: 7 √ó 2
&lt;span class="gu"&gt;##&lt;/span&gt;   lvl_sc_lit                                        n
&lt;span class="gu"&gt;##&lt;/span&gt;   &amp;lt;chr&amp;gt;                                         &amp;lt;int&amp;gt;
&lt;span class="gu"&gt;##&lt;/span&gt; 1 Difficult√©s en lettres et sciences             1334
&lt;span class="gu"&gt;##&lt;/span&gt; 2 Difficult√©s surtout en lettres                 1790
&lt;span class="gu"&gt;##&lt;/span&gt; 3 Difficult√©s surtout en sciences                1678
&lt;span class="gu"&gt;##&lt;/span&gt; 4 Facilit√©s en lettres, difficult√©s en sciences  1334
&lt;span class="gu"&gt;##&lt;/span&gt; 5 Facilit√©s en sciences et en lettres             259
&lt;span class="gu"&gt;##&lt;/span&gt; 6 Facilit√©s en sciences, difficult√©s en lettres  1337
&lt;span class="gu"&gt;##&lt;/span&gt; 7 R√©sultats irr√©guliers                          2268
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;C'est tout pour aujourd'hui! On esp√®re que cette note vous permettra de mieux exploiter la puissance de ces deux petits verbes bien pratiques. Si vous avez besoin de &lt;a href="https://statoscop.fr"&gt;conseils en programmation pour l'analyse de donn√©es&lt;/a&gt;, n'h√©sitez pas √† continuer votre navigation sur notre site ou √† nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="dplyr"></category><category term="tidyverse"></category><category term="if_any"></category><category term="if_all"></category><category term="across"></category></entry><entry><title>R√©seaux neuronaux convolutifs avec R et Keras</title><link href="https://blog.statoscop.fr/reseaux-neuronaux-convolutifs-avec-r-et-keras.html" rel="alternate"></link><published>2025-02-19T00:00:00+01:00</published><updated>2025-02-19T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-02-19:/reseaux-neuronaux-convolutifs-avec-r-et-keras.html</id><summary type="html">&lt;p&gt;D√©monstration de l'utilisation du package &lt;code&gt;keras3&lt;/code&gt; pour faire du Deep Learning avec R.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#presentation-de-la-librairie-keras"&gt;Pr√©sentation de la librairie Keras&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#origine-de-la-librairie"&gt;Origine de la librairie&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#installation-du-package-sur-r"&gt;Installation du package sur R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#entrainer-un-premier-reseau-convolutionnel"&gt;Entra√Æner un premier r√©seau convolutionnel&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#pre-traiter-vos-donnees"&gt;Pr√©-traiter vos donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#initialiser-et-definir-votre-reseau-de-neurones-profond"&gt;Initialiser et d√©finir votre r√©seau de neurones profond&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#entrainer-et-evaluer-les-performances-de-votre-modele"&gt;Entra√Æner et √©valuer les performances de votre mod√®le&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#predictions-a-partir-du-modele-pre-entraine"&gt;Pr√©dictions √† partir du mod√®le pr√©-entra√Æn√©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#deep-learning-avec-r-ou-python"&gt;Deep Learning avec R ou Python?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;On le sait, le &lt;strong&gt;d√©bat entre R et Python&lt;/strong&gt; est acharn√© et souvent peu productif. En Machine Learning, tout le monde ou presque s'accorde √† dire que Python a une longueur d'avance, surtout pour les mod√®les de Deep Learning (r√©seaux de neurones).  &lt;/p&gt;
&lt;p&gt;Heureusement, il existe souvent des alternatives pour celles et ceux ne souhaitant pas se mettre √† un autre langage (m√™me si on vous y encourage!). Ainsi &lt;strong&gt;le package R &lt;code&gt;keras3&lt;/code&gt; permet d'acc√©der √† la c√©l√®bre API Python&lt;/strong&gt; du m√™me nom. Nous vous montrons donc dans cet article comment elle fonctionne.   &lt;/p&gt;
&lt;h1 id="presentation-de-la-librairie-keras"&gt;Pr√©sentation de la librairie Keras&lt;/h1&gt;
&lt;h2 id="origine-de-la-librairie"&gt;Origine de la librairie&lt;/h2&gt;
&lt;p&gt;Keras est une &lt;strong&gt;API Python qui permet de cr√©er et entra√Æner des mod√®les de Deep Learning&lt;/strong&gt;. Elle a l'avantage d'offrir une interface simple et une syntaxe claire. Elle permet √©galement d'acc√©der √† de nombreux mod√®les pr√©-entra√Æn√©s qui &lt;strong&gt;peuvent ensuite facilement √™tre &lt;em&gt;fine-tun√©s&lt;/em&gt; sur d'autres donn√©es&lt;/strong&gt;. Elle a √©t√© r√©cemment int√©gr√©e √† &lt;code&gt;TensorFlow&lt;/code&gt; mais peut s'appuyer sur d'autres backends.&lt;/p&gt;
&lt;p&gt;Keras dispose aussi d'une &lt;a href="https://keras.io/api/"&gt;documentation tr√®s compl√®te&lt;/a&gt;, et sa popularit√© permet de retrouver de nombreux exemples d'utilisation en ligne. Elle est le plus souvent utilis√©e gr√¢ce au package Python &lt;code&gt;keras&lt;/code&gt; ou via TensorFlow avec &lt;code&gt;tf.keras&lt;/code&gt;, qui permettent d'exploiter facilement ses diff√©rentes m√©thodes.   &lt;/p&gt;
&lt;h2 id="installation-du-package-sur-r"&gt;Installation du package sur R&lt;/h2&gt;
&lt;p&gt;Gr√¢ce notamment √† la puissance de &lt;code&gt;reticulate&lt;/code&gt;, un package permettant de faire tourner Python depuis une session R, on dispose maintenant d'un package R &lt;code&gt;keras&lt;/code&gt;, que nous vous pr√©sentons ici. Nous utiliserons la derni√®re version disponible, le package &lt;code&gt;keras3&lt;/code&gt;. La premi√®re √©tape est bien sur d'installer le package avec &lt;code&gt;install.packages("keras3")&lt;/code&gt; puis de lancer la fonction &lt;code&gt;keras3::install_keras()&lt;/code&gt; qui permet d'installer Python et un environnement anaconda d√©di√©.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keras3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;install_keras&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si vous avez du GPU, vous pouvez v√©rifier que &lt;strong&gt;votre device a bien √©t√© rep√©r√©&lt;/strong&gt; avec l'instruction suivante (normalement, &lt;code&gt;tensorflow&lt;/code&gt; a √©t√© install√© au moment de l'installation de &lt;code&gt;keras3&lt;/code&gt;) :    &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;tensorflow&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;tf&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="nf"&gt;list_physical_devices&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;GPU&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;PhysicalDevice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nx"&gt;physical_device&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;GPU&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;device_type&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nx"&gt;GPU&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;      &lt;/p&gt;
&lt;h1 id="entrainer-un-premier-reseau-convolutionnel"&gt;Entra√Æner un premier r√©seau convolutionnel&lt;/h1&gt;
&lt;p&gt;Pour notre petite d√©monstration, nous allons utiliser la c√©l√©brissime base de donn√©es &lt;code&gt;mnist&lt;/code&gt; qui contient &lt;strong&gt;des images de chiffres √©crits √† la main&lt;/strong&gt;. Le but est donc de d√©velopper un mod√®le capable de reconna√Ætre les chiffres manuscrits.  &lt;/p&gt;
&lt;h2 id="pre-traiter-vos-donnees"&gt;Pr√©-traiter vos donn√©es&lt;/h2&gt;
&lt;p&gt;Les donn√©es fournies contiennent 60 000 observations pour les donn√©es d'entra√Ænements et 10 000 pour les donn√©es de test. Les images √©tant renseign√©es directement sous forme de matrice dans le package &lt;code&gt;keras3&lt;/code&gt; nous n'avons besoin que de normaliser ces matrices sur [0, 1]. On passe aussi la variable d'int√©r√™t, qui donne la valeur du chiffre en question, sous un &lt;em&gt;one-hot-encoder&lt;/em&gt; avec la fonction &lt;code&gt;to_categorical&lt;/code&gt;. On obtient ainsi un vecteur de taille 10 contenant un indicateur pour chaque chiffre. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;keras3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;dataset_mnist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;train&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;train&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;
&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;
&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;

&lt;span class="c1"&gt;# on normalise sur [0, 1]&lt;/span&gt;
&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;
&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;

&lt;span class="c1"&gt;# one-hot-encoder pour la variable d&amp;#39;int√©r√™t avec to_categorical&lt;/span&gt;
&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;to_categorical&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;num_classes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;to_categorical&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;num_classes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="initialiser-et-definir-votre-reseau-de-neurones-profond"&gt;Initialiser et d√©finir votre r√©seau de neurones profond&lt;/h2&gt;
&lt;p&gt;On &lt;strong&gt;initialise le mod√®le&lt;/strong&gt; avec &lt;code&gt;keras_model_sequential&lt;/code&gt;, dans lequel on pr√©cise d'embl√©e la dimension des donn√©es que le mod√®le prendra en entr√©e. Puis on ajoute les &lt;strong&gt;diff√©rentes couches de neurones&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;Comme nous sommes dans un r√©seau convolutionnel, on commence directement par une couche de convolution, qui permet de faire &lt;strong&gt;ressortir les caract√©ristiques de chaque image&lt;/strong&gt;. Cela fonctionne gr√¢ce √† un syst√®me de filtres, r√©alis√© en faisant le produit de la matrice de pixels et d'une matrice plus petite, appel√©e &lt;code&gt;feature detector&lt;/code&gt;. On d√©finit dans cette √©tape le nombre de filtres que l'on souhaite faire passer avec le param√®tre &lt;code&gt;filters&lt;/code&gt; et la taille de la matrice &lt;code&gt;feature detector&lt;/code&gt; avec le param√®tre &lt;code&gt;kernel_size&lt;/code&gt;.   &lt;/p&gt;
&lt;p&gt;On &lt;strong&gt;applique ensuite aux matrices obtenues une couche de &lt;em&gt;max pooling&lt;/em&gt;&lt;/strong&gt; qui permet de r√©duire les dimensions du probl√®me en ne conservant que les valeurs les plus importantes. Cette √©tape permet aussi de rendre plus souvent comparables &lt;strong&gt;des images ayant des caract√©ristiques semblables √† des endroits diff√©rents&lt;/strong&gt;. Le param√®tre &lt;code&gt;pool_size&lt;/code&gt; permet de choisir la &lt;strong&gt;taille du sous-ensemble sur lequel on ne va garder que la valeur maximale&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;On peut ensuite refaire des nouvelles couches de convolution suivies de pooling, en &lt;strong&gt;fonction de la complexit√© et de la taille de nos matrices de pixel en entr√©e du mod√®le&lt;/strong&gt;. On termine ces √©tapes par une couche &lt;code&gt;flatten()&lt;/code&gt; qui permet d'obtenir un vecteur unidimensionnel pour chaque observation, sur lequel on va pouvoir construire notre r√©seau de neurones profond avec des couches &lt;code&gt;dense()&lt;/code&gt;. On choisit ici une couche avec 128 neurones, suivie d'une couche avec 64 neurones. La couche de sortie contient &lt;strong&gt;10 neurones correspondant aux 10 classes possibles&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Le package R &lt;code&gt;keras3&lt;/code&gt; permet une syntaxe &lt;strong&gt;tr√®s proche de celle que l'on utiliserait sur Python&lt;/strong&gt;. On peut en plus relier ces couches avec l'op√©rateur &lt;code&gt;|&amp;gt;&lt;/code&gt;, rendant le code encore plus lisible et a√©r√©.  √Ä noter qu'une fois que le mod√®le &lt;code&gt;my_first_r_cnn&lt;/code&gt; est cr√©√©, &lt;strong&gt;il n'est pas n√©cessaire de le r√©assigner √† chaque ajout de layers&lt;/strong&gt;. L'op√©rateur &lt;code&gt;|&amp;gt;&lt;/code&gt; met √† jour directement l'objet &lt;code&gt;my_first_r_cnn&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Initialisation du mod√®le  &lt;/span&gt;
&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;keras_model_sequential&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;input_shape&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c1"&gt;# convolution et max pooling&lt;/span&gt;
&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on d√©finit les dimension des inputs dans une couche d√©di√©e&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_conv_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kernel_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="c1"&gt;# l&amp;#39;activation relu &amp;quot;casse&amp;quot; une lin√©arit√© qui a pu&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="c1"&gt;# √™tre introduite avec la convolution&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_max_pooling_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pool_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_conv_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;filters&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;kernel_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_max_pooling_2d&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pool_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_flatten&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;128&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;relu&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;layer_dense&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;units&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;activation&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;softmax&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut illustrer la &lt;strong&gt;structure de notre mod√®le&lt;/strong&gt; avec la fonction &lt;code&gt;summary()&lt;/code&gt; : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Model&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;sequential&amp;quot;&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÉ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Layer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                      &lt;/span&gt;&lt;span class="err"&gt;‚îÉ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Output&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;Shape&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="err"&gt;‚îÉ&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="nx"&gt;Param&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÉ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;conv2d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Conv2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mi"&gt;320&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;max_pooling2d&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;MaxPooling2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;conv2d_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Conv2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                 &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;064&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;max_pooling2d_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;MaxPooling2D&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;flatten&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Flatten&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                 &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;576&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;128&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="mi"&gt;73&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;856&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense_1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dense_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;Dense&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;               &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="mi"&gt;650&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îÇ&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Total&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;85&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;146&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;332.60&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;KB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Trainable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;85&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;146&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;332.60&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;KB&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="err"&gt;##&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nx"&gt;Non&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nx"&gt;trainable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;params&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m m-Double"&gt;0.00&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="entrainer-et-evaluer-les-performances-de-votre-modele"&gt;Entra√Æner et √©valuer les performances de votre mod√®le&lt;/h2&gt;
&lt;p&gt;La premi√®re √©tape est de compiler l'objet cr√©√© pr√©c√©demment, &lt;strong&gt;en d√©finissant l'&lt;em&gt;optimizer&lt;/em&gt; qui sera utilis√©&lt;/strong&gt;, la fonction de perte et la m√©trique sur laquelle on souhaite optimiser le r√©sultat du mod√®le :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;optimizer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;adam&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;loss&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;categorical_crossentropy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;metrics&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;accuracy&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ensuite, on peut &lt;strong&gt;lancer l'entra√Ænement avec une instruction &lt;code&gt;fit()&lt;/code&gt;&lt;/strong&gt; que l'on applique √† nos donn√©es d'entra√Ænement. On y d√©finit notamment le param√®tre &lt;code&gt;batch_size&lt;/code&gt; qui permet de d√©terminer combien d'images le mod√®le va traiter avant d'ajuster ses coefficients. Le param√®tre &lt;code&gt;epochs&lt;/code&gt; d√©finit le nombre de fois o√π le mod√®le passe sur toutes les donn√©es. Enfin, on split nos donn√©es d'entra√Ænement dont on conserve 30% comme donn√©es de validation afin de d'&lt;strong&gt;√©valuer correctement les performances de notre mod√®le&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;x_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y_train&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;epochs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;batch_size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;validation_split&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 1/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 5s - 8ms/step - accuracy: 0.9120 - loss: 0.2766 - val_accuracy: 0.9623 - val_loss: 0.1200
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 2/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9766 - loss: 0.0753 - val_accuracy: 0.9774 - val_loss: 0.0733
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 3/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9849 - loss: 0.0507 - val_accuracy: 0.9799 - val_loss: 0.0608
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 4/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9878 - loss: 0.0395 - val_accuracy: 0.9832 - val_loss: 0.0553
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 5/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9895 - loss: 0.0316 - val_accuracy: 0.9859 - val_loss: 0.0490
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 6/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9923 - loss: 0.0234 - val_accuracy: 0.9826 - val_loss: 0.0640
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 7/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9929 - loss: 0.0207 - val_accuracy: 0.9855 - val_loss: 0.0533
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 8/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9946 - loss: 0.0165 - val_accuracy: 0.9866 - val_loss: 0.0507
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 9/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9941 - loss: 0.0165 - val_accuracy: 0.9835 - val_loss: 0.0632
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 10/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9960 - loss: 0.0123 - val_accuracy: 0.9870 - val_loss: 0.0501
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 11/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9958 - loss: 0.0123 - val_accuracy: 0.9853 - val_loss: 0.0613
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 12/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9965 - loss: 0.0103 - val_accuracy: 0.9872 - val_loss: 0.0570
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 13/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9968 - loss: 0.0095 - val_accuracy: 0.9871 - val_loss: 0.0544
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 14/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0082 - val_accuracy: 0.9871 - val_loss: 0.0583
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 15/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9972 - loss: 0.0091 - val_accuracy: 0.9867 - val_loss: 0.0624
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 16/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9988 - loss: 0.0043 - val_accuracy: 0.9871 - val_loss: 0.0623
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 17/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9976 - loss: 0.0070 - val_accuracy: 0.9857 - val_loss: 0.0693
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 18/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0096 - val_accuracy: 0.9853 - val_loss: 0.0693
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 19/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9983 - loss: 0.0051 - val_accuracy: 0.9862 - val_loss: 0.0690
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 20/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9988 - loss: 0.0040 - val_accuracy: 0.9882 - val_loss: 0.0612
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 21/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9983 - loss: 0.0054 - val_accuracy: 0.9881 - val_loss: 0.0596
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 22/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9986 - loss: 0.0042 - val_accuracy: 0.9789 - val_loss: 0.1290
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 23/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9976 - loss: 0.0074 - val_accuracy: 0.9876 - val_loss: 0.0682
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 24/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9996 - loss: 0.0017 - val_accuracy: 0.9879 - val_loss: 0.0690
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 25/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9996 - loss: 0.0016 - val_accuracy: 0.9843 - val_loss: 0.0981
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 26/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9970 - loss: 0.0094 - val_accuracy: 0.9863 - val_loss: 0.0723
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 27/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9985 - loss: 0.0049 - val_accuracy: 0.9884 - val_loss: 0.0659
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 28/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9994 - loss: 0.0019 - val_accuracy: 0.9879 - val_loss: 0.0725
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 29/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9997 - loss: 9.4193e-04 - val_accuracy: 0.9889 - val_loss: 0.0674
&lt;span class="gu"&gt;##&lt;/span&gt; Epoch 30/30
&lt;span class="gu"&gt;##&lt;/span&gt; 657/657 - 1s - 2ms/step - accuracy: 0.9971 - loss: 0.0086 - val_accuracy: 0.9856 - val_loss: 0.0672
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut illustrer l'√©volution de la qualit√© du mod√®le au fur et √† mesure des epochs avec &lt;code&gt;plot&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;history&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-8-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Enfin, on sort la &lt;strong&gt;performance du mod√®le sur nos donn√©es test&lt;/strong&gt; avec &lt;code&gt;evaluate&lt;/code&gt;:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;accuracy_test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;evaluate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## 313/313 - 1s - 3ms/step - accuracy: 0.9898 - loss: 0.0522
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;accuracy_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## $accuracy
## [1] 0.9898
## 
## $loss
## [1] 0.05221168
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Inutile bien s√ªr de pr√©ciser que nous sommes dans un cas de classification relativement simple et avec √©norm√©ment de donn√©es de bonne qualit√©, donc ne cherchez pas √† atteindre de tels niveaux de pr√©cision sur des donn√©es un peu plus compliqu√©es! &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id="predictions-a-partir-du-modele-pre-entraine"&gt;Pr√©dictions √† partir du mod√®le pr√©-entra√Æn√©&lt;/h1&gt;
&lt;p&gt;Prenons par exemple la 20e image de l'√©chantillon test : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# On prend la 20e image&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;,,]&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# S√©lection de l&amp;#39;image&lt;/span&gt;
&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mnist&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Label associ√©&lt;/span&gt;

&lt;span class="c1"&gt;# Inverser les couleurs pour un affichage correct&lt;/span&gt;
&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;t&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rev&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="c1"&gt;# Afficher l&amp;#39;image en niveaux de gris&lt;/span&gt;
&lt;span class="nf"&gt;image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Label :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-10-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On peut sortir les &lt;strong&gt;pr√©dictions des probabilit√©s associ√©es √† chaque classe avec la fonction &lt;code&gt;predict()&lt;/code&gt;&lt;/strong&gt;. La pr√©diction associ√©e √† l'image pr√©c√©dente donne le r√©sultat suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# On pr√©dit l&amp;#39;ensemble des X_test&lt;/span&gt;
&lt;span class="n"&gt;matrice_pred&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;my_first_r_cnn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;predict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x_test&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;## 313/313 - 1s - 2ms/step
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# On sort l&amp;#39;index max - 1 (qui correspond √† la classe) de l&amp;#39;observation n¬∞20&lt;/span&gt;
&lt;span class="n"&gt;pred_obs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;which.max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;matrice_pred&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;,])&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="nf"&gt;image&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;image_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;col&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;gray&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;255&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;paste&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Label :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;label&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Pr√©diction :&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pred_obs&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="n"&gt;axes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;asp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/cnn_r_keras/unnamed-chunk-11-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;h1 id="deep-learning-avec-r-ou-python"&gt;Deep Learning avec R ou Python?&lt;/h1&gt;
&lt;p&gt;Le package &lt;code&gt;keras3&lt;/code&gt; est &lt;strong&gt;tr√®s complet et semble offrir autant de possibilit√©s que le module Python&lt;/strong&gt;. Il dispose aussi d'une &lt;a href="https://keras3.posit.co"&gt;documentation compl√®te et tr√®s d√©taill√©e&lt;/a&gt;. Cependant, il faut garder en t√™te qu'il fait tourner Python en arri√®re-plan.   &lt;/p&gt;
&lt;p&gt;Le gros avantage pour un utilisateur non aguerri de Python est qu'il va &lt;strong&gt;g√©rer pour vous l'environnement anaconda et les d√©pendances&lt;/strong&gt;, qui peuvent √™tre un vrai casse-t√™te quand on se met √† Python. Enfin, la &lt;strong&gt;syntaxe tr√®s proche de celle de Python peut vous permettre de commencer √† vous accoutumer en vue d'un futur changement de langage&lt;/strong&gt;, tout en restant sur votre langage favori en attendant!  &lt;/p&gt;
&lt;p&gt;Enfin, on peut imaginer que l'utilisation d'un package R peut √™tre tr√®s pratique dans le cadre de la mise en oeuvre de m√©thodes de statistiques inf√©rentielles sur des pr√©dictions de mod√®les de Machine Learning, comme par exemple dans &lt;a href="https://www.science.org/doi/10.1126/science.adi6000"&gt;ce papier tr√®s int√©ressant&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://bsky.app/profile/statoscop.fr"&gt;BlueSky&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Keras"></category><category term="CNN"></category><category term="Machine Learning"></category><category term="Data Science"></category></entry><entry><title>Appariement par score de propension (PSM) : mise en oeuvre avec R et discussions m√©thodologiques</title><link href="https://blog.statoscop.fr/appariement-score-propension.html" rel="alternate"></link><published>2025-02-04T00:00:00+01:00</published><updated>2025-02-04T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2025-02-04:/appariement-score-propension.html</id><summary type="html">&lt;p&gt;Implications th√©oriques des m√©thodes d'appariement par score de propension et impl√©mentation avec le package R &lt;code&gt;MatchIt&lt;/code&gt;.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#appariement-de-vos-donnees"&gt;Appariement de vos donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#description-des-donnees-et-de-notre-problematique"&gt;Description des donn√©es et de notre probl√©matique&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#evaluation-de-la-qualite-de-lappariement"&gt;√âvaluation de la qualit√© de l'appariement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux √† partir de la population appari√©e&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des m√©thodes avec score de propension&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Pour √©valuer un effet causal, comme par exemple les effets d'un m√©dicament sur des patients, on a besoin de ce que l'on appelle un &lt;strong&gt;essai clinique randomis√©&lt;/strong&gt;. Le principe est le suivant : on prend un certain nombre de patients (√† d√©terminer en fonction de l'effet minimum attendu, mais c'est un autre sujet) et on les s√©pare al√©atoirement en deux groupes : &lt;strong&gt;un groupe traitement&lt;/strong&gt; qui prend le m√©dicament et &lt;strong&gt;un groupe contr√¥le&lt;/strong&gt; qui en g√©n√©ral prend un placebo.&lt;br&gt;
Comme on a d√©cid√© de mani√®re compl√®tement al√©atoire l'assignation √† l'un ou l'autre groupe, on sait que ces deux groupes auront en moyenne des caract√©ristiques identiques (merci la loi faible des grands nombres!). Cela nous permet de conclure que les diff√©rences qui seraient observ√©es entre les deux groupes (meilleur r√©tablissement, prise de poids, selon ce qu'on cherche √† observer...) &lt;strong&gt;sont imputables au traitement et non √† une sp√©cificit√© d'un des groupes par rapport √† l'autre&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;L'essai clinique randomis√©, c'est donc l'id√©al pour montrer un effet causal et c'est d'ailleurs par l√† qu'il faut passer si vous souhaitez homologuer un nouveau m√©dicament. Mais c'est √©galement co√ªteux et difficile √† r√©aliser. C'est pourquoi on cherche de plus en plus √† essayer &lt;strong&gt;d'imiter les conditions d'un essai clinique randomis√© √† partir de donn√©es observationnelles&lt;/strong&gt;. Pour cette note de blog, on va vous pr√©senter une ces m√©thodes : le &lt;strong&gt;propensity score matching (PSM), ou appariement par score de propension&lt;/strong&gt;.  &lt;/p&gt;
&lt;h1 id="principes-du-propensity-score-matching"&gt;Principes du Propensity Score Matching&lt;/h1&gt;
&lt;p&gt;L'appariement par score de propension vise √† &lt;strong&gt;recr√©er les conditions d'un essai clinique √† partir de donn√©es observationnelles&lt;/strong&gt;. On a ainsi un ensemble de donn√©es avec par exemple un certain nombre de patients qui ont pris un traitement (le &lt;em&gt;groupe traitement&lt;/em&gt;) et d'autres qui ne l'ont pas pris (le &lt;em&gt;groupe contr√¥le&lt;/em&gt;). Probl√®me : ces population qui n'ont pas √©t√© s√©par√©es de mani√®re al√©atoire &lt;strong&gt;peuvent √™tre tr√®s diff√©rentes&lt;/strong&gt; et il n'est pas possible en l'√©tat de conclure qu'une diff√©rence entre elles soit imputable au traitement en question. Il faut donc recr√©er deux groupes de contr√¥le et de traitement qui puissent √™tre comparables.    &lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension"&gt;Calcul du score de propension&lt;/h2&gt;
&lt;p&gt;La premi√®re √©tape est de &lt;strong&gt;calculer le score de propension&lt;/strong&gt;. Il est n√©cessaire en premier lieu &lt;strong&gt;d'identifier les variables observables&lt;/strong&gt; sur lesquelles on souhaiterait r√©√©quilibrer les deux groupes. Il n'y a pas de m√©thode magique pour choisir ces variables : il faut que ce soit la connaissance technique du cas qui guide votre choix. L'id√©e est d'identifier les variables dont vous imaginez qu'elles peuvent √™tre &lt;strong&gt;d√©s√©quilibr√©es entre vos deux groupes&lt;/strong&gt; pour diff√©rentes raisons (par exemple, le traitement A est plus souvent donn√© aux femmes donc je sais qu'il y aura plus de femmes dans ce groupe que dans un autre). Il faut aussi bien s√ªr contr√¥ler par les variables dont on sait qu'elles peuvent avoir &lt;strong&gt;un impact sur le r√©sultat ind√©pendemment de l'efficacit√© du m√©dicament&lt;/strong&gt; (l'√¢ge impacte souvent la probabilit√© de gu√©rison par exemple).  &lt;/p&gt;
&lt;p&gt;Une fois ces variables identifi√©es, il ne vous reste plus qu'√† faire &lt;strong&gt;sur l'ensemble de vos donn√©es un mod√®le de r√©gression logistique.&lt;/strong&gt; Par exemple, si votre groupe traitement prend un m√©dicament A et le reste du groupe ne prend pas ce m√©dicament, votre variable &lt;code&gt;Y&lt;/code&gt; sera l'indicatrice &lt;em&gt;Prend le m√©dicament A&lt;/em&gt; et vos variables $X_i$ les variables sur lesquelles vous souhaitez contr√¥ler (sexe, √¢ge, etc...). La formule est la suivante :  &lt;/p&gt;
&lt;p&gt;$\log \left( \frac{P(Y=1)}{1 - P(Y=1)} \right) = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \dots$&lt;/p&gt;
&lt;h2 id="appariement-de-vos-donnees"&gt;Appariement de vos donn√©es&lt;/h2&gt;
&lt;p&gt;La mise en oeuvre de cette r√©gression logistique nous permet &lt;strong&gt;d'obtenir un score de propension&lt;/strong&gt;. Celui-ci repr√©sente pour chaque individu la probabilit√© pr√©dite qu'il appartienne au groupe traitement. Ce score de propension peut-√™tre utilis√© dans diff√©rentes m√©thodes (IPTW, variable d'ajustement dans la mod√®le...). Pour le PSM, nous l'utilisons pour &lt;strong&gt;apparier les donn√©es&lt;/strong&gt;.  &lt;/p&gt;
&lt;p&gt;En effet, pour chaque observation du groupe trait√©, l'id√©e est de lui attribuer une (ou plusieurs, selon vos donn√©es) observation(s) du groupe contr√¥le, ayant &lt;strong&gt;un score de propension le plus proche possible&lt;/strong&gt;, donc des caract√©ristiques semblables. Diff√©rentes m√©thodes d'appariement existent, la plus courante √©tant celle du plus proche voisin.  &lt;/p&gt;
&lt;p&gt;Une fois que chaque observation du groupe traitement s'est vue attribuer son plus proche voisin du groupe contr√¥le, on √©carte les donn√©es qui n'ont pas √©t√© appari√©es. La premi√®re chose √† faire est bien s√ªr &lt;strong&gt;d'√©valuer la qualit√© de l'appariement&lt;/strong&gt; en v√©rifiant la r√©partition des variables de contr√¥le entre les deux groupes. Puis, nous allons r√©aliser nos analyses comme si nous √©tions dans le cas d'un essai clinique randomis√©, ou presque...&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id="mise-en-oeuvre-de-lappariement-par-score-de-propension-avec-r"&gt;Mise en oeuvre de l'appariement par score de propension avec R&lt;/h1&gt;
&lt;p&gt;Les m√©thodes utilisant des scores de propension, et en particulier l'appariement par score de propension, sont tr√®s bien prises en charge avec R. Nous vous proposons ici d'utiliser le package R &lt;code&gt;MatchIt&lt;/code&gt; sur des &lt;a href="https://archive.ics.uci.edu/dataset/519/heart+failure+clinical+records"&gt;donn√©es cliniques librement accessibles&lt;/a&gt;. Il s'agit de patients hospitalis√©s pour une insuffisance cardiaque.  &lt;/p&gt;
&lt;h2 id="description-des-donnees-et-de-notre-problematique"&gt;Description des donn√©es et de notre probl√©matique&lt;/h2&gt;
&lt;p&gt;Nos donn√©es repr√©sentent 299 patients.  Parmi eux, la pr√©valence de cas d'hypertension art√©rielle (HTA) est la suivante :  &lt;/p&gt;
&lt;p&gt;Table: Pr√©sence de diab√®tes&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;high_blood_pressure&lt;/th&gt;
&lt;th style="text-align: right;"&gt;n&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;194&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Oui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;105&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il y a 13 variables disponibles :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;##&lt;/span&gt;  [1] &amp;quot;age&amp;quot;                      &amp;quot;anaemia&amp;quot;                 
&lt;span class="gu"&gt;##&lt;/span&gt;  [3] &amp;quot;creatinine_phosphokinase&amp;quot; &amp;quot;diabetes&amp;quot;                
&lt;span class="gu"&gt;##&lt;/span&gt;  [5] &amp;quot;ejection_fraction&amp;quot;        &amp;quot;high_blood_pressure&amp;quot;     
&lt;span class="gu"&gt;##&lt;/span&gt;  [7] &amp;quot;platelets&amp;quot;                &amp;quot;serum_creatinine&amp;quot;        
&lt;span class="gu"&gt;##&lt;/span&gt;  [9] &amp;quot;serum_sodium&amp;quot;             &amp;quot;sex&amp;quot;                     
&lt;span class="gu"&gt;##&lt;/span&gt; [11] &amp;quot;smoking&amp;quot;                  &amp;quot;time&amp;quot;                    
&lt;span class="gu"&gt;##&lt;/span&gt; [13] &amp;quot;death_event&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On cherche ici √† &lt;strong&gt;√©valuer l'impact de l'HTA sur la probabilit√© de d√©c√©der des suites d'une insuffisance cardiaque&lt;/strong&gt;. Notre &lt;strong&gt;variable d'int√©r√™t&lt;/strong&gt; est donc &lt;code&gt;death_event&lt;/code&gt;. Notre &lt;em&gt;traitement&lt;/em&gt; (ici on ne regarde pas l'effet d'un traitement mais d'une caract√©ristique des patients, cependant on va continuer √† utiliser cette terminologie) est ici le fait d'avoir une HTA. Le croisement de ces deux variables donne le r√©sultat suivant :  &lt;/p&gt;
&lt;p&gt;Table: HTA et d√©c√®s&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;high_blood_pressure&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Effectifs&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Part de d√©c√®s&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;194&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;Oui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;105&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Ici √† premi√®re vue on trouve une proportion plus importante de d√©c√®s parmi les patients ayant une HTA (37% contre 29% pour les autres). Mais bien s√ªr, il n'est pas encore possible de &lt;strong&gt;savoir si cela est d√ª √† l'HTA en soi ou √† d'autres caract√©ristiques&lt;/strong&gt; des patients souffrant de ce probl√®me.&lt;/p&gt;
&lt;h2 id="calcul-du-score-de-propension-et-appariement-des-patients"&gt;Calcul du score de propension et appariement des patients&lt;/h2&gt;
&lt;p&gt;La fonction &lt;code&gt;matchit&lt;/code&gt; du package R &lt;code&gt;MatchIt&lt;/code&gt; nous permet de &lt;strong&gt;mettre directement en oeuvre le calcul du score de propension et l'appariement&lt;/strong&gt;. On commence par s√©lectionner les variables par lesquelles il nous semble important de contr√¥ler : ici nous allons prendre l'ensemble des variables cliniques dont nous disposons. Il faut alors &lt;strong&gt;retirer les valeurs manquantes&lt;/strong&gt; pour ensuite obtenir deux groupes de patients avec et sans HTA ayant des caract√©ristiques semblables par ailleurs. La fonction s'√©crit ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MatchIt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;matchit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;creatinine_phosphokinase&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;diabetes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="n"&gt;platelets&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_creatinine&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;serum_sodium&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;smoking&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_ps&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;nearest&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;distance&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;glm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="n"&gt;estimand&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ATT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ici on choisit le param√©trage par d√©faut &lt;code&gt;method = "nearest"&lt;/code&gt; qui apparie √† chaque observation du &lt;strong&gt;groupe trait√©&lt;/strong&gt; (les patients ayant une HTA) l'observation du &lt;strong&gt;groupe contr√¥le&lt;/strong&gt; ayant le score de propension le plus proche possible.
Le param√®tre &lt;code&gt;method = "ATT"&lt;/code&gt; permet d'√©valuer un &lt;strong&gt;effet du traitement sur les trait√©s&lt;/strong&gt; et non sur la population globale. Enfin, on d√©finit le mod√®le (ici logistique avec avec &lt;code&gt;distance = "glm"&lt;/code&gt;) pour le calcul du score de propension. Si vous avez un doute sur la m√©thode √† utiliser, &lt;a href="https://cran.r-project.org/web/packages/MatchIt/vignettes/MatchIt.html"&gt;reportez-vous √† la documentation du package MatchIT&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="evaluation-de-la-qualite-de-lappariement"&gt;√âvaluation de la qualit√© de l'appariement&lt;/h2&gt;
&lt;p&gt;Encore une fois, la librairie &lt;code&gt;MatchIt&lt;/code&gt; nous m√¢che directement le travail en nous permettant de comparer facilement la &lt;strong&gt;r√©partition de nos patients avant et apr√®s appariement&lt;/strong&gt; avec &lt;code&gt;summary()&lt;/code&gt;. La &lt;strong&gt;r√©partition avant l'appariement&lt;/strong&gt; est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on affiche seulemet l&amp;#39;√©l√©ment `sum.all` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.all&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Treated&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Control&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Var. Ratio&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Mean&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Max&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;distance&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.36&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.11&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.23&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;age&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;60.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.20&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.91&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.13&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexFemme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.31&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.21&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexHomme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.69&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.21&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td style="text-align: right;"&gt;488.90&lt;/td&gt;
&lt;td style="text-align: right;"&gt;632.14&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.16&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.73&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.11&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.59&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;platelets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;269989.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;259769.00&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_creatinine&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.39&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.40&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.99&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.13&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_sodium&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.85&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.51&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.82&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.71&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.12&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate ainsi que les personnes souffrant d'hyper tension art√©rielle sont souvent plus √¢g√©es que les autres. Ce sont √©galement plus souvent des femmes, et plus souvent des personnes atteintes d'an√©mie. Observons maintenant si notre appariement a permis d'√©quilibrer nos deux groupes sur ces variables et sur les autres :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# on affiche seulement l&amp;#39;√©l√©ment `sum.matched` de la sortie&lt;/span&gt;
&lt;span class="n"&gt;output_matching&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;sum.matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Treated&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Means Control&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Mean Diff.&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Var. Ratio&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Mean&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eCDF Max&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Std. Pair Dist.&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;distance&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;age&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.34&lt;/td&gt;
&lt;td style="text-align: right;"&gt;62.36&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.00&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.93&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.07&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.89&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexFemme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.42&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.40&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;sexHomme&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.58&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.54&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.56&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;anaemiaOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.44&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.96&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;creatinine_phosphokinase&lt;/td&gt;
&lt;td style="text-align: right;"&gt;488.90&lt;/td&gt;
&lt;td style="text-align: right;"&gt;481.78&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.89&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.02&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.07&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.46&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.59&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.63&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;diabetesOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;platelets&lt;/td&gt;
&lt;td style="text-align: right;"&gt;269989.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;264619.41&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.87&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.10&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_creatinine&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.39&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.43&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;2.09&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.04&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.18&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.66&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;serum_sodium&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.85&lt;/td&gt;
&lt;td style="text-align: right;"&gt;136.60&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.88&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.01&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.07&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingNon&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.71&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;smokingOui&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.29&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.26&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;NA&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.03&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;On constate que la plupart des variables sont maintenant plus √©quilibr√©es entre les deux groupes. Au global, la variable &lt;code&gt;distance&lt;/code&gt; montre la grande proximit√© du score de propension entre les deux groupes. On peut √©galement mettre en √©vidence l'effet de l'appariement visuellement sur quelques unes des variables avec la fonction &lt;code&gt;plot&lt;/code&gt; :&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;td style="text-align: right;"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;plot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;density&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;interactive&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="n"&gt;which.xs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;anaemia&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sex&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/psm/unnamed-chunk-9-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;h2 id="mesure-des-effets-causaux-a-partir-de-la-population-appariee"&gt;Mesure des effets causaux √† partir de la population appari√©e&lt;/h2&gt;
&lt;p&gt;Une fois convaincus de la qualit√© de l'appariement, on peut mettre en oeuvre notre mod√®le statistique &lt;strong&gt;en tenant compte pour le calcul des estimateurs du fait que nous manipulons des observations appari√©es&lt;/strong&gt;. Diff√©rentes m√©thodes sont possibles en fonction de la variable d'int√©r√™t, du type d'appariement r√©alis√©, etc. En cas de doute, vous pouvez vous reporter &lt;a href="https://kosukeimai.github.io/MatchIt/articles/estimating-effects.html#modeling-the-outcome"&gt;√† la vignette consacr√©e √† l'estimation des effets du package &lt;code&gt;MatchIt&lt;/code&gt;&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;Dans notre exemple simple, nous allons tout d'abord extraire les donn√©es appari√©es avec &lt;code&gt;match_data&lt;/code&gt; et calibrer un mod√®le lin√©aire g√©n√©ralis√©. Nous &lt;strong&gt;pond√©rons avec les poids issus de l'appariement&lt;/strong&gt;. S'ils sont tous √©gaux √† 1 (c'est le cas pour nous) cela n'est pas n√©cessaire. Toutefois, cela reste une bonne habitude en cas d'appariement utilisant des poids diff√©rents. Il est possible √©galement de &lt;strong&gt;contr√¥ler notre r√©gression logistique par les variables ayant servi √† l'appariement, ou directement par le score de propension&lt;/strong&gt;. Nous choisissons ici de ne pas le faire en raison de la bonne qualit√© de l'appariement. &lt;/p&gt;
&lt;p&gt;Enfin, on utilise le package &lt;code&gt;marginaleffects&lt;/code&gt; pour estimer l'&lt;strong&gt;effet moyen sur les trait√©s (ATT)&lt;/strong&gt; en tenant compte l'appariement.   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;match_data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;m.out1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;glm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;death_event&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data_matched&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;family&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;binomial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;weights&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;marginaleffects&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;avg_comparisons&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fit&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;vcov&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="n"&gt;subclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                                            &lt;/span&gt;&lt;span class="n"&gt;newdata&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;subset&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;high_blood_pressure&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Oui&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="nf"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;term&lt;/th&gt;
&lt;th style="text-align: left;"&gt;contrast&lt;/th&gt;
&lt;th style="text-align: right;"&gt;estimate&lt;/th&gt;
&lt;th style="text-align: right;"&gt;std.error&lt;/th&gt;
&lt;th style="text-align: right;"&gt;statistic&lt;/th&gt;
&lt;th style="text-align: right;"&gt;p.value&lt;/th&gt;
&lt;th style="text-align: right;"&gt;s.value&lt;/th&gt;
&lt;th style="text-align: right;"&gt;conf.low&lt;/th&gt;
&lt;th style="text-align: right;"&gt;conf.high&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted_lo&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted_hi&lt;/th&gt;
&lt;th style="text-align: right;"&gt;predicted&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;high_blood_pressure&lt;/td&gt;
&lt;td style="text-align: left;"&gt;Oui - Non&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.05&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.06&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.76&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.45&lt;/td&gt;
&lt;td style="text-align: right;"&gt;1.16&lt;/td&gt;
&lt;td style="text-align: right;"&gt;-0.08&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.17&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.32&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.37&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;L'estimateur repr√©sente la &lt;strong&gt;diff√©rence de proportions de d√©c√®s&lt;/strong&gt; entre le groupe trait√© (ceux avec HTA) et le groupe contr√¥le (les autres). Elle est ici de 0.05, soit 5 points de pourcentage. En effet, les variables &lt;code&gt;predicted_lo&lt;/code&gt; et &lt;code&gt;predicted_hi&lt;/code&gt; indiquent que lorsqu'on apparie, la part de d√©c√®s dans le groupe contr√¥le monte √† 32% (contre 29% dans l'ensemble des patients n'ayant pas de tension art√©rielle), alors qu'elle est de 37% dans le groupe trait√©. De fait, cette diff√©rence n'est pas significative, puisque la p-value est de 0.45 (&lt;a href="https://blog.statoscop.fr/comprendre-et-interpreter-les-p-values.html"&gt;un autre de nos articles explique ce qu'est une p-value&lt;/a&gt;). Bien s√ªr, cela ne signifie pas forc√©ment que cet effet n'existe pas, mais en tout cas on ne dispose pas dans nos donn√©es de suffisament d'observations pour affirmer ici que l'HTA augmente signficativement la probabilit√© de d√©c√®s.&lt;/p&gt;
&lt;h1 id="forces-et-limites-des-methodes-avec-score-de-propension"&gt;Forces et limites des m√©thodes avec score de propension&lt;/h1&gt;
&lt;p&gt;De nombreuses questions se posent autour des m√©thodes de score de propension. La premi√®re est sans doute son avantage r√©el ou suppos√© par rapport √† un mod√®le multivari√© classique. Il est vrai cependant que cette m√©thode a l'avantage de capter dans une seule variable un ensemble de dimensions observables par lesquelles on souhaite contr√¥ler notre analyse. Mais le fait, dans le cas de l'appariement, de se passer d'une partie des donn√©es pose question. Cela permet cependant de calculer &lt;strong&gt;un effet moyen sur les trait√©s (ATT)&lt;/strong&gt; et de ne pas trop biaiser l'effet avec des observations qui auraient des caract√©ristiques tr√®s √©loign√©es de la population trait√©e. De plus, la m√©thode de pond√©ration par inverse de probabilit√© de traitement (IPTW) permet d'utiliser le score de propension sans √©carter de donn√©es, et il est √©galement possible d'estimer un ATT.  &lt;/p&gt;
&lt;p&gt;La plus grosse limite de cette m√©thode est sans doute le fait qu'elle pourrait faire oublier que nos groupes de traitement et de contr√¥le sont comparables &lt;strong&gt;uniquement sur des caract√©ristiques observables&lt;/strong&gt;. Il n'est donc pas √† exclure que des biais de s√©lection non observables polluent notre analyse, l√† o√π un essai clinique randomis√© calibr√© correctement met normalement √† l'abri de ce probl√®me. Il est donc fondamental de garder constamment cet √©cueil en t√™te pour essayer d'anticiper les possibles d√©fauts de nos analyses.  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui! Si vous cherchez des &lt;a href="https://www.statoscop.fr"&gt;statisticiens pour vos √©tudes cliniques n'h√©sitez pas √† visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Passer de RMarkdown √† Quarto pour vos rapports statistiques</title><link href="https://blog.statoscop.fr/quarto-rmarkdown.html" rel="alternate"></link><published>2024-12-12T00:00:00+01:00</published><updated>2024-12-12T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2024-12-12:/quarto-rmarkdown.html</id><summary type="html">&lt;p&gt;Petit exemple pour vous accompagner dans la transition de RMarkdown vers Quarto, et pourquoi √ßa va rendre vos rapports encore plus ergonomiques!&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#configuration-de-quarto"&gt;Configuration de Quarto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-des-onglets"&gt;Utilisation des onglets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#generation-dynamique-de-contenu-markdown"&gt;G√©n√©ration dynamique de contenu markdown&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#les-references-aux-graphiques-et-tableaux"&gt;Les r√©f√©rences aux graphiques et tableaux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href="https://rmarkdown.rstudio.com/"&gt;RMarkdown&lt;/a&gt; est un outil de g√©n√©ration de rapports qui permet de &lt;strong&gt;communiquer des r√©sultats d'analyse de mani√®re efficace, ergonomique et automatis√©e&lt;/strong&gt;. Nous l'utilisions de mani√®re quasi-quotidienne, mais force est de constater l'√©mergence irr√©m√©diable de &lt;a href="https://quarto.org/"&gt;Quarto&lt;/a&gt;. Du coup, on a fini par s'y mettre. Et en effet, Quarto permet non seulement de reproduire le type de rapports que l'on obtenait avec RMarkdown, mais il offre aussi &lt;strong&gt;encore plus de possibilit√©s!&lt;/strong&gt; C'est pour cela que nous vous pr√©sentons ici quelques unes de ses fonctionnalit√©s et 2/3 choses √† ne pas rater pour l'adopter sans peine.  &lt;/p&gt;
&lt;p&gt;Dans cet article nous allons suivre la cr√©ation d'un rapport fictif, qui repose sur des donn√©es compl√®tement invent√©es. L'id√©e est d'√©tudier la pr√©valence d'une maladie en fonction de diff√©rentes variables. &lt;/p&gt;
&lt;h1 id="configuration-de-quarto"&gt;Configuration de Quarto&lt;/h1&gt;
&lt;p&gt;Pour lancer votre premier rapport, vous pouvez comme pour RMarkdown le cr√©er directement depuis RStudio avec &lt;code&gt;File -&amp;gt; New file -&amp;gt; Quarto document&lt;/code&gt;. Je pr√©f√®re personnellement d√©cocher l'option &lt;code&gt;Use visual markdown editor&lt;/code&gt; qui propose une √©dition qui met directement en forme la partie Markdown, mais vous pouvez de toute fa√ßon passer de l'un √† l'autre en cliquant sur &lt;code&gt;Source&lt;/code&gt; ou &lt;code&gt;Visual&lt;/code&gt; en haut de de votre √©cran d'√©dition.  &lt;/p&gt;
&lt;p&gt;La premi√®re chose √† param√©trer est votre en-t√™te YAML qui donne les param√©trages globaux de votre document. Voici le mien :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;---
title: &amp;quot;Mon rapport dynamique&amp;quot;
format: 
  html:
    self-contained: true
    toc: true
    smooth-scroll: true
execute:
  echo: false
--- 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour RMarkdown, on y renseigne le titre et les formats de sortie, ici html. On remarque le param√®tre &lt;code&gt;self-contained: true&lt;/code&gt; &lt;strong&gt;qui est fondamental&lt;/strong&gt; : en effet, les sorties html de Quarto n√©cessitent de charger beaucoup de classes CSS et de fonctions javascript. Par d√©faut, tous ces √©l√©ments sont stock√©s dans un dossier &lt;code&gt;nom_de_votre_fichier_files&lt;/code&gt;. Cela permet par exemple de &lt;strong&gt;ne le charger qu'une fois&lt;/strong&gt; si vous avez plusieurs fichiers Quarto dans un projet. Par contre, si vous envoyez votre rapport html par mail, &lt;strong&gt;il ne va pas s'afficher correctement!&lt;/strong&gt; Ce param√®tre permet donc de &lt;strong&gt;charger toutes les d√©pendances n√©cessaires directement dans le fichier&lt;/strong&gt;, au prix d'un poids du fichier bien plus important. &lt;/p&gt;
&lt;p&gt;Bien s√ªr, ce que l'on adorait dans RMarkdown et qui est encore plus agr√©able avec Quarto, c'est &lt;strong&gt;la table des mati√®res flottante&lt;/strong&gt; sur le c√¥t√©. Coupl√©e au param√®tre &lt;code&gt;smooth-scroll: true&lt;/code&gt;, elle permet une navigation dans le fichier tr√®s agr√©able. C'est particuli√®rement appr√©ciable dans le cas de rapports tr√®s volumineux. Mais jugez plut√¥t :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/toc.gif"&gt;&lt;/p&gt;
&lt;p&gt;Enfin dans &lt;code&gt;execute&lt;/code&gt; je r√®gle un comportement par d√©faut de traitement de mes cellules de code. Ici, &lt;code&gt;echo: false&lt;/code&gt; indique que je souhaite que seules les sorties s'affichent dans mon rapport.  &lt;/p&gt;
&lt;p&gt;Bien s√ªr, on peut √©craser le param√©trage par d√©faut pour les blocs de code en les param√©trant directement, avec une syntaxe diff√©rente de celle de RMarkdown, ici par exemple pour le bloc me permettant de charger les librairies et les donn√©es :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| include: false&lt;/span&gt;

&lt;span class="gh"&gt;# Librairies&lt;/span&gt;
library(dplyr)
library(ggplot2)

&lt;span class="gh"&gt;# Th√®me et styles ggplot2&lt;/span&gt;
options(ggplot2.discrete.colour = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
options(ggplot2.discrete.fill = RColorBrewer::brewer.pal(11, &amp;quot;Set2&amp;quot;))
theme_set(theme_bw())

&lt;span class="gh"&gt;# Import de la base&lt;/span&gt;
base_patients &amp;lt;- read.csv(&amp;quot;base_fictive_patients.csv&amp;quot;)
```                                                                       &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;La partie &lt;code&gt;#| include: false&lt;/code&gt; permet d'indiquer que je ne souhaite pas que ce code ni sa sortie n'apparaisse dans le rapport.&lt;br&gt;
√Ä noter enfin qu'il existe de nombreuses nouvelles possibilit√©s avec Quarto, comme le fait de permettre √† l'utilisateur d'afficher ou non le code ayant permis de g√©n√©rer un r√©sultat (&lt;code&gt;code-fold&lt;/code&gt;) et de lui laisser le choix du comportement par d√©faut de ces blocs de code (&lt;code&gt;code-tools&lt;/code&gt;). Je vous laisse explorer les &lt;a href="https://quarto.org/docs/output-formats/html-code.html"&gt;pages de documentation li√©es √† ces points&lt;/a&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;    &lt;/p&gt;
&lt;h1 id="utilisation-des-onglets"&gt;Utilisation des onglets&lt;/h1&gt;
&lt;p&gt;Une de nos fonctionnalit√©s pr√©f√©r√©es de RMarkdown, c'√©tait la possibilit√© de faire des onglets. Comme pour la table des mati√®res flottante, cela permet d'all√©ger des rapports contenant parfois beaucoup de r√©sultats et cela facilite la navigation de la personne qui cherche un des nombreux r√©sultats qui se trouve dans votre rapport. √âvidemment cela reste possible avec Quarto, en utilisant une syntaxe l√©g√®rement diff√©rente. On va en effet encapsuler notre code Markdown dans une instruction &lt;code&gt;::: panel-tabset&lt;/code&gt;. Tous les titres qui suivront seront automatiquement cr√©√©s comme des onglets. Dans notre rapport fictif, on va par exemple pr√©senter la r√©partition de chacune des variables caract√®re dans un onglet de la mani√®re suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gu"&gt;## Variables caract√®res&lt;/span&gt;

::: panel-tabset
&lt;span class="gu"&gt;### Sexe&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Sexe) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Tabagisme&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Fumeur) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;

&lt;span class="gu"&gt;### Poids&lt;/span&gt;

```{r}
base_patients |&amp;gt; 
  count(Poids) |&amp;gt; 
  mutate(Proportion = n / sum(n),
         Proportion = glue::glue(&amp;quot;{round(100 * Proportion)} %&amp;quot;)) |&amp;gt; 
  knitr::kable()
```                                                                &amp;#39;
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le r√©sultat obtenu est le suivant :   &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets.gif"&gt;  &lt;/p&gt;
&lt;h1 id="generation-dynamique-de-contenu-markdown"&gt;G√©n√©ration dynamique de contenu markdown&lt;/h1&gt;
&lt;p&gt;Une autre fonctionnalit√© tr√®s pratique de RMarkdown que l'on retrouve dans Quarto est la possibilit√© de g√©n√©rer automatiquement le code Markdown, et pas seulement les blocs de code R ou Python. Cela est tr√®s pratique quand on souhaite par exemple automatiser la cr√©ation d'un dictionnaire de variables, ou faire un rapport standardis√© pour diff√©rentes donn√©es.  &lt;/p&gt;
&lt;p&gt;Ici par exemple on peut se dire qu'on va pr√©senter les variables num√©riques de cette fa√ßon. Comme pour les variables caract√®res, on va pr√©senter un tableau de statistiques par variable dans chaque onglet mais cette fois on va faire une boucle sur les variables num√©riques et ne pas r√©p√©ter le code pour chaque variable. Pour cela, on code dans un bloc R avec le param√®tre &lt;code&gt;results: asis&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| results: asis&lt;/span&gt;
&lt;span class="gh"&gt;# boucle sur les variables num√©riques&lt;/span&gt;
for (var_num in names(base_patients |&amp;gt; select(where(is.numeric)))){
  # titre de l&amp;#39;onglet
  cat(glue::glue(&amp;quot;### {var_num}&amp;quot;))  
  cat(&amp;quot;\n&amp;quot;)
  base_patients |&amp;gt; 
    summarise(
      across(all_of(var_num), list(Min = min,
                                   Moyenne = mean,
                                   Mediane = median,
                                   Max = max),
             .names = &amp;quot;{.fn}&amp;quot;)) |&amp;gt; 
    knitr::kable(format.args = list(digits = 2, nsmall = 2)) |&amp;gt; 
    print()
  # retour √† la ligne
  cat(&amp;quot;\n&amp;quot;)
}

```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il est important de noter plusieurs choses :&lt;br&gt;
- Le code Mardown doit se trouver dans une instructions &lt;code&gt;cat()&lt;/code&gt;&lt;br&gt;
- Ne pas oublier d'ajouter des retours √† la ligne avec &lt;code&gt;cat("\n")&lt;/code&gt; &lt;br&gt;
- Il faut afficher les sorties de R que l'on souhaite dans un &lt;code&gt;print()&lt;/code&gt;  &lt;/p&gt;
&lt;p&gt;Le r√©sultat obtenu est le m√™me que pour les variables caract√®res, mais avec un code factoris√© et g√©n√©ralisable √† diff√©rentes donn√©es en entr√©e :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/onglets_num.gif"&gt;  &lt;/p&gt;
&lt;h1 id="les-references-aux-graphiques-et-tableaux"&gt;Les r√©f√©rences aux graphiques et tableaux&lt;/h1&gt;
&lt;p&gt;Vous devez le savoir si vous avez d√©j√† men√© des analyses statistiques, le tableau 1 ne le reste pas forc√©ment tout au long du processus, le graphique 3 appara√Æt finalement souvent en second, etc... Avec Quarto, comme c'√©tait le cas avec RMarkdown, on peut automatiser le r√©f√©rencement aux diff√©rents √©l√©ments de notre rapport tr√®s simplement. Dans le code, on va indiquer un label et un titre au bloc de code correspondant √† notre graphique avec &lt;code&gt;#| label: fig-mon-label&lt;/code&gt; et &lt;code&gt;#| fig-cap: "Titre de mon graphique"&lt;/code&gt;, comme ci-dessous pour les deux graphiques de notre rapport :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;```{r}
&lt;span class="gh"&gt;#| label: fig-glucose&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Taux de glucose et pr√©sence de la maladie&amp;quot;&lt;/span&gt;

base_patients %&amp;gt;% 
  ggplot(aes(x = factor(Maladie), y = Taux_de_glucose)) + 
  geom_boxplot(aes(fill = factor(Maladie)), alpha = 0.4) + 
  geom_jitter(aes(color = factor(Maladie)), size = 0.4, alpha = 0.9) + 
  theme(legend.position = &amp;quot;none&amp;quot;) + 
   labs(x = &amp;quot;Pr√©sence de la maladie&amp;quot;, 
        y = &amp;quot;Taux de glucose&amp;quot;)
```                                                                   &amp;#39;

```{r}
&lt;span class="gh"&gt;#| label: fig-sexe-poids&lt;/span&gt;
&lt;span class="gh"&gt;#| fig-cap: &amp;quot;Sexe, poids et pr√©valence de la maladie&amp;quot;&lt;/span&gt;
base_patients |&amp;gt; 
  group_by(Sexe, Poids) |&amp;gt; 
  summarise(taux = mean(Maladie),
            .groups = &amp;quot;drop&amp;quot;) |&amp;gt; 
  ggplot(aes(x = Poids, y = taux, fill = Sexe)) + 
  geom_col(position = &amp;quot;dodge&amp;quot;, width = 0.5) + 
  scale_y_continuous(labels = ~ scales::percent(.)) + 
  labs(x = &amp;quot;Tabagisme&amp;quot;, y = &amp;quot;Pr√©valence de la maladie&amp;quot;)
```                                                                   &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Il n'y aura ensuite plus qu'√† faire r√©f√©rence √† la sortie voulue dans le texte avec la syntaxe &lt;code&gt;@fig-mon-label&lt;/code&gt; qui permettra de num√©roter correctement le graphique ou le tableau par rapport √† sa position dans le rapport. De plus, par d√©faut dans Quarto, l'√©l√©ment est cliquable ce qui permet de directement retrouver l'√©l√©ment en question. Enfin, en passant juste la souris sur l'√©l√©ment, on peut voir une pr√©visualisation de celui-ci :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/cross-ref.gif"&gt;  &lt;/p&gt;
&lt;h1 id="bonus-les-blocs-dannotation"&gt;Bonus : les blocs d'annotation&lt;/h1&gt;
&lt;p&gt;On a ainsi effleur√© qu'une toute petite partie des possibilit√©s de Quarto, mais on ne voulait pas partir sans vous parler des &lt;em&gt;Callout Blocks&lt;/em&gt;. Ce sont des blocs de texte mis en forme, permettant de g√©n√©rer diff√©rents types de messages (note, avertissement, erreurs...). On peut √©galement les rendre d√©pliables de mani√®re √† ce que le texte ne s'affiche que si l'utilisateur le souhaite.   &lt;/p&gt;
&lt;p&gt;Voici par exemple le code pour une note (d√©pliable) et un avertissement :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;::: {.callout-note collapse=&amp;quot;true&amp;quot;}   
Pour rappel, cette note s&amp;#39;appuie sur des donn√©es compl√®tement fictives et ne devrait pas r√©volutionner la recherche scientifique.
:::  

::: {.callout-caution}  
L&amp;#39;utilisation des blocs d&amp;#39;annotation de Quarto peut √™tre addictive, merci de ne pas en abuser.
:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le r√©sultat obtenu est le suivant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/quarto_rmarkdown/callout-bloc.gif"&gt;  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans cet article, nous n'avons pr√©sent√© qu'une petite partie du potentiel de Quarto. Mais vous pouvez explorer aussi toutes les autres possibilit√©s (Dashboards Observable/RShiny, utilisation de Python/Julia, r√©daction de livres, d√©ploiement de vos r√©sultats sur un serveur...) dans &lt;a href="https://quarto.org/docs/guide/"&gt;la documentation officielle du projet&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Vous souhaitez mettre en place des rapports Quarto automatis√©s dans votre entreprise ou votre laboratoire? Vous pr√©f√©rez l'utiliser pour votre premier dashboard? N'h√©sitez pas √† &lt;a href="https://statoscop.fr/contact"&gt;nous contacter&lt;/a&gt;! &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! Le faux rapport html sur lequel s'appuie cette note est &lt;a href="https://statoscop.fr/static/rapport_quarto.html"&gt;disponible en ligne&lt;/a&gt;. Vous retrouverez le code ayant permis de le g√©n√©rer sur le &lt;a href="https://github.com/Statoscop/notebooks-blog/tree/main/Rapport%20Quarto"&gt;github de Statoscop&lt;/a&gt;. Vous pouvez aussi &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="quarto"></category><category term="rmarkdown"></category><category term="rapport"></category></entry><entry><title>Coder des fonctions dans le tidyverse</title><link href="https://blog.statoscop.fr/coder-des-fonctions-dans-le-tidyverse.html" rel="alternate"></link><published>2023-11-28T00:00:00+01:00</published><updated>2023-11-28T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2023-11-28:/coder-des-fonctions-dans-le-tidyverse.html</id><summary type="html">&lt;p&gt;Quelques trucs pour coder facilement ses propres fonctions en utilisant la syntaxe du tidyverse.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#le-tidyverse-et-levaluation-non-standard"&gt;Le tidyverse et l'√©valuation non standard&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#faire-reference-aux-parametres-de-ma-fonction"&gt;Faire r√©f√©rence aux param√®tres de ma fonction&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#parametres-renseignes-en-symboles"&gt;Param√®tres renseign√©s en symboles&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#parametres-renseignes-en-chaines-de-caracteres"&gt;Param√®tres renseign√©s en cha√Ænes de caract√®res&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#nommer-des-variables-en-fonction-des-parametres"&gt;Nommer des variables en fonction des param√®tres&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#coder-une-fonction-avec-nimporte-quel-nombre-de-parametres"&gt;Coder une fonction avec n'importe quel nombre de param√®tres&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#utilisation-dacross"&gt;Utilisation d'across&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-pick-et"&gt;Utilisation de pick et ...&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cet article, on s'int√©resse aux mani√®res de coder des fonctions en utilisant la syntaxe du &lt;code&gt;tidyverse&lt;/code&gt;. Apr√®s avoir rappel√© quelques principes de l'√©valuation non standard dans le tidyverse, on pr√©sente concr√®tement les mani√®res de faire r√©f√©rence aux param√®tres de notre fonction, qu'ils soient renseign√©s sous forme de symboles ou de cha√Ænes de caract√®res. On termine avec des astuces pour coder des fonctions plus flexibles, notamment sans avoir √† fixer le nombre de param√®tres en amont.&lt;/p&gt;
&lt;h1 id="le-tidyverse-et-levaluation-non-standard"&gt;Le tidyverse et l'√©valuation non standard&lt;/h1&gt;
&lt;p&gt;La syntaxe du &lt;code&gt;tidyverse&lt;/code&gt; s'appuie sur des fonctions aux noms explicites et une grande facilit√© d'utilisation. Le principe est de rendre le code le plus lisible possible. Tout cela permet de coder de mani√®re intuitive et peu verbeuse. Mais lorsqu'il s'agit de coder ses propres fonctions, les choses se compliquent. Prenons par exemple la fonction suivante, qui permet de donner le nombre d'observations d'un dataframe dont une valeur num√©rique est inf√©rieure √† un certain seuil :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;## Attachement du package : &amp;#39;dplyr&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;## Les objets suivants sont masqu√©s depuis &amp;#39;package:stats&amp;#39;:&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;##     filter, lag&lt;/span&gt;
&lt;span class="c1"&gt;## Les objets suivants sont masqu√©s depuis &amp;#39;package:base&amp;#39;:&lt;/span&gt;
&lt;span class="c1"&gt;## &lt;/span&gt;
&lt;span class="c1"&gt;##     intersect, setdiff, setequal, union&lt;/span&gt;

&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;L'appel de cette fonction pour obtenir le nombre de voitures avec &lt;code&gt;mpg &amp;lt;= 20&lt;/code&gt; donne l'erreur suivante:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;data&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## Error in `filter()`:&lt;/span&gt;
&lt;span class="c1"&gt;## ‚Ñπ In argument: `x1 &amp;lt;= seuil`.&lt;/span&gt;
&lt;span class="c1"&gt;## Caused by error:&lt;/span&gt;
&lt;span class="c1"&gt;## ! objet &amp;#39;mpg&amp;#39; introuvable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Cette erreur est la cons√©quence d'une propri√©t√© importante du &lt;code&gt;tidyverse&lt;/code&gt; : le &lt;strong&gt;data masking&lt;/strong&gt;. C'est ce qui fait que les verbes de dplyr √©valuent l'appel d'une fonction √† un objet au sein du dataframe auquel elle s'applique. Ainsi, on fait appel √† des fonctions avec la syntaxe fonction(&lt;code&gt;data&lt;/code&gt;, &lt;code&gt;var1&lt;/code&gt;, &lt;code&gt;var2&lt;/code&gt;, &lt;code&gt;var3&lt;/code&gt;) et non fonction(&lt;code&gt;data$var1&lt;/code&gt;, &lt;code&gt;data$var2&lt;/code&gt;, &lt;code&gt;data$var3&lt;/code&gt;). Coupl√© √† l'utilisation du &lt;em&gt;pipe&lt;/em&gt; (que ce soit le &lt;code&gt;%&amp;gt;%&lt;/code&gt; de &lt;code&gt;magritr&lt;/code&gt; ou le r√©cent &lt;code&gt;|&amp;gt;&lt;/code&gt; de R auquel nous commen√ßons √† nous convertir), cette fonctionnalit√© permet d'obtenir un code bien plus ais√© et agr√©able √† √©crire et √† lire. Ainsi, dans &lt;code&gt;dplyr&lt;/code&gt;, on consid√®re un peu &lt;strong&gt;le dataframe comme un environnement&lt;/strong&gt; et les colonnes de ce dataframe comme des √©l√©ments de cet environnement. &lt;/p&gt;
&lt;p&gt;Seulement voil√†, cette √©valuation n'est pas non-standard pour rien : ici lors de l'appel de &lt;code&gt;my_filter&lt;/code&gt; l'objet &lt;code&gt;mpg&lt;/code&gt; est cherch√© dans l'environnement et il n'est pas trouv√©. Et pour cause : il n'existe pas, contrairement √† &lt;code&gt;mtcars$mpg&lt;/code&gt;. &lt;/p&gt;
&lt;h1 id="faire-reference-aux-parametres-de-ma-fonction"&gt;Faire r√©f√©rence aux param√®tres de ma fonction&lt;/h1&gt;
&lt;p&gt;Comment donc coder comme un d√©veloppeur de Posit et profiter de cette syntaxe avantageuse? Si les choses ne sont pas aussi simples et intuitives qu'avec base R, elles se sont r√©cemment simplifi√©es et ne devraient pas vous poser trop de probl√®mes.  &lt;/p&gt;
&lt;h2 id="parametres-renseignes-en-symboles"&gt;Param√®tres renseign√©s en symboles&lt;/h2&gt;
&lt;p&gt;Si les param√®tres sont renseign√©s "en dur", ou en symboles, comme c'est le cas dans les verbes de &lt;code&gt;dplyr&lt;/code&gt;, on privil√©giera l'√©criture &lt;code&gt;{{ var }}&lt;/code&gt;. Elle s'est r√©cemment substitu√©e √† l'ancienne option, plus √©nigmatique, de &lt;code&gt;!!enquo(var)&lt;/code&gt;. &lt;br&gt;
Testons cela sur notre petite fonction :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Merveilleux! Mais si, pour une raison ou pour une autre, vous souhaiteriez que l'utilisateur de votre fonction entre le param√®tre sous forme de cha√Æne de caract√®re?&lt;/p&gt;
&lt;h2 id="parametres-renseignes-en-chaines-de-caracteres"&gt;Param√®tres renseign√©s en cha√Ænes de caract√®res&lt;/h2&gt;
&lt;p&gt;Dans ce cas, on revient √† une notation classique de base R : &lt;code&gt;df[["var"]]&lt;/code&gt;. Sauf que, dans un contexte d'expressions cha√Æn√©es, on va utiliser la notation bien utile &lt;code&gt;.data[["var"]]&lt;/code&gt; qui fait r√©f√©rence au dataframe de la cha√Æne d'expression &lt;strong&gt;dans son √©tat au moment de l'appel&lt;/strong&gt;. En effet, si je voulais faire r√©f√©rence au dataframe par son nom je pourrais me retrouver dans cette situation :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;transmute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;carb_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;carb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## Error in `transmute()`:&lt;/span&gt;
&lt;span class="c1"&gt;## ‚Ñπ In argument: `carb_2 = mtcars[[&amp;quot;carb&amp;quot;]]^2`.&lt;/span&gt;
&lt;span class="c1"&gt;## Caused by error:&lt;/span&gt;
&lt;span class="c1"&gt;## ! `carb_2` must be size 18 or 1, not 32.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Les tailles des vecteurs ne correspondent pas! En effet, le filtre appliqu√© n'est pas pris en compte au moment de l'appel √† la variable &lt;code&gt;carb&lt;/code&gt;. La notation &lt;code&gt;.data&lt;/code&gt; r√©soud bien ce souci :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;transmute&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;carb_2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.data&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;carb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="o"&gt;^&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##                   carb_2&lt;/span&gt;
&lt;span class="c1"&gt;## Hornet Sportabout      4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Pour en revenir √† notre fonction, il est donc tr√®s ais√© avec cette notation de d√©finir le param√®tre en cha√Æne de caract√®res :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.data&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Mais si vous pr√©f√©rez l'ancienne notation, pour les param√®tres renseign√©s en cha√Ænes de caract√®res c'est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!!&lt;/span&gt;&lt;span class="nf"&gt;sym&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;nrow&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## [1] 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="nommer-des-variables-en-fonction-des-parametres"&gt;Nommer des variables en fonction des param√®tres&lt;/h2&gt;
&lt;p&gt;Imaginons maintenant que nous voulions cr√©er une indicatrice en fonction du seuil d'une variable num√©rique, et que nous aimerions nommer cette indicatrice en fonction de la variable num√©rique qu'elle d√©crit :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans cette version ma nouvelle variable va s'appeler &lt;code&gt;x1_indic&lt;/code&gt;, et non prendre le nom de la variable num√©rique de &lt;code&gt;x1&lt;/code&gt;. Et l√† encore c'est la double accolade qui va nous permettre de r√©soudre ce probl√®me, mais pas seulement. Pour cela, on fait &lt;strong&gt;r√©f√©rence au nom du param√®tre au sein d'une double accolade&lt;/strong&gt;. De plus, le nom de la variable ainsi cr√©√©e est donn√© entre guillemets. On peut √©galement ajouter d'autres caract√®res. Enfin, &lt;strong&gt;le signe &lt;code&gt;=&lt;/code&gt; doit √™tre remplac√© par &lt;code&gt;:=&lt;/code&gt;&lt;/strong&gt;. Cela donne :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_indic&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ x1 }}_indic&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;if_else&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On v√©rifie avec &lt;code&gt;mpg&lt;/code&gt; que la variable &lt;code&gt;mpg_indic&lt;/code&gt; est bien cr√©√© :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;my_indic&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;seuil&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg_indic&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##   mpg_indic  n&lt;/span&gt;
&lt;span class="c1"&gt;## 1         0 14&lt;/span&gt;
&lt;span class="c1"&gt;## 2         1 18&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="coder-une-fonction-avec-nimporte-quel-nombre-de-parametres"&gt;Coder une fonction avec n'importe quel nombre de param√®tres&lt;/h1&gt;
&lt;p&gt;Essayons maintenant d'aller un peu plus loin! On explore dans cette partie &lt;strong&gt;des mani√®res plus flexibles de coder nos fonctions&lt;/strong&gt;, sans fixer √† l'avance le nombre de param√®tres.  &lt;/p&gt;
&lt;h2 id="utilisation-dacross"&gt;Utilisation d'&lt;code&gt;across&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;La solution la plus directe pour permettre √† l'utilisateur de votre fonction de d√©finir le nombre de param√®tres qu'il souhaite est en g√©n√©ral d'utiliser la puissance d'&lt;code&gt;across()&lt;/code&gt;. On parle de mani√®re d√©taill√©e de ce verbe dans &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;cet article de notre blog&lt;/a&gt;. Vous pouvez √©galement explorer toutes ses possibilit√©s dans &lt;a href="https://www.icem7.fr/r/across-plus-puissant-flexible-quil-ny-parait/"&gt;cet article du blog d'Icem7&lt;/a&gt;. &lt;br&gt;
Dans le cas d'une fonction, c'est aussi la syntaxe &lt;code&gt;{{ var }}&lt;/code&gt; qui nous permettra de l'utiliser. Imaginez par exemple que vous souhaitiez cr√©er une fonction permettant des statistiques sur un certain nombre de variables d√©finies par l'utilisateur. Une telle fonction s'√©crirait ainsi :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On peut ensuite appeler la fonction en d√©finissant &lt;strong&gt;le param√®tre &lt;code&gt;vars_mean&lt;/code&gt; comme un vecteur de symboles&lt;/strong&gt;, ou comme un seul symbole dans le cas o√π on ne voudrait la moyenne que d'une variable :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;##       disp&lt;/span&gt;
&lt;span class="c1"&gt;## 1 230.7219&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mpg&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;disp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;qsec&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Si nous souhaitons que l'utilisateur entre un vecteur de cha√Ænes de caract√®res, cela fonctionne aussi car &lt;strong&gt;across utilise la tidyselection&lt;/strong&gt; qui tol√®re les appels aux vecteurs de cha√Ænes de caract√®res. Il faut juste l'encapsuler dans une fonction appropri√©e, ici &lt;code&gt;all_of()&lt;/code&gt; pour s√©lectionner tous les √©l√©ments du vecteur :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;all_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Notez qu'avec &lt;code&gt;any_of()&lt;/code&gt;, on autorise l'utilisateur √† entre &lt;strong&gt;des noms de colonnes n'existant pas dans le dataframe&lt;/strong&gt;. Ils sont alors juste √©cart√©s de la s√©lection, sans que cela g√©n√®re des erreurs :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;any_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var3&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal.Length&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal.Width&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##        mpg     disp     qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062 230.7219 17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Enfin, on peut utiliser l'argument &lt;code&gt;.names&lt;/code&gt; de la fonction &lt;code&gt;across&lt;/code&gt; pour permettre un &lt;strong&gt;renommage des variables au souhait de l'utilisateur&lt;/strong&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;prefixe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;all_of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{prefixe}_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;mean_multiple_var2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mpg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;disp&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;qsec&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;##   mean_mpg mean_disp mean_qsec&lt;/span&gt;
&lt;span class="c1"&gt;## 1 20.09062  230.7219  17.84875&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans cette version, l'utilisateur peut &lt;strong&gt;param√©trer le pr√©fixe qu'il souhaite&lt;/strong&gt;, gr√¢ce √† l'utilisation de la syntaxe propre au &lt;a href="https://glue.tidyverse.org/"&gt;package &lt;code&gt;glue&lt;/code&gt;&lt;/a&gt;. Notez l'utilisation de &lt;code&gt;.col&lt;/code&gt;, interne √† &lt;code&gt;across()&lt;/code&gt;, pour faire r√©f√©rence au nom de la variable.   &lt;/p&gt;
&lt;h2 id="utilisation-de-pick-et"&gt;Utilisation de &lt;code&gt;pick&lt;/code&gt; et &lt;code&gt;...&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;pick()&lt;/code&gt; (√† partir de dplyr &amp;gt;= 1.1.4) permet de s√©lectionner un nombre ind√©termin√© de param√®tres dans les fonctions du type &lt;code&gt;group_by()&lt;/code&gt;, &lt;code&gt;select()&lt;/code&gt;...c'est-√†-dire les fonctions permettant de s√©lectionner un sous-ensemble de la base. C'est l'√©quivalent de &lt;code&gt;across()&lt;/code&gt; pour les fonctions portant sur toute la base et non sur chacune des colonnes. Par exemple, la fonction suivante permet de grouper par des variables du choix de l'utilisateur et de sortir les moyennes de toutes les variables num√©riques :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_group_by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;pick&lt;/span&gt;&lt;span class="p"&gt;({{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}}))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;vars_group&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cyl&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## `summarise()` has grouped output by &amp;#39;am&amp;#39;. You can override using the `.groups`&lt;/span&gt;
&lt;span class="c1"&gt;## argument.&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 6 √ó 11&lt;/span&gt;
&lt;span class="c1"&gt;## # Groups:   am [2]&lt;/span&gt;
&lt;span class="c1"&gt;##      am   cyl mean_mpg mean_disp mean_hp mean_drat mean_wt mean_qsec mean_vs&lt;/span&gt;
&lt;span class="c1"&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1     0     4     22.9     136.     84.7      3.77    2.94      21.0   1    &lt;/span&gt;
&lt;span class="c1"&gt;## 2     0     6     19.1     205.    115.       3.42    3.39      19.2   1    &lt;/span&gt;
&lt;span class="c1"&gt;## 3     0     8     15.0     358.    194.       3.12    4.10      17.1   0    &lt;/span&gt;
&lt;span class="c1"&gt;## 4     1     4     28.1      93.6    81.9      4.18    2.04      18.4   0.875&lt;/span&gt;
&lt;span class="c1"&gt;## 5     1     6     20.6     155     132.       3.81    2.76      16.3   0    &lt;/span&gt;
&lt;span class="c1"&gt;## 6     1     8     15.4     326     300.       3.88    3.37      14.6   0    &lt;/span&gt;
&lt;span class="c1"&gt;## # ‚Ñπ 2 more variables: mean_gear &amp;lt;dbl&amp;gt;, mean_carb &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Comme pour &lt;code&gt;across&lt;/code&gt;, vous pouvez aussi utiliser les verbes de la tidyselection : &lt;code&gt;all_of&lt;/code&gt;, &lt;code&gt;any_of&lt;/code&gt;, &lt;code&gt;starts_with&lt;/code&gt;, etc...  &lt;/p&gt;
&lt;p&gt;Enfin, il est possible d'utiliser la syntaxe &lt;code&gt;...&lt;/code&gt;, de la mani√®re suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;my_group_by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;mean_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nf"&gt;my_group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mtcars&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;am&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cyl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## `summarise()` has grouped output by &amp;#39;am&amp;#39;. You can override using the `.groups`&lt;/span&gt;
&lt;span class="c1"&gt;## argument.&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 3 √ó 11&lt;/span&gt;
&lt;span class="c1"&gt;## # Groups:   am [1]&lt;/span&gt;
&lt;span class="c1"&gt;##      am   cyl mean_mpg mean_disp mean_hp mean_drat mean_wt mean_qsec mean_vs&lt;/span&gt;
&lt;span class="c1"&gt;##   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1     0     4     22.9      136.    84.7      3.77    2.94      21.0       1&lt;/span&gt;
&lt;span class="c1"&gt;## 2     0     6     19.1      205.   115.       3.42    3.39      19.2       1&lt;/span&gt;
&lt;span class="c1"&gt;## 3     0     8     15.0      358.   194.       3.12    4.10      17.1       0&lt;/span&gt;
&lt;span class="c1"&gt;## # ‚Ñπ 2 more variables: mean_gear &amp;lt;dbl&amp;gt;, mean_carb &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Cette notation a l'avantage d'√™tre tr√®s simple et flexible : on peut d√©finir √† la place des &lt;code&gt;...&lt;/code&gt; autant de param√®tres diff√©rents que l'on veut. Mais elle ne permet pas de diff√©rencier deux groupes de param√®tres diff√©rents, si l'on veut par exemple d√©finir d'une part des variables sur lesquels grouper, et d'autre des variables sur lesquels s√©lectionner.       &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Le &lt;code&gt;tidyverse&lt;/code&gt;, c'est donc plein d'astuces pour rendre le code tr√®s facile √† √©crire et √† lire, mais cela implique quelques √©tapes suppl√©mentaires quand on veut coder ses propres fonctions. On esp√®re que cet article vous aura aid√©s √† y voir plus clair. Pour creuser le sujet, vous pouvez vous r√©f√©rer √† la page &lt;a href="https://dplyr.tidyverse.org/articles/programming.html#user-supplied-data"&gt;Programming with dplyr&lt;/a&gt; sur la documentation officielle de &lt;code&gt;dplyr&lt;/code&gt;. Vous pouvez √©galement consulter, sur le site de &lt;code&gt;rlang&lt;/code&gt;, les pages &lt;a href="https://rlang.r-lib.org/reference/glue-operators.html"&gt;Name injection&lt;/a&gt; et &lt;a href="https://rlang.r-lib.org/reference/topic-data-mask-programming.html"&gt;Data mask programming patterns&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.   &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="tidyverse"></category><category term="dplyr"></category><category term="across"></category></entry><entry><title>Taux standardis√©s : calcul et interpr√©tation avec R</title><link href="https://blog.statoscop.fr/taux-standardises-calcul-et-interpretation-avec-r.html" rel="alternate"></link><published>2023-05-17T00:00:00+02:00</published><updated>2023-05-17T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2023-05-17:/taux-standardises-calcul-et-interpretation-avec-r.html</id><summary type="html">&lt;p&gt;Pr√©sentation de la m√©thode de standardisation directe sur les taux de survie des passagers du Titanic.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donn√©es&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-√†-pas des taux standardis√©s de survie au naufrage du Titanic&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#pour-conclure"&gt;Pour conclure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cette note nous pr√©sentons la m√©thode de standardisation directe des taux, qui permet de comparer des fr√©quences d'√©v√®nement entre diff√©rentes sous-populations en contr√¥lant par une ou plusieurs autres variables. Apr√®s avoir d√©fini le principe g√©n√©ral de standardisation directe, on pr√©sente une mise en oeuvre pas-√†-pas de la m√©thode sur une √©tude de cas √† partir des donn√©es des passagers du Titanic.  &lt;/p&gt;
&lt;h1 id="principe-de-la-standardisation-directe"&gt;Principe de la standardisation directe&lt;/h1&gt;
&lt;p&gt;Les m√©thodes de standardisation des taux sont principalement √©tudi√©es en √©pid√©miologie. Elles permettent en effet de r√©pondre au probl√®me suivant : comment &lt;strong&gt;comparer des indicateurs √©pid√©miologiques&lt;/strong&gt; entre diff√©rents pays ayant leurs sp√©cificit√©s d√©mographiques? &lt;br&gt;
On peut lire par exemple sur le site des &lt;a href="https://donnees.banquemondiale.org"&gt;donn√©es de la banque mondiale&lt;/a&gt; que le taux de mortalit√© en 2020 en Australie est de 6 pour 1000 habitants, contre 12 pour 1000 habitants en Allemagne. Or, cet indicateur est bien s√ªr fortement influenc√© par la structure d'√¢ge de la population concern√©e. Pour correctement comparer cet indicateur entre l'Australie et l'Allemagne et √©ventuellement en tirer des conclusions sur des diff√©rences de qualit√© de vie entre les deux pays, il faudrait &lt;strong&gt;comparer ces taux √† structure d'√¢ge constante&lt;/strong&gt;. &lt;br&gt;
C'est pr√©cis√©ment ce que permet de faire la standardisation directe. Il est n√©cessaire pour cela de disposer du d√©tail de l'indicateur par tranche d'√¢ge dans chacun des pays. Dans notre exemple, une fois qu'on dispose des taux de mortalit√© par tranche d'√¢ge en Australie et en Allemagne, on les  applique √† &lt;strong&gt;une structure d'√¢ge de r√©f√©rence&lt;/strong&gt;, qui peut √™tre soit celle d'un des deux pays, soit celle du monde entier si on dispose de l'information. On peut alors obtenir un nouveau taux de mortalit√© global &lt;strong&gt;corrig√© de l'effet li√© √† l'√¢ge&lt;/strong&gt; et permettant une comparaison plus pertinente entre les pays. Voyons concr√®tement comment on peut mettre en oeuvre cette m√©thode sur une √©tude de cas en R.  &lt;/p&gt;
&lt;h1 id="analyses-exploratoires-des-donnees"&gt;Analyses exploratoires des donn√©es&lt;/h1&gt;
&lt;p&gt;Pour notre petit exemple, on s'appuie sur un dataset tr√®s connu : les &lt;a href="https://www.kaggle.com/c/titanic"&gt;donn√©es des passagers du Titanic&lt;/a&gt;. Les informations qui nous int√©ressent ici sont la classe √©conomique, l'√¢ge et le fait d'avoir surv√©cu ou non au naufrage. On ne garde que les observations ayant des valeurs renseign√©es pour ces 3 variables. On veut r√©pondre √† la question suivante : &lt;strong&gt;le fait d'√™tre dans une classe √©conomique ais√©e augmente-t-elle les chances de survie au nauffrage?&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;La premi√®re approche de cette question est bien s√ªr de calculer les taux de survie par classe √©conomique. le r√©sultat est le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6373239&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4406130&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2614770&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet une forte disparit√© des taux de survie en fonction de la classe √©conomique, puisque les passagers de 1ere classe sont 63,7% √† survivre, contre 44,1% des passagers de seconde classe et 26,1% des passagers de 3e classe.&lt;br&gt;
Est-on bien s√ªr cependant que l'on observe &lt;strong&gt;l'effet de la classe √©conomique et pas d'un autre facteur de confusion&lt;/strong&gt;? On peut par exemple imaginer que l'√¢ge a un effet important sur la chance de survie, et qu'il est √©galement li√© √† la classe √©conomique choisie pour le voyage. V√©rifions ces hypoth√®ses en croisant la r√©partition en tranches d'√¢ge dans chaque classe :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# √Ä ce stade le df n&amp;#39;est plus group√© que par pclass&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Proportion&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;Proportion&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0528169&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3239437&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3697183&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2535211&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1264368&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5823755&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1954023&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0957854&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2115768&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6047904&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1576846&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0259481&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate en effet que la classe 3 comporte bien plus de mineurs et bien moins de passagers de plus de cinquante ans que la premi√®re classe. Comme on s'y attendait, &lt;strong&gt;plus la classe √©conomique est ais√©e, plus les passagers ont un √¢ge √©lev√©&lt;/strong&gt;. Voyons maintenant si les taux de survie varient en fonction de l'√¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5259740&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3765996&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4085106&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4000000&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Les taux de survie ne semblent pas beaucoup varier en fonction de l'√¢ge, √† part pour les mineurs qui ont un taux de survie bien sup√©rieur aux autres. Croisons maintenant les taux de survie en fonction de la classe √©conomique &lt;strong&gt;et&lt;/strong&gt; de la tranche d'√¢ge :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tx_survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;pclass&lt;/th&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;tx_survie&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8666667&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.7065217&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6285714&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;1&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5138889&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8787879&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4144737&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3333333&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;2&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2400000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;3&lt;/td&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On constate l√† plusieurs choses :&lt;br&gt;
- Au sein de chaque classe √©conomique il y a un lien tr√®s clair entre l'√¢ge et le taux de survie : plus on vieillit pluys celui-ci baisse.&lt;br&gt;
- Au sein de chaque tranche d'√¢ge, plus la classe √©conomique est √©lev√©e plus la chance de survie augmente. La seule exception est la tranche d'√¢ge 0 - 17 ans de la seconde classe qui a un taux de survie l√©g√®rement sup√©rieur √† la population du m√™me √¢ge de la 1ere classe (87,9% contre 86,7%).  &lt;/p&gt;
&lt;p&gt;Au vu de ces √©l√©ments il appara√Æt l√©gitime de calculer des taux standardis√©s pour comparer des fr√©quences de survie au sein de chaque classe corrig√©es de l'effet de l'√¢ge.  &lt;/p&gt;
&lt;h1 id="calcul-pas-a-pas-des-taux-standardises-de-survie-au-naufrage-du-titanic"&gt;Calcul pas-√†-pas des taux standardis√©s de survie au naufrage du Titanic&lt;/h1&gt;
&lt;p&gt;Au vu des r√©sultats des taux de survie crois√©s par classe et √¢ge, on sait d√©j√† que la classe √©conomique et l'√¢ge jouent sur la chance de survie. Le calcul des taux standardis√©s de survie va permettre de quantifier &lt;strong&gt;l'effet de la classe √©conomique isol√© de l'effet √¢ge&lt;/strong&gt;. Le principe est le suivant : on calcule le taux de survie que l'on observerait dans chaque classe √©conomique &lt;strong&gt;si la r√©partition des passagers en classe d'√¢ge √©tait la m√™me que celle de la population de r√©f√©rence&lt;/strong&gt;. Dans notre exemple, la population de r√©f√©rence est l'ensemble des passagers.&lt;/p&gt;
&lt;p&gt;La premi√®re √©tape est de r√©cup√©rer les effectifs de classe d'√¢ge de la population de r√©f√©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eff&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;154&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;547&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;235&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;On calcule ensuite comme pr√©c√©demment les taux de survie par tranche d'√¢ge de chaque classe √©conomique et on transforme la table pour avoir une colonne par classe √©conomique.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;titanic_data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;tr_age&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# taux de survie par classe et tranche d&amp;#39;√¢ge&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survived&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;n&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# on transforme la table en largeur pour avoir trois colonnes&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# donnant le taux de survie&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;tidyr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;pivot_wider&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;names_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pclass&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;values_from&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="c1"&gt;# option names_glue pour sp√©cifier le nom des variables cr√©√©es&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;names_glue&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{.value}_{pclass}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;

&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8666667&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.8787879&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3679245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.7065217&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.4144737&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2574257&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.6285714&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.3333333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.1645570&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.5138889&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2400000&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.0769231&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Il ne reste plus qu'√† fusionner les deux tables ainsi cr√©√©es et √† appliquer chacun des taux de survie aux effectifs par tranche d'√¢ge de la population de r√©f√©rence :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;rep_age_ref&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;inner_join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;survie_age_class&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;tr_age&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;
&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: left;"&gt;tr_age&lt;/th&gt;
&lt;th style="text-align: right;"&gt;eff&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;0 - 17 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;154&lt;/td&gt;
&lt;td style="text-align: right;"&gt;133.46667&lt;/td&gt;
&lt;td style="text-align: right;"&gt;135.33333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56.660377&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;18 - 34 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;547&lt;/td&gt;
&lt;td style="text-align: right;"&gt;386.46739&lt;/td&gt;
&lt;td style="text-align: right;"&gt;226.71711&lt;/td&gt;
&lt;td style="text-align: right;"&gt;140.811881&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;35 - 49 ans&lt;/td&gt;
&lt;td style="text-align: right;"&gt;235&lt;/td&gt;
&lt;td style="text-align: right;"&gt;147.71429&lt;/td&gt;
&lt;td style="text-align: right;"&gt;78.33333&lt;/td&gt;
&lt;td style="text-align: right;"&gt;38.670886&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="text-align: left;"&gt;50 ans ou +&lt;/td&gt;
&lt;td style="text-align: right;"&gt;110&lt;/td&gt;
&lt;td style="text-align: right;"&gt;56.52778&lt;/td&gt;
&lt;td style="text-align: right;"&gt;26.40000&lt;/td&gt;
&lt;td style="text-align: right;"&gt;8.461538&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;Si l'utilisation d'across ne vous semble pas claire, je ne saurais trop vous recommander &lt;a href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html"&gt;notre pr√©c√©dent article de blog&lt;/a&gt; sur ce verbe bien pratique de dplyr.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On obtient finalement nos taux de survie standardis√©s en sommant les effectifs par tranche d'√¢ge et en divisant par l'effectif total :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;eff_survie_age_class&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;survie_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;eff&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;knitr&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;kable&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style="text-align: right;"&gt;survie_1&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_2&lt;/th&gt;
&lt;th style="text-align: right;"&gt;survie_3&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style="text-align: right;"&gt;0.692329&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.446256&lt;/td&gt;
&lt;td style="text-align: right;"&gt;0.2338477&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Par rapport aux taux de survie bruts pr√©sent√©s plus haut, on constate que &lt;strong&gt;les in√©galit√©s √©conomiques de survie s'aggravent apr√®s avoir contr√¥l√© par l'√¢ge&lt;/strong&gt;. Le taux de survie standardis√©s de la classe 1 et de la classe 3 sont en effet de 69,2% et 23,4 % contre 63,7% et 26,1% avant la correction. Cela correspond √† ce que l'on pouvait pressentir apr√®s l'analyse exploratoire puisque les passagers de la classe 3 sont plus jeunes et que les jeunes ont une meilleure chance de survie au sein de chaque classe √©conomique.   &lt;/p&gt;
&lt;h1 id="pour-conclure"&gt;Pour conclure&lt;/h1&gt;
&lt;p&gt;J'esp√®re que cet exemple vous aura permis de mieux appr√©hender la question de la standardisation directe. Bien s√ªr, la m√©thode utilis√©e ici comporte des limites, notamment l'utilisation de tranches d'√¢ge tr√®s larges qui pourraient fausser le r√©sultat. On peut par exemple penser que les enfants en bas √¢ge ont b√©n√©fici√© d'une attention toute particuli√®re, et ils se retrouvent ici dans la m√™me tranche d'√¢ge que des adolescents. Mais nous sommes √©galement contraints par les effectifs qui nous emp√™chent de faire une analyse trop fine de ces subtilit√©s. Si ces questions vous int√©ressent, vous pouvez vous reporter √† notre article sur &lt;a href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html"&gt;le dilemme biais-variance&lt;/a&gt;.   &lt;/p&gt;
&lt;p&gt;Enfin, nous avons pass√© sous silence une variable explicative tr√®s importante : le sexe des passagers. Les taux de survie sont en effet tr√®s diff√©rents pour les hommes et pour les femmes. Il est possible de reproduire cette analyse en prenant en compte cette variable, crois√©e √©galement avec l'√¢ge. Cependant, toujours en raison de trop faibles effectifs, il sera sans doute n√©cessaire d'agr√©ger encore plus les tranches d'√¢ge. Vous avez les cartes en main pour le faire, et mieux comprendre les fortunes diverses de Jack et Rose dans le c√©l√®bre film de la trag√©die...  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category></entry><entry><title>Migration de SAS vers R</title><link href="https://blog.statoscop.fr/migration-de-sas-vers-r.html" rel="alternate"></link><published>2022-11-08T00:00:00+01:00</published><updated>2022-11-08T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2022-11-08:/migration-de-sas-vers-r.html</id><summary type="html">&lt;p&gt;Quelques conseils pour r√©ussir sa transition de SAS vers R&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#options-de-recodage-en-r"&gt;Options de recodage en R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#base-r"&gt;Base R&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#tidyverse"&gt;Tidyverse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datatable"&gt;data.table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#notre-conseil"&gt;Notre conseil&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#organisation-du-travail-de-recodage-en-r"&gt;Organisation du travail de recodage en R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#les-projets-rstudio"&gt;Les projets RStudio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#renv-pour-gerer-les-packages"&gt;Renv pour g√©rer les packages&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#git-ou-un-autre-logiciel-de-gestion-de-versions"&gt;Git ou un autre logiciel de gestion de versions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#accompagnement-de-la-migration-de-sas-vers-r"&gt;Accompagnement de la migration de SAS vers R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#en-interne"&gt;En interne&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#avec-un-prestataire"&gt;Avec un prestataire&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;L'utilisation du logiciel d'analyses statistiques SAS est encore assez ancr√©e dans certaines administrations publiques et grandes entreprises, malgr√© la concurrence de deux logiciels open-source offrant des performances souvent sup√©rieures : R et Python. La &lt;strong&gt;migration vers un nouveau langage&lt;/strong&gt; pr√©sente un certain nombre de difficult√©s, mais le jeu en vaut la chandelle! Nous proposons dans cet article quelques recommandations pour recoder ses scripts SAS en R et assurer une &lt;strong&gt;transition vers l'open-source&lt;/strong&gt; la plus simple possible.  &lt;/p&gt;
&lt;h1 id="options-de-recodage-en-r"&gt;Options de recodage en R&lt;/h1&gt;
&lt;p&gt;Une des difficult√©s de R est aussi une de ses forces : le grand nombre de possibilit√©s qui s'offrent √† vous pour coder. Le CRAN (pour &lt;em&gt;Comprehensive R Archive Network&lt;/em&gt;) comprend un nombre impressionnant de packages (+ de 18000!). Dans ces conditions, il est important de se mettre d'accord a minima sur l'orientation que vous souhaitez prendre, afin d'assurer une certaine homog√©n√©it√© entre les diff√©rents membres de vos √©quipes. Ces &lt;em&gt;r√®gles&lt;/em&gt; peuvent bien s√ªr varier d'une √©quipe √† l'autre, en fonction de ses besoins sp√©cifiques. On pr√©sente ici trois des options les plus couramment utilis√©es en statistiques : base R, le tidyverse et data.table. On ne rentre pas dans le d√©tail de la syntaxe de chacune de ces options mais vous pouvez approfondir cet aspect en lisant notre &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;article qui compare les performances de ces trois options&lt;/a&gt;.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous cherchez un prestataire pour vous accompagner dans votre migration vers R?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;   &lt;/p&gt;
&lt;h2 id="base-r"&gt;Base R&lt;/h2&gt;
&lt;p&gt;Base R d√©signe toutes les fonctions natives de R, qui sont charg√©es par d√©faut au lancement du logiciel. Pour l'analyse de donn√©es, on s'appuiera notamment sur le format &lt;code&gt;data.frame&lt;/code&gt;. L'utilisation exclusive de base R aurait l'avantage de ne pas faire d√©pendre votre code d'autres packages et donc de lui assurer une certaine stabilit√©. Cependant, pour l'analyse de donn√©es, la syntaxe sera vite verbeuse et peu lisible pour des non initi√©s. De plus, pour des traitements de donn√©es plus complexes, vous ne trouverez pas forc√©ment ce qu'il vous faut dans ce que propose base R. Enfin, cette option est souvent &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;bien moins performante&lt;/a&gt; en termes de vitesse d'ex√©cution que les deux que nous vous pr√©sentons ensuite.  &lt;/p&gt;
&lt;h2 id="tidyverse"&gt;Tidyverse&lt;/h2&gt;
&lt;p&gt;Le tidyverse est un &lt;a href="https://www.tidyverse.org/"&gt;ensemble de packages&lt;/a&gt; destin√©s au traitement de donn√©es, du nettoyage √† l'analyse et la datavisualisation. En particulier, le package &lt;code&gt;dplyr&lt;/code&gt; propose des fonctions de haut niveau couvrant la tr√®s grande majorit√© des besoins lors de la manipulation des donn√©es. Ces fonctions, cha√Æn√©es avec l'op√©rateur &lt;em&gt;pipe&lt;/em&gt; (&lt;code&gt;%&amp;gt;%&lt;/code&gt; du package &lt;code&gt;magritr&lt;/code&gt; ou &lt;code&gt;|&amp;gt;&lt;/code&gt; de base R depuis la version 4.1.0), offrent un &lt;strong&gt;code tr√®s lisible et intuitif&lt;/strong&gt; √† √©crire. Enfin, elles sont optimis√©es et offrent de &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;bonnes performances&lt;/a&gt;. L'inconv√©nient du tidyverse est sans doute qu'il concerne beaucoup de packages qui ont chacun √©galement un certain nombre de d√©pendances √† d'autres packages. Cependant, le fait qu'il soit maintenu par les √©quipes de RStudio (la soci√©t√© s'appelle &lt;a href="https://posit.co/"&gt;Posit&lt;/a&gt; depuis peu) est de nature √† rassurer sur la stabilit√© de cette solution. En g√©n√©ral on ne recommande de toute fa√ßon pas de charger l'ensemble du tidyverse mais seulement les packages que vous utilisez.  &lt;/p&gt;
&lt;h2 id="datatable"&gt;data.table&lt;/h2&gt;
&lt;p&gt;Des trois options, &lt;code&gt;data.table&lt;/code&gt; est &lt;a href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html"&gt;la plus performante&lt;/a&gt;. Ce package utilise un format concurrent du &lt;code&gt;data.frame&lt;/code&gt; de base R, le &lt;code&gt;data.table&lt;/code&gt;, qui optimise la vitesse d'ex√©cution des instructions. Ce package a aussi l'avantage de ne d√©pendre d'aucun autre package. En contrepartie, il offre une syntaxe sans doute moins lisible pour les non-initi√©s, en particulier pour des op√©rations plus complexes.  &lt;/p&gt;
&lt;h2 id="notre-conseil"&gt;Notre conseil&lt;/h2&gt;
&lt;p&gt;Dans la majorit√© des cas, le &lt;code&gt;tidyverse&lt;/code&gt; et en particulier &lt;strong&gt;&lt;code&gt;dplyr&lt;/code&gt; sera le choix le plus adapt√©&lt;/strong&gt;. Pour des utilisateurs de SAS, en particulier pour ceux connaissant un peu de SQL, les fonctions √† utiliser seront plus intuitives. Cette option b√©n√©ficie en outre d'une communaut√© d'utilisateurs tr√®s importante permettant de trouver facilement des r√©ponses en ligne aux probl√®mes que vous pourrez rencontrer. De plus, la vitesse d'ex√©cution sera souvent au moins aussi bonne que celle de SAS. Si l'activit√© concern√©e par le recodage a un gros enjeu de temps d'ex√©cution et moins de lisibilit√© du code, c'est sans doute vers &lt;code&gt;data.table&lt;/code&gt; qu'il sera int√©ressant de se tourner. Il peut aussi √™tre possible de choisir le meilleur des deux mondes avec le package &lt;a href="https://dtplyr.tidyverse.org/"&gt;dtplyr&lt;/a&gt;, combinant la syntaxe de dplyr aux fonctions de data.table. Enfin, il va de soi qu'une certaine souplesse est de mise pour pouvoir utiliser les fonctions de base R quand elles n'ont pas d'√©quivalent dans l'√©cosyst√®me choisi, ainsi que d'autres packages pour des besoins sp√©cifiques.  &lt;/p&gt;
&lt;h1 id="organisation-du-travail-de-recodage-en-r"&gt;Organisation du travail de recodage en R&lt;/h1&gt;
&lt;p&gt;Une fois que vous avez choisi comment vous souhaitez coder en R, vous pouvez sp√©cifier vos recommandations dans un document &lt;strong&gt;listant les bonnes pratiques&lt;/strong&gt; de codage en R. Cela pourra servir √† encadrer et accompagner le travail des d√©veloppeurs R et uniformiser autant que possible les diff√©rentes mani√®res de coder. En plus de cela, nous recommandons quelques outils simples √† adopter pour tirer le meilleur de l'√©co-syst√®me R.    &lt;/p&gt;
&lt;h2 id="les-projets-rstudio"&gt;Les projets RStudio&lt;/h2&gt;
&lt;p&gt;Les &lt;a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-RStudio-Projects"&gt;projets RStudio&lt;/a&gt; sont des fichiers associ√©s √† un dossier de travail que vous aurez cr√©√©s. Ils permettent de sp√©cifier les chemins vers vos donn√©es ou vers le dossier des sorties que vous voulez cr√©er de mani√®re &lt;strong&gt;relative √† ce dossier parent&lt;/strong&gt;. Leur utilisation permet de bannir de vos scripts l'utilisation de chemins sp√©cifiques √† votre machine. Ainsi, on remplacera avantageusement l'appel du chemin &lt;code&gt;C://Users/antoine/Documents/Mon_projet/data/ma_base.csv&lt;/code&gt; par &lt;code&gt;data/ma_base.csv&lt;/code&gt; dans les scripts.  C'est donc &lt;strong&gt;un premier pas&lt;/strong&gt; vers la cr√©ation d'un dossier de travail contenant des scripts r√©utilisables en l'√©tat par vos coll√®gues, que ce soit ceux qui travaillent dans votre √©quipe ou ceux qui vous succ√©deront.  &lt;/p&gt;
&lt;h2 id="renv-pour-gerer-les-packages"&gt;Renv pour g√©rer les packages&lt;/h2&gt;
&lt;p&gt;Renv est un gestionnaire de packages R, dont nous parlons d√©j√† dans &lt;a href="https://blog.statoscop.fr/gestion-des-packages-sur-r-avec-renv.html"&gt;cet article&lt;/a&gt;. Il vous permet de choisir un &lt;strong&gt;environnement stable de packages&lt;/strong&gt; sur un projet donn√©. En particulier, il vous assure √† un moment T que toute une √©quipe sur un m√™me projet travaille bien avec les m√™mes packages et les m√™mes versions de ceux-ci. Il vous permet aussi de pouvoir refaire tourner un code avec le m√™me syst√®me de packages qu'au moment o√π il a √©t√© cr√©√©. C'est donc un autre √©l√©ment essentiel de la reproductibilit√© et de la stabilit√© de vos projets, en particulier si on l'utilise avec un logiciel de gestion de versions...  &lt;/p&gt;
&lt;h2 id="git-ou-un-autre-logiciel-de-gestion-de-versions"&gt;Git ou un autre logiciel de gestion de versions&lt;/h2&gt;
&lt;p&gt;M√™me si √ßa n'est pas sp√©cifique √† R, il est important de profiter de cette migration pour adopter l'utilisation d'un logiciel de gestion de versions si cela n'est pas d√©j√† fait. &lt;a href="https://githowto.com/"&gt;Git&lt;/a&gt; est sans doute le plus utilis√© aujourd'hui. Il permet de tracer les modifications de votre code pas-√†-pas, de revenir √† une version ant√©rieure de votre projet sans difficult√©s, de partager en temps r√©el avec votre √©quipe les modifications du code, de g√©rer aussi simplement que possible des modifications simultan√©es sur un m√™me projet, et bien d'autres choses encore... La prise en main de Git peut prendre un peu de temps car cela n'est pas forc√©ment intuitif pour qui n'est pas habitu√© √† la gestion de versions mais c'est sans aucun doute absolument n√©cessaire pour assurer une bonne gestion de vos projets.    &lt;/p&gt;
&lt;h1 id="accompagnement-de-la-migration-de-sas-vers-r"&gt;Accompagnement de la migration de SAS vers R&lt;/h1&gt;
&lt;p&gt;Enfin, un aspect important de la migration vers un nouveau langage est la &lt;strong&gt;gestion de la transition&lt;/strong&gt; entre les deux. Que celle-ci soit prise en main en interne ou par un prestataire, il est indispensable de former les √©quipes en place et de lib√©rer du temps de travail pour accompagner cette transition.  &lt;/p&gt;
&lt;h2 id="en-interne"&gt;En interne&lt;/h2&gt;
&lt;p&gt;L'avantage de g√©rer la migration vers R en interne est qu'elle associe forc√©ment √† ce processus les √©quipes en place. L'inconv√©nient √©vident est qu'il est alors indispensable de lib√©rer beaucoup de temps du travail effectif √† consacrer √† cette t√¢che. Il est tr√®s important en amont de se mettre d'accord sur les points √©voqu√©s plus haut afin d'√©tablir une sorte de &lt;em&gt;charte&lt;/em&gt; du code qui assurera un minimum de coh√©rence au sein des √©quipes. Enfin, il est √©videmment indispensable d'accompagner chacun des membres des √©quipes en fonction de leur familiarit√© avec le nouveau langage. L'id√©al est de proposer des &lt;strong&gt;formations sur mesure&lt;/strong&gt; correspondant aux probl√©matiques m√©tier de chacun.  &lt;/p&gt;
&lt;h2 id="avec-un-prestataire"&gt;Avec un prestataire&lt;/h2&gt;
&lt;p&gt;Si vous faites appel √† un prestataire, cela ne signifie pas pour autant que vous ne devrez pas lib√©rer du temps de vos √©quipes pour la migration. On recommande en effet des √©changes √©troits et r√©guliers avec le prestataire, et plusieurs livraisons √† intervalles r√©guliers plut√¥t qu'une seule √† la fin du travail. Ceci doit permettre de s'assurer d'une part que le prestataire ne va pas dans une mauvaise direction et d'autre part que le code appara√Æt lisible et compr√©hensible pour les charg√©s d'√©tude. C'est aussi l'occasion pour ces derniers de se former et d'√©changer avec le prestataire sur ces choix lors du recodage. Il est aussi possible de faire appel √† un prestataire simplement pour encadrer votre √©quipe dans le travail de recodage, optimiser le code √† certains points bloquants, faire un audit du travail r√©alis√©...&lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Quitter SAS et aller vers R, ou un autre logiciel, c'est donc du travail et cela n√©cessite d'investir du temps et des moyens. Mais c'est aussi se lib√©rer d'une &lt;strong&gt;licence beaucoup trop ch√®re&lt;/strong&gt;, et s'ouvrir les portes de nouvelles possibilit√©s. Pourquoi ne pas en profiter pour &lt;strong&gt;automatiser vos rapports&lt;/strong&gt; et vos publications avec &lt;a href="https://rmarkdown.rstudio.com/"&gt;R Markdown&lt;/a&gt;? Et si vous vous lanciez dans le d√©veloppement d'une petite &lt;a href="https://shiny.rstudio.com/gallery/"&gt;application interactive R Shiny&lt;/a&gt; pour mettre en valeur vos r√©sultats les plus marquants? &lt;br&gt;
Quoiqu'il en soit, si cet article vous a donn√© envie d'aller plus loin, vous pouvez &lt;a href="https://www.statoscop.fr/contact"&gt;nous contacter sur le site de Statoscop&lt;/a&gt; pour discuter des prochaines √©tapes!   &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;   &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="SAS"></category><category term="recodage"></category><category term="migration"></category><category term="codes"></category><category term="scripts"></category></entry><entry><title>Ggplot2 : mise en forme d'un barplot</title><link href="https://blog.statoscop.fr/ggplot2-mise-en-forme-dun-barplot.html" rel="alternate"></link><published>2022-08-22T00:00:00+02:00</published><updated>2022-08-22T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2022-08-22:/ggplot2-mise-en-forme-dun-barplot.html</id><summary type="html">&lt;p&gt;R√©alisation et mise en forme d'un graphique en colonnes avec ggplot2.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#creer-notre-premier-graphique-avec-geom_col"&gt;Cr√©er notre premier graphique avec geom_col&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mettre-en-forme-le-graphique"&gt;Mettre en forme le graphique&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#ordonner-laffichage-en-fonction-de-la-valeur-de-la-variable-dinteret"&gt;Ordonner l'affichage en fonction de la valeur de la variable d'int√©r√™t&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mise-en-forme-des-axes"&gt;Mise en forme des axes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-dun-theme"&gt;Utilisation d'un th√®me&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Dans cette note nous proposons un petit cas pratique pour illustrer la mise en forme d'un graphique en colonnes, ou barplot, avec le package R &lt;code&gt;ggplot2&lt;/code&gt;. On s'appuie pour cela sur les donn√©es de la &lt;a href="https://www.gapminder.org/"&gt;fondation Gapminder&lt;/a&gt; en s'int√©ressant √† la part des d√©penses de sant√© financ√©es par l'Etat dans les 30 pays les plus peupl√©s au monde.  &lt;/p&gt;
&lt;h1 id="creer-notre-premier-graphique-avec-geom_col"&gt;Cr√©er notre premier graphique avec geom_col&lt;/h1&gt;
&lt;p&gt;Notre objectif dans cet exemple est d'afficher le taux de d√©penses de sant√© financ√©es par l'√âtat pour chaque pays pr√©sent dans la base. Ce barplot se r√©alise avec &lt;code&gt;ggplot2&lt;/code&gt; √† l'aide de &lt;code&gt;geom_col&lt;/code&gt;. En effet, nous voulons repr√©senter la valeur d'une variable (ce taux de d√©penses) pour chaque modalit√© donn√©e d'une variable cat√©gorielle (le pays). Si nous avions voulu repr√©senter le nombre de fois o√π une variable cat√©gorielle appara√Æt dans la base, nous aurions utilis√© &lt;code&gt;geom_bar&lt;/code&gt;.&lt;br&gt;
Avec ces √©l√©ments, le premier graphique qui nous viendrait √† l'esprit en utilisant &lt;code&gt;ggplot2&lt;/code&gt; serait le suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-1-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;Il est bien s√ªr illisible, en raison notamment du grand nombre de pays repr√©sent√© et du fait que leurs noms ne peuvent pas s'afficher correctement sur l'axe des abscisses. On peut corriger √ßa en faisant une rotation de l'√©tiquette des axes de 90¬∞ avec &lt;code&gt;theme(axis.text.x = element_text(angle = 90))&lt;/code&gt;. Les barres sont √©galement trop rapproch√©es, ce que l'on va corriger avec le param√®tre &lt;code&gt;width&lt;/code&gt; de &lt;code&gt;geom_col&lt;/code&gt;. On obtient avec ces r√©glages rapides le graphique suivant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-2-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;C'est d√©j√† mieux! Mais il reste un peu de travail pour faciliter la lecture de ce graphique.  &lt;/p&gt;
&lt;h1 id="mettre-en-forme-le-graphique"&gt;Mettre en forme le graphique&lt;/h1&gt;
&lt;p&gt;Pour rendre ce graphique plus agr√©able √† lire et plus compr√©hensible, on propose d'ordonner l'affichage en fonction de la valeur du r√©sultat, de mettre en forme et d'inverser les axes et enfin de changer quelques √©l√©ments graphiques. &lt;/p&gt;
&lt;h2 id="ordonner-laffichage-en-fonction-de-la-valeur-de-la-variable-dinteret"&gt;Ordonner l'affichage en fonction de la valeur de la variable d'int√©r√™t&lt;/h2&gt;
&lt;p&gt;Un √©l√©ment important de ce graphique est que les pays sont pr√©sent√©s dans l'ordre alphab√©tique, ce qui n'a pas d'int√©r√™t pour le lecteur. On peut facilement changer l'ordre d'affichage des modalit√©s de l'axe des abscisses en le conditionnant aux valeurs de l'axe des ordonn√©es. On utilise pour cela dans l'instruction &lt;code&gt;aes()&lt;/code&gt; la fonction &lt;code&gt;reorder()&lt;/code&gt; au moment de la d√©finition du &lt;code&gt;x&lt;/code&gt;, qui nous permet de l'ordonner de mani√®re croissante ou d√©croissante en fonction de notre variable d'int√©r√™t :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# par ordre croissant &lt;/span&gt;
&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;

&lt;span class="c1"&gt;# par ordre d√©croissant&lt;/span&gt;
&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;angle&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/order_desc_asc.png"&gt;  &lt;/p&gt;
&lt;p&gt;Il est maintenant bien  plus facile de situer chaque pays par rapport aux autres.  &lt;/p&gt;
&lt;h2 id="mise-en-forme-des-axes"&gt;Mise en forme des axes&lt;/h2&gt;
&lt;p&gt;Avec l'instruction &lt;code&gt;labs&lt;/code&gt;, on d√©finit tout d'abord les titres de nos axes ainsi que le titre g√©n√©ral du graphique. Puis, dans &lt;code&gt;scale_y_continuous&lt;/code&gt;, on met en forme l'axe repr√©sentant les parts de d√©penses de sant√© :&lt;br&gt;
- avec le param√®tre &lt;code&gt;labels&lt;/code&gt; on fait appara√Ætre les √©tiquettes sous forme de pourcentage gr√¢ce √† la fonction &lt;code&gt;scales::percent()&lt;/code&gt;.&lt;br&gt;
- avec le param√®tre &lt;code&gt;limits&lt;/code&gt; on fait en sorte que les pourcentages affich√©s aillent jusqu'√† 1, de mani√®re √† ce que le lecteur ait une repr√©sentation plus juste de ce que serait la part de d√©penses restantes financ√©es par les patients ou des organismes d'assurance priv√©s.&lt;br&gt;
- le param√®tre &lt;code&gt;expand = c(0, 0)&lt;/code&gt; permet de supprimer les espaces avant et apr√®s les valeurs minimum et maximum de notre variable d'int√©r√™t.&lt;br&gt;
Pour mieux lire les noms des pays, on intervertit l'axe des ordonn√©es et des abscisses avec l'instruction &lt;code&gt;coord_flip()&lt;/code&gt; pour avoir un graphique en barres horizontales. Enfin, on r√®gle la taille des labels des √©l√©ments de x et de y.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;df_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ggplot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;aes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;reorder&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;gvt_health_exp_10&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;geom_col&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;labs&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Pays&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Part de d√©penses de sant√©&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Part des d√©penses de sant√© financ√©es par l&amp;#39;Etat\n dans les 30 pays les plus peupl√©s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;scale_y_continuous&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;labels&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;scales&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;percent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;accuracy&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;limits&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;expand&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;coord_flip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;plot_health&lt;/span&gt;

&lt;span class="n"&gt;plot_health&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;axis.text.y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-4-1.png"&gt;  &lt;/p&gt;
&lt;h2 id="utilisation-dun-theme"&gt;Utilisation d'un th√®me&lt;/h2&gt;
&lt;p&gt;Pour l'affichage graphique il est possible de r√©gler chaque √©l√©ment du graphique comme on le souhaite. Le plus facile reste cependant d'utiliser les nombreux th√®mes existants disponibles, par d√©faut dans &lt;code&gt;ggplot2&lt;/code&gt; ou en installant d'autres packages, comme &lt;code&gt;ggthemes&lt;/code&gt;. Pour les utiliser il suffit d'ajouter l'instruction &lt;code&gt;+ theme_*()&lt;/code&gt; √† la suite de votre plot. Le th√®me par d√©faut dans ggplot2 est &lt;code&gt;theme_gray&lt;/code&gt;. On vous pr√©sente le r√©sultat donn√© par &lt;code&gt;theme_economist&lt;/code&gt;, disponible dans la librairie &lt;code&gt;ggthemes&lt;/code&gt;, qui reprend la charte graphique du magazine &lt;em&gt;The Economist&lt;/em&gt;. On ajuste √©galement la taille des labels √† ce nouveau th√®me.  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ggthemes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;plot_health&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;theme_economist&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;axis.text.x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;axis.text.y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;element_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="Pelican" src="../images/geom_col_files/figure-html/unnamed-chunk-5-1.png"&gt;  &lt;/p&gt;
&lt;p&gt;C'est la fin de cet article! N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver l'ensemble du code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;github de Statoscop&lt;/a&gt;.  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="ggplot2"></category><category term="dataviz"></category><category term="graphiques"></category><category term="barplot"></category></entry><entry><title>Le dilemme biais variance dans la mod√©lisation de donn√©es</title><link href="https://blog.statoscop.fr/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html" rel="alternate"></link><published>2021-11-08T00:00:00+01:00</published><updated>2021-11-08T00:00:00+01:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-11-08:/le-dilemme-biais-variance-dans-la-modelisation-de-donnees.html</id><summary type="html">&lt;p&gt;Pr√©sentation des enjeux th√©oriques et pratiques de l'arbitrage biais variance dans la construction d'un mod√®le de pr√©diction.&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les mod√®les de Machine Learning&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un mod√®le&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;L'arbitrage biais variance est souvent √©voqu√© pour caract√©riser les enjeux de la construction d'un mod√®le de pr√©diction performant. L'id√©e de cet article est d'essayer de donner au lecteur les outils th√©oriques de cette question en essayant de privil√©gier une approche intuitive et pratique du probl√®me. Apr√®s avoir d√©fini ce que sont le biais et la variance, on pr√©sente les enjeux de cet arbitrage puis l'application concr√®te dans le cas de l'entra√Ænement d'un mod√®le de Machine Learning.&lt;/p&gt;
&lt;h1 id="que-sont-le-biais-et-la-variance"&gt;Que sont le biais et la variance?&lt;/h1&gt;
&lt;p&gt;Pour expliquer le plus simplement possible ces concepts, on se place dans le contexte de l'observation de deux variables &lt;code&gt;Y&lt;/code&gt; et &lt;code&gt;X&lt;/code&gt;. Dans le cas d'une mod√©lisation d'une relation entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;, le biais d'un estimateur est son √©cart avec sa "vraie" valeur si on observait parfaitement la relation entre ces variables. On entend donc le biais comme &lt;strong&gt;l'√©cart entre la fonction mod√©lis√©e et la fonction th√©orique&lt;/strong&gt; qui permettrait de restituer le lien entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Une mani√®re de jouer sur le biais d'un mod√®le c'est de modifier sa variance. La variance est une mesure de dispersion de valeurs, qui donne une estimation de l'√©cart de celles-ci √† leur moyenne. La variance d'un mod√®le estime &lt;strong&gt;√† quel point celui-ci fluctue autour de sa moyenne pour coller aux donn√©es&lt;/strong&gt;. Une mesure utilis√©e couramment dans le cas des r√©gressions lin√©aires est le coefficient de d√©termination R2. Celui-ci calcule &lt;strong&gt;la part de la variance des donn√©es expliqu√©e par la variance du mod√®le&lt;/strong&gt;. Autrement dit, plus mon mod√®le sera proche des points de mes donn√©es, plus sa variance et donc le R2 seront √©lev√©s. Pour illustrer ce concept, on pr√©sente plusieurs mod√®les appliqu√©s au m√™me jeu de donn√©es avec une variance plus ou moins √©lev√©e :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-1-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Pour chaque mod√®le, la courbe du mod√®le est celle qui appara√Æt en rouge et on a mis en √©vidence en vert la projection de chaque point sur sa valeur pr√©dite par le mod√®le. Voyons comment interpr√©ter ces graphiques :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Le premier mod√®le est un mod√®le na√Øf qui se contente de pr√©dire que pour chaque valeur de &lt;code&gt;X&lt;/code&gt;, &lt;code&gt;Y&lt;/code&gt; sera √©gale √† sa moyenne. Par d√©finition donc, sa variance est nulle et sa capacit√© pr√©dictive faible.  &lt;/li&gt;
&lt;li&gt;Le second mod√®le est une r√©gression lin√©aire simple qui a un R2 d'environ 50%. Il a donc une meilleure qualit√© pr√©dictive que le premier mod√®le du fait qu'il capte une partie de la variance des donn√©es, ici √† travers une corr√©lation positive entre &lt;code&gt;X&lt;/code&gt; et &lt;code&gt;Y&lt;/code&gt;.  &lt;/li&gt;
&lt;li&gt;Le troisi√®me mod√®le est un mod√®le polynomial dont on voit qu'il est plus ajust√© que le second. Les points pr√©dits (en vert) par la courbe sont en effet plus proche des points que pour le pr√©c√©dent mod√®le et m√©caniquement cela fait augmenter le R2. Le fait d'utiliser un mod√®le polynomial a donn√© au mod√®le une plus grande souplesse ce qui lui a permis de se rapprocher de certains points extr√™mes qui √©taient √©loign√©s de la droite de r√©gression du second mod√®le.  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ainsi, plus la variance augmente, plus le mod√®le pr√©dit en moyenne des valeurs proches de leurs vraies valeurs, ce qui fait diminuer le biais, puisqu'il est d√©fini comme l'√©cart entre notre fonction de pr√©diction et une fonction qui permettrait de pr√©dire parfaitement les donn√©es observ√©es.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;üëã Nous c'est Antoine et Louis de Statoscop, une coop√©rative de statisticiens / data scientists.
Vous voulez en savoir plus sur ce que l'on fait?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;
&lt;h1 id="enjeux-de-larbitrage-biais-variance"&gt;Enjeux de l'arbitrage biais variance&lt;/h1&gt;
&lt;p&gt;D'apr√®s ce qu'on a vu, pourquoi alors ne pas simplement chercher √† maximiser la variance pour minimiser le biais, c'est-√†-dire son √©cart aux vraies valeurs? Tout simplement parce que dans le cas de la construction d'un mod√®le de pr√©diction, nous mod√©lisons des relations entre des donn√©es √† partir d'un √©chantillon pour pr√©dire un r√©sultat sur une nouvelle population. C'est donc la performance de ce mod√®le sur de nouvelles donn√©es qui va nous int√©resser. Or, comme vous avez pu le pressentir en observant les graphiques pr√©c√©dents, &lt;strong&gt;un mod√®le avec une variance tr√®s √©lev√©e se g√©n√©ralise mal √† de nouvelles donn√©es&lt;/strong&gt;. D'un autre c√¥t√©, &lt;strong&gt;un mod√®le avec une faible variance aura lui aussi une qualit√© pr√©dictive tr√®s faible&lt;/strong&gt; car il captera mal une √©ventuelle relation entre les variables.&lt;/p&gt;
&lt;p&gt;Tout le probl√®me de cet arbitrage (ou dilemme) biais variance est donc de &lt;strong&gt;trouver un mod√®le qui ait une variance suffisamment forte pour limiter le biais mais suffisamment faible pour qu'il soit g√©n√©ralisable&lt;/strong&gt;. Les mod√®les pr√©c√©dents avaient √©t√© entra√Æn√©s sur une base de donn√©es qui √©tait un √©chantillon al√©atoire correspondant √† 10% des donn√©es d'un √©chantillon plus important. Pour mesurer la qualit√© pr√©dictive de ces mod√®les on les applique donc aux donn√©es enti√®res et on calcule l'√©cart moyen au carr√© de la pr√©diction √† la vraie valeur, c'est-√†-dire l'erreur quadratique moyenne ou en anglais &lt;strong&gt;MSE&lt;/strong&gt; pour &lt;em&gt;Mean Squared Error&lt;/em&gt; :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/unnamed-chunk-2-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate que, comme attendu, le mod√®le avec le plus de variance se g√©n√©ralise mal √† des donn√©es non connues et pr√©sente une erreur de pr√©diction sup√©rieure √† celle du mod√®le lin√©aire simple. En effet, les variations de la courbe polynomiale qui lui permettait de coller au plus pr√®s des donn√©es sur lesquelles elle a √©t√© construite entra√Æne beaucoup de pr√©dictions tr√®s √©loign√©es de la vraie valeur des nouvelles donn√©es.&lt;br&gt;
L'erreur attendue d'un mod√®le de pr√©diction sur des donn√©es sur lesquelles il ne s'est pas entra√Æn√© peut en effet se d√©composer en &lt;strong&gt;la somme du biais au carr√© et de la variance de ce mod√®le, c'est la d√©composition biais-variance de l'erreur quadratique&lt;/strong&gt;. Si vous pr√©f√©rez vous en convaincre avec la formule et la d√©monstration math√©matique, vous pouvez vous r√©f√©rer √† &lt;a href="https://fr.wikipedia.org/wiki/Dilemme_biais-variance#D√©composition_biais-variance_de_l'erreur_quadratique"&gt;la page wikip√©dia qui en parle&lt;/a&gt;. Comme le biais diminue avec la variance, il faut donc trouver un niveau de complexit√© du mod√®le qui permette √† la fois de minimiser l'√©cart √† la vraie valeur (faible biais en augmentant la variance) et d'√™tre g√©n√©ralisable en dehors de son √©chantillon d'entra√Ænement (faible variance).&lt;/p&gt;
&lt;h1 id="liens-avec-loverfitting-et-lunderfitting-dans-les-modeles-de-machine-learning"&gt;Liens avec l'overfitting et l'underfitting dans les mod√®les de Machine Learning&lt;/h1&gt;
&lt;h2 id="appelons-un-chat-un-chat"&gt;Appelons un chat un chat&lt;/h2&gt;
&lt;p&gt;Le principe de l'apprentissage automatique supervis√© est le m√™me que celui qu'on a pr√©sent√© jusqu'√† maintenant : on renseigne au mod√®le des variables explicatives (&lt;code&gt;X&lt;/code&gt;) et une variable d'int√©r√™t (&lt;code&gt;Y&lt;/code&gt;) qu'on aimerait pouvoir ensuite pr√©dire √† partir de nouvelles donn√©es &lt;code&gt;X&lt;/code&gt;. Par exemple, on renseigne des photos de chats et de chiens √©tiquett√©es : &lt;code&gt;Y&lt;/code&gt; est alors le label "chien" ou "chat" de la photo, &lt;code&gt;X&lt;/code&gt; la matrice de pixels de la photo. Le mod√®le devra √™tre ensuite capable de pr√©dire √† partir d'une photo qu'il n'a jamais vue si celle-ci repr√©sente un chat ou un chien. Pour mesurer la qualit√© pr√©dictive de notre mod√®le, on r√©serve des donn√©es labellis√©es sur lesquelles il ne s'entra√Ænera pas. On va ensuite lui demander de pr√©dire les labels d√©j√† connus de ces donn√©es, ce qui va nous permettre d'√©valuer la qualit√© de ces pr√©dictions. Cet √©chantillon est en g√©n√©ral appel√© &lt;strong&gt;√©chantillon test&lt;/strong&gt; (&lt;em&gt;test set&lt;/em&gt; en anglais), et les donn√©es sur lesquelles le mod√®le est entra√Æn√© s'appelle l'&lt;strong&gt;√©chantillon d'entra√Ænement&lt;/strong&gt; (&lt;em&gt;train set&lt;/em&gt;). En g√©n√©ral, si l'on dispose de suffisamment de donn√©es, on n'aura pas trop de mal √† construire un mod√®le qui parviendra √† labelliser quasiment parfaitement &lt;strong&gt;nos donn√©es d'entra√Ænement&lt;/strong&gt;. Tout le probl√®me est d'avoir un mod√®le qui se g√©n√©ralise correctement √† de nouvelles donn√©es.&lt;/p&gt;
&lt;h2 id="courbe-dapprentissage-dun-modele"&gt;Courbe d'apprentissage d'un mod√®le&lt;/h2&gt;
&lt;p&gt;Pour sch√©matiser, imaginons que dans les donn√©es d'entra√Ænement les chiens soient en g√©n√©ral photographi√©es √† l'ext√©rieur et les chats √† l'int√©rieur. Si mon mod√®le a une forte variance, cela signifie qu'il va prendre en compte beaucoup de d√©tails de la photo. Il va par exemple donner du poids aux √©l√©ments de fond dans sa pr√©diction et sera incapable de labelliser correctement un chien photographi√© √† l'int√©rieur. Un mod√®le bien plus basique qui se serait appuy√© par exemple uniquement sur la forme des oreilles de l'animal aurait peut-√™tre de meilleurs r√©sultats.&lt;br&gt;
Dans le premier cas, on dit que l'on est dans une situation de &lt;strong&gt;surapprentissage, ou overfitting&lt;/strong&gt;. Le mod√®le a int√©gr√© des √©l√©ments anecdotiques, du bruit, dans son processus d√©cisionnel et cela va r√©duire sa performance pr√©dictive sur des donn√©es non connues. Autrement dit, &lt;strong&gt;sa variance est trop √©lev√©e&lt;/strong&gt;. Si au contraire le mod√®le est trop peu complexe et n'a pas int√©gr√© assez d'informations pour diff√©rencier un chat d'un chien m√™me sur les donn√©es d'apprentissage, on dit qu'il est dans un √©tat de &lt;strong&gt;sous-apprentissage, ou underfitting&lt;/strong&gt;.&lt;br&gt;
&lt;strong&gt;Dans les deux cas, le mod√®le va avoir de mauvaises performances pr√©dictives sur des nouvelles donn√©es&lt;/strong&gt;. Ce constat peut √™tre sch√©matis√© de la mani√®re suivante :&lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/biais_variance/courb_apprent.png"&gt;  &lt;/p&gt;
&lt;p&gt;Notons bien ici que cette relation entre complexit√© du mod√®le et d√©composition de l'erreur de pr√©diction s'entend &lt;strong&gt;√† taille d'√©chantillon fix√©e&lt;/strong&gt;. Ainsi, plus l'√©chantillon sera grand, plus le mod√®le pourra √™tre complexe avant d'entrer dans la phase de surapprentissage.  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Dans le cadre d'une &lt;strong&gt;d√©marche pr√©dictive&lt;/strong&gt;, il est donc tout √† fait naturel de limiter l'apprentissage du mod√®le pour optimiser ses capacit√©s pr√©dictives. Cela peut √™tre fait en r√©duisant le nombre de variables pr√©dictives utilis√©es, en limitant le nombre de couches de neurones dans un r√©seau, mais aussi en utilisant des m√©thodes de r√©duction des dimensions, comme &lt;a href="https://blog.statoscop.fr/acp-python.html"&gt;nous vous l'avions montr√© avec l'analyse en composantes principales&lt;/a&gt;. Bien s√ªr, dans une &lt;strong&gt;d√©marche explicative&lt;/strong&gt;, il sera au contraire normal de sacrifier √©ventuellement une meilleure capacit√© pr√©dictive pour mettre en √©vidence une relation avec une variable explicative. Si vous souhaitez aller plus loin, vous pouvez parcourir l'excellente √©tude de &lt;a href="https://www.stat.berkeley.edu/~aldous/157/Papers/shmueli.pdf"&gt;Shmueli, 2010&lt;/a&gt; qui expose les enjeux crois√©s des d√©marches explicative et pr√©dictive dans la mod√©lisation.&lt;br&gt;
Il me reste √† remercier &lt;a href="https://twitter.com/EParoissien"&gt;Emmanuel Paroissien&lt;/a&gt;, chercheur √† l'Inra, pour nos √©changes qui m'ont aid√© √† construire cette note. N'h√©sitez pas √† &lt;a href="https://www.statoscop.fr"&gt;visiter notre site&lt;/a&gt; et √† nous suivre sur &lt;a href="https://twitter.com/stato_scop"&gt;Twitter&lt;/a&gt; et &lt;a href="https://www.linkedin.com/company/statoscop"&gt;Linkedin&lt;/a&gt;. Pour retrouver le code ayant servi √† g√©n√©rer cette note, vous pouvez vous rendre sur le &lt;a href="https://github.com/Statoscop/notebooks-blog"&gt;d√©p√¥t github de nos notes de blog&lt;/a&gt;.  &lt;/p&gt;
&lt;div class = "d-flex justify-content-center mt-4"&gt;
   &lt;a href="https://statoscop.fr" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Visiter notre site&lt;/a&gt;
   &lt;a href="https://statoscop.fr/contact" target=_blank class="btn btn-primary btn-custom text-uppercase" type="button"&gt;Nous contacter&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;&lt;br&gt;  &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="data science"></category><category term="statistiques"></category><category term="Machine Learning"></category></entry><entry><title>Gestion des packages sur R avec renv</title><link href="https://blog.statoscop.fr/gestion-des-packages-sur-r-avec-renv.html" rel="alternate"></link><published>2021-10-07T00:00:00+02:00</published><updated>2021-10-07T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-10-07:/gestion-des-packages-sur-r-avec-renv.html</id><summary type="html">&lt;p&gt;Pr√©sentation du gestionnaire de packages de R&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#interet-dun-gestionnaire-de-packages-dans-un-projet-avec-r"&gt;Int√©r√™t d'un gestionnaire de packages dans un projet avec R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#organisation-du-projet"&gt;Organisation du projet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#avantages-dun-gestionnaire-de-packages-dans-un-projet-r"&gt;Avantages d'un gestionnaire de packages dans un projet R&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#votre-projet-sera-isole"&gt;Votre projet sera isol√©&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#votre-projet-sera-portable-et-reproductible"&gt;Votre projet sera portable et reproductible&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renv"&gt;Utilisation de renv&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#initialisation-de-renv"&gt;Initialisation de renv&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#mettre-a-jour-les-dependances-avec-le-fichier-lock"&gt;Mettre √† jour les d√©pendances avec le fichier lock&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renvrestore"&gt;Utilisation de renv::restore()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#utilisation-de-renvsnapshot"&gt;Utilisation de renv::snapshot()&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#petite-note-sur-git"&gt;Petite note sur git&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#conclusion"&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;En 2019, je pr√©sentais bri√®vement le package &lt;code&gt;packrat&lt;/code&gt; dans &lt;a href="https://antoinesir.rbind.io/post/gestion-des-packages-sur-r-pr%C3%A9sentation-de-packrat/"&gt;un article de blog&lt;/a&gt;. Ce package R permettait de g√©rer les d√©pendances aux packages d'un projet R √† la mani√®re des environnements de Python. Il comportait cependant un certain nombre d'inconv√©nients, dont celui d'un temps long de t√©l√©chargement des packages. Depuis 2020, il a √©t√© remplac√© par &lt;code&gt;renv&lt;/code&gt; qui gomme la plupart de ces d√©fauts, et c'est l'occasion de vous montrer pourquoi et comment vous devriez vous servir d'un gestionnaire de packages pour vos projets R √† partir d'un exemple concret!&lt;/p&gt;
&lt;p&gt;On commence cet article par la pr√©sentation du projet dont on se sert comme exemple et de l'int√©r√™t d'un gestionnaire de packages avant d'illustrer l'utilisation de &lt;code&gt;renv&lt;/code&gt; dans ce contexte. Cet article a pour but de pr√©senter un cas concret d'utilisation de &lt;code&gt;renv&lt;/code&gt; mais ne se substitue pas √† la &lt;a href="https://rstudio.github.io/renv/articles/renv.html"&gt;documentation officielle du package&lt;/a&gt;.  &lt;/p&gt;
&lt;h1 id="interet-dun-gestionnaire-de-packages-dans-un-projet-avec-r"&gt;Int√©r√™t d'un gestionnaire de packages dans un projet avec R&lt;/h1&gt;
&lt;p&gt;La premi√®re √©tape pour aller vers plus de reproductibilit√© sur R est de conna√Ætre le fonctionnement des projets (fichiers .Rproj), qui permettent d'ouvrir R √† la racine de votre projet et de proposer un code avec seulement des chemins relatifs. Si vous n'√™tes pas du tout familiers avec ce fonctionnement, je vous conseille de lire &lt;a href="http://larmarange.github.io/analyse-R/organiser-ses-fichiers.html"&gt;cet article&lt;/a&gt; de l'excellent blog de Joseph Larmarange.  &lt;/p&gt;
&lt;h2 id="organisation-du-projet"&gt;Organisation du projet&lt;/h2&gt;
&lt;p&gt;On propose pour illustrer le propos un projet tout simple dont l'organisation est pr√©sent√©e ci-dessous :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/orga_dossier.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Ce projet contient un dossier &lt;code&gt;data&lt;/code&gt; dans lequel se trouve notre base de donn√©es et un dossier &lt;code&gt;scripts&lt;/code&gt; avec un code R contenant quelques traitements basiques. √Ä la racine du dossier, on remarque √©galement notre fichier &lt;code&gt;Presentation renv.Rproj&lt;/code&gt; qui d√©finit donc l'emplacement de notre r√©pertoire de travail. Le script R contient les instructions suivantes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Chargement des packages&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Import des donn√©es&lt;/span&gt;
&lt;span class="n"&gt;mon_iris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="nf"&gt;fread&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data/iris.csv&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;results&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mon_iris&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Sepal&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Ce code tout simple permet donc de calculer la moyenne des largeur et longueur des s√©pales de la base de donn√©es &lt;code&gt;iris&lt;/code&gt;. L'utilisation d'un fichier .Rproj, d'un chemin relatif pour importer les donn√©es et le fait que les deux packages utilis√©s (&lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt;) soient charg√©s explicitement semblent rendre la reproductibilit√© des r√©sultats ais√©e : il me suffit de r√©cup√©rer l'ensemble du dossier, d'installer les deux packages s'ils ne sont pas d√©j√† install√©s et de faire tourner le code. Seulement, je pourrais avoir sur mon poste une version de dplyr install√©e trop ancienne et dans laquelle &lt;code&gt;across&lt;/code&gt; n'existerait pas encore. Bien s√ªr il suffirait ici de mettre √† jour mon package, mais peut-√™tre que la version la plus r√©cente de &lt;code&gt;dplyr&lt;/code&gt; ne correspond pas non plus √† la version du code utilis√© par la personne ayant √©crit le code, et que cela peut causer de nouveaux probl√®mes...&lt;/p&gt;
&lt;h2 id="avantages-dun-gestionnaire-de-packages-dans-un-projet-r"&gt;Avantages d'un gestionnaire de packages dans un projet R&lt;/h2&gt;
&lt;p&gt;Tout d'abord, sachez qu'en g√©n√©ral les d√©veloppeurs de package R, et en particulier ceux ayant un tr√®s grand nombre d'utilisateurs, portent une attention particuli√®re √† faire en sorte que les mises √† jour ne "cassent" pas les codes existants, en d'autres termes que ce qui a √©t√© cod√© dans une ancienne version du package tourne toujours avec la nouvelle version. Ceci √©tant dit, une mise √† jour peut toujours avoir des cons√©quences sur vos r√©sultats (anticip√©s ou non par les d√©veloppeurs) et il est bien plus facile d'utiliser un gestionnaire de packages, et nous allons vous expliquer pourquoi.  &lt;/p&gt;
&lt;h3 id="votre-projet-sera-isole"&gt;Votre projet sera isol√©&lt;/h3&gt;
&lt;p&gt;Avec le syst√®me classique de packages R, tous les packages install√©s le sont dans un r√©pertoire commun √† votre ordinateur. Quand vous mettez √† jour un package, l'ancienne version est √©cras√©e et ce pour &lt;strong&gt;tous&lt;/strong&gt; vos projets. Ce que va permettre un gestionnaire de packages, c'est de faire d√©pendre une version d'un package √† un projet en particulier. C'est ce qui va permettre √† chacun de vos projets d'√™tre &lt;strong&gt;isol√©s&lt;/strong&gt; les uns des autres. En plus, &lt;code&gt;renv&lt;/code&gt; fonctionne sur un syst√®me de caches qui lui permet malgr√© tout de ne pas avoir √† t√©l√©charger deux fois la m√™me version du m√™me package si elle est utilis√©e dans deux projets diff√©rents. Cette propri√©t√© est particuli√®rement importante pour des gros projets pour lesquels vous n'auriez pas le temps d'adapter le code √† une mise √† jour d'un package, tout en voulant b√©n√©ficier de cette mise √† jour pour vos autres travaux.  &lt;/p&gt;
&lt;h3 id="votre-projet-sera-portable-et-reproductible"&gt;Votre projet sera portable et reproductible&lt;/h3&gt;
&lt;p&gt;La portabilit√© d'un projet, c'est sa capacit√© √† pouvoir tourner sur n'importe quelle machine, n'importe quel OS, etc... C'est ce qui permet sa reproductibilit√©, c'est-√†-dire la capacit√© √† reproduire les r√©sultats dans des conditions identiques. C'est extr√™mement pr√©cieux pour les projets en √©quipe mais aussi pour soi : en effet rien ne nous assure que notre projet cod√© il y a deux ans va tourner apr√®s les nombreuses mises √† jour qu'ont d√ª subir les packages utilis√©s. &lt;code&gt;renv&lt;/code&gt; permet de r√©pondre √† cette probl√©matique en vous renvoyant 2 ans en arri√®re dans le m√™me environnement de packages, √† condition bien s√ªr que les versions utilis√©es alors soient encore disponibles sur le CRAN ou sur la source de laquelle vous les avez t√©l√©charg√©s.  &lt;/p&gt;
&lt;h1 id="utilisation-de-renv"&gt;Utilisation de renv&lt;/h1&gt;
&lt;p&gt;Apr√®s, je l'esp√®re, vous avoir convaincu de l'utilit√© d'un gestionnaire de packages, je vais vous pr√©senter rapidement comment utiliser &lt;code&gt;renv&lt;/code&gt; dans le petit projet que je vous ai pr√©sent√©.  &lt;/p&gt;
&lt;h2 id="initialisation-de-renv"&gt;Initialisation de &lt;code&gt;renv&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Pour commencer √† utiliser le gestionnaire de packages, vous ouvrez votre projet dans RStudio et vous lancez dans la console &lt;code&gt;renv::init()&lt;/code&gt;. Votre projet va maintenant ressembler √† √ßa :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/orga_dossier_renv.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate l'apparition d'un dossier &lt;code&gt;renv&lt;/code&gt;, qui contient les fichiers de lancement et de param√©trage du gestionnaire ainsi que les liens vers les packages √† charger. Contrairement √† &lt;code&gt;packrat&lt;/code&gt;, renv utilise en effet un cache dans lequel il installe les packages, ce qui permet de ne pas dupliquer l'installation de la m√™me version du m√™me package pour deux projets diff√©rents. Mais ce qui nous int√©resse plus, c'est l'apparition √† la racine du projet du fichier &lt;code&gt;renv.lock&lt;/code&gt;, qui ressemble √† √ßa :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;4.1.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repositories&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Name&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;URL&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;https://cloud.r-project.org&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Packages&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R6&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;R6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;2.5.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;b203113193e70978a696b2809525649d&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cli&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;cli&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;2.5.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;a94ba44cee3ea571e813721e64184172&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;crayon&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;crayon&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1.4.1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;e75525c55c70e5f4f78c9960a4b402e9&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data.table&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Package&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;data.table&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Version&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1.14.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Source&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Repository&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;CRAN&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hash&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;d1b8b1a821ee564a3515fa6c6d5c52dc&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;&lt;span class="kc"&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le gestionnaire a rep√©r√© les packages utilis√©s dans mon script et a recens√© toutes leurs informations utiles ainsi que celles de leurs d√©pendances : nom, version, source d'installation... Il renseigne aussi les caract√©ristiques du logiciel R install√© sur mon poste. C'est √† partir de ce fichier que le gestionnaire va ensuite √™tre capable de v√©rifier l'ad√©quation de l'environnement de packages de l'utilisateur et celui enregistr√© le plus r√©cemment. C'est aussi l√† qu'il va √©crire les r√©f√©rences des packages que j'installerai apr√®s avoir commenc√© √† travailler sur le poste.  &lt;/p&gt;
&lt;p&gt;√Ä noter que &lt;strong&gt;&lt;code&gt;renv&lt;/code&gt; peut aussi bien √™tre utilis√© au lancement de votre projet qu'au cours de celui-ci&lt;/strong&gt;. S'il est utilis√© au lancement, vous enregistrerez dans le fichier lock les informations des packages au fur et √† mesure de votre utilisation. Si le projet est d√©j√† bien avanc√© comme dans notre exemple, il va partir d'un fichier lock contenant d√©j√† les r√©f√©rences des packages install√©s et utilis√©s. &lt;/p&gt;
&lt;h2 id="mettre-a-jour-les-dependances-avec-le-fichier-lock"&gt;Mettre √† jour les d√©pendances avec le fichier lock&lt;/h2&gt;
&lt;p&gt;On pr√©sente les deux instructions les plus utiles de &lt;code&gt;renv&lt;/code&gt; : &lt;code&gt;restore()&lt;/code&gt; et &lt;code&gt;snapshot()&lt;/code&gt;. Ce sont elles qui permettent de raccorder l'√©tat de votre environnement de packages en local par rapport √† celui qui sera propos√© √† l'ouverture de votre projet &lt;code&gt;renv&lt;/code&gt;. C'est la fonction &lt;code&gt;status()&lt;/code&gt; qui permet de v√©rifier que votre environnement de packages utilis√© √† un moment T correspond bien √† celui enregistr√© dans le fichier lock.   &lt;/p&gt;
&lt;h3 id="utilisation-de-renvrestore"&gt;Utilisation de &lt;code&gt;renv::restore()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Imaginons que j'ouvre ce m√™me projet sur un autre poste sur lequel &lt;code&gt;data.table&lt;/code&gt; n'est pas install√©. En ouvrant le projet RStudio je vais avoir un message d'avertissement m'indiquant que mon environnement pourrait ne pas √™tre √† jour du projet. Je lance alors &lt;code&gt;renv::status()&lt;/code&gt;, qui me renvoie en effet :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/warning_renv.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;L'absence d'installation de &lt;code&gt;data.table&lt;/code&gt; a bien √©t√© rep√©r√©e. Comme sugg√©r√©, il suffit de lancer &lt;code&gt;renv::restore()&lt;/code&gt; pour que mon environnement de packages soit de nouveau √† jour avec celui d√©crit dans le fichier lock. Il aurait fallu aussi envoyer cette instruction si la version de &lt;code&gt;data.table&lt;/code&gt; enregistr√©e sur votre poste ne correspondait plus √† celle enregistr√©e dans le fichier lock. Cette instruction sert donc √† rendre mon environnement de packages en local coh√©rent avec celui renseign√© dans le fichier lock.     &lt;/p&gt;
&lt;h3 id="utilisation-de-renvsnapshot"&gt;Utilisation de &lt;code&gt;renv::snapshot()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Je peux aussi vouloir changer le fichier lock suite √† une √©volution du code. Imaginons par exemple que je n'utilise plus &lt;code&gt;data.table&lt;/code&gt; pour importer mes donn√©es mais directement la fonction &lt;code&gt;read.csv()&lt;/code&gt;, qui fait partie des fonctions charg√©es automatiquement au lancement de RStudio. Cette modification des d√©pendances va √™tre rep√©r√©e et &lt;code&gt;renv::status()&lt;/code&gt; va renvoyer le message suivant :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/renv/warning_renv2.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Si au contraire j'avais install√© et utilis√© un nouveau package, c'est la m√™me instruction qui m'aurait permis d'ajouter ses r√©f√©rences au fichier lock. &lt;code&gt;renv::snapshot()&lt;/code&gt; permet donc de mettre √† jour le fichier lock afin que mes modifications dans l'utilisation des packages soient prises en compte. &lt;strong&gt;Avant d'avoir lanc√© cette instruction, les modifications dans les d√©pendances de mon projet ne seront pas prises en compte par le gestionnaire de packages&lt;/strong&gt;.   &lt;/p&gt;
&lt;h2 id="petite-note-sur-git"&gt;Petite note sur git&lt;/h2&gt;
&lt;p&gt;Comme on l'a vu, l'utilisation de &lt;code&gt;renv&lt;/code&gt; est particuli√®rement int√©ressante dans le cadre d'un travail collaboratif. C'est donc naturellement qu'on l'utilisera avec git. Il est important de noter qu'il n'est pas n√©cessaire de versionner tout le dossier &lt;code&gt;renv&lt;/code&gt;, mais seulement le fichier lock, le script &lt;code&gt;renv/activate.R&lt;/code&gt; et le fichier &lt;code&gt;.Rprofile&lt;/code&gt; de la personne ayant initialis√© le projet. Le reste du dossier &lt;code&gt;renv&lt;/code&gt; contient en effet des informations sp√©cifiques √† chaque poste, comme les liens vers le cache ayant stock√© les packages install√©s. Il se mettra √† jour automatiquement avec les trois fichiers versionn√©s. Pensez √† vous &lt;a href="https://rstudio.github.io/renv/articles/collaborating.html"&gt;r√©f√©rer √† la documentation avant de vous lancer&lt;/a&gt;.  &lt;/p&gt;
&lt;h1 id="conclusion"&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Vous l'avez compris, &lt;code&gt;renv&lt;/code&gt; est un outil tr√®s pr√©cieux pour s'assurer que d'autres personnes ou vous-m√™me pourront refaire tourner votre code sans difficult√©s. Il est sans doute n√©cessaire, mais pas suffisant : certains packages ont des d√©pendances externes comme javascript, il faut bien s√ªr veiller √† ce que les donn√©es soient accessibles et identiques pour tous et que les scripts ne contiennent pas de param√®tres sp√©cifiques √† un utilisateur. &lt;br&gt;
En plus des qualit√©s pr√©sent√©es dans l'article, &lt;code&gt;renv&lt;/code&gt; vous permettra aussi de vous rendre compte du nombre de packages sur lequel repose votre projet, qui ne se limitent pas qu'aux packages install√©s mais aussi √† leurs d√©pendances. Cela peut √™tre une bonne occasion d'essayer de les r√©duire dans la mesure du possible. R√©cemment, un frisson a parcouru les quelques milliers de d√©veloppeurs de packages R d√©pendant du package &lt;code&gt;lubridate&lt;/code&gt; quand ils ont re√ßu un mail du CRAN leur annon√ßant que ce dernier risquait d'√™tre supprim√© et qu'ils devaient ajuster leurs packages en cons√©quence. Naturellement, au vu de la popularit√© de &lt;code&gt;lubridate&lt;/code&gt;, cela &lt;a href="https://twitter.com/dvaughan32/status/1445459240718458881"&gt;n'arrivera finalement pas&lt;/a&gt;, mais c'est un rappel utile de la fragilit√© relative d'un projet avec de trop nombreuses d√©pendances.&lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="renv"></category><category term="packages"></category><category term="CRAN"></category></entry><entry><title>Fonctionnement et performances d'across dans dplyr</title><link href="https://blog.statoscop.fr/fonctionnement-et-performances-dacross-dans-dplyr.html" rel="alternate"></link><published>2021-06-02T00:00:00+02:00</published><updated>2021-06-02T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-06-02:/fonctionnement-et-performances-dacross-dans-dplyr.html</id><summary type="html">&lt;p&gt;Mise √† jour de l'√©valuation des performances du verbe &lt;code&gt;across&lt;/code&gt; dans dplyr version 1.0.6&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#across-ca-marche-comment"&gt;across(), √ßa marche comment?&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#syntaxe-de-base"&gt;Syntaxe de base&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#selection-avec-des-conditions"&gt;S√©lection avec des conditions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#selection-a-partir-du-nom"&gt;S√©lection √† partir du nom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#autres-proprietes"&gt;Autres propri√©t√©s&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#across-ca-tourne-comment"&gt;across(), √ßa tourne comment?&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#instructions-sur-lesquelles-on-compare-les-methodes"&gt;Instructions sur lesquelles on compare les m√©thodes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#resultats-de-la-version-106"&gt;R√©sultats de la version 1.0.6&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#resultats-de-la-version-100"&gt;R√©sultats de la version 1.0.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;A la sortie de l'√©t√© dernier, j'ai r√©alis√© une &lt;a href="https://antoinesir.rbind.io/post/fonctionnement-de-across-dans-dplyr/" target="_blank"&gt;note sur mon blog personnel&lt;/a&gt; sur un √©l√©ment important d'une mise √† jour majeure de dplyr : &lt;code&gt;across()&lt;/code&gt;, un nouveau verbe pour r√©aliser des op√©rations sur plusieurs colonnes. Dans cette note, on utilisait la version &lt;code&gt;1.0.2&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; et on comparait &lt;code&gt;across&lt;/code&gt; aux verbes √©quivalents que cela devait remplacer (fonctions index√©es par &lt;code&gt;_at&lt;/code&gt;, &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;) . On constatait une moins bonne performance d' &lt;code&gt;across&lt;/code&gt; en termes de temps d'ex√©cution. Cet √©l√©ment √©tait bien connu des d√©veloppeurs de RStudio et a √©t√© constamment pris en compte dans les diff√©rentes mises √† jour. On reprend ici cette note en la mettant √† jour avec la version &lt;code&gt;1.0.6&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; disponible √† ce jour pour voir o√π se place d√©sormais &lt;code&gt;across&lt;/code&gt; en termes de temps d'ex√©cution.&lt;/p&gt;
&lt;p&gt;Si vous voulez balayer plus largement les diff√©rents √©l√©ments de la mise √† jour de &lt;code&gt;dplyr&lt;/code&gt;, vous pouvez vous rendre sur &lt;a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/" target="_blank"&gt;le site du tidyverse&lt;/a&gt; (en anglais) ou sur &lt;a href="https://thinkr.fr/hey-quoi-de-neuf-dplyr-le-point-sur-la-v1/#La_fonction_de_calcul_avec_conditions_sur_les_variables_across()" target="_blank"&gt;cet article du blog de ThinkR&lt;/a&gt; (en fran√ßais) qui en pr√©sentent les changements majeurs. &lt;/p&gt;
&lt;h1 id="across-ca-marche-comment"&gt;&lt;code&gt;across()&lt;/code&gt;, √ßa marche comment?&lt;/h1&gt;
&lt;h2 id="syntaxe-de-base"&gt;Syntaxe de base&lt;/h2&gt;
&lt;p&gt;Le verbe &lt;code&gt;across()&lt;/code&gt; vise √† remplacer toutes les fonctions suffix√©es par &lt;code&gt;_if&lt;/code&gt;, &lt;code&gt;_at&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;. Il regroupe ces m√©thodes dans une seule et permet ainsi de les associer, ce qui n'√©tait pas possible avant. Il s'utilise dans &lt;code&gt;mutate&lt;/code&gt; et &lt;code&gt;summarise&lt;/code&gt;. La syntaxe associ√©e √† ce verbe est la suivante :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.cols&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.fns&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Dans laquelle :&lt;br&gt;
 - Les colonnes &lt;code&gt;.cols&lt;/code&gt; peuvent √™tre s√©lectionn√©es en utilisant la m√™me syntaxe que pour la m√©thode &lt;code&gt;vars()&lt;/code&gt; (nom des variables, &lt;code&gt;starts_with&lt;/code&gt;, &lt;code&gt;end_with&lt;/code&gt;, &lt;code&gt;contains&lt;/code&gt;,...), mais aussi avec des conditions rentr√©es dans &lt;code&gt;where()&lt;/code&gt; qui s√©lectionneront de la m√™me mani√®re que le faisaient les fonctions suffix√©es par &lt;code&gt;_if&lt;/code&gt;.&lt;br&gt;
 - La fonction &lt;code&gt;.fns&lt;/code&gt; est d√©finie comme auparavant (le nom de la fonction ou sa d√©finition "√† la vol√©e" avec &lt;code&gt;~ my_fun(.)&lt;/code&gt;).  &lt;/p&gt;
&lt;p&gt;On pr√©sente quelques exemples en utilisant la table &lt;code&gt;penguins&lt;/code&gt; promue par &lt;a href="https://github.com/allisonhorst/palmerpenguins" target="_blank"&gt;Allison Horst&lt;/a&gt; pour remplacer l'usage de la table iris. Vous pouvez l'obtenir depuis le package &lt;code&gt;palmerpenguins&lt;/code&gt; sur le CRAN.  &lt;/p&gt;
&lt;h2 id="selection-avec-des-conditions"&gt;S√©lection avec des conditions&lt;/h2&gt;
&lt;p&gt;√Ä partir de cette table, l'instruction visant √† sortir la moyenne de toutes les variables num√©riques s'√©crivait auparavant :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202. 2008.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Elle se r√©√©crit avec &lt;code&gt;across()&lt;/code&gt; en utilisant &lt;code&gt;where()&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202. 2008.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="selection-a-partir-du-nom"&gt;S√©lection √† partir du nom&lt;/h2&gt;
&lt;p&gt;Si l'on souhaite s√©lectionner √† partir du nom des variables, la nouvelle syntaxe est la suivante :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Ancienne version&lt;/span&gt;
&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill*|flipper*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 3&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.&lt;/span&gt;

&lt;span class="c1"&gt;# Avec across()&lt;/span&gt;
&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;matches&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill*|flipper*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 3&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="autres-proprietes"&gt;Autres propri√©t√©s&lt;/h2&gt;
&lt;p&gt;On note √©galement qu'on peut combiner dor√©navant les s√©lections sur les types des colonnes et sur leur nom dans une seule instruction &lt;code&gt;across()&lt;/code&gt;, ce qui n'√©tait pas possible avant. Pour enlever les ann√©es des moyennes num√©riques, on peut par exemple √©crire :   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nf"&gt;contains&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;year&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;na.rm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 1 x 4&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;             &amp;lt;dbl&amp;gt;       &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           43.9          17.2              201.       4202.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Enfin, le param√®tre &lt;code&gt;.names&lt;/code&gt; de &lt;code&gt;across()&lt;/code&gt; est √©galement tr√®s pratique et permet notamment dans une instruction &lt;code&gt;mutate()&lt;/code&gt; de cr√©er de nouvelles colonnes nomm√©es √† partir des anciennes auxquelles on peut se r√©f√©rer avec &lt;code&gt;.col&lt;/code&gt;. Par exemple, si je veux cr√©er deux nouvelles colonnes passant les informations sur le bec en pouces mais en conservant les anciennes colonnes, je peux √©crire :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;penguins&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0.04&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;.names&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;pouces_{.col}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;select&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;contains&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;bill&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 5 x 4&lt;/span&gt;
&lt;span class="c1"&gt;##   bill_length_mm bill_depth_mm pouces_bill_length_mm pouces_bill_depth_mm&lt;/span&gt;
&lt;span class="c1"&gt;##            &amp;lt;dbl&amp;gt;         &amp;lt;dbl&amp;gt;                 &amp;lt;dbl&amp;gt;                &amp;lt;dbl&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;## 1           39.1          18.7                  1.56                0.748&lt;/span&gt;
&lt;span class="c1"&gt;## 2           39.5          17.4                  1.58                0.696&lt;/span&gt;
&lt;span class="c1"&gt;## 3           40.3          18                    1.61                0.72 &lt;/span&gt;
&lt;span class="c1"&gt;## 4           NA            NA                   NA                  NA    &lt;/span&gt;
&lt;span class="c1"&gt;## 5           36.7          19.3                  1.47                0.772&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h1 id="across-ca-tourne-comment"&gt;&lt;code&gt;across()&lt;/code&gt;, √ßa tourne comment?&lt;/h1&gt;
&lt;p&gt;√Ä la sortie de la mise √† jour de &lt;code&gt;dplyr&lt;/code&gt;, il avait √©t√© signal√© que la m√©thode &lt;code&gt;across()&lt;/code&gt; impliquerait peut-√™tre de l√©g√®res pertes en termes de vitesse d'ex√©cution par rapport aux anciennes m√©thodes &lt;code&gt;_at&lt;/code&gt;, &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_all&lt;/code&gt;. On a mis en √©vidence ce probl√®me avec la version &lt;code&gt;1.0.2&lt;/code&gt; de dplyr dans &lt;a href="https://antoinesir.rbind.io/post/fonctionnement-de-across-dans-dplyr/" target="_blank"&gt;la premi√®re version de cet article&lt;/a&gt;. Sur ce m√™me mod√®le, on va comparer les instructions &lt;code&gt;_if&lt;/code&gt; et &lt;code&gt;_at&lt;/code&gt; d'un summarise group√© avec leurs √©quivalents dans &lt;code&gt;across()&lt;/code&gt; pour diff√©rentes tailles d'√©chantillons et de groupes.   &lt;/p&gt;
&lt;h2 id="instructions-sur-lesquelles-on-compare-les-methodes"&gt;Instructions sur lesquelles on compare les m√©thodes&lt;/h2&gt;
&lt;p&gt;On cr√©e un tibble comportant 4 variables num√©riques et une variable facteur, et on va comparer la vitesse d'ex√©cution des moyennes de ces variables num√©riques group√©es par modalit√© de la variable facteur en faisant varier le nombre de lignes du tibble et le nombre de groupes (de modalit√©s distinctes de la variable facteur). Le tibble est cr√©√© par exemple ainsi, pour 100 lignes et deux groupes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;
&lt;span class="n"&gt;nbgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="nf"&gt;as_tibble&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;x3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;runif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;x4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;runif&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbrow&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.factor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;sample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;floor&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nbgpe&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;                               &lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;arrange&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;round&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;.&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="c1"&gt;## # A tibble: 100 x 5&lt;/span&gt;
&lt;span class="c1"&gt;##       x1    x2    x3    x4 y    &lt;/span&gt;
&lt;span class="c1"&gt;##    &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;fct&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;##  1 -3.36  0.9   0.32  0.36 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  2 -3.04  0.92  0.61  0.46 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  3 -2.4   1.37  0.32  0.98 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  4 -2.08  1.64  0.87  0.72 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  5 -2.05  1.22  0.62  0.79 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  6 -1.78 -1.28  0.58  0.31 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  7 -1.56  1.19  0.96  0.58 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  8 -1.55 -1.18  0.4   0.85 2    &lt;/span&gt;
&lt;span class="c1"&gt;##  9 -1.47  1.77  0.71  0.21 2    &lt;/span&gt;
&lt;span class="c1"&gt;## 10 -1.29 -0.6   0.68  0.4  2    &lt;/span&gt;
&lt;span class="c1"&gt;## # ‚Ä¶ with 90 more rows&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Sur chaque tibble (chaque combinaison du nombre de lignes et de groupes), les diff√©rentes instructions test√©es sont les suivantes :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# summarise_if  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="c1"&gt;# across + where()  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;where&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;is.numeric&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;

&lt;span class="c1"&gt;# summarise_at  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise_at&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="c1"&gt;# across + starts_with()  &lt;/span&gt;
&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;across&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;starts_with&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;x&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Toutes les instructions font la m√™me chose : une moyenne group√©e par &lt;code&gt;y&lt;/code&gt; des 4 variables num√©riques. L'id√©e est de v√©rifier que l'option &lt;code&gt;across&lt;/code&gt; n'est pas plus lente que les options &lt;code&gt;summarise_if&lt;/code&gt; et &lt;code&gt;summarise_at&lt;/code&gt;. &lt;/p&gt;
&lt;h2 id="resultats-de-la-version-106"&gt;R√©sultats de la version 1.0.6&lt;/h2&gt;
&lt;p&gt;Les r√©sultats du &lt;code&gt;microbenchmark()&lt;/code&gt; pour les diff√©rentes combinaisons de nombres de groupes et de lignes sont pr√©sent√©s dans un graphique qui repr√©sente la distribution du temps d‚Äôex√©cution des 10 occurences test√©es pour chaque m√©thode :     &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/across_files/unnamed-chunk-10-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;Sur nos exemples, il semblerait qu'&lt;code&gt;across&lt;/code&gt; ait compl√®tement rattrap√© son retard sur ses √©quivalents &lt;code&gt;_at&lt;/code&gt; et &lt;code&gt;_if&lt;/code&gt;. Il semble m√™me l√©g√®rement plus performant dans certains cas de figure.  &lt;/p&gt;
&lt;h2 id="resultats-de-la-version-100"&gt;R√©sultats de la version 1.0.0&lt;/h2&gt;
&lt;p&gt;Pour illustrer le chemin parcouru, on peut refaire tourner cette m√™me comparaison avec la version &lt;code&gt;1.0.0&lt;/code&gt; de &lt;code&gt;dplyr&lt;/code&gt; :  &lt;/p&gt;
&lt;p&gt;&lt;img alt="Pelican" src="../images/across_files/unnamed-chunk-11-1.png"&gt;&lt;!-- --&gt;&lt;/p&gt;
&lt;p&gt;On constate bien que dans sa premi√®re version, &lt;code&gt;across&lt;/code&gt; connaissait de bien moins bonnes performances, en particulier sur les dataframes avec beaucoup de lignes et/ou beaucoup de groupes. Les mises √† jour successives ont donc bien permis de combler ces probl√®mes de performance et c'est une excellente nouvelle car au niveau de la syntaxe, nous, on adore!  &lt;/p&gt;
&lt;p&gt;C'est tout pour aujourd'hui ! Comme d'habitude vous pouvez retrouver le fichier Rmarkdown ayant servi √† g√©n√©rer cette note sur le &lt;a href="https://github.com/Statoscop/notebooks-blog" target="_blank"&gt;github de Statoscop&lt;/a&gt;.&lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="dplyr"></category><category term="across"></category><category term="tidyverse"></category></entry><entry><title>Comparaisons base R, dplyr et data.table</title><link href="https://blog.statoscop.fr/comparaisons-base-dplyr-datatable.html" rel="alternate"></link><published>2021-03-30T00:00:00+02:00</published><updated>2021-03-30T00:00:00+02:00</updated><author><name>Antoine</name></author><id>tag:blog.statoscop.fr,2021-03-30:/comparaisons-base-dplyr-datatable.html</id><summary type="html">&lt;p&gt;Comparaisons des temps d'ex√©cution de base R, dplyr et data.table sur quelques cas d'√©tude&lt;/p&gt;</summary><content type="html">&lt;div class="toc"&gt;&lt;span class="toctitle"&gt;Table des mati√®res&lt;/span&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#rappels-sur-dplyr-et-datatable"&gt;Rappels sur dplyr et data.table&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#dplyr-et-le-tidyverse"&gt;dplyr et le tidyverse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#datatable"&gt;Data.table&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#vitesses-dexecution"&gt;Vitesses d'ex√©cution&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#comparaisons-sur-une-etude-de-cas-simple"&gt;Comparaisons sur une √©tude de cas simple&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#notre-etude-de-cas"&gt;Notre √©tude de cas&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#moyenne-des-retards-et-fusion-des-tables"&gt;Moyenne des retards et fusion des tables&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#comparaisons-des-vitesses-dexecution"&gt;Comparaisons des vitesses d'ex√©cution&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;Cet article est une mise √† jour de l'article du &lt;a href="https://antoinesir.rbind.io/post/comparaisons-base-r-dplyr-data-table/" target="_blank"&gt;blog d'Antoine&lt;/a&gt; r√©alis√© en 2018. L'id√©e est de comparer les performances de trois alternatives dans R pour l'analyse de donn√©es : &lt;br&gt;
- l'utilisation des seules fonctions de base R&lt;br&gt;
- dplyr&lt;br&gt;
- data.table  &lt;/p&gt;
&lt;h1 id="rappels-sur-dplyr-et-datatable"&gt;Rappels sur dplyr et data.table&lt;/h1&gt;
&lt;p&gt;On rappelle ici les principales caract√©ristiques de ces packages mais pour se former √† leur utilisation on peut se r√©f√©rer au &lt;a href="https://teaching.slmc.fr/perf/presentation_handout.pdf" target="_blank"&gt;cours de perfectionnement de Martin Chevalier&lt;/a&gt;. Pour une exploration de ce qu'englobe le &lt;code&gt;tidyverse&lt;/code&gt; et notamment une pr√©sentation des commandes de &lt;code&gt;dplyr&lt;/code&gt;, vous pouvez jeter un oeil √† &lt;a href="https://juba.github.io/tidyverse/index.html" target="_blank"&gt;l'introduction √† R et au tidyverse&lt;/a&gt; de J. Barnier. Enfin pour data.table, on trouve des informations utiles sur le cours &lt;a href="http://larmarange.github.io/analyse-R/manipulations-avancees-avec-data-table.html" target="_blank"&gt;Manipulations avanc√©e avec data.table&lt;/a&gt; de J. Larmarange et on vous conseille l'excellent article &lt;a href="https://atrebas.github.io/post/2020-06-17-datatable-introduction/" target="_blank"&gt;a gentle introduction to data.table&lt;/a&gt;.  &lt;/p&gt;
&lt;h2 id="dplyr-et-le-tidyverse"&gt;dplyr et le tidyverse&lt;/h2&gt;
&lt;p&gt;Le &lt;code&gt;tidyverse&lt;/code&gt; (contraction de "tidy" et "universe") est un concept initi√© par Hadley Wickham, chef statisticien de RStudio. Il regroupe un ensemble de packages utiles au traitement statistique et au nettoyage de bases de donn√©es. On va s'int√©resser ici presque seulement au package &lt;code&gt;dplyr&lt;/code&gt; (dont les instructions seront appliqu√©es aux &lt;code&gt;tibbles&lt;/code&gt;, un format de data.frame issu du &lt;code&gt;tidyverse&lt;/code&gt;), mais vous pouvez parcourir les packages propos√©s dans le tidyverse sur &lt;a href="https://www.tidyverse.org/" target="_blank"&gt;le site officiel&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;&lt;code&gt;dplyr&lt;/code&gt; propose un ensemble d'op√©rations de traitement de donn√©es sous une syntaxe diff√©rente de celle utilis√©e dans les fonctions de base de R. Ce langage pr√©sente le double avantage d'√™tre √† la fois lisible pour quelqu'un habitu√© aux langages tels que SAS ou SQL et de proposer des fonctions optimis√©es qui pr√©sentent de bonnes performances en termes de temps d'ex√©cution. La grammaire &lt;code&gt;dplyr&lt;/code&gt; s'appuie en effet sur des fonctions au nom explicite :  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mutate(data, newvar1=fonction(var1,var2...))&lt;/code&gt; et &lt;code&gt;transmute(data, newvar1=fonction(var1,var2...))&lt;/code&gt; cr√©ent de nouvelles variables&lt;/li&gt;
&lt;li&gt;&lt;code&gt;filter(data, condition)&lt;/code&gt; s√©lectionne au sein d'une table certaines observations, √† la mani√®re de &lt;code&gt;where&lt;/code&gt; dans SAS.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;arrange(data, var1, descending var2,...)&lt;/code&gt; trie une base selon une ou plusieurs variables (l'√©quivalent d'une &lt;code&gt;proc sort&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;select(data, var1 : varX)&lt;/code&gt; s√©lectionne certaines variables dans une base, √† la mani√®re de &lt;code&gt;keep&lt;/code&gt; dans SAS. &lt;/li&gt;
&lt;li&gt;&lt;code&gt;summarise(data, newvar1=mean(var1), newvar2=sum(var2))&lt;/code&gt; r√©alise toute sorte d'op√©rations statistiques sur une table.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;group_by(data, var)&lt;/code&gt; regroupe une table par une variable&lt;/li&gt;
&lt;li&gt;et bien d'autres...  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Un aspect pratique de ce langage est que toutes ces op√©rations peuvent √™tre cha√Æn√©es √† l'aide de l'op√©rateur &lt;code&gt;%&amp;gt;%&lt;/code&gt; ("pipe" en anglais, issu du package &lt;code&gt;magrittr&lt;/code&gt;) dont la syntaxe est la suivante : &lt;code&gt;data %&amp;gt;% fonction(...)&lt;/code&gt; est √©quivalent √† &lt;code&gt;fonction(data, ...)&lt;/code&gt;. Cette syntaxe permet de cha√Æner un grand nombre d'op√©rations sur une base commune, en limitant le nombre de fois o√π l'on √©crit des tables interm√©diaires tout en conservant une grande lisibilit√© du code. Ce petit exemple vous en convaincra peut-√™tre :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dplyr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# on cr√©e un data frame avec 100 lignes, &lt;/span&gt;
&lt;span class="c1"&gt;# chaque individu appartenant √† un des 50 groupes&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;sample&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;50&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;TRUE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on y applique les instructions de dplyr&lt;/span&gt;
&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as_tibble&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mutate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_tibble&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Un regard peu habitu√© contesterait peut-√™tre l'aspect tr√®s lisible de l'instruction, mais √ßa l'est r√©ellement. Le d√©roul√© est le suivant :  &lt;/p&gt;
&lt;p&gt;1) on transforme notre data.frame en tibble (pour rappel : format optimis√© de data.frame pour dplyr) avec &lt;code&gt;as_tibble&lt;/code&gt;&lt;br&gt;
2) on cr√©e une variable &lt;code&gt;var&lt;/code&gt; avec &lt;code&gt;mutate&lt;/code&gt;&lt;br&gt;
3) on agr√®ge par  &lt;code&gt;idgpe&lt;/code&gt; avec &lt;code&gt;group_by&lt;/code&gt; &lt;br&gt;
4) on calcule la moyenne de &lt;code&gt;var&lt;/code&gt; avec &lt;code&gt;summarise&lt;/code&gt;, que l'on stocke dans &lt;code&gt;var_mean&lt;/code&gt;. Comme cette instruction suit un group_by, elle est r√©alis√©e √† l'int√©rieur de chaque groupe (d√©fini par &lt;code&gt;idgpe&lt;/code&gt;), sinon elle aurait √©t√© r√©alis√© sur l'ensemble de la table.    &lt;/p&gt;
&lt;p&gt;Tout cela est stock√© dans une table output_tibble, qui est ainsi un tibble agr√©g√© par &lt;code&gt;idgpe&lt;/code&gt; et qui a donc 50 lignes. L'int√©r√™t de ce cha√Ænage est qu'il permet une √©conomie de code et d'√©criture d'√©ventuelles tables interm√©diaires.  &lt;/p&gt;
&lt;h2 id="datatable"&gt;Data.table&lt;/h2&gt;
&lt;p&gt;Le package &lt;code&gt;data.table&lt;/code&gt; ne pr√©tend pas, contrairement au &lt;code&gt;tidyverse&lt;/code&gt;, proposer une syntaxe concurrente √† base R mais enrichir celle-ci. Il est ax√© autour d'un nouveau format d'objet, le data.table, qui est un type de data.frame qui permet une utilisation optimis√©e de l'op√©rateur &lt;code&gt;[&lt;/code&gt;.&lt;br&gt;
Tout data.frame peut √™tre converti en data.table gr√¢ce √† la fonction &lt;code&gt;as.data.table&lt;/code&gt;, ou, de mani√®re plus optimale pour l'utilisation de la m√©moire, gr√¢ce √† la fonction &lt;code&gt;setDT&lt;/code&gt; qui permet de directement transformer la nature de l'objet sans avoir √† en √©crire un autre. Il est important d'avoir en t√™te qu'un data.frame converti en data.table conserve les caract√©ristiques d'un data.frame. Cependant, l'op√©rateur &lt;code&gt;[&lt;/code&gt; appliqu√© au data.table change de signification et devient :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;DT&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;j&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Avec &lt;code&gt;i&lt;/code&gt; qui permet de s√©lectionner des observations (sans avoir besoin de r√©p√©ter le nom de la base dans laquelle on se trouve), &lt;code&gt;j&lt;/code&gt; qui permet de cr√©er ou s√©lectionner des variables et &lt;code&gt;by&lt;/code&gt; de regrouper les traitement selon les modalit√©s d'une variable d√©finie. Comme dans &lt;code&gt;dplyr&lt;/code&gt;, il est possible de cha√Æner les op√©rations r√©alis√©es comme le montre l'exemple suivant, qui reprend le m√™me cas de figure que celui illustrant le package &lt;code&gt;dplyr&lt;/code&gt; :  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="c1"&gt;# on convertit notre data frame pr√©c√©demment cr√©√© en data.table&lt;/span&gt;
&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;df&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# on y applique les m√™me instructions&lt;/span&gt;
&lt;span class="n"&gt;dt&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;var_mean&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;rnorm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="m"&gt;100&lt;/span&gt;&lt;span class="p"&gt;))),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;idgpe&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_dt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Le fait de renseigner les variables au sein de &lt;code&gt;list()&lt;/code&gt; permet d'avoir une table en sortie au niveau de &lt;code&gt;idgpe&lt;/code&gt; (donc 50 observations), sans cela la variable est bien moyenn√©e par groupe mais la table en sortie est toujours au niveau &lt;code&gt;id1&lt;/code&gt; (100 observations).   &lt;/p&gt;
&lt;h2 id="vitesses-dexecution"&gt;Vitesses d'ex√©cution&lt;/h2&gt;
&lt;p&gt;Voil√† donc pour les pr√©sentations! Allez, on montre le r√©sultat d'un petit &lt;code&gt;microbenchmark&lt;/code&gt; des deux juste pour voir : &lt;/p&gt;
&lt;table class="dataframe"&gt;
&lt;caption&gt;Temps d'ex√©cution en microsecondes&lt;/caption&gt;
&lt;thead&gt;
    &lt;tr&gt;&lt;th scope=col&gt;expr&lt;/th&gt;&lt;th scope=col&gt;lq&lt;/th&gt;&lt;th scope=col&gt;mean&lt;/th&gt;&lt;th scope=col&gt;uq&lt;/th&gt;&lt;th scope=col&gt;neval&lt;/th&gt;&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;dplyr     &lt;/td&gt;&lt;td&gt;9.79270&lt;/td&gt;&lt;td&gt;13.23297&lt;/td&gt;&lt;td&gt;14.367579&lt;/td&gt;&lt;td&gt;100&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;data.table&lt;/td&gt;&lt;td&gt;1.40644&lt;/td&gt;&lt;td&gt; 2.13729&lt;/td&gt;&lt;td&gt; 2.546176&lt;/td&gt;&lt;td&gt;100&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Sur cet exemple, on voit un avantage clair √† data.table! Mais on est sur une toute petite table en entr√©e. On va essayer de se rapprocher de cas plus concrets en s'int√©ressant √† un exemple sur des bases plus importantes.  &lt;/p&gt;
&lt;h1 id="comparaisons-sur-une-etude-de-cas-simple"&gt;Comparaisons sur une √©tude de cas simple&lt;/h1&gt;
&lt;p&gt;Les avantages et inconv√©nients de ces deux packages sont √† l'origine de nombreux d√©bats. Vous pouvez vous en convaincre en suivant &lt;a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly" target="_blank"&gt;cette discussion sur stackoverflow&lt;/a&gt;. On peut quand m√™me d√©gager deux compromis :   &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Le choix de l'un ou l'autre des packages d√©pend beaucoup de ce que l'on va en faire (types d'analyses, taille des donn√©es, profils des utilisateurs du code...).   &lt;/li&gt;
&lt;li&gt;Les deux packages sont plus int√©ressants que base R pour l'analyse de donn√©es, que ce soit en termes de facilit√© d'√©criture ou de performances.   &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour ce deuxi√®me point, on va essayer de s'en convaincre ensemble avec ce petit exemple.&lt;/p&gt;
&lt;h2 id="notre-etude-de-cas"&gt;Notre √©tude de cas&lt;/h2&gt;
&lt;p&gt;Pour cet exemple, on utilise les donn√©es du package de Hadley Wickham que l'on trouve dans &lt;code&gt;nycflights13&lt;/code&gt;. En particulier, la base &lt;code&gt;flights&lt;/code&gt; donne toutes les heures de d√©part et d'arriv√©e selon les a√©roports de d√©part et d'arriv√©e ainsi que les retards au d√©part et √† l'arriv√©e. La base &lt;code&gt;weather&lt;/code&gt; donne elle des indications m√©t√©o, heure par heure, dans chaque a√©roport. &lt;br&gt;
Commen√ßons par charger nos packages (n'oubliez pas de faire &lt;code&gt;install.packages("nom_pck")&lt;/code&gt; avant si vous ne l'avez jamais fait) et nos donn√©es : &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Les packages n√©cessaires&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tidyverse&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Regroupe diff√©rents packages, voir https://www.tidyverse.org/ &lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data.table&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;microbenchmark&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Pour les calculs de vitesse d&amp;#39;ex√©cution&lt;/span&gt;
&lt;span class="nf"&gt;library&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nycflights13&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;# Pour les donn√©es&lt;/span&gt;

&lt;span class="c1"&gt;# data.table pour tests avec data.table&lt;/span&gt;
&lt;span class="n"&gt;flightsdt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;weatherdt&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;as.data.table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="moyenne-des-retards-et-fusion-des-tables"&gt;Moyenne des retards et fusion des tables&lt;/h2&gt;
&lt;p&gt;Un rapide examen des bases vous montre que la premi√®re √©tape avant toute analyse est comme souvent de regrouper les √©l√©ments de flights par heure et a√©roport de d√©part pour pouvoir les fusionner avec la table weather, qui donnent les indications m√©t√©o minute par minute. On √©crit cette instruction de  3 mani√®res diff√©rentes :  &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;En base R&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;flights_time_hour&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;aggregate.data.frame&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="o"&gt;$&lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;output_base&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flights_time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                     &lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;FALSE&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;En dplyr&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;flights&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;group_by&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;time_hour&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;origin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;summarise&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;ungroup&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;%&amp;gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nf"&gt;inner_join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;weather&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;output_dplyr&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;En data.table&lt;/strong&gt;  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;output_DT&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flightsdt&lt;/span&gt;&lt;span class="p"&gt;[,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_perc_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arr_delay&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                                    &lt;/span&gt;&lt;span class="n"&gt;dep_perc_delay&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;mean&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;dep_delay&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                             &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)],&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="n"&gt;weatherdt&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                   &lt;/span&gt;&lt;span class="n"&gt;by&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;c&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;time_hour&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;origin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;On utilise la fonction &lt;code&gt;merge&lt;/code&gt; plut√¥t que &lt;code&gt;DT1[DT2, on = c("time_hour", "origin"), nomatch = 0]&lt;/code&gt; car on a constat√© qu'elle √©tait plus rapide, conform√©ment √† ce que montre bien cet &lt;a href="https://jozefhajnala.gitlab.io/r/r006-merge/" target="_blank"&gt;article du Jozef's Rblog&lt;/a&gt;.  &lt;/p&gt;
&lt;h2 id="comparaisons-des-vitesses-dexecution"&gt;Comparaisons des vitesses d'ex√©cution&lt;/h2&gt;
&lt;p&gt;Chacun jugera de la lisibilit√© de chacune de ces instructions, qui font toutes la m√™me chose, car c'est finalement assez subjectif. On donne ici les r√©sultats d'un &lt;code&gt;microbenchmark&lt;/code&gt; de ces instructions : &lt;/p&gt;
&lt;table class="dataframe"&gt;
&lt;caption&gt;Temps d'ex√©cution en millisecondes&lt;/caption&gt;
&lt;thead&gt;
    &lt;tr&gt;&lt;th scope=col&gt;expr&lt;/th&gt;&lt;th scope=col&gt;lq&lt;/th&gt;&lt;th scope=col&gt;mean&lt;/th&gt;&lt;th scope=col&gt;uq&lt;/th&gt;&lt;th scope=col&gt;neval&lt;/th&gt;&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
    &lt;tr&gt;&lt;td&gt;Base &lt;/td&gt;&lt;td&gt;1182.33161&lt;/td&gt;&lt;td&gt;1396.52780&lt;/td&gt;&lt;td&gt;1559.42968&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;dplyr&lt;/td&gt;&lt;td&gt; 223.45642&lt;/td&gt;&lt;td&gt; 313.16457&lt;/td&gt;&lt;td&gt; 360.95388&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
    &lt;tr&gt;&lt;td&gt;DT   &lt;/td&gt;&lt;td&gt;  22.83487&lt;/td&gt;&lt;td&gt;  24.68264&lt;/td&gt;&lt;td&gt;  26.32068&lt;/td&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Les r√©sultats sont tr√®s nettement en faveur des packages &lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt;. Ce dernier est m√™me assez largement le plus rapide, son avantage s'√©tant accru depuis la premi√®re version de cette article. Sans doute existe-t-il des moyens de plus optimiser l'instruction en base R, mais l√† n'est pas vraiment la question. On voit qu'avec une syntaxe simple et lisible, &lt;code&gt;dplyr&lt;/code&gt; et &lt;code&gt;data.table&lt;/code&gt; font beaucoup mieux en termes de vitesse d'ex√©cution que les fonctions de base R. &lt;/p&gt;</content><category term="R"></category><category term="R"></category><category term="Rstats"></category><category term="dplyr"></category><category term="data.table"></category><category term="benchmark"></category></entry></feed>